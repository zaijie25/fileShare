
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/hall/scripts/framework/net/dun/AppDunControl.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'a29e00GFsVIi62WKu8QRtA2', 'AppDunControl');
// hall/scripts/framework/net/dun/AppDunControl.ts

"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DUNSTATE = exports.DUNTYPE = void 0;
var HallStorageKey_1 = require("../../../logic/hallcommon/const/HallStorageKey");
var YunDun_1 = require("./YunDun");
var ZADun_1 = require("./ZADun");
var AliDun_1 = require("./AliDun");
var DUNTYPE;
(function (DUNTYPE) {
    DUNTYPE[DUNTYPE["None"] = 0] = "None";
    // T_DUN = 1,//T盾
    DUNTYPE[DUNTYPE["YUN_DUN"] = 2] = "YUN_DUN";
    DUNTYPE[DUNTYPE["ZA_DUN"] = 3] = "ZA_DUN";
    DUNTYPE[DUNTYPE["Ali_DUN"] = 4] = "Ali_DUN"; //阿里云游戏盾
})(DUNTYPE = exports.DUNTYPE || (exports.DUNTYPE = {}));
var DUNSTATE;
(function (DUNSTATE) {
    DUNSTATE[DUNSTATE["INIT"] = 10000] = "INIT";
    DUNSTATE[DUNSTATE["LOADING"] = 10001] = "LOADING";
    DUNSTATE[DUNSTATE["SUCCESS"] = 0] = "SUCCESS";
    DUNSTATE[DUNSTATE["FAILED"] = -1] = "FAILED";
})(DUNSTATE = exports.DUNSTATE || (exports.DUNSTATE = {}));
var AppDunControl = /** @class */ (function () {
    function AppDunControl() {
    }
    //设置盾配置
    AppDunControl.prototype.setDunConfig = function (cfg) {
        if (cfg == null && cfg.type == null)
            return;
        Global.Setting.storage.setObject(HallStorageKey_1.default.DunConfig, cfg);
    };
    //加载盾配置
    AppDunControl.prototype.loadDunConfig = function () {
        var cfg = Global.Setting.storage.getObject(HallStorageKey_1.default.DunConfig);
        if (cfg == null) {
            Logger.error("loadDunConfig cfg = null");
            return;
        }
        this.DUNConifg = cfg;
    };
    AppDunControl.prototype.init = function () {
        //初始化盾配置
        this.loadDunConfig();
        //初始化盾类
        this.initDun();
    };
    AppDunControl.prototype.initDun = function () {
        // this.tDun = new TDun(DUNTYPE.T_DUN);
        this.yunDun = new YunDun_1.default(DUNTYPE.YUN_DUN);
        this.zaDun = new ZADun_1.default(DUNTYPE.ZA_DUN);
        this.aliDun = new AliDun_1.default(DUNTYPE.Ali_DUN);
        //上次盾有启动成功记录没，有的话则优先启动
        if (this.DUNConifg) {
            // this.initDunSDKByStorage(DUNTYPE.T_DUN)
            this.initDunSDKByStorage(DUNTYPE.YUN_DUN);
            this.initDunSDKByStorage(DUNTYPE.ZA_DUN);
            this.initDunSDKByStorage(DUNTYPE.Ali_DUN);
        }
    };
    AppDunControl.prototype.initDunSDKByStorage = function (dunType) {
        var dunInitRecord = Global.Setting.storage.get(HallStorageKey_1.default.DunInitRecord + "_" + dunType);
        if (dunInitRecord) {
            this.initDunSDK(dunType);
        }
    };
    AppDunControl.prototype.initDunSDK = function (dunType) {
        if (!dunType) {
            Logger.log("initDunSDK dunType == null");
            return;
        }
        var isSupport = this.checkAppIsSupportDunByType(dunType);
        if (!isSupport) {
            Logger.log("initDunSDK App is not Support dunType =" + dunType);
            return;
        }
        if (!this.DUNConifg) {
            Logger.log("initDunSDK this.DUNConifg == null");
            this.loadDunConfig();
            if (!this.DUNConifg) {
                Logger.log("initDunSDK loadDunConfig DUNConifg == null");
                return;
            }
        }
        var dunObj = null;
        var dunConfig = null;
        switch (dunType) {
            // case DUNTYPE.T_DUN:
            //     dunObj = this.tDun
            //     dunConfig = this.DUNConifg.tdun
            //     break;
            case DUNTYPE.YUN_DUN:
                dunObj = this.yunDun;
                dunConfig = this.DUNConifg.yundun;
                break;
            case DUNTYPE.ZA_DUN:
                dunObj = this.zaDun;
                dunConfig = this.DUNConifg.zadun;
                break;
            case DUNTYPE.Ali_DUN:
                dunObj = this.aliDun;
                dunConfig = this.DUNConifg.alidun;
                break;
            default:
                break;
        }
        if (!dunObj) {
            Logger.log("initDunSDK dunObj == null dunType = " + dunType);
            return;
        }
        if (!dunConfig) {
            Logger.log("initDunSDK dunConfig == null dunType = " + dunType);
            return;
        }
        var isCfgValid = dunObj.checkCfgIsValid(dunConfig);
        if (isSupport && isCfgValid) {
            var dunInitState = dunObj.getInitState();
            if (!this.checkDunStateIsInit(dunInitState)) {
                dunObj.init(dunConfig);
            }
            else {
                Logger.log("initDunSDK checkDunStateIsInit == true " + dunType);
            }
        }
        else {
            Logger.log("initDunSDK  can't init dunType" + dunType);
        }
    };
    //检测当前版本是否支持指定类型盾
    AppDunControl.prototype.checkAppIsSupportDunByType = function (dunType) {
        var isSupport = false;
        var dunObj = null;
        switch (dunType) {
            // case DUNTYPE.T_DUN:
            //     dunObj = this.tDun
            //     break;
            case DUNTYPE.YUN_DUN:
                dunObj = this.yunDun;
                break;
            case DUNTYPE.ZA_DUN:
                dunObj = this.zaDun;
                break;
            case DUNTYPE.Ali_DUN:
                dunObj = this.aliDun;
                break;
            default:
                break;
        }
        if (dunObj) {
            isSupport = dunObj.isAppSupport();
        }
        return isSupport;
    };
    //判断盾是否初始化完成
    AppDunControl.prototype.checkDunStateIsInit = function (dunInitState) {
        if (dunInitState != null) {
            //还没开始出初始化或初始化失败
            if (dunInitState == DUNSTATE.INIT || dunInitState == DUNSTATE.FAILED) {
                return false;
            }
            else {
                return true;
            }
        }
        return false;
    };
    AppDunControl.prototype.getDunIsInitByType = function (dunType) {
        if (!dunType) {
            Logger.log("getDunIsInitByType dunType = null");
            return;
        }
        var isDunInit = false;
        var dunObj = null;
        switch (dunType) {
            // case DUNTYPE.T_DUN:
            //     dunObj = this.tDun;               
            //     break;
            case DUNTYPE.YUN_DUN:
                dunObj = this.yunDun;
                break;
            case DUNTYPE.ZA_DUN:
                dunObj = this.zaDun;
                break;
            case DUNTYPE.Ali_DUN:
                dunObj = this.aliDun;
                break;
            default:
                break;
        }
        if (dunObj) {
            isDunInit = dunObj.isInit();
        }
        //尝试启动SDK
        if (!isDunInit) {
            this.initDunSDK(dunType);
        }
        Logger.error("getDunIsInit dunType = " + dunType + " isDunInit = " + isDunInit);
        return isDunInit;
    };
    AppDunControl.prototype.getServerIPAndPort = function (host, lo_port, dunType, attr) {
        if (!host || !lo_port || !dunType) {
            Logger.log("getServerIPAndPort error host lo_port dunType ");
            return;
        }
        var isSupport = this.checkAppIsSupportDunByType(dunType);
        if (!isSupport) {
            Logger.log("getServerIPAndPort App not Support dunType = " + dunType);
            return;
        }
        var ipPortInfo = null;
        var dunObj = null;
        switch (dunType) {
            // case DUNTYPE.T_DUN:
            //     dunObj = this.tDun;
            //     break;
            case DUNTYPE.YUN_DUN:
                dunObj = this.yunDun;
                break;
            case DUNTYPE.ZA_DUN:
                dunObj = this.zaDun;
                break;
            case DUNTYPE.Ali_DUN:
                dunObj = this.aliDun;
                break;
            default:
                break;
        }
        if (dunObj) {
            ipPortInfo = dunObj.getServerIPAndPort(host, lo_port, attr);
        }
        return ipPortInfo;
    };
    //判断是否有盾在异步初始化中
    AppDunControl.prototype.checkIsDunLoading = function () {
        var dunInitState = 0;
        var isDunLoading = false;
        if (this.yunDun) {
            dunInitState = this.yunDun.getInitState();
            if (dunInitState == DUNSTATE.LOADING) {
                isDunLoading = true;
            }
        }
        if (this.zaDun) {
            dunInitState = this.zaDun.getInitState();
            if (dunInitState == DUNSTATE.LOADING) {
                isDunLoading = true;
            }
        }
        if (this.aliDun) {
            dunInitState = this.aliDun.getInitState();
            if (dunInitState == DUNSTATE.LOADING) {
                isDunLoading = true;
            }
        }
        return isDunLoading;
    };
    return AppDunControl;
}());
exports.default = AppDunControl;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcaGFsbFxcc2NyaXB0c1xcZnJhbWV3b3JrXFxuZXRcXGR1blxcQXBwRHVuQ29udHJvbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxpRkFBNEU7QUFHNUUsbUNBQThCO0FBQzlCLGlDQUE0QjtBQUM1QixtQ0FBOEI7QUFHOUIsSUFBWSxPQU1YO0FBTkQsV0FBWSxPQUFPO0lBQ2YscUNBQVEsQ0FBQTtJQUNSLGlCQUFpQjtJQUNqQiwyQ0FBVyxDQUFBO0lBQ1gseUNBQVUsQ0FBQTtJQUNWLDJDQUFXLENBQUEsQ0FBQyxRQUFRO0FBQ3hCLENBQUMsRUFOVyxPQUFPLEdBQVAsZUFBTyxLQUFQLGVBQU8sUUFNbEI7QUFFRCxJQUFZLFFBS1g7QUFMRCxXQUFZLFFBQVE7SUFDaEIsMkNBQVksQ0FBQTtJQUNaLGlEQUFlLENBQUE7SUFDZiw2Q0FBVyxDQUFBO0lBQ1gsNENBQVcsQ0FBQTtBQUNmLENBQUMsRUFMVyxRQUFRLEdBQVIsZ0JBQVEsS0FBUixnQkFBUSxRQUtuQjtBQUVEO0lBQUE7SUE2UUEsQ0FBQztJQTdQRyxPQUFPO0lBQ0Esb0NBQVksR0FBbkIsVUFBb0IsR0FBRztRQUNuQixJQUFJLEdBQUcsSUFBSSxJQUFJLElBQUksR0FBRyxDQUFDLElBQUksSUFBSSxJQUFJO1lBQy9CLE9BQU87UUFDWCxNQUFNLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsd0JBQWMsQ0FBQyxTQUFTLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDcEUsQ0FBQztJQUVELE9BQU87SUFDQSxxQ0FBYSxHQUFwQjtRQUNJLElBQUksR0FBRyxHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyx3QkFBYyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3JFLElBQUksR0FBRyxJQUFJLElBQUksRUFBRTtZQUNiLE1BQU0sQ0FBQyxLQUFLLENBQUMsMEJBQTBCLENBQUMsQ0FBQTtZQUN4QyxP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QyxNQUFNLENBQUM7Z0JBQ3JCLE1BQU07WUFDVjtnQkFDSSxNQUFNO1NBQ2I7UUFDRCxJQUFJLE1BQU0sRUFBRTtZQUNSLFVBQVUsR0FBRyxNQUFNLENBQUMsa0JBQWtCLENBQUMsSUFBSSxFQUFFLE9BQU8sRUFBQyxJQUFJLENBQUMsQ0FBQTtTQUM3RDtRQUVELE9BQU8sVUFBVSxDQUFBO0lBQ3JCLENBQUM7SUFFRCxlQUFlO0lBQ1IseUNBQWlCLEdBQXhCO1FBQ0ksSUFBSSxZQUFZLEdBQUcsQ0FBQyxDQUFDO1FBQ3JCLElBQUksWUFBWSxHQUFHLEtBQUssQ0FBQztRQUN6QixJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUU7WUFDYixZQUFZLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxZQUFZLEVBQUUsQ0FBQTtZQUN6QyxJQUFJLFlBQVksSUFBSSxRQUFRLENBQUMsT0FBTyxFQUFDO2dCQUNqQyxZQUFZLEdBQUcsSUFBSSxDQUFDO2FBQ3ZCO1NBQ0o7UUFFRCxJQUFJLElBQUksQ0FBQyxLQUFLLEVBQUM7WUFDWCxZQUFZLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLEVBQUUsQ0FBQTtZQUN4QyxJQUFJLFlBQVksSUFBSSxRQUFRLENBQUMsT0FBTyxFQUFDO2dCQUNqQyxZQUFZLEdBQUcsSUFBSSxDQUFDO2FBQ3ZCO1NBQ0o7UUFDRCxJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUM7WUFDWixZQUFZLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxZQUFZLEVBQUUsQ0FBQTtZQUN6QyxJQUFJLFlBQVksSUFBSSxRQUFRLENBQUMsT0FBTyxFQUFDO2dCQUNqQyxZQUFZLEdBQUcsSUFBSSxDQUFDO2FBQ3ZCO1NBQ0o7UUFDRCxPQUFPLFlBQVksQ0FBQTtJQUN2QixDQUFDO0lBS0wsb0JBQUM7QUFBRCxDQTdRQSxBQTZRQyxJQUFBIiwiZmlsZSI6IiIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEhhbGxTdG9yYWdlS2V5IGZyb20gXCIuLi8uLi8uLi9sb2dpYy9oYWxsY29tbW9uL2NvbnN0L0hhbGxTdG9yYWdlS2V5XCI7XHJcbmltcG9ydCB7IFJlcG9ydFRvb2wgfSBmcm9tIFwiLi4vLi4vLi4vbG9naWMvY29yZS90b29sL1JlcG9ydFRvb2xcIjtcclxuaW1wb3J0IElEdW4gZnJvbSBcIi4vSUR1blwiO1xyXG5pbXBvcnQgWXVuRHVuIGZyb20gXCIuL1l1bkR1blwiO1xyXG5pbXBvcnQgWkFEdW4gZnJvbSBcIi4vWkFEdW5cIjtcclxuaW1wb3J0IEFsaUR1biBmcm9tIFwiLi9BbGlEdW5cIjtcclxuXHJcblxyXG5leHBvcnQgZW51bSBEVU5UWVBFIHtcclxuICAgIE5vbmUgPSAwLC8v5peg55u+XHJcbiAgICAvLyBUX0RVTiA9IDEsLy9U55u+XHJcbiAgICBZVU5fRFVOID0gMiwvL+S6keebvlxyXG4gICAgWkFfRFVOID0gMywvL1pB55u+XHJcbiAgICBBbGlfRFVOID0gNCAvL+mYv+mHjOS6kea4uOaIj+ebvlxyXG59XHJcblxyXG5leHBvcnQgZW51bSBEVU5TVEFURSB7XHJcbiAgICBJTklUID0gMTAwMDAsXHJcbiAgICBMT0FESU5HID0gMTAwMDEsXHJcbiAgICBTVUNDRVNTID0gMCxcclxuICAgIEZBSUxFRCA9IC0xXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEFwcER1bkNvbnRyb2wge1xyXG4gICAgLyoqXHJcbiAgICAgKiB7XCJ0ZHVuXCI6e2tleTp4eHh4eH0sXCJ5dW5kdW5cIjp7XCJhY2Nlc3NLZXlcIjp4eHh4LFwidXVpZFwiOnh4eHh9fVxyXG4gICAgICogXHJcbiAgICAgKiAqKi9cclxuICAgIHByaXZhdGUgRFVOQ29uaWZnOiBhbnk7XHJcblxyXG4gICAgLy9U55u+XHJcbiAgICAvLyBwcml2YXRlIHREdW46IFREdW47XHJcbiAgICAvL+S6keebvlxyXG4gICAgcHJpdmF0ZSB5dW5EdW46IFl1bkR1bjtcclxuICAgIC8vWkHnm75cclxuICAgIHByaXZhdGUgemFEdW46WkFEdW47XHJcbiAgICAvL+mYv+mHjOS6kea4uOaIj+ebvlxyXG4gICAgcHJpdmF0ZSBhbGlEdW46QWxpRHVuO1xyXG5cclxuICAgIC8v6K6+572u55u+6YWN572uXHJcbiAgICBwdWJsaWMgc2V0RHVuQ29uZmlnKGNmZykge1xyXG4gICAgICAgIGlmIChjZmcgPT0gbnVsbCAmJiBjZmcudHlwZSA9PSBudWxsKVxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgR2xvYmFsLlNldHRpbmcuc3RvcmFnZS5zZXRPYmplY3QoSGFsbFN0b3JhZ2VLZXkuRHVuQ29uZmlnLCBjZmcpO1xyXG4gICAgfVxyXG5cclxuICAgIC8v5Yqg6L2955u+6YWN572uXHJcbiAgICBwdWJsaWMgbG9hZER1bkNvbmZpZygpIHtcclxuICAgICAgICBsZXQgY2ZnID0gR2xvYmFsLlNldHRpbmcuc3RvcmFnZS5nZXRPYmplY3QoSGFsbFN0b3JhZ2VLZXkuRHVuQ29uZmlnKTtcclxuICAgICAgICBpZiAoY2ZnID09IG51bGwpIHtcclxuICAgICAgICAgICAgTG9nZ2VyLmVycm9yKFwibG9hZER1bkNvbmZpZyBjZmcgPSBudWxsXCIpXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5EVU5Db25pZmcgPSBjZmc7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGluaXQoKSB7XHJcbiAgICAgICAgLy/liJ3lp4vljJbnm77phY3nva5cclxuICAgICAgICB0aGlzLmxvYWREdW5Db25maWcoKTtcclxuICAgICAgICAvL+WIneWni+WMluebvuexu1xyXG4gICAgICAgIHRoaXMuaW5pdER1bigpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaW5pdER1bigpIHtcclxuICAgICAgICAvLyB0aGlzLnREdW4gPSBuZXcgVER1bihEVU5UWVBFLlRfRFVOKTtcclxuICAgICAgICB0aGlzLnl1bkR1biA9IG5ldyBZdW5EdW4oRFVOVFlQRS5ZVU5fRFVOKTtcclxuICAgICAgICB0aGlzLnphRHVuID0gbmV3IFpBRHVuKERVTlRZUEUuWkFfRFVOKTtcclxuICAgICAgICB0aGlzLmFsaUR1biA9IG5ldyBBbGlEdW4oRFVOVFlQRS5BbGlfRFVOKTtcclxuICAgICAgICAvL+S4iuasoeebvuacieWQr+WKqOaIkOWKn+iusOW9leayoe+8jOacieeahOivneWImeS8mOWFiOWQr+WKqFxyXG4gICAgICAgIGlmICh0aGlzLkRVTkNvbmlmZykge1xyXG4gICAgICAgICAgICAvLyB0aGlzLmluaXREdW5TREtCeVN0b3JhZ2UoRFVOVFlQRS5UX0RVTilcclxuICAgICAgICAgICAgdGhpcy5pbml0RHVuU0RLQnlTdG9yYWdlKERVTlRZUEUuWVVOX0RVTilcclxuICAgICAgICAgICAgdGhpcy5pbml0RHVuU0RLQnlTdG9yYWdlKERVTlRZUEUuWkFfRFVOKVxyXG4gICAgICAgICAgICB0aGlzLmluaXREdW5TREtCeVN0b3JhZ2UoRFVOVFlQRS5BbGlfRFVOKVxyXG4gICAgICAgICAgICBcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpbml0RHVuU0RLQnlTdG9yYWdlKGR1blR5cGUpIHtcclxuICAgICAgICBsZXQgZHVuSW5pdFJlY29yZCA9IEdsb2JhbC5TZXR0aW5nLnN0b3JhZ2UuZ2V0KEhhbGxTdG9yYWdlS2V5LkR1bkluaXRSZWNvcmQgKyBcIl9cIiArIGR1blR5cGUpXHJcbiAgICAgICAgaWYgKGR1bkluaXRSZWNvcmQpIHtcclxuICAgICAgICAgICAgdGhpcy5pbml0RHVuU0RLKGR1blR5cGUpXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwdWJsaWMgaW5pdER1blNESyhkdW5UeXBlKSB7XHJcbiAgICAgICAgaWYgKCFkdW5UeXBlKSB7XHJcbiAgICAgICAgICAgIExvZ2dlci5sb2coXCJpbml0RHVuU0RLIGR1blR5cGUgPT0gbnVsbFwiKVxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBpc1N1cHBvcnQgPSB0aGlzLmNoZWNrQXBwSXNTdXBwb3J0RHVuQnlUeXBlKGR1blR5cGUpXHJcbiAgICAgICAgaWYgKCFpc1N1cHBvcnQpe1xyXG4gICAgICAgICAgICBMb2dnZXIubG9nKFwiaW5pdER1blNESyBBcHAgaXMgbm90IFN1cHBvcnQgZHVuVHlwZSA9XCIgKyBkdW5UeXBlKVxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghdGhpcy5EVU5Db25pZmcpIHtcclxuICAgICAgICAgICAgTG9nZ2VyLmxvZyhcImluaXREdW5TREsgdGhpcy5EVU5Db25pZmcgPT0gbnVsbFwiKVxyXG4gICAgICAgICAgICB0aGlzLmxvYWREdW5Db25maWcoKVxyXG4gICAgICAgICAgICBpZiAoIXRoaXMuRFVOQ29uaWZnKSB7XHJcbiAgICAgICAgICAgICAgICBMb2dnZXIubG9nKFwiaW5pdER1blNESyBsb2FkRHVuQ29uZmlnIERVTkNvbmlmZyA9PSBudWxsXCIpXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgbGV0IGR1bk9iajogSUR1biA9IG51bGxcclxuICAgICAgICBsZXQgZHVuQ29uZmlnID0gbnVsbFxyXG4gICAgICAgIHN3aXRjaCAoZHVuVHlwZSkge1xyXG4gICAgICAgICAgICAvLyBjYXNlIERVTlRZUEUuVF9EVU46XHJcbiAgICAgICAgICAgIC8vICAgICBkdW5PYmogPSB0aGlzLnREdW5cclxuICAgICAgICAgICAgLy8gICAgIGR1bkNvbmZpZyA9IHRoaXMuRFVOQ29uaWZnLnRkdW5cclxuICAgICAgICAgICAgLy8gICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIERVTlRZUEUuWVVOX0RVTjpcclxuICAgICAgICAgICAgICAgIGR1bk9iaiA9IHRoaXMueXVuRHVuO1xyXG4gICAgICAgICAgICAgICAgZHVuQ29uZmlnID0gdGhpcy5EVU5Db25pZmcueXVuZHVuXHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBEVU5UWVBFLlpBX0RVTjpcclxuICAgICAgICAgICAgICAgIGR1bk9iaiA9IHRoaXMuemFEdW47XHJcbiAgICAgICAgICAgICAgICBkdW5Db25maWcgPSB0aGlzLkRVTkNvbmlmZy56YWR1blxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgRFVOVFlQRS5BbGlfRFVOOlxyXG4gICAgICAgICAgICAgICAgZHVuT2JqID0gdGhpcy5hbGlEdW47XHJcbiAgICAgICAgICAgICAgICBkdW5Db25maWcgPSB0aGlzLkRVTkNvbmlmZy5hbGlkdW5cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghZHVuT2JqKSB7XHJcbiAgICAgICAgICAgIExvZ2dlci5sb2coXCJpbml0RHVuU0RLIGR1bk9iaiA9PSBudWxsIGR1blR5cGUgPSBcIiArIGR1blR5cGUpXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCFkdW5Db25maWcpIHtcclxuICAgICAgICAgICAgTG9nZ2VyLmxvZyhcImluaXREdW5TREsgZHVuQ29uZmlnID09IG51bGwgZHVuVHlwZSA9IFwiICsgZHVuVHlwZSlcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgXHJcbiAgICAgICAgbGV0IGlzQ2ZnVmFsaWQgPSBkdW5PYmouY2hlY2tDZmdJc1ZhbGlkKGR1bkNvbmZpZylcclxuICAgICAgICBpZiAoaXNTdXBwb3J0ICYmIGlzQ2ZnVmFsaWQpIHtcclxuICAgICAgICAgICAgbGV0IGR1bkluaXRTdGF0ZSA9IGR1bk9iai5nZXRJbml0U3RhdGUoKVxyXG4gICAgICAgICAgICBpZiAoIXRoaXMuY2hlY2tEdW5TdGF0ZUlzSW5pdChkdW5Jbml0U3RhdGUpKSB7XHJcbiAgICAgICAgICAgICAgICBkdW5PYmouaW5pdChkdW5Db25maWcpXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBMb2dnZXIubG9nKFwiaW5pdER1blNESyBjaGVja0R1blN0YXRlSXNJbml0ID09IHRydWUgXCIgKyBkdW5UeXBlKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgTG9nZ2VyLmxvZyhcImluaXREdW5TREsgIGNhbid0IGluaXQgZHVuVHlwZVwiICsgZHVuVHlwZSlcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy/mo4DmtYvlvZPliY3niYjmnKzmmK/lkKbmlK/mjIHmjIflrprnsbvlnovnm75cclxuICAgIHB1YmxpYyBjaGVja0FwcElzU3VwcG9ydER1bkJ5VHlwZShkdW5UeXBlKSB7XHJcbiAgICAgICAgbGV0IGlzU3VwcG9ydCA9IGZhbHNlO1xyXG4gICAgICAgIGxldCBkdW5PYmo6IElEdW4gPSBudWxsXHJcbiAgICAgICAgc3dpdGNoIChkdW5UeXBlKSB7XHJcbiAgICAgICAgICAgIC8vIGNhc2UgRFVOVFlQRS5UX0RVTjpcclxuICAgICAgICAgICAgLy8gICAgIGR1bk9iaiA9IHRoaXMudER1blxyXG4gICAgICAgICAgICAvLyAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgRFVOVFlQRS5ZVU5fRFVOOlxyXG4gICAgICAgICAgICAgICAgZHVuT2JqID0gdGhpcy55dW5EdW5cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIERVTlRZUEUuWkFfRFVOOlxyXG4gICAgICAgICAgICAgICAgZHVuT2JqID0gdGhpcy56YUR1blxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgRFVOVFlQRS5BbGlfRFVOOlxyXG4gICAgICAgICAgICAgICAgZHVuT2JqID0gdGhpcy5hbGlEdW5cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChkdW5PYmope1xyXG4gICAgICAgICAgICBpc1N1cHBvcnQgPSBkdW5PYmouaXNBcHBTdXBwb3J0KClcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgcmV0dXJuIGlzU3VwcG9ydFxyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvL+WIpOaWreebvuaYr+WQpuWIneWni+WMluWujOaIkFxyXG4gICAgcHVibGljIGNoZWNrRHVuU3RhdGVJc0luaXQoZHVuSW5pdFN0YXRlKSB7XHJcbiAgICAgICAgaWYgKGR1bkluaXRTdGF0ZSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgIC8v6L+Y5rKh5byA5aeL5Ye65Yid5aeL5YyW5oiW5Yid5aeL5YyW5aSx6LSlXHJcbiAgICAgICAgICAgIGlmIChkdW5Jbml0U3RhdGUgPT0gRFVOU1RBVEUuSU5JVCB8fCBkdW5Jbml0U3RhdGUgPT0gRFVOU1RBVEUuRkFJTEVEKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHB1YmxpYyBnZXREdW5Jc0luaXRCeVR5cGUoZHVuVHlwZTogRFVOVFlQRSkge1xyXG4gICAgICAgIGlmICghZHVuVHlwZSkge1xyXG4gICAgICAgICAgICBMb2dnZXIubG9nKFwiZ2V0RHVuSXNJbml0QnlUeXBlIGR1blR5cGUgPSBudWxsXCIpXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IGlzRHVuSW5pdCA9IGZhbHNlO1xyXG4gICAgICAgIGxldCBkdW5PYmogOklEdW4gPSBudWxsXHJcbiAgICAgICAgc3dpdGNoIChkdW5UeXBlKSB7XHJcbiAgICAgICAgICAgIC8vIGNhc2UgRFVOVFlQRS5UX0RVTjpcclxuICAgICAgICAgICAgLy8gICAgIGR1bk9iaiA9IHRoaXMudER1bjsgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIERVTlRZUEUuWVVOX0RVTjpcclxuICAgICAgICAgICAgICAgIGR1bk9iaiA9IHRoaXMueXVuRHVuO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgRFVOVFlQRS5aQV9EVU46XHJcbiAgICAgICAgICAgICAgICBkdW5PYmogPSB0aGlzLnphRHVuO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgRFVOVFlQRS5BbGlfRFVOOlxyXG4gICAgICAgICAgICAgICAgZHVuT2JqID0gdGhpcy5hbGlEdW47XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZHVuT2JqKXtcclxuICAgICAgICAgICAgaXNEdW5Jbml0ID0gZHVuT2JqLmlzSW5pdCgpXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvL+WwneivleWQr+WKqFNES1xyXG4gICAgICAgIGlmICghaXNEdW5Jbml0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5pdER1blNESyhkdW5UeXBlKVxyXG4gICAgICAgIH1cclxuICAgICAgICBMb2dnZXIuZXJyb3IoXCJnZXREdW5Jc0luaXQgZHVuVHlwZSA9IFwiICsgZHVuVHlwZSArIFwiIGlzRHVuSW5pdCA9IFwiICsgaXNEdW5Jbml0KVxyXG4gICAgICAgIHJldHVybiBpc0R1bkluaXQ7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHB1YmxpYyBnZXRTZXJ2ZXJJUEFuZFBvcnQoaG9zdDogc3RyaW5nLCBsb19wb3J0OiBudW1iZXIsIGR1blR5cGU6IG51bWJlcixhdHRyOmFueSkge1xyXG4gICAgICAgIGlmICghaG9zdCB8fCAhbG9fcG9ydCB8fCAhZHVuVHlwZSkge1xyXG4gICAgICAgICAgICBMb2dnZXIubG9nKFwiZ2V0U2VydmVySVBBbmRQb3J0IGVycm9yIGhvc3QgbG9fcG9ydCBkdW5UeXBlIFwiKVxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBpc1N1cHBvcnQgPSB0aGlzLmNoZWNrQXBwSXNTdXBwb3J0RHVuQnlUeXBlKGR1blR5cGUpXHJcbiAgICAgICAgaWYgKCFpc1N1cHBvcnQpe1xyXG4gICAgICAgICAgICBMb2dnZXIubG9nKFwiZ2V0U2VydmVySVBBbmRQb3J0IEFwcCBub3QgU3VwcG9ydCBkdW5UeXBlID0gXCIgKyBkdW5UeXBlKVxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBpcFBvcnRJbmZvID0gbnVsbFxyXG4gICAgICAgIGxldCBkdW5PYmo6IElEdW4gPSBudWxsXHJcbiAgICAgICAgc3dpdGNoIChkdW5UeXBlKSB7XHJcbiAgICAgICAgICAgIC8vIGNhc2UgRFVOVFlQRS5UX0RVTjpcclxuICAgICAgICAgICAgLy8gICAgIGR1bk9iaiA9IHRoaXMudER1bjtcclxuICAgICAgICAgICAgLy8gICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIERVTlRZUEUuWVVOX0RVTjpcclxuICAgICAgICAgICAgICAgIGR1bk9iaiA9IHRoaXMueXVuRHVuO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgRFVOVFlQRS5aQV9EVU46XHJcbiAgICAgICAgICAgICAgICBkdW5PYmogPSB0aGlzLnphRHVuO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgRFVOVFlQRS5BbGlfRFVOOlxyXG4gICAgICAgICAgICAgICAgZHVuT2JqID0gdGhpcy5hbGlEdW47XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZHVuT2JqKSB7XHJcbiAgICAgICAgICAgIGlwUG9ydEluZm8gPSBkdW5PYmouZ2V0U2VydmVySVBBbmRQb3J0KGhvc3QsIGxvX3BvcnQsYXR0cilcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBpcFBvcnRJbmZvXHJcbiAgICB9XHJcblxyXG4gICAgLy/liKTmlq3mmK/lkKbmnInnm77lnKjlvILmraXliJ3lp4vljJbkuK1cclxuICAgIHB1YmxpYyBjaGVja0lzRHVuTG9hZGluZygpe1xyXG4gICAgICAgIGxldCBkdW5Jbml0U3RhdGUgPSAwO1xyXG4gICAgICAgIGxldCBpc0R1bkxvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICBpZiAodGhpcy55dW5EdW4pIHtcclxuICAgICAgICAgICAgZHVuSW5pdFN0YXRlID0gdGhpcy55dW5EdW4uZ2V0SW5pdFN0YXRlKClcclxuICAgICAgICAgICAgaWYgKGR1bkluaXRTdGF0ZSA9PSBEVU5TVEFURS5MT0FESU5HKXtcclxuICAgICAgICAgICAgICAgIGlzRHVuTG9hZGluZyA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLnphRHVuKXtcclxuICAgICAgICAgICAgZHVuSW5pdFN0YXRlID0gdGhpcy56YUR1bi5nZXRJbml0U3RhdGUoKVxyXG4gICAgICAgICAgICBpZiAoZHVuSW5pdFN0YXRlID09IERVTlNUQVRFLkxPQURJTkcpe1xyXG4gICAgICAgICAgICAgICAgaXNEdW5Mb2FkaW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5hbGlEdW4pe1xyXG4gICAgICAgICAgICBkdW5Jbml0U3RhdGUgPSB0aGlzLmFsaUR1bi5nZXRJbml0U3RhdGUoKVxyXG4gICAgICAgICAgICBpZiAoZHVuSW5pdFN0YXRlID09IERVTlNUQVRFLkxPQURJTkcpe1xyXG4gICAgICAgICAgICAgICAgaXNEdW5Mb2FkaW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gaXNEdW5Mb2FkaW5nXHJcbiAgICB9XHJcblxyXG5cclxuXHJcblxyXG59Il19