{"version":3,"sources":["assets\\bbwz\\Bbwz\\scripts\\subview\\BbwzChipItem.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import BbwzData from \"../data/BbwzData\";\r\nimport BbwzBetGameTool from \"../tool/BbwzBetGameTool\";\r\nimport BbwzBaseView from \"./BbwzBaseView\";\r\nimport BbwzPathHelper from \"../tool/BbwzPathHelper\";\r\nimport BbwzConstDefine from \"../data/BbwzConstDefine\";\r\n\r\n/**\r\n * 游戏层 单个筹码的控制组件\r\n */\r\nexport default class BbwzChipItem extends BbwzBaseView {\r\n\r\n    /**\r\n     * 筹码精灵\r\n     */\r\n    spriteIcon: cc.Sprite = null;\r\n\r\n    /**\r\n     * 属于哪个玩家\r\n     */\r\n    playerIndex = -1;\r\n    /**\r\n     * 下注在哪个区域\r\n     */\r\n    betAreaIndex = -1;\r\n    /**\r\n     * 筹码面值索引\r\n     */\r\n    chipIndex = 0;\r\n    /**\r\n     * 筹码面值\r\n     */\r\n    chipNumber = 1;\r\n    /**\r\n     * 动画对象\r\n     */\r\n    tween: cc.Tween = null;\r\n\r\n    constructor(node: cc.Node) {\r\n        super();\r\n        this.setNode(node);\r\n    }\r\n\r\n    initView() {\r\n        this.spriteIcon = this.node.getComponent(cc.Sprite)\r\n    }\r\n\r\n    /**\r\n     * 更新显示\r\n     */\r\n    updateUI() {\r\n        let strArr = BbwzData.instance.getBetChipsIconStr();\r\n        let str = strArr[this.chipIndex];\r\n        Global.ResourceManager.loadBundleAutoAtlas(BbwzConstDefine.GAME_ID,this.spriteIcon, BbwzPathHelper.gameTexturePath + \"atlas/dynamic/atlas_dynamic\", str, null, true);\r\n    }\r\n\r\n    /**\r\n     * 设置筹码\r\n     * @param index \r\n     */\r\n    setChipIndex(index: number) {\r\n        this.chipIndex = index;\r\n        this.chipNumber = BbwzData.instance.chipList[index];\r\n        this.updateUI();\r\n    }\r\n\r\n    /**\r\n     * 设置筹码\r\n     * @param chipNum \r\n     */\r\n    setChipNumber(chipNum: number) {\r\n        this.chipIndex = BbwzData.instance.chipList.indexOf(chipNum);\r\n        this.chipNumber = chipNum;\r\n        this.updateUI();\r\n    }\r\n\r\n    /**\r\n     * 停止动画\r\n     */\r\n    stopAnim() {\r\n        this.node.scale = 1;\r\n        if (this.tween) {\r\n            this.tween.stop();\r\n            this.tween = null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 设置数据\r\n     * @param playerIndex \r\n     * @param chipNum \r\n     */\r\n    setData(playerIndex: number, chipNum: number) {\r\n        this.playerIndex = playerIndex;\r\n        this.setChipNumber(chipNum);\r\n    }\r\n\r\n    /**\r\n     * 随机旋转\r\n     */\r\n    randomRotate() {\r\n        let rotation = this.getRandomRotation();\r\n        this.node.angle = -rotation;\r\n    }\r\n\r\n    /**\r\n     * 获得随机旋转角度\r\n     */\r\n    getRandomRotation() {\r\n        let rotation = BbwzBetGameTool.random() * 120 - 60;\r\n        return rotation;\r\n    }\r\n\r\n    /**\r\n     * 下注飞筹码动画\r\n     */\r\n    betFlyAnim(startPos: cc.Vec2, endPos: cc.Vec2) {\r\n        this.stopAnim();\r\n        this.node.setPosition(startPos);\r\n        this.tween = Game.Tween.get(this.node);\r\n        let animTime = startPos.sub(endPos).mag() / 1000;//1500\r\n        let randomRotation = this.getRandomRotation() + 1080;\r\n        this.tween.to(animTime, { position: cc.v2(endPos.x, endPos.y), angle : randomRotation }, cc.easeQuadraticActionOut())\r\n            .to(0.15, { scale: 1.1 }, cc.easeIn(1))\r\n            .to(0.1, { scale: 1 }, cc.easeOut(1))\r\n            .start();\r\n    }\r\n\r\n    /**\r\n     * 尝试设置最大筹码\r\n     * @param money \r\n     */\r\n    tryBigest(money: number) {\r\n        var chipIndex = BbwzData.instance.tryBigest(money);\r\n        this.setChipIndex(chipIndex);\r\n    }\r\n\r\n    /**\r\n     * 尝试设置最合适的筹码\r\n     * @param money \r\n     */\r\n    tryRight(money: number) {\r\n        var chipIndex = BbwzData.instance.tryRight(money);\r\n        this.setChipIndex(chipIndex);\r\n    }\r\n\r\n\r\n    /**\r\n     * 聚合动画\r\n     * @param animTime \r\n     * @param endPos \r\n     * @param complete \r\n     */\r\n    playItemMoveToBank(animTime: number, endPos: cc.Vec2, complete: Function = null) {\r\n        this.stopAnim();\r\n        this.tween = Game.Tween.get(this.node);\r\n        this.tween.to(animTime, { position: endPos }, null)\r\n            .call(()=>{\r\n                this.stopAnim();\r\n                if (complete) complete();\r\n            }).start();\r\n    }\r\n\r\n    /**\r\n     * 去往返回区动画\r\n     * @param animTime \r\n     * @param endPos \r\n     * @param complete \r\n     */\r\n    playItemMoveToArea(animTime: number, endPos: cc.Vec2, complete: Function = null) {\r\n        this.stopAnim();\r\n        this.tween = Game.Tween.get(this.node);\r\n        this.tween.to(animTime, { position: endPos }, { progress: null, easing: \"sineIn\" })\r\n            .call(()=>{\r\n                this.stopAnim();\r\n                if (complete) complete();\r\n            }).start();\r\n    }\r\n\r\n    /**\r\n     * 去往头像动画\r\n     * @param endPos \r\n     * @param index \r\n     * @param complete \r\n     */\r\n    public playOneChipAwardAnim(endPos: cc.Vec2, index: number, complete: Function = null) {\r\n        this.stopAnim();\r\n        let animTime = endPos.sub(this.node.position).mag() / 1200;\r\n        let delayTime = index * 0.001;\r\n\r\n        this.tween = Game.Tween.get(this.node);\r\n        this.tween.delay(delayTime).to(animTime, { position: endPos }, { progress: null, easing: \"sineIn\" })\r\n            .call(()=>{\r\n                this.stopAnim();\r\n                if (complete) complete();\r\n            }).start();\r\n    }\r\n\r\n    public reset(){\r\n        this.stopAnim();\r\n        if (this.node) {\r\n            this.spriteIcon.spriteFrame = null;\r\n            this.active = true;\r\n        }\r\n        this.playerIndex = -1;\r\n        this.betAreaIndex = -1;\r\n    }\r\n}\r\n"]}