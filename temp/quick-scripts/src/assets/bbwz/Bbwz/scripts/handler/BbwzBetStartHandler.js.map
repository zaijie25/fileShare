{"version":3,"sources":["assets\\bbwz\\Bbwz\\scripts\\handler\\BbwzBetStartHandler.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import BbwzSocketBaseHandler from \"./BbwzSocketBaseHandler\";\r\nimport BbwzConstDefine, { BbwzGameState } from \"../data/BbwzConstDefine\";\r\nimport BbwzData from \"../data/BbwzData\";\r\nimport BbwzDriver from \"../BbwzDriver\";\r\n\r\nconst time_daojishi_bet = 1.0;  //倒计时显示需要的时间\r\nconst time_start_bet = 1.5;     //开始下注动画需要的时间\r\nconst time_nothing = 8.0;       //空置时间\r\nconst time_vs = 1.0;            //龙vs虎动画需要的时间\r\n// const time_one_deal = 0.5;      //发2组牌\r\n// const delay_one_deal = 0.2;     // 发牌间隔\r\n\r\n/**\r\n * 开始下注 e1\r\n */\r\nexport class BbwzBetStartHandler extends BbwzSocketBaseHandler {\r\n\r\n    handleData(data) {\r\n        BbwzDriver.instance.gameUI.clearByRound();\r\n        cc.log(\"BetStartHandler----------handleData------data = \" + JSON.stringify(data));\r\n        //修正时间\r\n        data._para.time /= 1000;\r\n        var currTime = Date.now();\r\n        var jiangeTime = currTime - data._receiveTime;\r\n        var totalSec = data._para.time - jiangeTime / 1000;\r\n        var dataStr = JSON.stringify(data);\r\n        var msgArr = [];\r\n\r\n        //闹钟倒计时\r\n        totalSec -= time_daojishi_bet;\r\n        var msg = JSON.parse(dataStr);\r\n        msg._cmd = BbwzConstDefine.GameStart_Daojishi;\r\n        msg._needPlay = totalSec >= 0;\r\n        msg.time = time_daojishi_bet;\r\n        msgArr.unshift(msg);\r\n\r\n        //开始下注的动画\r\n        totalSec -= time_start_bet;\r\n        var msg = JSON.parse(dataStr);\r\n        msg._cmd = BbwzConstDefine.GameStart_Animation;\r\n        msg._needPlay = totalSec >= 0;\r\n        msg.time = time_start_bet;\r\n        msgArr.unshift(msg);\r\n\r\n        //空置\r\n        totalSec -= time_nothing;\r\n\r\n        Game.Event.event(Game.EVENT_UNSHFIT_MSGLIST, msgArr);\r\n\r\n        //更新续压数据\r\n        BbwzData.instance.updatePreContinueData(data._para.my_bet);\r\n        //设置牌桌已下注的数据\r\n        BbwzData.instance.setTableBetData(data._para);\r\n\r\n        //更新在线玩家数量\r\n        BbwzData.instance.onlinePlayer = data._para.p_count;\r\n        //更新显示在线玩家数量\r\n        BbwzDriver.instance.gameUI.updateOnlinePlayer(data._para.p_count);\r\n        // 更新下注文本\r\n        BbwzDriver.instance.gameUI.betAreaRootView.updateSelfBetLabel(BbwzData.instance.gameTableBetInfo);\r\n        BbwzDriver.instance.gameUI.betAreaRootView.updateTotalBetLabel(BbwzData.instance.gameTableBetInfo);\r\n    }\r\n}\r\n\r\n\r\n/**\r\n * 开始下注 e1-x 龙vs虎动画\r\n */\r\nexport class BbwzBetStartVSHandler extends BbwzSocketBaseHandler {\r\n\r\n    handleData(data) {\r\n        // if (data._needPlay) {\r\n        //     Game.Event.event(Game.EVENT_ADDTIMELOCK, \"BetStartVS\", data.time);\r\n        // }\r\n        // //设置状态\r\n        // BbwzData.instance.gameState = BbwzGameState.Deal;\r\n        // BbwzDriver.instance.gameUI.stateView.UpdateUI(data._needPlay);\r\n        // //更新显示下注按钮\r\n        // BbwzDriver.instance.gameUI.updateBetSelectButton();\r\n    }\r\n}\r\n\r\n\r\n/**\r\n * 开始下注 e1-1 播放“开始下注”的动画\r\n */\r\nexport class BbwzBetStartAnimationHandler extends BbwzSocketBaseHandler {\r\n\r\n    handleData(data) {\r\n        if (data._needPlay) {\r\n            Game.Event.event(Game.EVENT_ADDTIMELOCK, \"BetStartAnimation\", data.time);\r\n        }\r\n\r\n        BbwzData.instance.gameState = BbwzGameState.BetStart;\r\n        BbwzDriver.instance.gameUI.stateView.runState(BbwzData.instance.gameState, data._needPlay);\r\n        //更新显示下注按钮\r\n        BbwzDriver.instance.gameUI.updateBetSelectButton();\r\n    }\r\n}\r\n\r\n/**\r\n * 开始下注 e1-0 发牌的动画\r\n */\r\nexport class BbwzBetStartFapaiHandler extends BbwzSocketBaseHandler {\r\n    handleData(data) {\r\n        // //设置游戏状态\r\n        // BbwzData.instance.gameState = BbwzGameState.Deal;\r\n        \r\n        // BbwzDriver.instance.gameUI.stateView.runState(BbwzData.instance.gameState, false);\r\n    }\r\n}\r\n\r\n/**\r\n * 开始下注 e1-2 闹钟倒计时\r\n */\r\nexport class BbwzBetStartDaojishiHandler extends BbwzSocketBaseHandler {\r\n\r\n    handleData(data) {\r\n        //设置倒计时时间\r\n        var currTime = Date.now();\r\n        var jiangeTime = currTime - data._receiveTime;\r\n        BbwzData.instance.remainTime = Math.floor(Math.max(0.5, data._para.time - jiangeTime / 1000));\r\n\r\n        //设置状态\r\n        BbwzData.instance.gameState = BbwzGameState.Bet;\r\n        BbwzDriver.instance.gameUI.stateView.runState(BbwzData.instance.gameState, false);\r\n        BbwzDriver.instance.gameUI.stateView.setTimeRunConfig(BbwzData.instance.remainTime, (leftTime: number)=>{\r\n            if (leftTime > 0 && leftTime <= 3)\r\n                Global.Audio.playBundleSound(BbwzConstDefine.GAME_ID,BbwzConstDefine.SOUND_DAOJISHI);\r\n            if (leftTime == 0)\r\n                Global.Audio.playBundleSound(BbwzConstDefine.GAME_ID,BbwzConstDefine.SOUND_DAOJISHI_END);\r\n        }, this);\r\n        //更新显示下注按钮\r\n        BbwzDriver.instance.gameUI.updateBetSelectButton();\r\n        //允许飞筹码\r\n        BbwzDriver.instance.gameUI.betEnable = true;\r\n    }\r\n}"]}