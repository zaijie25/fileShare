{"version":3,"sources":["assets\\hall\\scripts\\logic\\hall\\tool\\HallPopMsgHelper.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { SceneType } from \"../../core/scene/SceneManager\";\r\n\r\nexport enum BindAwardUIType{ //弹出AwardUI方式\r\n    onlyBindPoint = 1,  //绑定手机后只有bind_point\r\n    onlyPhonePoint = 2, //绑定手机后只有phone_point\r\n    bindPoint = 3,      //绑定手机后有bind_point,phone_point,但是先弹bind_point\r\n    phonePoint = 4,     //绑定手机后有bind_point,phone_point,弹phone_point\r\n    share = 5,          //分享\r\n    MegePoint           //合服奖励弹窗\r\n\r\n}\r\n\r\nexport enum PopWndName{\r\n    ForceUpdate = 0,\r\n    Spread = 1,\r\n    Mail = 2,\r\n    ActivityCenter = 3,\r\n    MegePoint, //合服奖励弹窗\r\n    BindPhone ,\r\n    BindGiftGet,    //绑定手机后bind_point\r\n    PhoneGiftGet,   //绑定手机后phone_point\r\n    RebateGet,\r\n    // 顺序低即优先级高, 上面是插入式弹窗(弹窗里点开的弹窗) 优先级要比下面的高\r\n    Notice,     \r\n    BindGift\r\n   \r\n    \r\n}\r\n\r\nexport default class HallPopMsgHelper{\r\n    private static _instance: HallPopMsgHelper = null;\r\n    private msgList = [];\r\n    private lock = false;\r\n    private lockName: number = 0;\r\n    private timer;\r\n\r\n    private needPop = true;\r\n    private timeCounter = 0;\r\n    \r\n    public static get Instance(): HallPopMsgHelper {\r\n        if (this._instance == null) {\r\n            this._instance = new HallPopMsgHelper();\r\n            \r\n        }\r\n        return this._instance;\r\n    }\r\n\r\n\r\n    public static releaseInstance() {\r\n        if (this._instance) {\r\n            this._instance.stopTimer();\r\n            this._instance = null;\r\n        }\r\n    }\r\n\r\n    private startTimer()\r\n    {\r\n        this.stopTimer();\r\n        this.timer = setInterval(() => {\r\n            this.update();\r\n        }, 150);\r\n    }\r\n\r\n    private stopTimer()\r\n    {\r\n        clearTimeout(this.timer);\r\n    }\r\n\r\n    public addMsgList(name: number, func: Function,sort = null){\r\n        if (func){\r\n            let priority = sort || name;\r\n            let msg = {name, func, priority};\r\n            this.msgList.push(msg);\r\n            this.sortMsgList();\r\n            //this.popMsgList();\r\n        }\r\n    }\r\n    \r\n    public sortMsgList(){\r\n        this.msgList.sort((a, b)=>{\r\n            return b.priority - a.priority;\r\n        })\r\n    }\r\n\r\n    public popMsgList(){\r\n        if (Global.SceneManager.sceneType !== SceneType.Hall){\r\n            return;\r\n        } \r\n        if(!this.timer)\r\n        {\r\n            this.startTimer()\r\n        }\r\n        if(this.msgList.length > 0 && !this.lock && !this.lockName){\r\n            let msg = this.msgList[this.msgList.length - 1];    // 消息存在时序问题，可能hallUI还没open, 不能pop掉\r\n            msg.func.call();\r\n        }\r\n    }\r\n\r\n    public addLock(name: number){\r\n        this.lockName = name;\r\n        this.lock = true;\r\n    }\r\n\r\n    public releaseLock(name: number, isForce: boolean = false){\r\n        if (this.lockName == name || isForce){\r\n            this.msgList = this.msgList.filter((item)=>{\r\n                return item.name != this.lockName;\r\n            })\r\n            this.lock = false;\r\n            this.lockName = 0;\r\n            this.needPop = true;\r\n            // this.popMsgList();\r\n        }\r\n    }\r\n\r\n    public update()\r\n    {\r\n        if(!this.needPop || this.msgList.length == 0)\r\n            return;\r\n        this.timeCounter++;\r\n        if(this.timeCounter >= 2)\r\n        {   \r\n            this.needPop = false;\r\n            this.timeCounter = 0;\r\n            this.popMsgList();\r\n        }\r\n        \r\n    }\r\n}"]}