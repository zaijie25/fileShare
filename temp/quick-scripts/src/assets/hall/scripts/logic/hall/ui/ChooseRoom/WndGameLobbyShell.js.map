{"version":3,"sources":["assets\\hall\\scripts\\logic\\hall\\ui\\ChooseRoom\\WndGameLobbyShell.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import WndBase, { DestoryType } from \"../../../core/ui/WndBase\";\r\n\r\nexport enum GameType {\r\n    PVE = 0,\r\n    PVP = 1,\r\n    /** 路珠类型 */\r\n    TRENDGAME = 2,\r\n    /** 老虎机类型 */\r\n    LUCKGAME = 3,\r\n    /** 捕鱼类型 */\r\n    FISH = 4,\r\n    /**直接进游戏（暂定美术未提供大厅选场的游戏 如 红包接龙） */\r\n    NOCHANGE = 5,\r\n    /**红包 */\r\n    REDPACKGAME = 6,\r\n    /*外接游戏*/\r\n    WEBGAME = 8\r\n}\r\n\r\nconst keepCount = 1;\r\nexport default class WndGameLobbyShell extends WndBase{\r\n    private poolNode: cc.Node;\r\n    private keepMap: Map<number, cc.Node> = new Map;\r\n    private keepArr: number[] = [];\r\n    private activeGameId: number = 0;\r\n    private activeGameData: any;\r\n    \r\n    protected onInit() {\r\n        this.name = \"WndGameLobbyShell\";\r\n        this.layer = \"FullScreenLayer\";\r\n        this.resPath = \"hall/prefabs/ui/ChooseRoom/GameLobbyShellUI\";\r\n        this.destoryType = DestoryType.Persist;\r\n    }\r\n\r\n    protected initView(){\r\n        this.node.width = cc.Canvas.instance.node.width;\r\n        this.node.height = cc.Canvas.instance.node.height;\r\n        this.poolNode = cc.find(\"pool\", this.node);\r\n        this.poolNode.active = false;\r\n        Game.Event.on(GlobalEvent.OnCloseGameLobby, this, this.closeWnd);\r\n        Game.Event.on(GlobalEvent.OnGotoGameScene, this, this.gotoGame);\r\n    }\r\n\r\n    protected onOpen(args: any[]){\r\n        if (args && args.length > 0)\r\n            [this.activeGameId] = args;\r\n        if (Game.GamePreloadTool.curGameId != this.activeGameId){\r\n            this.closeWnd();\r\n            return //console.error(\"异常onOpen\", Game.GamePreloadTool.curGameId, this.activeGameId);\r\n        }\r\n        \r\n        this.setGameContent();\r\n    }\r\n\r\n    public reshow(){\r\n        let [gid] = this.args;\r\n        if (Game.GamePreloadTool.curGameId != gid)\r\n            return //console.error(\"异常reshow\", Game.GamePreloadTool.curGameId, gid);\r\n        if (gid == this.activeGameId)\r\n            return;\r\n        if (this.activeGameId && this.keepMap.has(this.activeGameId) && cc.isValid(this.keepMap.get(this.activeGameId))){\r\n            let node = this.keepMap.get(this.activeGameId);\r\n            node.setParent(this.poolNode);\r\n            node.active = false;\r\n        }\r\n        this.activeGameId = gid;\r\n\r\n        this.setGameContent();\r\n    }\r\n\r\n    private setGameContent(){\r\n        let bundleName = Game.GamePreloadTool.curBundleName;\r\n        this.activeGameData = Global.GameData.getGameInfo(this.activeGameId);\r\n        if (this.activeGameId && Global.ResourceManager.checkBundleValid(bundleName)){\r\n            if (this.keepMap.has(this.activeGameId) && cc.isValid(this.keepMap.get(this.activeGameId))){\r\n                Logger.error(\"use keepMap node\", this.activeGameId);\r\n                let node = this.keepMap.get(this.activeGameId);\r\n                node.setParent(this.node);\r\n                node.active = true;\r\n            }\r\n            else{\r\n                let prefab = Game.GamePreloadTool.getSelectPrefab(Game.GamePreloadTool.lobbyUIPath, true);\r\n                if (prefab){\r\n                    Logger.error(\"use new node, prefab.refCount\", this.activeGameId, prefab.refCount);\r\n                    let node = <cc.Node>cc.instantiate(prefab);\r\n                    node.setParent(this.node);\r\n                    node.active = true;\r\n                    this.keepMap.set(this.activeGameId, node);\r\n                    this.keepArr.push(this.activeGameId);\r\n                }\r\n                else{\r\n                  //  console.error(\"error, 未预加载或找不到LobbyUI\");\r\n                    this.closeWnd();\r\n                }\r\n            }\r\n        }\r\n        else{\r\n          //  console.error(\"error, 当前游戏选场bundle未预加载\", this.activeGameId, bundleName);\r\n            this.closeWnd();\r\n        }\r\n    }\r\n\r\n    private closeWnd(){\r\n        Game.GamePreloadTool.releaseKeepAsset(this.activeGameId, true);\r\n        this.checkLeaveKeepCount();     // 关闭退出选场时检测上限释放\r\n        if (this.keepMap.has(this.activeGameId)){           // debug 退出页面时手动关闭节点, 避免开另一个游戏时 触发onEnable\r\n            let node = this.keepMap.get(this.activeGameId);\r\n            if (node && cc.isValid(node)){\r\n                node.active = false;\r\n                node.setParent(this.poolNode);\r\n            }\r\n        }\r\n        Global.UI.close(this.name);\r\n    }\r\n\r\n    private gotoGame(level: string, gameData:object = null){\r\n        if (!this.checkMoney(level, gameData) || !this.checkVersion())\r\n            return;\r\n        \r\n        this.checkEnterKeepCount();         \r\n        let enterFunc = () => {\r\n            if(gameData){\r\n                Game.Control.curGid = gameData[\"gameid\"];\r\n            }\r\n            Game.Control.curLv = level;\r\n            Global.Event.event(GlobalEvent.RecordGameListOffsetX);\r\n            Global.SceneManager.loadGameScene();\r\n        }\r\n        if (this.activeGameData.portraitModel) {    // 检查是否需要显示横竖屏切换提示\r\n            Global.UI.showPortraitScreenNotice(enterFunc);\r\n        }\r\n        else {\r\n            enterFunc();\r\n        }\r\n    }\r\n\r\n    private checkMoney(level = \"l0\", gameData = null) {\r\n        let gameObj = null;\r\n        if(gameData){\r\n            gameObj = gameData;\r\n        }else if (this.activeGameData.levels) {\r\n            for (let index = 0; index < this.activeGameData.levels.length; index++) {\r\n                let levelStr = this.activeGameData.levels[index].level;\r\n                if(levelStr && levelStr == level){\r\n                    gameObj = this.activeGameData.levels[index];\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        \r\n        let pointLow = gameObj.PointLow;\r\n        if (pointLow && Global.PlayerData.point < pointLow) {\r\n            let limit = Global.Toolkit.formatPointStr(pointLow);\r\n            let str = \"游戏准入\" + limit + \"金币，请您充值哦！\";\r\n            Global.Toolkit.showMoneyNotEnough(str);\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    private checkVersion() {\r\n        if (this.activeGameData.supportVersion && this.activeGameData.supportVersion > 0) {\r\n            if (!Global.Toolkit.checkVersionSupport(this.activeGameData.supportVersion, this.activeGameData.supportIosVersion)) {\r\n                Global.UI.showYesNoBox(\"版本过旧，请下载新包使用该功能\", () => {\r\n                    cc.sys.openURL(Global.Setting.Urls.downLoadUrl);\r\n                })\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /** 按照设定保留游戏选场数资源 新增显示选场资源时检测 */\r\n    private checkLeaveKeepCount(){\r\n        if (this.keepArr.length > 0 && this.keepArr.length == keepCount + 1){   // 超出保存上限一个 就清理一个\r\n            let oldGid = this.keepArr.shift();\r\n            this.releaseOneKeep(oldGid);\r\n        }\r\n    }\r\n\r\n    /** 按照设定保留游戏选场数资源 */\r\n    private checkEnterKeepCount(){\r\n        if (this.activeGameData.gameType == GameType.FISH){        // 进入捕鱼游戏时要检测只保留捕鱼那份资源\r\n            this.keepOnlyCurrent();\r\n        }\r\n        else if(this.keepArr.length == 1){                  // 保留当前那个 \r\n            Logger.log(\"keep current with no action\");\r\n        }\r\n        else{\r\n            if (keepCount > 0){\r\n                this.checkLeaveKeepCount();             // 按照上限检测释放\r\n            }\r\n        }\r\n    }\r\n\r\n    /** 保留当前游戏选场, 其余删除释放 */\r\n    private keepOnlyCurrent(){\r\n        let count = this.keepArr.length;\r\n        if (count > 1){\r\n            for(let i = 0; i < count; i++){\r\n                let gid = this.keepArr[i];\r\n                if (gid !== this.activeGameId)  // 只保留当前gid\r\n                    this.releaseOneKeep(gid);\r\n            }\r\n            this.keepArr = [this.activeGameId];\r\n        }\r\n    }\r\n\r\n    private releaseOneKeep(gid: number){\r\n        let node = this.keepMap.get(gid);\r\n        if (node){\r\n            node.removeFromParent();\r\n            node.active = false;\r\n            node.destroy();\r\n            this.keepMap.delete(gid);\r\n        }\r\n        Game.GamePreloadTool.releaseKeepAsset(gid, false);\r\n        Game.GamePreloadTool.releasePreloadBundle(gid);\r\n    }\r\n\r\n    protected onDispose(){\r\n        this.keepMap.clear();\r\n        this.keepArr = [];\r\n    }\r\n}"]}