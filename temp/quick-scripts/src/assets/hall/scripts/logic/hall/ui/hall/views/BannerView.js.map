{"version":3,"sources":["assets\\hall\\scripts\\logic\\hall\\ui\\hall\\views\\BannerView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\r\nimport ViewBase from \"../../../../core/ui/ViewBase\";\r\nimport GongGaoViewItem from \"./GongGaoViewItem\";\r\nimport { SingleGongGaoModel } from \"../../../../hallcommon/data/GongGaoData\";\r\nimport AppHelper from \"../../../../core/tool/AppHelper\";\r\n\r\nexport default class BannerView extends ViewBase {\r\n\r\n    // private tempNode: cc.Node;\r\n\r\n    private itemList: Array<GongGaoViewItem> = new Array();\r\n    // private itemPool: Array<GongGaoViewItem> = new Array();\r\n    private pageView: any;\r\n\r\n    private content :cc.Node;\r\n\r\n\r\n    //自动滚动间隔\r\n    private scrollDelayTime = 15;\r\n    //切页用时\r\n    private scrollTime = 1;\r\n\r\n    private gongGaoCount = 0;\r\n\r\n    private mask:cc.Mask;\r\n\r\n    private hasRefreshMask = false;\r\n\r\n    /* private clearRecord() {\r\n        //自动播放开关\r\n        this.pageView.isAutoScroll = false;\r\n\r\n        this.pageView.removeAllPages();\r\n        for (let index = 0; index < this.itemList.length; index++) {\r\n            const item = this.itemList[index];\r\n            item.node.setParent(this.tempNode);\r\n            // item.reset();\r\n            item.node.active = false;\r\n            this.itemPool.push(item);\r\n        }\r\n        this.itemList = [];\r\n    } */\r\n\r\n    protected initView() {\r\n        this.pageView = this.node.getComponent(\"LoopPageView\");\r\n        // this.tempNode = this.getChild(\"maskNode/view\");\r\n        this.mask = this.getComponent(\"maskNode\", cc.Mask);\r\n        this.itemList = [];\r\n        // this.initData();\r\n        this.hasRefreshMask = false;\r\n    }\r\n\r\n    private initData() {\r\n        let bannerlist: SingleGongGaoModel[] = Global.GongGaoData.gongGaoList;\r\n        if(bannerlist){\r\n            this.gongGaoCount = bannerlist.length;\r\n            for(let i=0;i<this.gongGaoCount;i++){\r\n                let itemData: SingleGongGaoModel = bannerlist[i];\r\n                this.addPrefeb(itemData);\r\n            }\r\n        }\r\n        \r\n    }\r\n\r\n    /*type :1 普通弹窗  2 二维码  3 跳转url\r\n        subtype: 1.财富秘籍 2.复制官网 3.修复 4.充值\r\n    */\r\n    private configs = {\r\n        11001:{\r\n            type: 0, \r\n            subtype: 0 \r\n        },\r\n        11002:{\r\n            type: 1, \r\n            subtype: 1\r\n        },\r\n        11003:{\r\n            type: 1, \r\n            subtype: 4 \r\n        },\r\n        11004:{\r\n            type: 1, \r\n            subtype: 2 \r\n        },\r\n        11005:{\r\n            type: 1, \r\n            subtype: 3\r\n        },\r\n        11006:{\r\n            type: 2\r\n        },\r\n        \r\n    }\r\n\r\n    private refreshMask()\r\n    {\r\n        if(this.hasRefreshMask)\r\n            return;\r\n        this.hasRefreshMask = true;\r\n        if(this.mask && this.itemList.length > 0)\r\n        {\r\n            let spNode = cc.find(\"content/guangao_di\", this.itemList[0].node);\r\n            if(spNode)\r\n            {\r\n                let sp = spNode.getComponent(cc.Sprite);\r\n                if(sp)\r\n                {\r\n                    this.mask.spriteFrame = sp.spriteFrame;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private addPrefeb(itemData: SingleGongGaoModel){\r\n        let data = itemData;\r\n        let id = data.lunbo_id;\r\n        if(!this.configs[id]){\r\n            Logger.error(\"ID无效！\",id);\r\n            return ;\r\n        }\r\n        Global.ResourceManager.loadRes(\"hall@effect/hall/lunbo/gonggaoItem_\"+ id, (error, prefab)=>{\r\n            if(error != null){\r\n                Logger.error(\"加载预设失败\", id);\r\n                return;\r\n            }\r\n            if (cc.sys.platform != cc.sys.IPHONE&&id==11005) {\r\n                return;\r\n            }\r\n            let effect = cc.instantiate(prefab) as cc.Node;\r\n            effect.name = \"gonggaoItem_\" + id\r\n            \r\n            //1找到对应节点2.找到sprit组件3.设置对应图片\r\n            let item = new GongGaoViewItem();\r\n            item.setNode(effect);\r\n            if(data.jump_type==1&&data.jump_url){\r\n                item.setData({ type: 3, subtype: data.jump_url },this.pageView);\r\n            }else{\r\n                item.setData(this.configs[id],this.pageView);\r\n            }\r\n            let callback = ()=>{\r\n                this.pageView.addPage(item.node);\r\n                //紫色公告mask是图片mask 需要特殊处理\r\n                if(Global.Setting.SkinConfig.isPurple)\r\n                    this.refreshMask();\r\n            }\r\n            if(id == 11003)\r\n            {\r\n                item.InitVipCharge()\r\n            }\r\n            Global.customApp.loadBannerBg(item.icon,\"guangao\"+id+\".png\",callback);\r\n            this.itemList.push(item);\r\n           \r\n            //g公告图集在大厅中  需要跟着大厅一起销毁或者不销毁\r\n        }, null, null, Global.Toolkit.isIphone6());\r\n    }\r\n    \r\n\r\n    onSubViewShow() {\r\n        this.initData();\r\n        //自动切页滚动间隔\r\n        this.pageView.autoScrollDelayTime = this.scrollDelayTime;\r\n        //切页用时\r\n        this.pageView.autoScrollTime = this.scrollTime;\r\n        this.pageView.scrollToPage(0, 0);\r\n        //\r\n        this.updateView();\r\n        this.updateQrCodeItem();\r\n        //自动播放开关\r\n        this.pageView.isAutoScroll = true;\r\n    }\r\n\r\n   \r\n\r\n    onSubViewHide(){\r\n        this.pageView.removeAllPages();\r\n        this.itemList = [];\r\n    }\r\n\r\n    public close()\r\n    {\r\n        this.itemList = [];\r\n    }\r\n\r\n    onDispose() {\r\n        // this.clearRecord();\r\n        this.mask = null;\r\n    }\r\n\r\n    //刷新二维码\r\n    updateQrCodeItem() {\r\n        if (this.itemList) {\r\n            for (let i = 0; i < this.itemList.length; i++) {\r\n                let item = this.itemList[i]\r\n                let itemData = item.getData();\r\n                if (itemData && itemData.type == 2) {\r\n                    item.setData(itemData)\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    updateView() {\r\n        \r\n    }\r\n\r\n\r\n\r\n\r\n\r\n}\r\n"]}