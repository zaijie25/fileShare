{"version":3,"sources":["assets\\hall\\scripts\\logic\\hall\\ui\\CashBack\\WndDailyCashBackUI.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import WndBase from \"../../../core/ui/WndBase\";\r\nimport PoolBase from \"../../../core/tool/PoolBase\";\r\nimport { CashBackEvent } from \"./CashBackEvent\";\r\nimport YXButton from \"../../../core/component/YXButton\";\r\nimport CashBackModel from \"../../../hallcommon/model/CashBackModel\";\r\nimport { SkinType } from \"../../../hallcommon/app/SkinConfig\";\r\nimport AppCfg from \"../../AppCfg\";\r\n\r\nexport default class WndDailyCashBackUI extends WndBase{\r\n    CashBackModel: CashBackModel;\r\n    contentNode: any;\r\n    copyItem: any;\r\n    itemPool: ItemPool;\r\n    nodeList: any[];\r\n    myDailyCash : cc.Label;     //我的流水\r\n    dayNum : cc.Label;          //保留几天\r\n    awardNumLabel : cc.Label;   //累积奖励\r\n\r\n    awardId : string = \"\";      //领取奖励id\r\n    awardBtn : cc.Node;         //领取按钮\r\n\r\n    protected onInit() {\r\n        this.isNeedDelay = true\r\n        this.name = \"WndDailyCashBackUI\";\r\n        this.layer = Global.UI.PopLayer;\r\n        this.resPath = \"hall/prefabs/ui/CashBack/DailyCashBackUI\";\r\n    }\r\n\r\n    protected initView() {\r\n        this.copyItem = this.getChild(\"scrollview/view/content/item\")\r\n        this.copyItem.active = false;\r\n        this.contentNode = this.getChild(\"scrollview/view/content\")\r\n        this.myDailyCash = this.getComponent(\"myDailyCash\",cc.Label);\r\n        this.dayNum = this.getComponent(\"dayNum\",cc.Label);\r\n        this.awardNumLabel = this.getComponent(\"awardNum/awardNumLabel\",cc.Label);\r\n        this.initItemPool();\r\n        this.addCommonClick(\"getAwardBtn\", this.getAward, this)\r\n        this.addCommonClick('close', this.close, this)\r\n        this.awardBtn = this.getChild(\"getAwardBtn\")\r\n        this.setAwardBtnState(false)\r\n        this.CashBackModel = <CashBackModel>Global.ModelManager.getModel(\"CashBackModel\");\r\n        this.CashBackModel.on(CashBackEvent.GetActivityCfg, this, this.DescriptionDay);\r\n        this.CashBackModel.on(CashBackEvent.GetDayFlowBackAll, this, this.GetAwardResq);\r\n    }\r\n\r\n    setAwardBtnState(canget:boolean){\r\n        let btn = this.awardBtn.getComponent(YXButton)\r\n        let btnEffect = this.getChild(\"getAwardBtn/effect\")\r\n        btnEffect.active = canget\r\n        if (btn) {\r\n            Global.UIHelper.setNodeGray(btn.node, !canget, 150, true)\r\n            btn.interactable = canget\r\n        }\r\n    }\r\n\r\n    getAward(){\r\n        if(this.awardId == \"\"){\r\n            Global.UI.fastTip(\"暂无奖励可以领取\")\r\n            return;\r\n        }\r\n        this.CashBackModel.GetDayFlowBack(this.awardId)\r\n    }\r\n\r\n    GetAwardResq(data){\r\n        if (!data || !data.get_point) return\r\n        Global.UI.show(\"WndRebateGet\", data.get_point, 6);\r\n        this.awardNumLabel.string = cc.js.formatStr(\"%s\", Global.Toolkit.formatPointStr(0, true));\r\n        this.setAwardBtnState(false);\r\n    }\r\n\r\n    DescriptionDay(data) {\r\n        this.OnDataPrepared();\r\n        this.contentNode.removeAllChildren();\r\n        if (data == null) {\r\n            return\r\n        }\r\n        for (let i = 0; i < data.data.length; i++) {\r\n            if (data.data[i].atype === 7) {\r\n                this.refreshCfg(data.data[i].cfg)\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    public refreshCfg(data){\r\n        if(!data) return\r\n        let arr: Array<any> = data.cfg || [];\r\n        let dayCount = data.read_day || 0;\r\n        let awardNum = data.day_un_read_point || 0;\r\n        let dayFlow = data.day_flow || 0;\r\n        this.awardId = data.read_id || \"\";\r\n        this.nodeList = [];\r\n        for (let j = 0; j < arr.length; j++) {\r\n            let node = this.itemPool.getItem();\r\n            this.nodeList.push(node);\r\n            node.active = true\r\n            node.setParent(this.contentNode);\r\n            node.getComponent(\"CashBackDescription\").Init(arr[j])\r\n        }\r\n        this.myDailyCash.string = Global.Toolkit.formatPointStr(dayFlow);\r\n        this.awardNumLabel.string = cc.js.formatStr(\"%s\", Global.Toolkit.formatPointStr(awardNum, false));\r\n        if(AppCfg.SKIN_TYPE == SkinType.green){\r\n            this.dayNum.string = dayCount +\"天\";\r\n        }else{\r\n            this.dayNum.string = dayCount;\r\n        }\r\n        \r\n        this.setAwardBtnState(this.awardId != \"\");\r\n    }\r\n\r\n    private initItemPool() {\r\n        this.itemPool = new ItemPool(this.copyItem);\r\n    }\r\n\r\n    protected onOpen(args?: any[]) {\r\n        this.CashBackModel.GetActivityCfg();\r\n    }\r\n\r\n    onDispose() {\r\n        this.CashBackModel.off(CashBackEvent.GetActivityCfg, this, this.DescriptionDay);\r\n        this.CashBackModel.off(CashBackEvent.GetDayFlowBackAll, this, this.GetAwardResq);\r\n    }\r\n}\r\n\r\nclass ItemPool extends PoolBase {\r\n    constructor(private copyNode: cc.Node) {\r\n        super();\r\n    }\r\n\r\n    protected createItem() {\r\n        return cc.instantiate(this.copyNode);\r\n    }\r\n\r\n    protected resetItem(node: cc.Node) {\r\n        node.active = false;\r\n        node.setParent(null);\r\n    }\r\n}"]}