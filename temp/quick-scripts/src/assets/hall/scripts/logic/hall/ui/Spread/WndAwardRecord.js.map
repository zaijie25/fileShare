{"version":3,"sources":["assets\\hall\\scripts\\logic\\hall\\ui\\Spread\\WndAwardRecord.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import WndBase from \"../../../core/ui/WndBase\";\r\nimport PoolBase from \"../../../core/tool/PoolBase\";\r\nimport SpreadModel from \"../../../hallcommon/model/SpreadModel\";\r\nimport { NetAppface } from \"../../../core/net/hall/NetEvent\";\r\n\r\nexport default class WndAwardRecord extends WndBase {\r\n    copyItem: any;\r\n    contentNode: any;\r\n    itemPool: AwardRecordItemPool;\r\n    nodeList: any[] = [];\r\n    page = 1\r\n    TotalPage = 0\r\n    SpreadModel = null\r\n    limit = 4\r\n    noTips: cc.Node\r\n    titleNode: cc.Node\r\n    botNode: cc.Node\r\n\r\n    TotalInfoLabel: cc.Label\r\n    PageLabel: cc.Label\r\n    LastPageBtn: cc.Node\r\n    NextPageBtn: cc.Node\r\n    cmmi_type: number\r\n    // tipmyself: cc.Node;\r\n\r\n    protected onInit() {\r\n        this.name = \"WndAwardRecord\";\r\n        this.layer = Global.UI.PopLayer;\r\n        this.resPath = \"hall/prefabs/ui/SpreadUI/AwardHistory\";\r\n\r\n    }\r\n\r\n    protected initView() {\r\n        var SpreadModel = Global.ModelManager.getModel(\"SpreadModel\");\r\n        this.cmmi_type = SpreadModel.commiType\r\n        this.SpreadModel = <SpreadModel>Global.ModelManager.getModel(\"SpreadModel\");\r\n        this.node.width = cc.Canvas.instance.node.width;\r\n        this.node.height = cc.Canvas.instance.node.height;\r\n        this.addCommonClick(\"bg_popup_middle/close\", this.close, this)\r\n        this.LastPageBtn = this.getChild(\"BotBtn/LastPage\")\r\n        this.NextPageBtn = this.getChild(\"BotBtn/NextPage\")\r\n        this.LastPageBtn.on(\"click\", this.OnLastPageBtnClick, this);\r\n        // this.tipmyself = this.getChild(\"bg_popup_middle/topTitle/type\")\r\n        // if (this.SpreadModel.self_rate > 0|| this.cmmi_type === 2) {\r\n        //     this.tipmyself.active = true\r\n        // }\r\n        // else {\r\n        //     this.tipmyself.active = false\r\n        // }\r\n        this.NextPageBtn.on(\"click\", this.OnNextPagePageBtnClick, this);\r\n        this.copyItem = this.getChild(\"bg_popup_middle/scrollview/view/content/item\")\r\n        this.contentNode = this.getChild(\"bg_popup_middle/scrollview/view/content\")\r\n        this.TotalInfoLabel = this.getChild(\"BotBtn/TotalInfoLabel\").getComponent(cc.Label)\r\n        this.PageLabel = this.getChild(\"BotBtn/PageLabel\").getComponent(cc.Label)\r\n        this.noTips = this.getChild(\"bg_popup_middle/scrollview/noListTipsSk\")\r\n        this.noTips.active = false\r\n        this.titleNode = this.getChild(\"bg_popup_middle/topTitle\")\r\n        this.titleNode.active = false\r\n        this.botNode = this.getChild(\"BotBtn\")\r\n        this.botNode.active = false\r\n        this.initItemPool();\r\n\r\n    }\r\n\r\n    OnNextPagePageBtnClick() {\r\n        Global.Audio.playBtnSound();\r\n        this.page++\r\n        if (this.page > this.TotalPage) {\r\n            this.page = this.TotalPage\r\n            Global.UI.fastTip(\"没有更多数据\")\r\n            return\r\n        }\r\n        this.SpreadModel.GetDayAgentRecord(this.page, this.limit)\r\n    }\r\n    OnLastPageBtnClick() {\r\n        Global.Audio.playBtnSound();\r\n        this.page--\r\n        if (this.page <= 0) {\r\n            this.page = 1\r\n            Global.UI.fastTip(\"已经是第一页了\")\r\n            return\r\n        }\r\n\r\n        this.SpreadModel.GetDayAgentRecord(this.page, this.limit)\r\n\r\n    }\r\n\r\n    protected onOpen(data) {\r\n        this.SpreadModel.on(NetAppface.GetSelfReadRecord, this, this.RefreshScrollView)\r\n        this.SpreadModel.on(NetAppface.GetDayAgentRecord, this, this.RefreshScrollView)\r\n        this.copyItem.active = false\r\n        if (data == null || data.length == 0) {\r\n\r\n            return;\r\n        }\r\n        this.RefreshScrollView(data[0])\r\n    }\r\n    RefreshScrollView(data: any) {\r\n        if (data == null) {\r\n            Global.UI.fastTip(\"无数据\")\r\n            return\r\n        }\r\n        if (data.total == 0) {\r\n            this.noTips.active = true\r\n            this.titleNode.active = false\r\n            this.botNode.active = false\r\n        }\r\n        else {\r\n            this.noTips.active = false\r\n            this.titleNode.active = true\r\n            this.botNode.active = true\r\n        }\r\n        this.TotalPage = Math.ceil(data.total / data.limit)\r\n        let msgFormat = \"共%s条\"\r\n        this.TotalInfoLabel.string = cc.js.formatStr(msgFormat, data.total);\r\n        let str = \"第%s页\"\r\n        this.PageLabel.string = cc.js.formatStr(str, this.TotalPage);\r\n        let arr: Array<any> = data.data || [];\r\n        let count = arr.length;\r\n\r\n        this.recycle()\r\n\r\n        for (let j = 0; j < count; j++) {\r\n\r\n            let node = this.itemPool.getItem() as cc.Node;\r\n            this.nodeList.push(node);\r\n            node.active = true;\r\n           // node.getChildByName(\"bg\").active = j % 2 == 0;\r\n            node.setParent(this.contentNode);\r\n            node.getComponent(\"AwardRecordItem\").Init(arr[j])\r\n        }\r\n\r\n    }\r\n\r\n    protected onClose() {\r\n        this.ResetData()\r\n        this.SpreadModel.off(NetAppface.GetSelfReadRecord, this, this.RefreshScrollView)\r\n        this.SpreadModel.off(NetAppface.GetDayAgentRecord, this, this.RefreshScrollView)\r\n    }\r\n    ResetData() {\r\n        this.page = 1\r\n        this.TotalPage = 0\r\n    }\r\n    protected onDispose() {\r\n        this.nodeList = [];\r\n        this.itemPool.resetPool()\r\n    }\r\n    private initItemPool() {\r\n\r\n\r\n        this.itemPool = new AwardRecordItemPool(this.copyItem);\r\n    }\r\n    public recycle() {\r\n        this.itemPool.recycleAll(this.nodeList);\r\n        this.nodeList = [];\r\n    }\r\n}\r\nclass AwardRecordItemPool extends PoolBase {\r\n    constructor(private copyNode: cc.Node) {\r\n        super();\r\n    }\r\n\r\n    protected createItem() {\r\n        return cc.instantiate(this.copyNode);\r\n    }\r\n\r\n    protected resetItem(node: cc.Node) {\r\n        node.active = false;\r\n        node.setParent(null);\r\n    }\r\n}"]}