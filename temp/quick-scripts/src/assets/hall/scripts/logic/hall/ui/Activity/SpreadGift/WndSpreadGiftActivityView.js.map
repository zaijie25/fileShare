{"version":3,"sources":["assets\\hall\\scripts\\logic\\hall\\ui\\Activity\\SpreadGift\\WndSpreadGiftActivityView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import YXButton from \"../../../../core/component/YXButton\";\r\nimport ViewBase from \"../../../../core/ui/ViewBase\";\r\nimport WndBase from \"../../../../core/ui/WndBase\";\r\nimport RechargeGiftModel from \"../../../../hallcommon/model/RechargeGiftModel\";\r\nimport HallPopMsgHelper from \"../../../tool/HallPopMsgHelper\";\r\nimport { ActivityConstants, ActivityType } from \"../ActivityConstants\";\r\nimport SpreadGiftItemView from \"./SpreadGiftItemView\";\r\n\r\n\r\nexport default class WndSpreadGiftActivityView extends WndBase {\r\n\r\n    private model: RechargeGiftModel\r\n    private personLabel :cc.Label\r\n    private rechargePointLabel :cc.Label\r\n    private achieveIndex = -1\r\n    private monthAwardLabel:cc.Label\r\n    private sc0Node: cc.ScrollView\r\n    private clickLeft: cc.Node\r\n    private clickReight: cc.Node\r\n    protected onInit(){\r\n        this.name = \"WndSpreadGiftActivityView\";\r\n        this.isNeedDelay = false\r\n        this.layer = Global.UI.PopLayer;\r\n        this.resPath = \"hall/prefabs/ui/SpreadGift/spreadGiftNode\"\r\n    }\r\n\r\n    protected initView() {\r\n        this.model = <RechargeGiftModel>Global.ModelManager.getModel(\"RechargeGiftModel\");\r\n\r\n        this.model.on(RechargeGiftModel.GetAward, this, this.onGetAward);\r\n        this.model.on(RechargeGiftModel.GetCfg, this, this.onGetConfig);\r\n        this.personLabel = this.getComponent(\"count\",cc.Label)\r\n      \r\n        \r\n        this.monthAwardLabel = this.getComponent(\"monthAward\",cc.Label)\r\n        this.rechargePointLabel = this.getComponent(\"rechargePoint\",cc.Label)\r\n        for (let index = 0; index < 7; index++) {\r\n            this.addCommonClick(cc.js.formatStr(\"sco/view/awardPanel/redPack_%s\",index),this.onAwardBtnClicked,this)\r\n        }\r\n        // this.sc0Node = this.getComponent(\"sco\", cc.ScrollView)\r\n        // this.addCommonClick(\"sco/clickLeft\", this.onClickLeftSco, this)\r\n        // this.addCommonClick(\"sco/clickReight\", this.onClickReightSco, this)\r\n        // this.clickLeft = this.getChild(\"sco/clickLeft\");\r\n        // this.clickReight = this.getChild(\"sco/clickReight\");\r\n        // this.sc0Node.node.on(\"scroll-to-left\",this.onClickLeftSco,this)\r\n        // this.sc0Node.node.on(\"scroll-to-right\",this.onClickReightSco,this)\r\n        // this.onClickLeftSco();\r\n        this.addCommonClick(\"close\",this.close,this)\r\n        \r\n    }\r\n    onClickLeftSco() {\r\n        this.clickLeft.getComponent(YXButton).interactable = false\r\n        this.sc0Node.scrollToLeft(0.5)\r\n        this.clickReight.getComponent(YXButton).interactable = true\r\n    }\r\n    onClickReightSco() {\r\n        this.clickReight.getComponent(YXButton).interactable = false\r\n        this.sc0Node.scrollToRight(0.5)\r\n        this.clickLeft.getComponent(YXButton).interactable = true\r\n    }\r\n    onAwardBtnClicked(target) {\r\n        this.model.reqReceiveActivityAward(ActivityType.spreadAward)\r\n    }\r\n\r\n    protected onOpen() {\r\n        \r\n        this.model.reqGetActivityCfg(false)\r\n\r\n    }\r\n\r\n\r\n    protected onClose()\r\n    {\r\n        HallPopMsgHelper.Instance.releaseLock(ActivityType.spreadAward);\r\n    }\r\n   \r\n\r\n    private onGetAward(awardData) {\r\n        if(awardData && awardData.atype != ActivityType.spreadAward)\r\n        {\r\n            return\r\n        }\r\n        Global.UI.show(\"WndRebateGet\", awardData.award);\r\n        let giftItem :SpreadGiftItemView = this.getComponent(cc.js.formatStr(\"sco/view/awardPanel/redPack_%s\",this.achieveIndex),SpreadGiftItemView)\r\n        if(giftItem)\r\n        {\r\n            giftItem.RefreshState(RedPackState.Open,null)\r\n        }\r\n        Global.Event.event(ActivityConstants.HIDE_RED_PORT,awardData.atype)\r\n        \r\n    }\r\n    protected onDispose() {\r\n        this.model.off(RechargeGiftModel.GetAward, this, this.onGetAward);\r\n        this.model.off(RechargeGiftModel.GetCfg, this, this.onGetConfig);\r\n    }\r\n    private onGetConfig(data) {\r\n        if(data == null) return\r\n        Global.Event.event(ActivityConstants.SHOW_ACT_WAITTING, false)\r\n        let arr = data.data\r\n        if(arr == null) return\r\n        for (let index = 0; index < arr.length; index++) {\r\n            \r\n            if(arr[index].atype == ActivityType.spreadAward)\r\n            {\r\n                let  actData = arr[index].cfg\r\n                this.achieveIndex = actData.doc\r\n\r\n                this.personLabel.string = cc.js.formatStr(\"%s\",actData.num)\r\n                this.rechargePointLabel.string = Global.Toolkit.formatPointStr(actData.pay)\r\n                for (let index = 0; index < actData.list.length; index++) {\r\n                    let element = actData.list[index];\r\n                    let redPackState = this.getSpreadGiftItemState(actData.doc,index)\r\n                    let giftItem :SpreadGiftItemView = this.getComponent(cc.js.formatStr(\"sco/view/awardPanel/redPack_%s\",index),SpreadGiftItemView)\r\n                    if(giftItem)\r\n                    {\r\n                        giftItem.RefreshState(redPackState,element)\r\n                    }\r\n                    if(index == actData.list.length -1)\r\n                    {\r\n                        this.monthAwardLabel.string =  Global.Toolkit.formatPointStr(actData.list[index].point)\r\n                    }\r\n                }\r\n\r\n            }\r\n        }\r\n\r\n    }\r\n    \r\n\r\n    getSpreadGiftItemState(index,dataIndex)\r\n    {\r\n        if(index === -1)\r\n        {\r\n            return RedPackState.Normal\r\n        }\r\n        if(index === dataIndex)\r\n        {\r\n            return RedPackState.HightLight\r\n        }\r\n        return RedPackState.Normal\r\n\r\n    }\r\n\r\n}\r\n\r\nexport enum RedPackState\r\n{\r\n    Normal = 0,\r\n    HightLight = 1,\r\n    Open = 2,\r\n    None = 3\r\n}"]}