{"version":3,"sources":["assets\\hall\\scripts\\logic\\hall\\ui\\playerInfo\\MusicLayerView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import ViewBase from \"../../../core/ui/ViewBase\";\r\nimport PlayerInfoModel, { BgmEntity } from \"../../../hallcommon/model/PlayerInfoModel\";\r\nimport DiantaiItem from \"./DiantaiItem\";\r\nimport ScrollViewCarmack from \"../../../core/component/ScrollViewCarmack\";\r\n\r\n/**\r\n * 音乐电台\r\n */\r\nexport default class MusicLayerView extends ViewBase {\r\n    private model:PlayerInfoModel\r\n    /**\r\n     * 滚动容器\r\n     */\r\n    scrollView:cc.ScrollView = null;\r\n\r\n    /**\r\n     * 音乐集合\r\n     */\r\n    musicArr:any[] = [];\r\n\r\n    copyItem :cc.Node\r\n\r\n\r\n    listView :ScrollViewCarmack\r\n    protected initView()\r\n    {\r\n        this.model = Global.ModelManager.getModel(\"PlayerInfoModel\")\r\n        \r\n        this.scrollView = this.getComponent(\"scrollview\",cc.ScrollView)\r\n        this.copyItem = this.getChild(\"scrollview/item\");\r\n        if(this.copyItem)\r\n        {\r\n            this.copyItem.active = false\r\n        }\r\n        this.InitScrollViewObj()\r\n        this.initMusic()\r\n    }\r\n    \r\n    initMusic() {\r\n        let musicData : Map<string,BgmEntity> = this.model.musicData\r\n        if(musicData)\r\n        {\r\n            this.transMusicData(musicData)\r\n            return\r\n        }\r\n        this.model.requestBgmList((data :Map<string,BgmEntity>) =>{\r\n            console.log(data)\r\n            this.transMusicData(data)\r\n        })\r\n    }\r\n\r\n\r\n    transMusicData(musicData)\r\n    {\r\n        if(!musicData)\r\n        {\r\n            return\r\n        }\r\n        let dataObj = this.model.diantaiMusicArr[0];\r\n        this.musicArr.push(dataObj);\r\n        let arrName = musicData.keys();\r\n        for(let i = 0; i < musicData.size; i++){\r\n            let key = arrName.next().value as string;\r\n            let entity = musicData.get(key);\r\n            this.musicArr.push(entity);\r\n        }\r\n        for(let i = 0; i < this.musicArr.length; i++){\r\n            let diantaiObj = this.musicArr[i];\r\n            diantaiObj.url = diantaiObj.file;\r\n            if (CC_JSB){\r\n                diantaiObj.surl = this.model.getLocalFileName(diantaiObj.file);\r\n            }\r\n            if(i == this.musicArr.length -1)\r\n            {\r\n                this.initItem();\r\n            }\r\n        }\r\n    }\r\n    initItem(){\r\n\r\n        this.listView.allDatas = this.musicArr;\r\n        this.listView.updateView();\r\n        \r\n    }\r\n\r\n    InitScrollViewObj() {\r\n        let item_setter = (item, index) => {\r\n            let data = this.listView.allDatas[index];\r\n            item.getComponent(DiantaiItem).init(data)\r\n        };\r\n        this.listView = Global.UIHelper.addScrollViewCarmackComp(this.scrollView.node, this.copyItem, 5, 0, this, item_setter);\r\n    }\r\n\r\n    refreshUI()\r\n    {\r\n        this.listView.updateView();\r\n    }\r\n\r\n    onSubViewHide()\r\n    {\r\n        this.model.off(PlayerInfoModel.UpdateScrollView,this,this.refreshUI)\r\n    }\r\n\r\n    onSubViewShow()\r\n    {\r\n        this.refreshUI()\r\n        this.model.on(PlayerInfoModel.UpdateScrollView,this,this.refreshUI)\r\n    }\r\n\r\n    \r\n}"]}