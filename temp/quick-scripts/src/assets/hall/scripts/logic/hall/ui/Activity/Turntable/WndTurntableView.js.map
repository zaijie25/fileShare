{"version":3,"sources":["assets\\hall\\scripts\\logic\\hall\\ui\\Activity\\Turntable\\WndTurntableView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import WndBase from \"../../../../core/ui/WndBase\";\r\nimport ZhuanpanModel from \"../../../../hallcommon/model/ZhuanpanModel\";\r\nimport HallPopMsgHelper from \"../../../tool/HallPopMsgHelper\";\r\nimport { ActivityType } from \"../ActivityConstants\";\r\nimport TurnTable from \"./TurnTable\";\r\n\r\nexport default class WndTurntableView extends WndBase \r\n{\r\n\r\n\r\n    private model :ZhuanpanModel\r\n\r\n    private turnTable:TurnTable\r\n\r\n    speed:number = 30;\r\n    /**\r\n     * 当前轮播数据索引\r\n     */\r\n    lunboIndex:number = -1;\r\n    /**\r\n     * 积分文本集合\r\n     */\r\n    labelArr:cc.Label[] = [];\r\n    \r\n    /**\r\n     * 子元素 RichText组件集合 \r\n     */\r\n    itemArr : Array<cc.Node> = new Array();\r\n\r\n    /**\r\n     * 轮播遮罩节点\r\n     */\r\n    maskNode:cc.Node = null;\r\n\r\n    /**\r\n     * xy坐标和间隔\r\n     */\r\n    xyGapArr:number[] = [0, -16, 0, 26];\r\n\r\n    private subViewPath :any = {\r\n        \"turnTable\":\"hall/prefabs/ui/luckyDraw/turnTable\",\r\n    }\r\n\r\n    private viewKeyTypeMap :any = {\r\n        \"turnTable\":TurnTable,\r\n    }\r\n\r\n    private timer : NodeJS.Timeout\r\n\r\n    frameTime: number = 16;\r\n\r\n    protected onInit(){\r\n        this.name = \"WndTurntableView\";\r\n        this.isNeedDelay = false\r\n        this.layer = Global.UI.PopLayer;\r\n        this.resPath = \"hall/prefabs/ui/luckyDraw/turnTableNode\"\r\n    }\r\n    \r\n    protected initView()\r\n    {\r\n       \r\n\r\n        this.model = Global.ModelManager.getModel(\"ZhuanpanModel\")\r\n\r\n        this.model.on(ZhuanpanModel.RefreshRecordUI,this,this.updateIndex)\r\n        this.model.on(ZhuanpanModel.RefreshScore,this,this.refreshScore)\r\n        for(var i = 0; i < 5; i++){\r\n            this.labelArr[i] = this.getComponent(\"turnTableView/jifen/label_jifen_\" + i,cc.Label)\r\n        }\r\n        this.addCommonClick(\"turnTableView/jifen/btn_rule\",this.onRuleBtnClicked,this)\r\n        this.addCommonClick(\"close\",this.close,this)\r\n\r\n        this.maskNode =this.getChild(\"turnTableView/lunbo/mask\");\r\n        // var tempItem:cc.RichText = this.getComponent(\"turnTableView/lunbo/mask/itemRichText\",cc.RichText)\r\n        // tempItem.string = \"\";\r\n        // for(var i = 0; i < 6; i++){\r\n        //     if(i > 0){\r\n        //         tempItem = cc.instantiate(tempItem.node).getComponent(cc.RichText);\r\n        //     }\r\n\r\n        //     this.itemArr.push(tempItem);\r\n        //     tempItem.node.setParent(this.maskNode);\r\n        //     tempItem.node.y = this.xyGapArr[1] - i * this.xyGapArr[3];\r\n        // }\r\n        var tempItem= this.getChild(\"turnTableView/lunbo/mask/lay\")\r\n        tempItem.getChildByName(\"itemRichText1\").getComponent(cc.RichText).string=''\r\n        tempItem.getChildByName(\"itemRichText2\").getComponent(cc.RichText).string=''\r\n        for(var i = 0; i < 6; i++){\r\n            if(i > 0){\r\n                tempItem = cc.instantiate(tempItem);\r\n            }\r\n\r\n            this.itemArr.push(tempItem);\r\n            tempItem.setParent(this.maskNode);\r\n            tempItem.y = this.xyGapArr[1] - i * this.xyGapArr[3];\r\n        }\r\n        this.initSubViewClass(this.viewKeyTypeMap)\r\n        this.InitScripts()\r\n\r\n    }\r\n\r\n    async InitScripts() {\r\n        await this.initSubView(this.subViewPath,this.viewKeyTypeMap,this.getChild(\"turnTableView\"))\r\n    }\r\n\r\n    updateIndex(index) {\r\n        this.lunboIndex = index\r\n    }\r\n    onRuleBtnClicked() {\r\n        Global.UI.show(\"WndTurntableRule\")\r\n    }\r\n\r\n    refreshScore()\r\n    {\r\n        var data =this.model.data;\r\n        if(!data){\r\n            return;\r\n        }\r\n        this.labelArr[0].string = \"\" + data[\"coin\"];\r\n        this.labelArr[1].string = \"\" + data[\"week_login_coin\"];\r\n        this.labelArr[2].string = \"\" + data[\"week_bet_coin\"];\r\n        this.labelArr[3].string = \"\" + data[\"week_share_coin\"];\r\n        this.labelArr[4].string = \"\" + data[\"week_share_bet_coin\"];\r\n\r\n    }\r\n\r\n    protected onOpen()\r\n    {\r\n        this.model.reqActivityCfg()\r\n        this.model.reqLunbo()\r\n        this.turnTable.subViewState = true\r\n        this.timer = setInterval(this.runCarousel.bind(this),this.frameTime)\r\n    }\r\n    \r\n    runCarousel() {\r\n        let dt = this.frameTime / 1000\r\n        if(this.lunboIndex < 0){\r\n            this.UpdateCarouselUI();\r\n            return;\r\n        }\r\n        var dis = dt * this.speed;\r\n        // for(var i = 0; i < this.itemArr.length; i++){\r\n        //     var item:cc.RichText = this.itemArr[i];\r\n        //     item.node.y += dis;\r\n        //     if(item.node.y >= this.xyGapArr[1] + this.xyGapArr[3]){\r\n        //         item.node.y -= this.xyGapArr[3] * 6;\r\n        //         this.UpdateRichText(item);\r\n        //     }\r\n        // }\r\n        for(var i = 0; i < this.itemArr.length; i++){\r\n            var item:cc.Node = this.itemArr[i];\r\n            item.y += dis;\r\n            if(item.y >= this.xyGapArr[1] + this.xyGapArr[3]){\r\n                item.y -= this.xyGapArr[3] * 6;\r\n                this.UpdateRichText(item);\r\n            }\r\n        }\r\n    }\r\n    \r\n\r\n    onDispose()\r\n    {\r\n        if(this.timer)\r\n        {\r\n            clearTimeout(this.timer)\r\n            this.timer = null\r\n        } \r\n        this.itemArr = []\r\n        this.model.off(ZhuanpanModel.RefreshRecordUI,this,this.updateIndex)\r\n        this.model.off(ZhuanpanModel.RefreshScore,this,this.refreshScore)\r\n    }\r\n\r\n    /**\r\n     * 更新显示\r\n     */\r\n    UpdateCarouselUI(){\r\n        var dataArr = this.model.lunboDataArr;\r\n        if(dataArr.length > 0){\r\n            for(var i = 0; i < this.itemArr.length; i++){\r\n                var item:cc.Node = this.itemArr[i];\r\n                this.UpdateRichText(item);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 更新单一轮播文本\r\n     * @param item \r\n     */\r\n    UpdateRichText(item:cc.Node){\r\n        var dataArr = this.model.lunboDataArr;\r\n        if(dataArr.length <= 0){\r\n            return;\r\n        }\r\n        this.lunboIndex++;\r\n        if(this.lunboIndex >= dataArr.length){\r\n            this.lunboIndex = 0;\r\n        }\r\n\r\n        var obj = dataArr[this.lunboIndex];\r\n        let color1 = Global.Setting.SkinConfig.zhuanpanColors[0];\r\n        let color2 = Global.Setting.SkinConfig.zhuanpanColors[1];\r\n        // item.string = \"恭喜玩家<color=\" + color1 + \">\" + obj.name + \"</c>，获得<color=\" + color2 + \">\" + obj.point_name + \"</c>\";\r\n        item.getChildByName(\"itemRichText1\").getComponent(cc.RichText).string = \"恭喜玩家 <color=\" + color1 + \">\" + obj.name + \"</c>\";\r\n        item.getChildByName(\"itemRichText2\").getComponent(cc.RichText).string = \"获得 <color=\" + color2 + \">\" + obj.point_name + \"</c>\";\r\n\r\n        if(this.lunboIndex == dataArr.length - 1){\r\n            //请求新的轮播数据\r\n            this.model.reqLunbo(1000);\r\n        }\r\n    }\r\n\r\n\r\n    protected onClose()\r\n    {\r\n        if(this.timer)\r\n        {\r\n            clearTimeout(this.timer)\r\n            this.timer = null\r\n        }\r\n        HallPopMsgHelper.Instance.releaseLock(ActivityType.zhuanpan);\r\n    }\r\n\r\n   \r\n    \r\n}"]}