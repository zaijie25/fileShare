{"version":3,"sources":["assets\\hall\\scripts\\logic\\hall\\ui\\login\\view\\AutoCodeView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import ViewBase from \"../../../../core/ui/ViewBase\";\r\nimport PhoneInputView from \"./PhoneInputView\";\r\nimport YXButton from \"../../../../core/component/YXButton\";\r\n\r\nexport default class AutoCodeView extends ViewBase\r\n{\r\n    private codeInput:cc.EditBox;\r\n    private sendCodeBtn:YXButton;\r\n    //倒计时节点\r\n    private timeBtn:cc.Node;\r\n    private timeLabel:cc.RichText;\r\n    private nextSendTime = 0;\r\n    private phoneInputView:PhoneInputView;\r\n    private type = 1;\r\n    protected initView()\r\n    {\r\n        this.addCommonClick(\"codeBtn\", this.onCodeBtnClick, this);\r\n        this.sendCodeBtn = this.getComponent(\"codeBtn\", YXButton);\r\n        this.codeInput = this.getComponent(\"code\", cc.EditBox);\r\n        this.timeBtn = this.getChild(\"timeBtn\");\r\n        this.timeLabel = this.getComponent(\"timeBtn/label\", cc.RichText);\r\n        this.timeBtn.active = false;\r\n    }\r\n\r\n    public setPhoneInputAndType(phoneInput:PhoneInputView, type:number)\r\n    {\r\n        this.phoneInputView = phoneInput;\r\n        this.type = type;\r\n    }\r\n\r\n    public set code( value : string )\r\n    {\r\n        this.codeInput.string = value;\r\n    }\r\n    public get code()\r\n    {\r\n        return this.codeInput.string;\r\n    }\r\n\r\n    private onCodeBtnClick()\r\n    {\r\n        if(this.phoneInputView.phone == \"\")\r\n        {\r\n            Global.UI.fastTip(\"请输入手机号码\");\r\n            return;\r\n        }\r\n\r\n        if(!this.phoneInputView.isAreaVaild())\r\n        {\r\n            Global.UI.fastTip(\"请选择正确的地区信息\");\r\n            return;\r\n        }\r\n\r\n        let area = this.phoneInputView.area;\r\n        Global.ModelManager.getModel(\"LoginModel\").reqGetPhoneVerifyCode(this.phoneInputView.phone, this.type, area, (msg)=>\r\n        {\r\n            Global.UI.fastTip(\"验证码发送成功\");\r\n            //开始倒计时\r\n            this.nextSendTime = Date.now() + Global.Setting.phoneVerifyCodeInterval * 1000;\r\n            this.updateSendCodeTime();\r\n            if(msg && msg.code)\r\n            {\r\n                Global.UI.showSingleBox(msg.code);\r\n            }\r\n        })\r\n    }\r\n\r\n    protected onSubViewShow()\r\n    {\r\n        this.updateSendCodeTime();\r\n    }\r\n\r\n    protected onSubViewHide()\r\n    {\r\n        this.sendCodeBtn.unscheduleAllCallbacks();\r\n    }\r\n\r\n    protected onDispose()\r\n    {\r\n        this.nextSendTime = 0;\r\n    }\r\n\r\n    public updateSendCodeTime()\r\n    {\r\n        //最后一秒忽略不计\r\n        if(this.checkCanSend())\r\n        {\r\n            this.setCodeBtnCanSend();\r\n            return;\r\n        }\r\n        let totalTime = this.getLeftTime();\r\n        this.sendCodeBtnDisable()\r\n        this.codeInput.schedule(()=>\r\n        {\r\n            if(this.checkCanSend())\r\n            {\r\n                this.setCodeBtnCanSend();\r\n                this.sendCodeBtn.unscheduleAllCallbacks();\r\n                this.sendCodeBtn.isClickValid = true;\r\n            }\r\n            else\r\n            {\r\n                this.timeLabel.string = this.getLeftTime() + \"s\"\r\n            }\r\n        }, 1, totalTime + 1);\r\n    }\r\n\r\n    private checkCanSend()\r\n    {\r\n        return this.nextSendTime == 0 || this.nextSendTime < (Date.now() + 1000)\r\n    }\r\n\r\n    private sendCodeBtnDisable()\r\n    {\r\n        this.sendCodeBtn.node.active = false;\r\n        this.timeBtn.active = true;\r\n        let totalTime = this.getLeftTime();\r\n        this.timeLabel.string =   totalTime.toString();\r\n    }\r\n\r\n    private setCodeBtnCanSend()\r\n    {\r\n        this.sendCodeBtn.node.active = true;\r\n        this.timeBtn.active = false;\r\n    }\r\n\r\n    private getLeftTime()\r\n    {\r\n        return Math.floor((this.nextSendTime - Date.now())/1000);\r\n    }\r\n}"]}