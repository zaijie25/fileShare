{"version":3,"sources":["assets\\hall\\scripts\\logic\\hall\\ui\\Activity\\Turntable\\TurntableView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import ViewBase from \"../../../../core/ui/ViewBase\";\r\nimport ZhuanpanModel from \"../../../../hallcommon/model/ZhuanpanModel\";\r\nimport TurnTable from \"./TurnTable\";\r\n\r\nexport default class TurntableView extends ViewBase \r\n{\r\n\r\n\r\n    private model :ZhuanpanModel\r\n\r\n    private turnTable:TurnTable\r\n\r\n    speed:number = 30;\r\n    /**\r\n     * 当前轮播数据索引\r\n     */\r\n    lunboIndex:number = -1;\r\n    /**\r\n     * 积分文本集合\r\n     */\r\n    labelArr:cc.Label[] = [];\r\n    \r\n    /**\r\n     * 子元素 RichText组件集合 \r\n     */\r\n    itemArr : Array<cc.RichText> = new Array();\r\n\r\n    /**\r\n     * 轮播遮罩节点\r\n     */\r\n    maskNode:cc.Node = null;\r\n\r\n    /**\r\n     * xy坐标和间隔\r\n     */\r\n    xyGapArr:number[] = [0, -16, 0, 26];\r\n\r\n    private subViewPath :any = {\r\n        \"turnTable\":\"hall/prefabs/ui/ActivityCenter/subView/turnTable\",\r\n    }\r\n\r\n    private viewKeyTypeMap :any = {\r\n        \"turnTable\":TurnTable,\r\n    }\r\n\r\n    private timer : NodeJS.Timeout\r\n\r\n    frameTime: number = 16;\r\n    \r\n    protected initView()\r\n    {\r\n       \r\n\r\n        this.model = Global.ModelManager.getModel(\"ZhuanpanModel\")\r\n\r\n        this.model.on(ZhuanpanModel.RefreshRecordUI,this,this.updateIndex)\r\n        this.model.on(ZhuanpanModel.RefreshScore,this,this.refreshScore)\r\n        // if(this.model)\r\n        // {\r\n        //     this.model.reqLunbo()\r\n        // }\r\n        for(var i = 0; i < 5; i++){\r\n            this.labelArr[i] = this.getComponent(\"turnTableView/jifen/label_jifen_\" + i,cc.Label)\r\n        }\r\n        this.addCommonClick(\"turnTableView/jifen/btn_rule\",this.onRuleBtnClicked,this)\r\n\r\n        this.maskNode =this.getChild(\"turnTableView/lunbo/mask\");\r\n        var tempItem:cc.RichText = this.getComponent(\"turnTableView/lunbo/mask/itemRichText\",cc.RichText)\r\n        tempItem.string = \"\";\r\n        for(var i = 0; i < 6; i++){\r\n            if(i > 0){\r\n                tempItem = cc.instantiate(tempItem.node).getComponent(cc.RichText);\r\n            }\r\n\r\n            this.itemArr.push(tempItem);\r\n            tempItem.node.setParent(this.maskNode);\r\n            tempItem.node.y = this.xyGapArr[1] - i * this.xyGapArr[3];\r\n        }\r\n        this.initSubViewClass(this.viewKeyTypeMap)\r\n        this.InitScripts()\r\n\r\n    }\r\n\r\n    async InitScripts() {\r\n        await this.initSubView(this.subViewPath,this.viewKeyTypeMap,this.getChild(\"turnTableView\"))\r\n    }\r\n\r\n    updateIndex(index) {\r\n        this.lunboIndex = index\r\n    }\r\n    onRuleBtnClicked() {\r\n        Global.UI.show(\"WndTurntableRule\")\r\n    }\r\n\r\n    refreshScore()\r\n    {\r\n        var data =this.model.data;\r\n        if(!data){\r\n            return;\r\n        }\r\n        this.labelArr[0].string = \"\" + data[\"coin\"];\r\n        this.labelArr[1].string = \"\" + data[\"week_login_coin\"];\r\n        this.labelArr[2].string = \"\" + data[\"week_bet_coin\"];\r\n        this.labelArr[3].string = \"\" + data[\"week_share_coin\"];\r\n        this.labelArr[4].string = \"\" + data[\"week_share_bet_coin\"];\r\n\r\n    }\r\n\r\n    protected onSubViewShow()\r\n    {\r\n        //this.model.reqActivityCfg()\r\n        //this.model.reqLunbo()\r\n        this.turnTable.subViewState = true\r\n        this.timer = setInterval(this.runCarousel.bind(this),this.frameTime)\r\n    }\r\n    \r\n    runCarousel() {\r\n        let dt = this.frameTime / 1000\r\n        if(this.lunboIndex < 0){\r\n            this.UpdateCarouselUI();\r\n            return;\r\n        }\r\n        var dis = dt * this.speed;\r\n        for(var i = 0; i < this.itemArr.length; i++){\r\n            var item:cc.RichText = this.itemArr[i];\r\n            item.node.y += dis;\r\n            if(item.node.y >= this.xyGapArr[1] + this.xyGapArr[3]){\r\n                item.node.y -= this.xyGapArr[3] * 6;\r\n                this.UpdateRichText(item);\r\n            }\r\n        }\r\n    }\r\n    \r\n\r\n    onDispose()\r\n    {\r\n        if(this.timer)\r\n        {\r\n            clearTimeout(this.timer)\r\n        } \r\n        this.model.off(ZhuanpanModel.RefreshRecordUI,this,this.updateIndex)\r\n        this.model.off(ZhuanpanModel.RefreshScore,this,this.refreshScore)\r\n    }\r\n\r\n    /**\r\n     * 更新显示\r\n     */\r\n    UpdateCarouselUI(){\r\n        var dataArr = ZhuanpanModel.instance.lunboDataArr;\r\n        if(dataArr.length > 0){\r\n            for(var i = 0; i < this.itemArr.length; i++){\r\n                var item:cc.RichText = this.itemArr[i];\r\n                this.UpdateRichText(item);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 更新单一轮播文本\r\n     * @param item \r\n     */\r\n    UpdateRichText(item:cc.RichText){\r\n        var dataArr = ZhuanpanModel.instance.lunboDataArr;\r\n        if(dataArr.length <= 0){\r\n            return;\r\n        }\r\n        this.lunboIndex++;\r\n        if(this.lunboIndex >= dataArr.length){\r\n            this.lunboIndex = 0;\r\n        }\r\n\r\n        var obj = dataArr[this.lunboIndex];\r\n        let color1 = Global.Setting.SkinConfig.zhuanpanColors[0];\r\n        let color2 = Global.Setting.SkinConfig.zhuanpanColors[1];\r\n        item.string = \"恭喜玩家<color=\" + color1 + \">\" + obj.name + \"</c>，获得<color=\" + color2 + \">\" + obj.point_name + \"</c>\";\r\n\r\n        if(this.lunboIndex == dataArr.length - 1){\r\n            //请求新的轮播数据\r\n            ZhuanpanModel.instance.reqLunbo(1000);\r\n        }\r\n    }\r\n\r\n\r\n    protected onSubViewHide()\r\n    {\r\n        if(this.timer)\r\n        {\r\n            clearTimeout(this.timer)\r\n        }\r\n    }\r\n\r\n   \r\n    \r\n}"]}