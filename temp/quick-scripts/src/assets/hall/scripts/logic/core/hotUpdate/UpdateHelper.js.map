{"version":3,"sources":["assets\\hall\\scripts\\logic\\core\\hotUpdate\\UpdateHelper.ts"],"names":[],"mappings":";;;;;;AAAA,2CAAsC;AAEtC;;;;;;;;;;;GAWG;AAEH;IAUI,sBAAY,UAAU,EAAE,WAAW,EAAE,UAAU,EAAE,oBAAoB;QATrE,SAAI,GAAG,EAAE,CAAC,CAAA,oBAAoB;QAC9B,cAAS,GAAG,EAAE,CAAC,CAAA,gBAAgB;QAC/B,UAAK,GAAG,EAAE,CAAC,CAAA,OAAO;QAClB,kBAAa,GAAG,EAAE,CAAC,CAAA,UAAU;QAC7B,iBAAY,GAAG,EAAE,CAAC,CAAC,UAAU;QAC7B,mBAAc,GAAG,EAAE,CAAC;QACpB,kBAAa,GAAG,EAAE,CAAC;QACnB,4BAAuB,GAAG,EAAE,CAAA;QAGxB,IAAI,CAAC,YAAY,GAAG,UAAU,CAAC;QAC/B,IAAI,CAAC,cAAc,GAAG,WAAW,CAAC;QAClC,IAAI,CAAC,aAAa,GAAG,UAAU,CAAC;QAChC,IAAI,CAAC,uBAAuB,GAAG,oBAAoB,CAAC;IACxD,CAAC;IACD,2BAAI,GAAJ,UAAK,QAAQ,EAAE,IAAW;QAAX,qBAAA,EAAA,WAAW;QACtB,IAAI,cAAc,GAAG,IAAI,CAAC;QAC1B,IAAI,cAAc,IAAI,IAAI,EAAE;YACxB,cAAc,GAAG,EAAE,CAAC,CAAA,gCAAgC;SACvD;QACD,MAAM,CAAC,GAAG,CAAC,8BAA8B,EAAE,cAAc,CAAC,CAAC;QAC3D,IAAI,cAAc,EAAE;YAChB,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;SAC7B;QAED,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;QAExB,IAAI,GAAG,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC;QACxB,IAAI,IAAI,GAAG,IAAI,CAAC,cAAc,EAAE,CAAC;QACjC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,CAAC;QACxB,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,cAAc,EAAE,CAAC,CAAC;IAC5C,CAAC;IAEM,+BAAQ,GAAf,UAAgB,GAAS;QACrB,IAAI,GAAG;YAAE,IAAI,CAAC,SAAS,GAAG,GAAG,CAAC;QAC9B,OAAO,IAAI,CAAC,SAAS,CAAC;IAC1B,CAAC;IACD,0BAAG,GAAH,UAAI,GAAG;QACH,IAAI,GAAG;YAAE,IAAI,CAAC,IAAI,GAAG,GAAG,CAAC;QACzB,OAAO,IAAI,CAAC,IAAI,CAAC;IACrB,CAAC;IACD,2BAAI,GAAJ,UAAK,GAAG;QACJ,IAAI,GAAG;YAAE,IAAI,CAAC,KAAK,GAAG,GAAG,CAAC;QAC1B,OAAO,IAAI,CAAC,KAAK,CAAC;IACtB,CAAC;IACD,kCAAW,GAAX,UAAY,GAAS;QACjB,IAAI,GAAG;YAAE,IAAI,CAAC,aAAa,GAAG,GAAG,CAAC;QAClC,OAAO,IAAI,CAAC,aAAa,CAAC;IAC9B,CAAC;IACD,iCAAU,GAAV,UAAW,GAAS;QAChB,IAAI,GAAG;YAAE,IAAI,CAAC,YAAY,GAAG,GAAG,CAAC;QACjC,OAAO,IAAI,CAAC,YAAY,CAAC;IAC7B,CAAC;IACD,kCAAW,GAAX,UAAY,GAAS;QACjB,IAAI,GAAG;YAAE,IAAI,CAAC,cAAc,GAAG,GAAG,CAAC;QACnC,OAAO,IAAI,CAAC,cAAc,CAAC;IAC/B,CAAC;IACD,kCAAW,GAAX,UAAY,GAAS;QACjB,IAAI,GAAG;YAAE,IAAI,CAAC,aAAa,GAAG,GAAG,CAAC;QAClC,OAAO,IAAI,CAAC,aAAa,CAAC;IAC9B,CAAC;IACD,qCAAc,GAAd,UAAe,QAAc;QACzB,IAAI,CAAC,EAAE,CAAC,GAAG,CAAC,QAAQ;YAAE,OAAO,EAAE,CAAC;QAChC,QAAQ,GAAG,QAAQ,IAAI,IAAI,CAAC,QAAQ,EAAE,CAAC;QACvC,OAAO,CAAC,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC,CAAC,GAAG,CAAC,SAAS,CAAC,eAAe,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,UAAU,EAAE,GAAG,GAAG,GAAG,QAAQ,CAAC,CAAC;IAC1G,CAAC;IACD,6BAAM,GAAN,UAAO,IAAU,EAAE,QAAc;QAC7B,QAAQ,GAAG,QAAQ,IAAI,IAAI,CAAC,QAAQ,EAAE,CAAC;QACvC,IAAI,GAAG,GAAG,MAAM,CAAC,gBAAgB,CAAC,YAAY,GAAG,GAAG,CAAC,CAAC,SAAS;QAC/D,OAAO,GAAG,GAAG,QAAQ,CAAC;IAC1B,CAAC;IACD,iCAAU,GAAV,UAAW,QAAQ;QACf,IAAI,KAAK,GAAG,iBAAO,CAAC,UAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC;QAC9E,QAAQ,GAAG,QAAQ,IAAI,IAAI,CAAC,QAAQ,EAAE,CAAC;QACvC,IAAI,SAAS,GAAG,IAAI,CAAC,uBAAuB,GAAG,QAAQ,CAAC;QACxD,EAAE,CAAC,GAAG,CAAC,YAAY,CAAC,OAAO,CAAC,SAAS,EAAE,QAAQ,CAAC,CAAC;IACrD,CAAC;IACD,sCAAe,GAAf,UAAgB,QAAQ;QACpB,QAAQ,GAAG,QAAQ,IAAI,IAAI,CAAC,QAAQ,EAAE,CAAC;QACvC,IAAI,SAAS,GAAG,IAAI,CAAC,uBAAuB,GAAG,QAAQ,CAAC;QACxD,EAAE,CAAC,GAAG,CAAC,YAAY,CAAC,OAAO,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;QAC3C,MAAM,CAAC,gBAAgB,CAAC,wBAAwB,CAAC,QAAQ,CAAC,CAAA;IAC9D,CAAC;IACD,mCAAY,GAAZ,UAAa,QAAQ;QACjB,QAAQ,GAAG,QAAQ,IAAI,IAAI,CAAC,QAAQ,EAAE,CAAC;QACvC,IAAI,SAAS,GAAG,IAAI,CAAC,uBAAuB,GAAG,QAAQ,CAAC;QACxD,sBAAsB;QACtB,+CAA+C;QAC/C,wCAAwC;QACxC,IAAI,WAAW,GAAG,EAAE,CAAC,GAAG,CAAC,YAAY,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;QACzD,4CAA4C;QAC5C,OAAO,WAAW,KAAK,QAAQ,CAAC,QAAQ,EAAE,CAAC;IAC/C,CAAC;IACD,6BAAM,GAAN;QACI,uDAAuD;IAC3D,CAAC;IAEL,mBAAC;AAAD,CAlGA,AAkGC,IAAA","file":"","sourceRoot":"/","sourcesContent":["import Toolkit from \"../tool/Toolkit\";\r\n\r\n/**\r\n1 初始热更地址 动态话 可以从一下2个方式获取 openinstall /svr  每次获取就写入缓存 如果缓存有的话 就读取缓存  ？是否需要对缓存做操作指令 \r\n\r\n2 热更新管理器\r\n 负责设置要更新的游戏 \r\n 获取要更新的地址目录 通常为/gameName\r\n 获取更新后本地保存地址 \r\n 设置热更皮肤 \r\n 设置热更地址 \r\n 启动热更UI \r\n 内存常驻 \r\n**/\r\n\r\nexport default class UpdateHelper {\r\n    _url = '';// 热更地址  通过改变这个能换皮肤 \r\n    _gameType = '';// 需要更新的子游戏 、大厅 \r\n    _skin = '';// 皮肤类型\r\n    _storage_path = '';// 本地缓存路径 \r\n    _root_folder = \"\"; // 本地缓存跟目录\r\n    _proj_cfg_file = \"\";\r\n    _ver_cfg_file = \"\";\r\n    _downloaded_storage_key = \"\"\r\n\r\n    constructor(rootFolder, projCfgFile, verCfgFile, downloadedStorageKey) {\r\n        this._root_folder = rootFolder;\r\n        this._proj_cfg_file = projCfgFile;\r\n        this._ver_cfg_file = verCfgFile;\r\n        this._downloaded_storage_key = downloadedStorageKey;\r\n    }\r\n    init(gameType, skin = null) {\r\n        var skilFolderName = skin;\r\n        if (skilFolderName == null) {\r\n            skilFolderName = '';//appBaseData.upDataFolderName; \r\n        }\r\n        Logger.log('game XXXXX skilFolderName = ', skilFolderName);\r\n        if (skilFolderName) {\r\n            this.skin(skilFolderName);\r\n        }\r\n\r\n        this.gameType(gameType);\r\n\r\n        let url = this.genUrl();\r\n        let path = this.genStoragePath();\r\n        this.url(this.genUrl());\r\n        this.storagePath(this.genStoragePath());\r\n    }\r\n\r\n    public gameType(val?: any): any {\r\n        if (val) this._gameType = val;\r\n        return this._gameType;\r\n    }\r\n    url(val) {\r\n        if (val) this._url = val;\r\n        return this._url;\r\n    }\r\n    skin(val) {\r\n        if (val) this._skin = val;\r\n        return this._skin;\r\n    }\r\n    storagePath(val?: any) {\r\n        if (val) this._storage_path = val;\r\n        return this._storage_path;\r\n    }\r\n    rootFolder(val?: any): any {\r\n        if (val) this._root_folder = val;\r\n        return this._root_folder;\r\n    }\r\n    prjFileName(val?: any) {\r\n        if (val) this._proj_cfg_file = val;\r\n        return this._proj_cfg_file;\r\n    }\r\n    verFileName(val?: any): any {\r\n        if (val) this._ver_cfg_file = val;\r\n        return this._ver_cfg_file;\r\n    }\r\n    genStoragePath(gameType?: any): any {\r\n        if (!cc.sys.isNative) return '';\r\n        gameType = gameType || this.gameType();\r\n        return ((jsb.fileUtils ? jsb.fileUtils.getWritablePath() : '/') + this.rootFolder() + '/' + gameType);\r\n    }\r\n    genUrl(skin?: any, gameType?: any): any {\r\n        gameType = gameType || this.gameType();\r\n        let url = Global.HotUpdateManager.hotUpdateUrl + \"/\"; //子游戏更新地址\r\n        return url + gameType;\r\n    }\r\n    downloaded(gameType) {\r\n        var value = Toolkit.underscore.isNull(gameType) ? this.gameType() : undefined;\r\n        gameType = gameType || this.gameType();\r\n        var store_key = this._downloaded_storage_key + gameType;\r\n        cc.sys.localStorage.setItem(store_key, gameType);\r\n    }\r\n    clearDownloaded(gameType){\r\n        gameType = gameType || this.gameType();\r\n        var store_key = this._downloaded_storage_key + gameType;\r\n        cc.sys.localStorage.setItem(store_key, \"\");\r\n        Global.HotUpdateManager.removeNativeHotUpdateDir(gameType)\r\n    }\r\n    isDownloaded(gameType) {\r\n        gameType = gameType || this.gameType();\r\n        var store_key = this._downloaded_storage_key + gameType;\r\n        // @krisirk temp debug\r\n        // cc.sys.localStorage.removeItem( store_key );\r\n        // Logger.log('store key:' + store_key);\r\n        var store_value = cc.sys.localStorage.getItem(store_key);\r\n        // Logger.log('store value:' + store_value);\r\n        return store_value === gameType.toString();\r\n    }\r\n    showUI() {\r\n        // var isHall = this.gameType() === cc.GAME_TYPES.HALL;\r\n    }\r\n\r\n}\r\n"]}