{"version":3,"sources":["assets\\hall\\scripts\\logic\\core\\component\\PaoMaDengCompNew.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import AppHelper from \"../tool/AppHelper\";\r\nimport PoolBase from \"../tool/PoolBase\";\r\nimport PaoMaDengItem from \"./PaoMaDengItem\";\r\n\r\n// Learn TypeScript:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/typescript.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n/**跑马灯通用组件 */\r\n@ccclass\r\nexport default class PaoMaDengCompNew extends cc.Component {\r\n\r\n  \r\n    /**\r\n     * 根节点，无消息时隐藏\r\n     */\r\n    rootNode: cc.Node = null;\r\n\r\n    private itemPool:PaoMaDengItemPool = null\r\n    private nodeList = []\r\n    private copyNode:cc.Node\r\n    private nodePoolLen:number = 3\r\n    private poolNode:cc.Node\r\n    private startPos = cc.v2(1170,260)\r\n\r\n    private currentUsedPaoMaDeng = []\r\n\r\n    public initNode(poolCount)\r\n    {\r\n        this.nodePoolLen = poolCount\r\n        this.copyNode = this.node.getChildByName(\"PaoMaDengBoxItem\")\r\n        this.poolNode = this.node.getChildByName(\"poolNode\")\r\n        if(!cc.isValid(this.copyNode))\r\n        {\r\n            return\r\n        }\r\n        this.copyNode.active = false\r\n        this.itemPool = new PaoMaDengItemPool(this.copyNode)\r\n        for (let index = 0; index < this.nodePoolLen; index++) {\r\n            let item:cc.Node = this.itemPool.getItem()   \r\n            if(cc.isValid(item))\r\n            {\r\n                item.setPosition(this.startPos)\r\n                this.poolNode.addChild(item)\r\n                this.nodeList.push(item)\r\n            }\r\n        }\r\n        this.itemPool.recycleAll(this.nodeList)\r\n\r\n    }\r\n\r\n    onLoad()\r\n    {\r\n        cc.game.on(cc.game.EVENT_HIDE, this.onHide, this);\r\n        cc.game.on(cc.game.EVENT_SHOW, this.onResume, this);\r\n    }\r\n\r\n\r\n    private onHide()\r\n    {\r\n        this.stopTimer();\r\n        this.pause()\r\n    }\r\n\r\n    private onResume()\r\n    {\r\n        this.startTimer();\r\n        this.resume()\r\n    }\r\n    \r\n    /**\r\n     * \r\n     * @param bAddDefaultMsg 是否添加默认跑马灯\r\n     */\r\n    run(bAddDefaultMsg)\r\n    {\r\n        if(bAddDefaultMsg)\r\n        {\r\n            this.addDefautMsg()\r\n        }\r\n        this.startTimer();\r\n\r\n      \r\n\r\n    }\r\n    private getPaoMaDengItem(msg)\r\n    {\r\n\r\n        let item:cc.Node = this.itemPool.getItem()\r\n        if(cc.isValid(item))\r\n        {\r\n            \r\n            let itemComp = item.getComponent(PaoMaDengItem)\r\n            this.currentUsedPaoMaDeng.push(itemComp)\r\n            let callback = ()=>{\r\n                let itemNode = this.currentUsedPaoMaDeng.shift()\r\n                itemNode.recoveryItem(itemNode.playNode)\r\n                this.itemPool.recycleItem(itemNode.node)\r\n\r\n            }\r\n            if(itemComp)\r\n            {\r\n                let currentRunnig = this.getCurrentRunning()\r\n                this.currentUsedPaoMaDeng.forEach(element => {\r\n                    if(element.isPlaying && currentRunnig >= this.nodePoolLen -1)\r\n                    {\r\n                        element.moveUp(callback)\r\n                    }\r\n                    \r\n                });\r\n                itemComp.node.active = true\r\n                itemComp.run(msg,currentRunnig,this.nodePoolLen -1)\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 获取当前正在使用的跑马灯数量\r\n     */\r\n    private getCurrentRunning()\r\n    {\r\n        let count = 0\r\n        this.currentUsedPaoMaDeng.forEach(element => {\r\n            if(element.isPlaying)\r\n            {\r\n                count += 1\r\n            }\r\n            \r\n        });\r\n\r\n        return count\r\n\r\n    }\r\n\r\n\r\n\r\n  \r\n    //轮询Timer\r\n    private checkTimer = null;\r\n\r\n    //消息缓存队列\r\n    private msgDataCacheList = [];\r\n    //消息队列缓存长度限制\r\n    private listLengthLimit = 8;\r\n\r\n    //所有优先级的总长度\r\n    private totalLenghLimit = 10;\r\n\r\n    //跑马灯遮罩宽度\r\n    private boxLength = 600;\r\n    //跑马灯速度\r\n    private baseSpeed = 120;\r\n\r\n\r\n    //界面销毁\r\n    protected onDestroy() {\r\n        this.stopTimer();\r\n        if (this.itemPool)\r\n            this.itemPool.resetPool()\r\n        this.nodeList = [];\r\n        this.currentUsedPaoMaDeng = []\r\n        cc.game.off(cc.game.EVENT_HIDE, this.onHide, this);\r\n        cc.game.off(cc.game.EVENT_SHOW, this.onResume, this);\r\n    }\r\n\r\n    onEnable() {\r\n        this.startTimer();\r\n    }\r\n\r\n    onDisable() {\r\n        this.reset()\r\n        this.stopTimer();\r\n    }\r\n\r\n\r\n\r\n    startTimer() {\r\n        if (this.checkTimer == null) {\r\n            this.checkTimer = setInterval(this.checkMsgList.bind(this), 1000);\r\n\r\n            Global.Event.on(GlobalEvent.MARQUEESCROLL_COMMON, this, this.addMsgData);\r\n            Global.Event.on(GlobalEvent.MARQUEESCROLL_BIGWINNER, this, this.addMsgData);\r\n            Global.Event.on(GlobalEvent.MARQUEESCROLL_VIP, this, this.addPriorityMsgData);\r\n            Global.Event.on(GlobalEvent.MARQUEESCROLL_COMMI, this, this.addPriorityMsgData);\r\n        }\r\n    }\r\n\r\n    stopTimer() {\r\n        if (this.checkTimer) {\r\n            Global.Event.off(GlobalEvent.MARQUEESCROLL_COMMON, this, this.addMsgData);\r\n            Global.Event.off(GlobalEvent.MARQUEESCROLL_BIGWINNER, this, this.addMsgData);\r\n            Global.Event.off(GlobalEvent.MARQUEESCROLL_VIP, this, this.addPriorityMsgData);\r\n            Global.Event.off(GlobalEvent.MARQUEESCROLL_COMMI, this, this.addPriorityMsgData);\r\n\r\n            clearInterval(this.checkTimer);\r\n            this.checkTimer = null;\r\n        }\r\n    }\r\n    \r\n    addPriorityMsgData(data) {\r\n        if(this.node == null || !this.node.isValid)\r\n        {\r\n            this.stopTimer();\r\n            return;\r\n        }\r\n        //缓存数量大于10 任何消息都丢\r\n        if(this.msgDataCacheList.length >= this.totalLenghLimit)\r\n        {\r\n            this.msgDataCacheList.pop()\r\n            this.msgDataCacheList.unshift(data.data)\r\n            return;\r\n        }\r\n        this.msgDataCacheList.unshift(data.data)\r\n\r\n    }\r\n\r\n    \r\n\r\n    /**\r\n     * data ={  game_id: 1007\r\n                game_level: \"l0\"\r\n                game_rule: \"default\"\r\n                headimg: \"7\"\r\n                hitPoint: 5434000\r\n                nickname: \"鱼一直下\"\r\n        }\r\n     */\r\n    private checkMsgList() {\r\n        try {\r\n            if (!this.node || !this.node.isValid)\r\n                return;\r\n          \r\n            if (this.msgDataCacheList.length == 0) return;\r\n            var data = this.msgDataCacheList.shift();\r\n            this.getPaoMaDengItem(data);\r\n           \r\n        } catch (error) {\r\n            //this.stopTimer();\r\n            Logger.error(error);\r\n        }\r\n    }\r\n\r\n    private pause()\r\n    {\r\n        this.nodeList.forEach((item)=>{\r\n            let paomadengItem = item.getComponent(PaoMaDengItem)\r\n            if(paomadengItem && cc.isValid(paomadengItem.node))\r\n            {\r\n                paomadengItem.node.pauseAllActions()\r\n            }\r\n        })\r\n    }\r\n\r\n    private resume()\r\n    {\r\n        this.nodeList.forEach((item)=>{\r\n            let paomadengItem = item.getComponent(PaoMaDengItem)\r\n            if(paomadengItem && cc.isValid(paomadengItem.node))\r\n            {\r\n                paomadengItem.node.resumeAllActions()\r\n            }\r\n        })\r\n    }\r\n\r\n\r\n    private reset() {\r\n        this.currentUsedPaoMaDeng = []\r\n        this.nodeList.forEach((item)=>{\r\n            let paomadengItem = item.getComponent(PaoMaDengItem)\r\n            if(paomadengItem)\r\n            {\r\n                paomadengItem.recoveryItem(paomadengItem.playNode)\r\n                this.itemPool.recycleItem(paomadengItem.node)\r\n            }\r\n        })\r\n    }\r\n\r\n    /**\r\n     * 排序方法,子类可重写\r\n     * @param dataA \r\n     * @param dataB \r\n     */\r\n    protected dataSortFunc(dataA: any, dataB: any) {\r\n        return dataA.type - dataB.type;\r\n    }\r\n\r\n    /**\r\n     * 添加跑马灯数据\r\n     * @param data {\r\n            msg,\r\n            type,\r\n     * }\r\n     */\r\n    protected addMsgItem(data: any) {\r\n        if(this.node == null || !this.node.isValid)\r\n        {\r\n            this.stopTimer();\r\n            return;\r\n        }\r\n\r\n\r\n        //缓存数量大于10 任何消息都丢\r\n        if(this.msgDataCacheList.length >= this.totalLenghLimit)\r\n        {\r\n            return;\r\n        }\r\n\r\n        //当数据大于8时，优先插入高优先级数据\r\n        if(this.msgDataCacheList.length >= this.listLengthLimit)\r\n        {\r\n            if(data.clientPriority != null && data.clientPriority == 0 && data.nickname != null)\r\n            {\r\n                return;\r\n            }\r\n        }\r\n\r\n        this.msgDataCacheList.push(data);\r\n    }\r\n\r\n    public addDefautMsg() {\r\n        let msgList = [\r\n            { msg: PaoMaDengMsgTemp.Welcome, type: 1 },\r\n            { msg: PaoMaDengMsgTemp.TipBadGame, type: 1 },\r\n            { msg: PaoMaDengMsgTemp.NoWallow, type: 1 },\r\n        ]\r\n        for (let index = 0; index < msgList.length; index++) {\r\n            const data = msgList[index];\r\n            this.addMsgItem(data);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @param msg {\r\n                type : 20001,\r\n                data : {\r\n                    type : 0 , \r\n                    msg : \"<color=#FF0000>TestData!!!!!!!!!!!!!!</color>\"\r\n                },\r\n            }\r\n     */\r\n    private addMsgData(msg: any) {\r\n        if(msg.data.game_id)\r\n        {\r\n            let gameInfo = Global.GameData.getGameInfo(msg.data.game_id);\r\n            if (gameInfo.status != 1) {\r\n                return\r\n            }\r\n            if (!gameInfo || gameInfo.name == null) {\r\n                Logger.error(\"找不到gameid\", msg.data.game_id);\r\n                return;\r\n            }\r\n        }\r\n        this.addMsgItem(msg.data);\r\n    }\r\n\r\n\r\n\r\n}\r\nclass PaoMaDengItemPool extends PoolBase{\r\n    constructor(private copyNode: cc.Node){\r\n        super();\r\n    }\r\n    protected createItem(){\r\n        return cc.instantiate(this.copyNode);\r\n    }\r\n\r\n    protected resetItem(node: cc.Node){\r\n        node.stopAllActions()\r\n        node.active = false;\r\n    }\r\n    public recycleAll(arr: Array<any>)\r\n    {\r\n        super.recycleAll(arr)\r\n        arr.forEach(ele => {\r\n            this.resetItem(ele);\r\n        });\r\n\r\n    }\r\n}\r\n\r\nexport enum PaoMaDengMsgTemp{\r\n    Welcome = \"尊敬的玩家，欢迎进入游戏大厅！\",\r\n    TipBadGame = \"抵制不良游戏，拒绝盗版游戏，注意自身保护，谨防上当受骗\",\r\n    NoWallow = \"适度游戏益脑，沉迷游戏伤身，合理安排时间，享受健康生活\",\r\n}\r\n"]}