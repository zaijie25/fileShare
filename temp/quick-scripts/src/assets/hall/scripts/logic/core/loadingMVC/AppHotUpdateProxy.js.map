{"version":3,"sources":["assets\\hall\\scripts\\logic\\core\\loadingMVC\\AppHotUpdateProxy.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\r\nimport LoadingFacade from \"./LoadingFacade\";\r\nimport Const from \"./LoadingConst\";\r\nimport { ReportTool } from \"../tool/ReportTool\";\r\nimport HallStorageKey from \"../../hallcommon/const/HallStorageKey\";\r\n/**\r\n * 当前热更阶段\r\n */\r\nexport enum HotUpdateContext\r\n{\r\n\r\n    none = -1,\r\n    app = 0,\r\n    hall = 1,\r\n    main = 2,\r\n}\r\n\r\n// 大厅部分热更\r\nexport default class AppHotUpdateProxy extends puremvc.Proxy {\r\n    facade: LoadingFacade;\r\n\r\n    localManifestJsonObj: any; // 本地manifest对象\r\n    localManifest: any;\r\n\r\n    currentContext:HotUpdateContext // 当前热更阶段\r\n    _currentVersion: string; // 本地当前版本\r\n    _newestVersion: string; // 最新版本\r\n    _storagePath: string;  // 热更存储路径\r\n    _updating: boolean;    // 是否正在热更\r\n    _needUpdate: boolean;  // 是否需要热更\r\n    _assetsMgr: jsb.AssetsManager; \r\n    totalAssetByte = 0 //manifest上标记的总size\r\n    totalFileCount = 0 //总共下载文件数量\r\n    totalByte = 0 //总共下载文件大小\r\n    startTime = 0 // 开始下载事件\r\n    downLoadType = 0 // 下载类型 0 从零开始下载 1 热更新\r\n    appStartVer = \"0.0.0\" // app独立包开始热更版本\r\n    hallStyleStartver = \"0.0.0\" // 大厅风格独立包开始热更版本\r\n    mainBundleStartVer = \"0.0.0\" // 主包开始热更版本\r\n    startVer = \"0.0.0\"\r\n    targetVer = \"0.0.0\"\r\n    targetAppVer = \"0.0.0\"\r\n    targetHallStyleVer = \"0.0.0\"\r\n    targetMainBundleVer = \"0.0.0\"\r\n    hallTotalSize = 0\r\n    mainTotalSize = 0\r\n    hallTotalFilecount = 0\r\n    mainTotalFilecount = 0\r\n\r\n    _canRetry: boolean;  //是否重试\r\n    _faildRes: any;      // 失败资源\r\n\r\n    projectManifestNativeUrl: string [];\r\n\r\n    updateFailTimes = 0\r\n    currentManifestUrl:string // 当前随包资源url\r\n\r\n    checkVersionData:any;\r\n\r\n    needRestart = false\r\n\r\n    loadVersion = false\r\n    isAwait = false\r\n\r\n    updateCount = -1\r\n    updateFinishedSubCount = 0\r\n\r\n    /**\r\n     * 当前子热更名\r\n     */\r\n    hotUpdateNameObj = {\r\n        \"-1\":null,\r\n        \"0\":\"app\",\r\n        \"1\":\"hall_style\",\r\n        \"2\":\"main\"\r\n    }\r\n\r\n\r\n    //服务器返回的热更地址\r\n    private serverHotupdateUrl = \"\"\r\n    private serverVersion = \"\"\r\n\r\n    static NAME = \"AppHotUpdateProxy\";\r\n\r\n    constructor(manifests:cc.Asset[]) {\r\n        super();\r\n        // Logger.log(\"----------HotUpdateProxy-------\" + manifest.nativeUrl)\r\n        this.proxyName = AppHotUpdateProxy.NAME;\r\n        this.currentContext = HotUpdateContext.none\r\n        this.projectManifestNativeUrl = this.getNativeUrl(manifests);\r\n        this.currentManifestUrl = \"\"\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param manifest 组装随包资源文件\r\n     */\r\n    getNativeUrl(manifest:cc.Asset[])\r\n    {\r\n        if(!manifest || manifest.length == 0)\r\n        {\r\n            return null\r\n        }\r\n        let nativeUrls : string[] = []\r\n        for (let index = 0; index < manifest.length; index++) {\r\n            const element = manifest[index];\r\n            nativeUrls.push(manifest[index].nativeUrl)\r\n        }\r\n        return nativeUrls\r\n\r\n    }\r\n\r\n    reportLog(result = 1,key = ReportTool.REPORT_TYPE_DOWNLOADSUBGAME_RESULT ,failedRes = \"\" ) {\r\n        let totalTime = new Date().getTime() - this.startTime\r\n        if(this.totalAssetByte && this.totalAssetByte != this.totalByte && result == 1)\r\n        {\r\n            result = 2\r\n        }\r\n        if(!this.totalAssetByte)\r\n        {\r\n            this.totalAssetByte = 0\r\n        }\r\n        this.totalAssetByte = Number(this.totalAssetByte) || 0\r\n        \r\n        let retryTimes = cc.sys.localStorage.getItem(\"errorReStartTimes\")\r\n\r\n        retryTimes  = Number(retryTimes) || 0\r\n\r\n        this.totalByte = this.hallTotalSize + this.mainTotalSize\r\n        this.totalFileCount = this.hallTotalFilecount + this.mainTotalFilecount\r\n        let reportParam = {\r\n            \"result\": result,\r\n            \"game\": 0,\r\n            \"totalFileCount\": this.totalFileCount,\r\n            \"totalByte\": this.totalByte/1000,\r\n            \"totalTime\": totalTime / 1000,\r\n            \"downLoadType\": this.downLoadType,\r\n            \"updateUrl\": Global.HotUpdateManager.hotUpdateUrl,\r\n            \"startVer\": this.startVer,\r\n            \"totalAssetsBytes\": this.totalAssetByte/1000,\r\n            \"targetVer\": this.targetVer,\r\n            \"appBundleStartVer\":this.appStartVer,\r\n            \"hallStyleStartVer\":this.hallStyleStartver,\r\n            \"mainBundleStartVer\":this.mainBundleStartVer,\r\n            \"targetAppBundlever\":Global.Setting.Urls.appVersion,\r\n            \"targetHallStyleVer\":this.targetHallStyleVer,\r\n            \"targeMainBundleVer\":this.targetMainBundleVer,\r\n            \"retryTimes\": Number(retryTimes),\r\n            \"appVersion\":Global.Setting.SystemInfo.appVersion,\r\n            \"dun\":Global.DunHotUpdateUrlSetting.curDunType,\r\n            \"failedRes\":failedRes\r\n        }\r\n        if(!result)\r\n        {\r\n            Global.ReportTool.ReportClientError(key, reportParam);\r\n            return\r\n        }\r\n        Global.ReportTool.ReportPublicClientLog(key, reportParam);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param hotUpdateContext 获取当前热更子路径\r\n     */\r\n    getCurrentHotUpdateName(hotUpdateContext:HotUpdateContext)\r\n    {\r\n        if(hotUpdateContext == HotUpdateContext.none)\r\n        {\r\n            return \"\"\r\n        }\r\n\r\n        if(hotUpdateContext != HotUpdateContext.hall )\r\n        {\r\n            return this.hotUpdateNameObj[hotUpdateContext] \r\n        }\r\n        let path =  \"assets/\" + Global.customApp.getHallBundleName()\r\n        return path\r\n    }\r\n    /**\r\n     * 获取本地manifest路径\r\n     */\r\n    getLocalHotUpdatePath()\r\n    {\r\n        let rootPath = ((jsb.fileUtils ? jsb.fileUtils.getWritablePath() : '/') + Global.HotUpdateManager.hotUpdateDirName + \"/\" + Global.HotUpdateManager.hallHotUpdateDirName + \"/\" )\r\n        return rootPath\r\n    }\r\n\r\n   \r\n    onRegister() {\r\n        // //初始化system信息\r\n        // Global.Setting.SystemInfo.Version = \"1.0.5\";\r\n    }\r\n    /**\r\n     * _versionCompare\r\n     */\r\n    _versionCompare(versionA: string, versionB: string) {\r\n        // var vA = versionA.split('.');\r\n      //  console.log(\"JS 自定义版本比较: version A : \" + versionA + ', version B : ' + versionB);\r\n        return versionA === versionB ? 0 : -1;\r\n        // var vB = versionB.split('.');\r\n        // this._currentVersion = versionA;\r\n        // this._newestVersion = versionB;\r\n        // for (var i = 0; i < vA.length; ++i) {\r\n        //     var a = parseInt(vA[i]);\r\n        //     var b = parseInt(vB[i] || \"0\");\r\n        //     if (a === b) { continue; }\r\n        //     else { return a - b; }\r\n        // }\r\n        // if (vB.length > vA.length) { return -1; }\r\n        // else { return 0; }\r\n    }\r\n\r\n\r\n    preUpdate(hotUpdateUrl: string, version: string,HotUpdatePath: string)\r\n    {\r\n        if (!Global.Setting.isStartHotUpdate) {\r\n            this.next();\r\n            return;\r\n        }\r\n      //  console.log(\"开始检查更新\",hotUpdateUrl,version,HotUpdatePath)\r\n        this.sendNotification(Const.SHOW_CHECK_LABEL, { parm: \"检查更新中...\" })\r\n        Global.HotUpdateManager.hotUpdateUrl = hotUpdateUrl\r\n        this.serverHotupdateUrl = `${Global.HotUpdateManager.hotUpdateUrl}/${HotUpdatePath}/${version}/main/`;\r\n        let versionUrl = this.serverHotupdateUrl + Global.HotUpdateManager.versionCfgFileName;\r\n        console.log(\"这是当前开始更新整地址=\"+versionUrl)\r\n        Global.HotUpdateManager.getGameVersion(versionUrl).then(data=>{\r\n            let nativeVersion = Global.HotUpdateManager.getNativeHotUpdateVersion(\"hall\");\r\n            this.serverVersion = data.version\r\n            console.log(\"main本地=\"+nativeVersion+\"远程版本=\"+this.serverVersion)\r\n            if (Global.Toolkit.versionCompare(this.serverVersion, nativeVersion) == 0) {\r\n                console.log(\"本地版本与服务器版本号一致\")\r\n                this.checkNext();\r\n                return;\r\n            }\r\n            Global.UI.show(\"WndGameUpgrade\")\r\n            this._storagePath = this.getLocalHotUpdatePath()\r\n         //   console.log(\"这是当前原生的地址\", this._storagePath)\r\n            this.localManifestJsonObj = Global.HotUpdateManager.getManifestObj(this.serverHotupdateUrl, this.getLocalHotUpdatePath())\r\n          //  console.log(\"这是当前原生的地址1111111111\", JSON.stringify(this.localManifestJsonObj));\r\n            let storageManifestUrl = this._storagePath + '/' + Global.HotUpdateManager.projectCfgFileName;\r\n            jsb.fileUtils.writeStringToFile(JSON.stringify(this.localManifestJsonObj), storageManifestUrl)\r\n            this._assetsMgr = new jsb.AssetsManager(\"\", this._storagePath, this._versionCompare.bind(this))\r\n            this._assetsMgr.setVerifyCallback(this._cbVerify.bind(this))\r\n            if (cc.sys.os === cc.sys.OS_ANDROID) {\r\n                this._assetsMgr.setMaxConcurrentTask(10)\r\n            }\r\n            this.checkUpdate();\r\n        },()=>{\r\n            this.downloadVerFaild(hotUpdateUrl,version,HotUpdatePath)\r\n        })\r\n    }\r\n   \r\n\r\n    \r\n    /**\r\n     * 保存文件到本地\r\n     * @param filepath \r\n     * @param data \r\n     * @param callback \r\n     */\r\n    saveVerFileToNative(filepath, data, callback?) {\r\n        let hotUpdatePath = ((jsb.fileUtils ? jsb.fileUtils.getWritablePath() : '/') + Global.HotUpdateManager.hotUpdateDirName + \"/\" + Global.HotUpdateManager.hallHotUpdateDirName)\r\n        if(!jsb.fileUtils.isDirectoryExist(hotUpdatePath))\r\n        {\r\n            jsb.fileUtils.createDirectory(hotUpdatePath)\r\n        }\r\n        if (typeof data !== 'undefined') {\r\n            if (jsb.fileUtils.writeDataToFile(new Uint8Array(data), filepath)) {\r\n                cc.log('DiantaiItem Remote write file succeed.');\r\n                if (callback) {\r\n                    callback();\r\n                }\r\n                return;\r\n            }\r\n        }\r\n    }\r\n    downloadVerFaild(hotUpdateUrl: string, version: string,HotUpdatePath:string) {\r\n        this.updateFailTimes += 1\r\n        let updateCallBackFunc = () => {\r\n            setTimeout(() => {\r\n                this.restartCheckUpdate();\r\n            }, 1000);\r\n        }\r\n        if (this.updateFailTimes > 2) {\r\n            Global.UI.showSingleBox(\"下载失败，请检查网络\",updateCallBackFunc,updateCallBackFunc );\r\n            return\r\n        }\r\n        //发送上报\r\n        let reportParam = { \"host\": hotUpdateUrl }\r\n        Global.ReportTool.ReportClientError(ReportTool.REPORT_TYPE_HOTUPDATE_HOST_ERROR, reportParam)\r\n\r\n\r\n        Global.UI.showSingleBox(\"下载失败，请检查网络\", this.preUpdate.bind(this, hotUpdateUrl, version,HotUpdatePath), this.preUpdate.bind(this, hotUpdateUrl, version,HotUpdatePath));\r\n    }\r\n    \r\n  \r\n\r\n    checkUpdate() {\r\n        if (this._updating) {\r\n            this.sendNotification(Const.SHOW_CHECK_LABEL, { parm: \"检查更新中...\" })\r\n            return;\r\n        }\r\n        if (this._assetsMgr.getState() === jsb.AssetsManager.State.UNINITED) {\r\n            let jsonStr = JSON.stringify(this.localManifestJsonObj)\r\n            this.localManifest = new jsb.Manifest(jsonStr, this._storagePath)\r\n            this._assetsMgr.loadLocalManifest(this.localManifest, this._storagePath);\r\n        }\r\n        // 更换 manifest 路径以后这里会报错\r\n        if (!this._assetsMgr.getLocalManifest() || !this._assetsMgr.getLocalManifest().isLoaded()) {\r\n            this.sendNotification(Const.SHOW_CHECK_LABEL, { parm:\"导入文件失败，建议重启游戏或重新下载最新版本\" })\r\n            return;\r\n        }\r\n\r\n        this._assetsMgr.setEventCallback(this._cbCheckUpdate.bind(this));\r\n        this._assetsMgr.checkUpdate();\r\n        this._updating = true;\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * _cbCheckUpdate\r\n     * \r\n     * ios10中，在弹出是否允许联网之前，会报：\r\n     * AssetsManagerEx : Fail to download version file, step skipped Code: 1\r\n     */\r\n    _cbCheckUpdate(event) {\r\n        switch (event.getEventCode()) {\r\n            case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:\r\n                //this.sendNotification(Const.SHOW_PROGRESS_BAR, { parm: -1 })\r\n                this.sendNotification(Const.SHOW_CHECK_LABEL, { parm: \"已经是最新版\" })\r\n                this.next();\r\n                this.updateFinishedSubCount += 1\r\n                return;\r\n                //version Update_progression在new version found之前\r\n            case jsb.EventAssetsManager.UPDATE_PROGRESSION:\r\n                if(event && event.getMessage() == \"VersionDownloaded\")\r\n                {\r\n                    Logger.error(\"VersionDownloaded formatVersion\")\r\n                    this.formatVersion();\r\n                }else if(event && event.getMessage() == \"ProjectDownloaded\")\r\n                {\r\n                    Logger.error(\"ProjectDownloaded formatManifest\")\r\n                    this.formatManifest();\r\n                }\r\n                return;\r\n            case jsb.EventAssetsManager.NEW_VERSION_FOUND:\r\n                //this.sendNotification(Const.SHOW_PROGRESS_BAR, { parm: 0 })\r\n                this._needUpdate = true;\r\n                break;\r\n            case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:\r\n            case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:\r\n            case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:\r\n                \r\n                // let reportParam = {\"game\":\"hall\",\"eventcode\":event.getEventCode(),\"event\":\"checkupdate\",\"url\":Global.Setting.Urls.hallHotUpdateUrl}\r\n                // Global.ReportTool.ReportClientError(ReportTool.REPORT_TYPE_HOT_UPDATE_ERROR,reportParam)\r\n                this.reportLog(0, ReportTool.REPORT_TYPE_DOWNLOADSUBGAME_FAILED)\r\n                this.sendNotification(Const.SHOW_CHECK_LABEL, { parm: \"下载失败，请检查网络\" })\r\n                let updateCallBackFunc = () => {\r\n                    setTimeout(() => {\r\n                        this.restartCheckUpdate();\r\n                    }, 1000);\r\n                }\r\n                Global.UI.showSingleBox(\"下载失败，请检查网络\", updateCallBackFunc, updateCallBackFunc);\r\n                // this._showRetryPanel( true );\r\n                break;\r\n            case jsb.EventAssetsManager.UPDATE_FINISHED:\r\n                this.checkNext();\r\n                this.updateFinishedSubCount += 1\r\n               \r\n                return\r\n            default:\r\n                return;\r\n        }\r\n        this._assetsMgr.setEventCallback(null);\r\n        this._updating = false;\r\n        this.hotUpdate();\r\n    }\r\n    async checkNext() {\r\n        this.sendNotification(Const.CLEAR_LOADING_TIMER)\r\n        if( this._assetsMgr)\r\n        {\r\n            this._assetsMgr.setEventCallback(null);\r\n            this._assetsMgr = null\r\n            this._updating = false\r\n        }\r\n        Global.HotUpdateManager.hotFailRes = \"\";\r\n        Global.HotUpdateManager.hotFaildNum = 0;\r\n        this.next() \r\n    }\r\n\r\n    restartCheckUpdate(autoRestart = true) {\r\n        Logger.error(\"restartCheckUpdate\")\r\n        if (this._assetsMgr) {\r\n            this._assetsMgr.setEventCallback(null);\r\n            this._updating = false;\r\n            this._assetsMgr = null;\r\n        }\r\n        if (autoRestart) {\r\n            let errorReStartTimes = cc.sys.localStorage.getItem(\"errorReStartTimes\")\r\n                if (errorReStartTimes != null && errorReStartTimes != \"\") {\r\n                    let num = Number(errorReStartTimes)\r\n                    if (num) {\r\n                        num++;\r\n                    } else {\r\n                        num = 1;\r\n                    }\r\n                    cc.sys.localStorage.setItem(\"errorReStartTimes\", num)\r\n                } else {\r\n                    cc.sys.localStorage.setItem(\"errorReStartTimes\", 1)\r\n                }\r\n            }\r\n            let storage_hall_urls = Global.Setting.storage.getObject(HallStorageKey.HotUpdateHosts)\r\n            if (!storage_hall_urls) {\r\n                Global.Setting.storage.setObject(HallStorageKey.HotUpdateHosts, Global.Setting.Urls.hallHotUpdateUrlArray)\r\n            }\r\n            //发送上报\r\n            let reportParam = { \"host\": Global.Setting.Urls.hallHotUpdateUrl }\r\n            Global.ReportTool.ReportClientError(ReportTool.REPORT_TYPE_HOTUPDATE_HOST_ERROR, reportParam)\r\n\r\n        this.clearDownloadTmpDir();\r\n        if (autoRestart) {\r\n            this.restartGame()\r\n        } else {\r\n            setTimeout(() => {\r\n                Global.UI.show(\"WndMessageBox\", \"修复完成，点击确定将重启游戏...\", 0, () => {\r\n                    this.restartGame()\r\n                }, () => {\r\n                    this.restartGame()\r\n                });\r\n            }, 300);\r\n\r\n        }\r\n\r\n    }\r\n\r\n    restartGame(){\r\n        Global.UI.clearAllUIPrefab();\r\n        Global.NativeEvent.unzipHallPackage();\r\n        setTimeout(() => {\r\n            cc.game.restart();\r\n        }, 1000);\r\n        \r\n    }\r\n\r\n    clearProjectManifest(){\r\n        let pathParam = this.getCurrentHotUpdateName(this.currentContext) \r\n        let path = cc.js.formatStr(\"hall/%s/\",pathParam)\r\n        Logger.error(\"clearProjectManifest--pathParam--path--\" ,pathParam,path)\r\n        let projectPath = Global.HotUpdateManager.updateHelper.genStoragePath(path) + Global.HotUpdateManager.projectCfgFileName;\r\n            if(jsb.fileUtils.isFileExist(projectPath))\r\n            {\r\n                Logger.error(\"remove file projectPath is exist = \" + projectPath)\r\n                jsb.fileUtils.removeFile(projectPath);\r\n            }else {\r\n                Logger.error(\"projectPath is not exist = \" + projectPath)\r\n            }\r\n    }\r\n\r\n    clearDownloadTmpDir(){\r\n        let path = this.getTempPath()\r\n        let tmpDowndloadPath = Global.HotUpdateManager.updateHelper.genStoragePath(path)\r\n        if (jsb.fileUtils.isDirectoryExist(tmpDowndloadPath)){\r\n            Logger.error(\"remove tmpDowndloadPath  = \" + tmpDowndloadPath)\r\n            jsb.fileUtils.removeDirectory(tmpDowndloadPath)\r\n        }else {\r\n            Logger.error(\"tmpDowndloadPath is not exist = \" + tmpDowndloadPath)\r\n        }\r\n    }\r\n\r\n    getTempPath()\r\n    {\r\n        let path = \"hall_temp\"\r\n        return path\r\n    }\r\n\r\n\r\n    /**\r\n     * hotUpdate\r\n     */\r\n    hotUpdate() {\r\n        if (this._assetsMgr && !this._updating) {\r\n            // this.barNode.active = true ;\r\n            Logger.error(JSON.stringify(this._assetsMgr))\r\n            //this.sendNotification(Const.SHOW_PROGRESS_BAR, { parm: 0 })\r\n            this._assetsMgr.setEventCallback(this._cbUpdate.bind(this));\r\n\r\n            if (this._assetsMgr.getState() === jsb.AssetsManager.State.UNINITED) {\r\n\r\n                this.localManifest = new jsb.Manifest(JSON.stringify(this.localManifestJsonObj), this._storagePath)\r\n                this._assetsMgr.loadLocalManifest(this.localManifest);\r\n            }\r\n            this._assetsMgr.update();\r\n            this._updating = true;\r\n\r\n        }\r\n    }\r\n\r\n\r\n    private formatVersion()\r\n    {\r\n        let path = this.getTempPath()\r\n        Logger.error(\"formatVersion----path--\" ,path)\r\n        let remoteVersion = this.serverVersion\r\n        let tmpVersionPath = Global.HotUpdateManager.updateHelper.genStoragePath(path) + \"/\" + Global.HotUpdateManager.versionCfgFileName\r\n        if(!jsb.fileUtils.isFileExist(tmpVersionPath))\r\n        {\r\n            Logger.error(\"找不到文件\", tmpVersionPath);\r\n            return;\r\n        }\r\n        let content = jsb.fileUtils.getStringFromFile(tmpVersionPath);\r\n        let tmpVersion = JSON.parse(content);\r\n        tmpVersion.packageUrl = this.serverHotupdateUrl;\r\n        tmpVersion.remoteManifestUrl = this.serverHotupdateUrl + Global.HotUpdateManager.projectCfgFileName\r\n        tmpVersion.remoteVersionUrl = this.serverHotupdateUrl + Global.HotUpdateManager.versionCfgFileName\r\n        tmpVersion.version = remoteVersion;\r\n\r\n        let newTmpContent = JSON.stringify(tmpVersion);\r\n        jsb.fileUtils.writeStringToFile(newTmpContent, tmpVersionPath);\r\n    }\r\n\r\n\r\n\r\n    private formatManifest()\r\n    {\r\n        if(!cc.sys.isNative)\r\n        return;\r\n\r\n    let path = this.getTempPath()\r\n    Logger.error(\"formatVersion----path--\" ,path)\r\n    let remoteVersion =this.serverVersion\r\n    let tmpProjectPath = Global.HotUpdateManager.updateHelper.genStoragePath(path) + \"/\" +  \"project.manifest.temp\";\r\n    if(!jsb.fileUtils.isFileExist(tmpProjectPath))\r\n    {\r\n        Logger.error(\"找不到文件\", tmpProjectPath);\r\n        return;\r\n    }\r\n    let content = jsb.fileUtils.getStringFromFile(tmpProjectPath);\r\n    let tmpManifest = JSON.parse(content);\r\n    //tmpManifest = this.removeApp(tmpManifest)\r\n   \r\n    tmpManifest.packageUrl = this.serverHotupdateUrl;\r\n    tmpManifest.remoteManifestUrl = this.serverHotupdateUrl + Global.HotUpdateManager.projectCfgFileName\r\n    tmpManifest.remoteVersionUrl = this.serverHotupdateUrl + Global.HotUpdateManager.versionCfgFileName\r\n    tmpManifest.version = remoteVersion;\r\n    this.totalAssetByte += tmpManifest.totalSize\r\n\r\n        let newTmpContent = JSON.stringify(tmpManifest);\r\n        jsb.fileUtils.writeStringToFile(newTmpContent, tmpProjectPath);\r\n    }\r\n\r\n    /**\r\n     * _cbUpdate - 更新的回调\r\n     */\r\n    _cbUpdate(event) {\r\n        var needRestartRightNow = false;\r\n        var failed = false;\r\n        var currentUpdateFinish = false\r\n        switch (event.getEventCode()) {\r\n            case jsb.EventAssetsManager.UPDATE_PROGRESSION:\r\n                let percentNum = event.getPercent()\r\n                if ( !percentNum || percentNum < 0.0001) {\r\n                    percentNum = 0.0001\r\n                }\r\n                if(this.updateCount>0)\r\n                {\r\n                    percentNum = percentNum/this.updateCount + this.updateFinishedSubCount/this.updateCount\r\n                }\r\n                this.sendNotification(Const.SHOW_PROGRESS_BAR, { parm:percentNum })\r\n                let per = (percentNum * 100).toFixed(2);\r\n\r\n                if(event && event.getMessage() == \"ProjectDownloaded\")\r\n                {\r\n                    this.formatManifest();\r\n                }\r\n                //event.getDownloadedFiles() + ' / ' + event.getTotalFiles() \r\n                // let per = (event.getDownloadedBytes() ) + \" / \"+ event.getTotalBytes();\r\n                this.sendNotification(Const.SHOW_PROGRESS_LABEL, { parm: parseInt(per) + \"%\" })\r\n                \r\n                break;\r\n            case jsb.EventAssetsManager.UPDATE_FINISHED:\r\n                this.sendNotification(Const.SHOW_PROGRESS_LABEL, { parm: \"100%\" })\r\n                this.sendNotification(Const.SHOW_CHECK_LABEL, { parm: '更新完成' + event.getMessage() })\r\n                needRestartRightNow = true; // 最后一个包下载完成再重启\r\n                currentUpdateFinish = true\r\n                this.needRestart = true\r\n                this.updateFinishedSubCount += 1\r\n                break;\r\n            case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:\r\n\r\n                this.sendNotification(Const.SHOW_CHECK_LABEL, { parm: '已经是最新版' })\r\n                this.checkNext()\r\n                return\r\n                //failed = true;\r\n                break;\r\n            case jsb.EventAssetsManager.UPDATE_FAILED:\r\n                this.reportLog(0, ReportTool.REPORT_TYPE_DOWNLOADSUBGAME_FAILED,event.getAssetId())\r\n                // let reportParam3 = {\"game\":\"hall\",\"eventcode\":event.getEventCode(),\"event\":\"update\",\"faildres\":event.getAssetId(),\"url\":Global.Setting.Urls.hallHotUpdateUrl}\r\n                // Global.ReportTool.ReportClientError(ReportTool.REPORT_TYPE_HOT_UPDATE_ERROR,reportParam3)\r\n                \r\n                this.sendNotification(Const.SHOW_CHECK_LABEL, { parm: '更新失败： ' + event.getMessage() })\r\n                this._updating = false;\r\n                this._canRetry = true;\r\n                failed = true;\r\n                break;\r\n            case jsb.EventAssetsManager.ERROR_UPDATING:\r\n                this._faildRes = event.getAssetId();\r\n                // let reportParam1 = {\"game\":\"hall\",\"eventcode\":event.getEventCode(),\"event\":\"update\",\"faildres\":this._faildRes,\"url\":Global.Setting.Urls.hallHotUpdateUrl}\r\n                // Global.ReportTool.ReportClientError(ReportTool.REPORT_TYPE_HOT_UPDATE_ERROR,reportParam1)\r\n                this.reportLog(0, ReportTool.REPORT_TYPE_DOWNLOADSUBGAME_FAILED,this._faildRes)\r\n                // this.sendNotification(Const.SHOW_CHECK_LABEL, { parm: 'Asset update error: ' + event.getAssetId() + ', ' + event.getMessage() })\r\n                failed = true;\r\n                break;\r\n            case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:\r\n            case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:\r\n            case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:\r\n            case jsb.EventAssetsManager.ERROR_DECOMPRESS:\r\n                // let reportParam2 = {\"game\":\"hall\",\"eventcode\":event.getEventCode(),\"event\":\"update\",\"faildres\":event.getAssetId(),\"url\":Global.Setting.Urls.hallHotUpdateUrl}\r\n                // Global.ReportTool.ReportClientError(ReportTool.REPORT_TYPE_HOT_UPDATE_ERROR,reportParam2)\r\n                this.reportLog(0, ReportTool.REPORT_TYPE_DOWNLOADSUBGAME_FAILED,event.getAssetId())\r\n                this.sendNotification(Const.SHOW_CHECK_LABEL, { parm: '下载失败，请检查网络' })\r\n                let updateCallBackFunc = () => {\r\n                    setTimeout(() => {\r\n                        this.restartCheckUpdate();\r\n                    }, 1000);\r\n                }\r\n                Global.UI.showSingleBox(\"下载失败，请检查网络\", updateCallBackFunc, updateCallBackFunc);\r\n                failed = true;\r\n                break;\r\n        }\r\n\r\n        if (failed) {\r\n            this._assetsMgr.setEventCallback(null);\r\n\r\n            this._updating = false;\r\n            this.retry();\r\n        }\r\n        \r\n\r\n        if (currentUpdateFinish) { //当前阶段热更是否完毕\r\n\r\n            this.sendNotification(Const.CLEAR_LOADING_TIMER)\r\n            \r\n            Global.HotUpdateManager.hotFailRes = \"\";\r\n            Global.HotUpdateManager.hotFaildNum = 0;\r\n            let searchPaths = jsb.fileUtils.getSearchPaths();\r\n            let newPaths = this._assetsMgr.getLocalManifest().getSearchPaths();\r\n            Global.SearchPathHelper.addPathList(newPaths);\r\n            let retPaths = Global.SearchPathHelper.getSystemSearchPath();\r\n            let hotUpdateManager = Global.HotUpdateManager\r\n            cc.sys.localStorage.setItem(hotUpdateManager.hotUpdateStorageKey + hotUpdateManager.hallHotUpdateDirName, hotUpdateManager.hallHotUpdateDirName);\r\n            cc.sys.localStorage.setItem('HotUpdateSearchPaths', JSON.stringify(retPaths));\r\n         //   console.log(\"这是当前的缓存路径\",retPaths)\r\n            this._assetsMgr.setEventCallback(null);\r\n            this._assetsMgr = null\r\n            this._updating = false\r\n           \r\n            if (!needRestartRightNow) { //是否立即重启  最后一个热更完毕即立即重启\r\n                this.checkNext()\r\n            }\r\n            else {\r\n                this.reportLog(1, ReportTool.REPORT_TYPE_DOWNLOADSUBGAME_RESULT)\r\n                Global.Setting.storage.removeKey(HallStorageKey.HotUpdateHosts)\r\n                cc.sys.localStorage.setItem(\"errorReStartTimes\", null)\r\n                cc.sys.localStorage.setItem(\"needRestart\", 1)\r\n                cc.audioEngine.stopAll();\r\n                Global.UI.clearAllUIPrefab()\r\n                setTimeout(() => {\r\n                    cc.game.restart();\r\n                }, 1000);\r\n                Logger.error(\"restart\");\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    restart()\r\n    {\r\n        Global.Setting.storage.removeKey(HallStorageKey.HotUpdateHosts)\r\n\r\n        cc.sys.localStorage.setItem(\"needRestart\", 1)\r\n        cc.audioEngine.stopAll();\r\n        Global.UI.clearAllUIPrefab()\r\n        setTimeout(() => {\r\n            cc.game.restart();\r\n        }, 1000);\r\n        Logger.error(\"restart\");\r\n    }\r\n    /**\r\n     * retry\r\n     */\r\n    retry() {\r\n        //如果一个资源下载失败超过了两次，就清除之前的下载\r\n        if (Global.HotUpdateManager.hotFailRes == this._faildRes && Global.HotUpdateManager.hotFaildNum >= 2) {\r\n            Global.HotUpdateManager.hotFailRes = \"\";\r\n            Global.HotUpdateManager.hotFaildNum = 0;\r\n            \r\n            let updateCallBackFunc = () => {\r\n                setTimeout(() => {\r\n                    this.restartCheckUpdate();\r\n                }, 1000);\r\n            }\r\n            Global.UI.showSingleBox(\"下载失败，请检查网络\", updateCallBackFunc, updateCallBackFunc);\r\n        } else {\r\n            Global.HotUpdateManager.hotFaildNum = this._faildRes;\r\n            Global.HotUpdateManager.hotFaildNum++;\r\n            \r\n        }\r\n\r\n    }\r\n\r\n    \r\n\r\n    /**\r\n     * _cbVerify\r\n     * \r\n     * 由于下载过程中仍然有小概率可能由于网络原因或其他网络库的问题导致下载的文件内容有问题，所以我们提供了用户文件校验接口，在文件下载完成后热更新管理器会调用这个接口（用户实现的情况下），如果返回 true 表示文件正常，返回 false 表示文件有问题\r\n     * \r\n     */\r\n    _cbVerify(path, asset) {\r\n        let self = this\r\n        // Setup the verification callback, but we don't have md5 check function yet, so only print some message\r\n        // Return true if the verification passed, otherwise return false\r\n        // When asset is compressed, we don't need to check its md5, because zip file have been deleted.\r\n        var compressed = asset.compressed;\r\n        // Retrieve the correct md5 value.\r\n        var expectedMD5 = asset.md5;\r\n        // asset.path is relative path and path is absolute.\r\n        var relativePath = asset.path;\r\n        // The size of asset file, but this value could be absent.\r\n        var size = asset.size;\r\n        let fileSize = jsb.fileUtils.getFileSize(path);\r\n        if (self.currentContext == HotUpdateContext.hall) {\r\n            self.hallTotalSize += fileSize\r\n            self.hallTotalFilecount += 1\r\n        }\r\n        else if (self.currentContext == HotUpdateContext.main) {\r\n            self.mainTotalSize += fileSize\r\n            self.mainTotalFilecount += 1\r\n        }\r\n        if (compressed) {\r\n            Logger.log((\"Verification passed : \" + relativePath));\r\n            return true;\r\n        }\r\n        else {\r\n            return fileSize == asset.size;\r\n            // var data = jsb.fileUtils.getDataFromFile(path);\r\n           \r\n            // if (data == null) {\r\n            //     // Logger.log('data == null MD5 verify fail,path a:' + path + ',path b:' + asset.path  + ',md5 b:' + asset.md5);\r\n            //     return false;\r\n            // }\r\n            // var curMD5 = md5(data);\r\n            // if (curMD5 == asset.md5) {\r\n            //     // Logger.log('MD5 verify success!');\r\n            //     return true;\r\n            // }\r\n            // else {\r\n            //     // Logger.log('MD5 verify fail,path a:' + path + ',path b:' + asset.path + ',md5 a:' + curMD5 + ',md5 b:' + asset.md5);\r\n            //     return false;\r\n            // }\r\n\r\n        }\r\n\r\n    }\r\n    next() {\r\n        if(this.needRestart)\r\n        {\r\n            cc.sys.localStorage.setItem(\"errorReStartTimes\", null)\r\n            this.reportLog(1, ReportTool.REPORT_TYPE_DOWNLOADSUBGAME_RESULT)\r\n            this.restart()\r\n            return\r\n        }\r\n        Global.ChannelUtil.getUuid()\r\n\t\tGlobal.ChannelUtil.getEntryType()\r\n        Global.ChannelUtil.getSignType()\r\n        Global.ChannelUtil.PostInstallApp()\r\n        Global.ChannelUtil.initOpeninstall();\r\n        this.sendNotification(Const.CLEAR_LOADING_TIMER)\r\n        //TestFlight 包低于20007 客户端弹更新弹框\r\n        let nativePlatform = Global.Setting.SystemInfo.nativePlatform\r\n        if (nativePlatform == \"testflight\"){\r\n            let app_force_type = 0\r\n            Global.AppUpdateHelper.showLoadingGameUpdateUI(app_force_type)\r\n        }else {\r\n            if (!Global.AppUpdateHelper.startForceUpdateLogic(this.checkVersionData)){\r\n                Global.AppUpdateHelper.goToLogin();\r\n            }\r\n        }\r\n        \r\n    }\r\n\r\n    onRemove() {\r\n\r\n    }\r\n\r\n}"]}