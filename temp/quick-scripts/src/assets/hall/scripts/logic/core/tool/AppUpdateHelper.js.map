{"version":3,"sources":["assets\\hall\\scripts\\logic\\core\\tool\\AppUpdateHelper.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["/**\r\n * 更新相关逻辑\r\n * \r\n*/\r\n\r\nimport LoadingFacade from \"../loadingMVC/LoadingFacade\";\r\nimport AppHelper from \"./AppHelper\";\r\nimport HallPopMsgHelper, { PopWndName } from \"../../hall/tool/HallPopMsgHelper\";\r\n\r\n\r\nexport default class AppUpdateHelper {\r\n    //tips_type 弹窗提示   0 登录前  1登录后\r\n    private _forceDialogSceneType = -1;\r\n    private _hasShowForceDialog = false;\r\n    private _checkVersionData  = null;\r\n    private _forceDialogType = -1;// 0 强更  1 非强更\r\n\r\n\r\n    public set forceDialogSceneType(value:number){\r\n        this._forceDialogSceneType = value\r\n    }\r\n\r\n    public get forceDialogSceneType(){\r\n        return this._forceDialogSceneType\r\n    }\r\n\r\n    public set hasShowForceDialog(value:boolean){\r\n        this._hasShowForceDialog = value\r\n    }\r\n\r\n    public get hasShowForceDialog(){\r\n        return this._hasShowForceDialog\r\n    }\r\n\r\n    public set checkVersionData(data:any){\r\n        this._checkVersionData = data\r\n    }\r\n\r\n    public get checkVersionData(){\r\n        return this._checkVersionData\r\n    }\r\n\r\n\r\n\r\n    public goToLogin(){\r\n        LoadingFacade.releaseInstance()\r\n        Global.SceneManager.goToLogin();\r\n    }\r\n\r\n    public showLoadingGameUpdateUI(app_force_type){\r\n        let noForceNoCallback = () => {\r\n            this.goToLogin();\r\n        }\r\n        let forceNoCallback = () => {\r\n            this.showLoadingGameUpdateUI(app_force_type)\r\n        }\r\n        let forceUpdateFunc = ()=>{\r\n            let url = Global.Setting.Urls.downLoadUrl\r\n            cc.sys.openURL(Global.Toolkit.DealWithUrl(url));\r\n        }\r\n        let noCallback = noForceNoCallback\r\n        let autoClose = true;\r\n        let showType = 1; ////1 两个按钮  2 yes 一个按钮\r\n        if (app_force_type == 0) {//强制更新\r\n            showType = 2\r\n            noCallback = forceNoCallback\r\n            autoClose = false;\r\n        }\r\n        \r\n        Global.UI.show(\"WndGameUpdateUI\",showType, forceUpdateFunc, noCallback, autoClose, false,this.checkVersionData.app_force.desc);\r\n    }\r\n\r\n\r\n    public checkIsShowLoginUpdateDlg(){\r\n        let data  = this._checkVersionData\r\n        if (data){\r\n            let app_force = data.app_force // 强更字段\r\n            if (app_force){\r\n                let app_force_version = app_force.version\r\n                let nativeAppVerion = Global.Setting.SystemInfo.appVersion\r\n                if (this.forceDialogSceneType == 1 && this.hasShowForceDialog == false && (Global.Toolkit.versionCompare(app_force_version, nativeAppVerion) > 0)){\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n        \r\n        return false;\r\n    }\r\n\r\n    public showLoginUpdateDlg(){\r\n        if (this.checkIsShowLoginUpdateDlg()){\r\n            if (this._checkVersionData){\r\n                let app_force = this._checkVersionData.app_force\r\n                if (app_force){\r\n                    let app_force_force_type = app_force.force_type //0强制更新 1非强制更新\r\n                    let app_force_url = app_force.url\r\n                    HallPopMsgHelper.Instance.addMsgList(PopWndName.ForceUpdate, () => {\r\n                        HallPopMsgHelper.Instance.addLock(PopWndName.ForceUpdate);\r\n                        \r\n                        let noForceNoCallback = () => {\r\n                            HallPopMsgHelper.Instance.releaseLock(PopWndName.ForceUpdate);\r\n                        }\r\n                        let forceNoCallback = () => {\r\n                            HallPopMsgHelper.Instance.releaseLock(PopWndName.ForceUpdate);\r\n                            this.showLoginUpdateDlg()\r\n                        }\r\n                        let forceUpdateFunc = ()=>{\r\n                            let url = Global.Setting.Urls.downLoadUrl\r\n                            if (app_force_url){\r\n                                url = app_force_url\r\n                            }\r\n                            cc.sys.openURL(Global.Toolkit.DealWithUrl(url));\r\n                        }\r\n                        let noCallback = noForceNoCallback\r\n                        let autoClose = true;\r\n                        let showType = 1; ////1 两个按钮  2 yes 一个按钮\r\n                        if (app_force_force_type == 0) {//强制更新\r\n                            showType = 2\r\n                            noCallback = forceNoCallback\r\n                            autoClose = false;\r\n                        }\r\n                        \r\n                        Global.UI.show(\"WndGameUpdateUI\",showType, forceUpdateFunc, noCallback, autoClose, false,app_force.desc);\r\n                        this.hasShowForceDialog = true\r\n                    }); \r\n                }\r\n               \r\n            }\r\n            \r\n        }else {\r\n            Logger.error(\"showLoginUpdateDlg false\")\r\n        }\r\n    }\r\n    \r\n\r\n\r\n\r\n    public startForceUpdateLogic(data) {\r\n        if (!data){\r\n            Logger.error(\"data == null\")\r\n            return false;\r\n        }\r\n        this.checkVersionData = data;\r\n        let app_force = data.app_force // 强更字段\r\n        let nativeAppVerion = Global.Setting.SystemInfo.appVersion\r\n        if (app_force && app_force.version && (app_force.version > 0) && app_force.pack_type && app_force.pack_type != \"\") { //新强更字段\r\n            let app_force_version = app_force.version\r\n            let app_force_pack_type = app_force.pack_type //包类型  全平台:all  企业签/超级签：main 马甲包:appstore TF包:testflight 华为包:huawei \r\n            let nativePlatform = Global.Setting.SystemInfo.nativePlatform\r\n            let app_tips_type = app_force.tips_type // tips_type 弹窗提示   0 登录前  1登录后\r\n            \r\n            if (app_tips_type != null && app_tips_type != undefined && app_tips_type != \"\" ){\r\n                this.forceDialogSceneType = app_tips_type\r\n                if (this.forceDialogSceneType == 1){\r\n                    return false;\r\n                }else {\r\n                    Logger.error(\"startForceUpdateLogic show loading update dlg \")\r\n                }\r\n            }\r\n            //判断包类型\r\n            if (app_force_pack_type != \"all\" && nativePlatform != app_force_pack_type) {\r\n                return false;\r\n            }\r\n            \r\n            //判断版本号\r\n            if (Global.Toolkit.versionCompare(app_force_version, nativeAppVerion) > 0) {\r\n                \r\n                let force_update_url = data.force_update_url //强更的官网下载地址\r\n                let app_force = data.app_force // 强更字段\r\n                let app_force_url = app_force.url //强更的下载地址，包下载类型：Android 是Apk地址，IOS 是plist地址  落地页：包下载页地址\r\n                let app_force_force_type = app_force.force_type //0强制更新 1非强制更新\r\n                let app_force_desc = app_force.desc //更新说明\r\n                let app_force_url_type = app_force.url_type //下载地址类型  0 包下载地址 1 落地页\r\n                \r\n\r\n                if (AppHelper.enableForceUpdateAppInstall) {\r\n                    let noForceNoCallback = () => {\r\n                        this.goToLogin();\r\n                    }\r\n                    let forceNoCallback = () => {\r\n                        //继续请求checkversion\r\n                        this.startForceUpdateLogic(data)\r\n                    }\r\n\r\n                    let noCallback = noForceNoCallback\r\n                    let autoClose = true;\r\n                    let showType = 1; ////1 两个按钮  2 yes 一个按钮\r\n                    let isForceUpdate = false;\r\n                    if (app_force_force_type == 0) {//强制更新\r\n                        showType = 2\r\n                        noCallback = forceNoCallback\r\n                        autoClose = false;\r\n                        isForceUpdate = true;\r\n                    }\r\n                    if (app_force_desc == null || app_force_desc === \"\") {\r\n                        app_force_desc = \"有新版本更新，请升级！\"\r\n                    }\r\n\r\n                    if (app_force_url_type == 0) {//0 包下载地址\r\n                        if (cc.sys.os === cc.sys.OS_IOS) {\r\n                            let signMd5 = Global.Toolkit.md5(Global.Setting.SystemInfo.appSign);\r\n                            if (signMd5 == Global.Setting.serverIOSCertMd5) {\r\n                                if (app_force_url && app_force_url != \"\") {\r\n                                    //ios 下载plist文件并更新\r\n                                    let forceUpdateFunc = () => {\r\n                                        Global.NativeEvent.hotUpdateIPA(app_force_url)\r\n                                    }\r\n                                    if (app_force_force_type == 0) {\r\n                                        Global.UI.showSingleBox(app_force_desc, forceUpdateFunc, noCallback, autoClose, false);\r\n                                    } else {\r\n                                        Global.UI.showYesNoBox(app_force_desc, forceUpdateFunc, noCallback, autoClose)\r\n                                    }\r\n                                } else {\r\n                                    if (force_update_url && force_update_url != \"\") {\r\n                                        this.showForceUpdateWnd(force_update_url,isForceUpdate)\r\n                                    } else {\r\n                                        return false;\r\n                                    }\r\n                                }\r\n\r\n                            } else {\r\n                                if (force_update_url && force_update_url != \"\") {\r\n                                    //弹框提示删除本地App后再升级\r\n                                    let forceUpdateFunc = () => {\r\n                                        cc.sys.openURL(Global.Toolkit.DealWithUrl(force_update_url))\r\n                                    }\r\n                                    app_force_desc = \"有新版本更新，请卸载App后重新下载！\"\r\n                                    if (app_force_force_type == 0) {\r\n                                        Global.UI.showSingleBox(app_force_desc, forceUpdateFunc, noCallback, autoClose, false);\r\n                                    } else {\r\n                                        Global.UI.showYesNoBox(app_force_desc, forceUpdateFunc, noCallback, autoClose)\r\n                                    }\r\n                                } else {\r\n                                    return false\r\n                                }\r\n                            }\r\n\r\n                        } else if (cc.sys.os === cc.sys.OS_ANDROID) {\r\n                            if (app_force_url && app_force_url != \"\") {\r\n                                //Android下载Apk文件并更新\r\n                                let yesCallback = () => {\r\n\r\n                                }\r\n                                Global.UI.show(\"WndDownLoadApkUI\", app_force_desc, showType, app_force_url, yesCallback, noCallback, autoClose, false)\r\n\r\n                            } else {\r\n                                if (force_update_url && force_update_url != \"\") {\r\n                                    this.showForceUpdateWnd(force_update_url,isForceUpdate)\r\n                                } else {\r\n                                    return false;\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                    } else if (app_force_url_type == 1) {// 1落地页\r\n                        if (app_force_url && app_force_url != \"\") {\r\n                            let forceUpdateFunc = () => {\r\n                                cc.sys.openURL(Global.Toolkit.DealWithUrl(app_force_url))\r\n                            }\r\n                            let autoClose = true;\r\n                            let showType = 1; ////1 两个按钮  2 yes 一个按钮\r\n                            if (app_force_force_type == 0) {//强制更新\r\n                                showType = 2\r\n                                noCallback = forceNoCallback\r\n                                autoClose = false;\r\n                            }\r\n                            Global.UI.show(\"WndGameUpdateUI\",showType, forceUpdateFunc, noCallback, autoClose, false,app_force_desc);\r\n                        } else {\r\n                            if (force_update_url && force_update_url != \"\") {\r\n                                this.showForceUpdateWnd(force_update_url,isForceUpdate)\r\n                            } else {\r\n                                return false;\r\n                            }\r\n                        }\r\n                    }\r\n                } else {\r\n                    if (force_update_url && force_update_url != \"\") {\r\n                        this.showForceUpdateWnd(force_update_url)\r\n                    } else {\r\n                        return false;\r\n                    }\r\n                }\r\n                return true;\r\n            }\r\n        } else {\r\n            let force_update_url = data.force_update_url\r\n            let force_version = data.force_version\r\n            if (Global.Toolkit.versionCompare(force_version, nativeAppVerion) > 0) {\r\n                this.showForceUpdateWnd(force_update_url)\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    private showForceUpdateWnd(force_update_url,isForceUpdate = false) {\r\n        //走强更流程\r\n        let forceUpdateFunc = () => {\r\n            cc.sys.openURL(Global.Toolkit.DealWithUrl(force_update_url))\r\n        }\r\n        let noCallback = null;\r\n        let force_update_dec = \"有新版本更新，请重新下载游戏\"\r\n        if (isForceUpdate) {\r\n            noCallback = forceUpdateFunc\r\n            Global.UI.showSingleBox(force_update_dec, forceUpdateFunc, noCallback, false, false);\r\n        } else {\r\n            Global.UI.showYesNoBox(force_update_dec, forceUpdateFunc, noCallback, true)\r\n        }\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n}"]}