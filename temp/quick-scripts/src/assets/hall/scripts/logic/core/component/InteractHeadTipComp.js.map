{"version":3,"sources":["assets\\hall\\scripts\\logic\\core\\component\\InteractHeadTipComp.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import ViewBase from \"../ui/ViewBase\";\r\n\r\n/**\r\n * 其他玩家信息tip界面 控制组件\r\n */\r\nexport default class InteractHeadTipComp extends cc.Component {\r\n    private contentNode: cc.Node;\r\n    private headtipNode: cc.Node\r\n    private coinLbl: cc.Label;\r\n    private nameLbl: cc.Label;\r\n    private idLbl: cc.Label;\r\n    private headImgSp: cc.Sprite;\r\n    private headBoxSp: cc.Sprite;\r\n\r\n    private curSeat: number = -1;\r\n\r\n    public interactChooseView: InteractChooseView;\r\n\r\n    private time = 5;\r\n\r\n    private _needHeadTip: boolean = false;\r\n\r\n    onLoad() {\r\n        this.contentNode = cc.find(\"content\", this.node);\r\n        this.headtipNode = cc.find(\"content/headtip\", this.node);\r\n        this.coinLbl = cc.find(\"coinLbl\", this.headtipNode).getComponent(cc.Label)\r\n        this.nameLbl = cc.find(\"nameLbl\", this.headtipNode).getComponent(cc.Label)\r\n        this.idLbl = cc.find(\"idLbl\", this.headtipNode).getComponent(cc.Label)\r\n        this.headImgSp = cc.find(\"mask/sprite_head\", this.headtipNode).getComponent(cc.Sprite)\r\n        this.headBoxSp = cc.find(\"head_kuang\", this.headtipNode).getComponent(cc.Sprite)\r\n        let touchNode = cc.find(\"content/touchBg\", this.node);\r\n        touchNode.on(cc.Node.EventType.TOUCH_END, this.hideView, this);\r\n        touchNode._touchListener.setSwallowTouches(false)\r\n\r\n        this.interactChooseView = new InteractChooseView();\r\n        this.interactChooseView.setNode(cc.find(\"content/actView\", this.node));\r\n        this.interactChooseView.active = true;\r\n        this.interactChooseView.setFatherFuntion(this)\r\n    }\r\n\r\n    private hideView() {\r\n        this.node.active = false;\r\n    }\r\n\r\n    protected onDestroy() {\r\n        this.node.stopAllActions();\r\n        this.curSeat = -1;\r\n    }\r\n\r\n    public set needHeadTip(bool: boolean) {\r\n        this._needHeadTip = bool;\r\n    }\r\n\r\n    public get needHeadTip() {\r\n        return this._needHeadTip;\r\n    }\r\n\r\n    public showHeadView(isShow: boolean, localSeat: number, worldPos: cc.Vec3 = cc.Vec3.ZERO, data: any) {\r\n        if (isShow) {\r\n            this.curSeat = localSeat;\r\n            let pos = this.contentNode.parent.convertToNodeSpaceAR(worldPos);\r\n            this.node.active = true;\r\n            this.contentNode.position = pos;\r\n            this.headtipNode.active = this.needHeadTip;\r\n            if (this.needHeadTip) {\r\n                this.updateContent(localSeat, data);\r\n                this.interactChooseView.sChair = data._chair;\r\n            }\r\n            else {\r\n                this.interactChooseView.sChair = data.chair;\r\n            }\r\n            this.closeTips(5);\r\n            this.interactChooseView.setPlayerData(data);\r\n        }\r\n        else {\r\n            if (this.curSeat == localSeat)\r\n                this.hideView();\r\n        }\r\n    }\r\n\r\n    public closeTips(num: number) {\r\n        this.time = num\r\n    }\r\n\r\n    update(dt) {\r\n        this.time -= dt;\r\n        if (this.time <= 0) {\r\n            this.node.stopAllActions();\r\n            this.node.active = false;\r\n        }\r\n    }\r\n\r\n    private updateContent(localSeat: number, userData: any) {\r\n        if (!userData)\r\n            return;\r\n        let name = userData.nickname\r\n        let point = userData.point;\r\n        let id = userData._uid;\r\n        let head = userData.headimg;\r\n\r\n        this.nameLbl.string = name;\r\n        this.updatePoint(localSeat, point);\r\n        let [w, h] = [this.headImgSp.node.width, this.headImgSp.node.height];\r\n        this.headImgSp.spriteFrame = Global.Toolkit.getLocalHeadSf(head);\r\n        Global.Toolkit.loadLocalHeadFrameByGames(this.headBoxSp, userData.a_box);\r\n        this.headImgSp.node.setContentSize(w, h);\r\n        this.idLbl.string = \"ID:\" + id;\r\n    }\r\n\r\n    public updatePoint(localSeat: number, point: any) {\r\n        if (this.node.active == true && this.curSeat == localSeat)\r\n            this.coinLbl.string = Global.Toolkit.formatPointStr(point, true);\r\n    }\r\n}\r\n\r\nconst InteractCD = 2;\r\nclass InteractChooseView extends ViewBase {\r\n    private _chair: number;\r\n    private lastSendTime = 0;\r\n    static readonly CmdChat = \"chat\";        // 聊天 表情和文字\r\n    public selfSrc = -1;\r\n    private headtipsView: InteractHeadTipComp;\r\n    showvipList = [0, 0, 0, 0, 10, 11, 12, 13]\r\n    /** 玩家数据集合 */\r\n    private playerData: any;\r\n\r\n    public setPlayerData(data: any) {\r\n        this.playerData = data\r\n    }\r\n\r\n    public setSelfSrc(num: number) {\r\n        this.selfSrc = num\r\n    }\r\n\r\n    public setFatherFuntion(node: InteractHeadTipComp) {\r\n        this.headtipsView = node\r\n    }\r\n\r\n    public set sChair(chair: number) {\r\n        this._chair = chair;\r\n    }\r\n\r\n    public get sChair() {\r\n        return this._chair;\r\n    }\r\n\r\n    initView() {\r\n        for (let i = 0; i < 8; i++) {\r\n            let node = cc.find('content/' + i, this.node);\r\n            new InteractItem(node, i, this.onInteractClick, this);\r\n            let tip = cc.find(\"tip\", node)\r\n            tip.active = false;\r\n            if (Global.PlayerData.vip < this.showvipList[i]) {\r\n                tip.active = true;\r\n            }\r\n        }\r\n    }\r\n\r\n    private onInteractClick(index: number) {\r\n        this.headtipsView.closeTips(0);\r\n        if (Global.PlayerData.vip < this.showvipList[index]) {\r\n           return Global.UI.fastTip('您的vip等级不足以使用该表情');\r\n        }\r\n        if (this.playerData._rchair && this.playerData._rchair === this.selfSrc) {\r\n            return Global.UI.fastTip('不能给自己发送互动表情哦！');\r\n        }\r\n\r\n        let curTime = Date.now();\r\n        if (curTime - this.lastSendTime <= InteractCD * 1000) {\r\n            return Global.UI.fastTip('您太急啦～喝口茶稍等一下吧～');\r\n        }\r\n        if (this.sChair != null) {\r\n            this.sendChatReq(index, this.sChair);\r\n            // this.active = false;\r\n            this.lastSendTime = curTime;\r\n        }\r\n    }\r\n\r\n    private sendChatReq(content: number, chair: number) {\r\n        let from_chair = this.selfSrc;\r\n        if (this.playerData && this.playerData._rchair === this.selfSrc) {\r\n            from_chair = Number(this.playerData._chair);\r\n        }\r\n        let param = {\r\n            emoji: content,\r\n            ctype: 1,\r\n            to_chair: chair,\r\n            from_chair: from_chair\r\n        }\r\n        Game.Server.send(InteractChooseView.CmdChat, param);\r\n    }\r\n\r\n    onClose() {\r\n        this.sChair = null;\r\n    }\r\n\r\n    public reset() {\r\n        this.lastSendTime = 0;\r\n    }\r\n}\r\n\r\nclass InteractItem extends ViewBase {\r\n    constructor(node: cc.Node, private index: number, private callback: Function, private target: any) {\r\n        super();\r\n        this.setNode(node);\r\n    }\r\n\r\n    protected initView() {\r\n        this.getChild('').on('click', this.onItemClick, this);\r\n    }\r\n\r\n    private onItemClick() {\r\n        if (this.callback && this.target) {\r\n            this.callback.call(this.target, this.index);\r\n        }\r\n    }\r\n}"]}