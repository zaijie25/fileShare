{"version":3,"sources":["assets\\hall\\scripts\\logic\\core\\component\\WebViewControl.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { GameType } from \"../../hallcommon/data/GameData\";\r\n// Learn TypeScript:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/typescript.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nimport HallModel from \"../../hallcommon/model/HallModel\";\r\nimport PlayerInfoModel from \"../../hallcommon/model/PlayerInfoModel\";\r\n\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class WebViewControl {\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n    private url: string;\r\n    private scheme: string;\r\n    private hasApplyTopPoint = false;\r\n    private style = 1; //默认为1\r\n    private webViewGamePanel:cc.Node;\r\n        \r\n    init(){\r\n\r\n    }\r\n\r\n    clear(){\r\n        if (this.webViewGamePanel){\r\n            this.webViewGamePanel.removeFromParent(true)\r\n            this.webViewGamePanel.destroy()\r\n            this.webViewGamePanel = null;\r\n        }\r\n    }\r\n\r\n    //显示百胜webview\r\n    showWebView(url:string ,scheme:string,actionViewHidden:string,parent:cc.Node,gid = Game.Control.curGid){\r\n        this.url = url;\r\n        this.scheme = scheme;\r\n        this.hasApplyTopPoint = false;\r\n        let direction = gid == 9001 ? 1 : -1 //竖屏\r\n        let gameInfo = Global.GameData.getGameInfo(gid)\r\n        let gameType = gameInfo ? gameInfo.gameType : -1\r\n        if(gameType === GameType.AGBG){ //AG BG 外接游戏类型\r\n            this.style = 2;\r\n        }\r\n        if (!this.webViewGamePanel){\r\n            Global.ResourceManager.loadBundleRes(\"resources\",\"hall/prefabs/ui/WebViewGamePanel\",(error,prefab)=>{\r\n                if (error){\r\n                    Logger.error(\"load WebViewGamePanel error\")\r\n                    return;\r\n                }\r\n                this.webViewGamePanel = cc.instantiate(prefab)\r\n                this.webViewGamePanel.active = true;\r\n                if(cc.isValid(this.webViewGamePanel))\r\n                {\r\n                    Logger.error(\"show WebViewGame --\")\r\n                    this.webViewGamePanel.parent = parent;\r\n                    let bg = this.webViewGamePanel.getChildByName(\"bg\")\r\n                    if (bg){\r\n                        bg.active = false;\r\n                    }\r\n                }\r\n                Global.Event.event(GlobalEvent.SHOW_NET_WAITING,\"showWebView\")\r\n                Logger.error(\"show WebViewGame bg 隐藏1111\")\r\n                Global.NativeEvent.openExternalGame(url,scheme,actionViewHidden,2,direction)\r\n            })\r\n        }else { \r\n            if(cc.isValid(this.webViewGamePanel))\r\n            {\r\n                let bg = this.webViewGamePanel.getChildByName(\"bg\")\r\n                if (bg){\r\n                    bg.active = false;\r\n                }\r\n                this.webViewGamePanel.active = true;\r\n            }\r\n            Logger.error(\"show WebViewGame bg 隐藏222\")\r\n            Global.NativeEvent.openExternalGame(url,scheme,actionViewHidden,2,direction)\r\n        }\r\n        \r\n    }\r\n\r\n    //原生调用js \r\n    native2JSCallback(state:String,url:String){\r\n        let hallModel: HallModel = Global.ModelManager.getModel(\"HallModel\")\r\n        if(state==\"1\"){//开始加载\r\n            Logger.log(\"WebViewGame --开始加载\");\r\n        }else if(state==\"2\"){//加载成功\r\n            //进游戏关闭大厅音乐\r\n            Global.Audio.stopMusic();\r\n            Global.Event.event(GlobalEvent.HIDE_NET_WAITING,\"showWebView\")\r\n            if (!this.hasApplyTopPoint) {\r\n                this.hasApplyTopPoint = true; \r\n                \r\n                hallModel.requestApplyTopPoint(Game.Control.curGid)\r\n            }\r\n            if (this.webViewGamePanel){\r\n                let bg = this.webViewGamePanel.getChildByName(\"bg\")\r\n                if (bg){\r\n                    bg.active = true;\r\n                }\r\n            }\r\n            Logger.log(\"WebViewGame --http加载成功\");\r\n        }else if(state==\"3\"){//http加载失败,404\r\n            if (this.scheme){\r\n                // this.hideWebView()\r\n                // Global.NativeEvent.closeBS()\r\n                // Global.UI.fastTip(\"网络异常，请重试-1\");\r\n            }\r\n            Logger.log(\"WebViewGame --http加载失败,404\");\r\n        }else if(state==\"4\"){//没有网\r\n            if (this.scheme){\r\n                // this.hideWebView()\r\n                // Global.NativeEvent.closeBS()\r\n                // Global.UI.fastTip(\"网络异常，请重试-2\");\r\n            }\r\n            Logger.log(\"WebViewGame --没有网\");\r\n        }else if(state==\"5\"){//shema的拦截\r\n\r\n            hallModel.requestApplyDownPoint(Game.Control.curGid)\r\n            this.hideWebView()\r\n            Global.NativeEvent.closeExternalGame()\r\n            Logger.log(\"WebViewGame --shema的拦截\");\r\n        }else if(state==\"6\"){//原生进行了刷新\r\n            Logger.log(\"WebViewGame --原生进行了刷新\");\r\n        }else if(state==\"7\"){//原生退出游戏\r\n            Logger.log(\"WebViewGame --原生退出游戏\");\r\n            this.hideWebView()\r\n            hallModel.requestApplyDownPoint(Game.Control.curGid)\r\n            \r\n        }else{\r\n            Logger.log(\"WebViewGame --state其他情况\");\r\n        }\r\n    }\r\n\r\n\r\n\r\n    hideWebView() {\r\n        this.playHallBGM()\r\n        Global.Event.event(GlobalEvent.CloseWebViewGame)\r\n        Global.Event.event(GlobalEvent.HIDE_NET_WAITING,\"showWebView\")\r\n        if (cc.isValid(this.webViewGamePanel) && this.webViewGamePanel.active) {\r\n            this.webViewGamePanel.removeFromParent();\r\n            this.webViewGamePanel.destroy()\r\n            this.webViewGamePanel = null\r\n        }\r\n        //有过上分才下分\r\n        if (this.hasApplyTopPoint){\r\n            let hallModel: HallModel = Global.ModelManager.getModel(\"HallModel\")\r\n            hallModel.requestApplyDownPoint( Game.Control.curGid)\r\n        }\r\n        //静默请求刷新玩家数据\r\n        Global.HallServer.send(NetAppface.mod, NetAppface.GetUserInfo, {},null,null,false);\r\n        \r\n    }\r\n\r\n\r\n    playHallBGM(){\r\n        var model = Global.ModelManager.getModel(\"PlayerInfoModel\")\r\n        if(model)\r\n        {\r\n            model.InitBgm()\r\n        }\r\n    }\r\n\r\n}\r\n"]}