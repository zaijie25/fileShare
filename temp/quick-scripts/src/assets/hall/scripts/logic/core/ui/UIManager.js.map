{"version":3,"sources":["assets\\hall\\scripts\\logic\\core\\ui\\UIManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import WndBase, { LoadingState, DestoryType } from \"./WndBase\";\r\nimport ResourceManager from \"../../../framework/resource/ResourceManager\";\r\nimport FastTip from \"../../hall/ui/common/FastTip\";\r\nimport UIAnimComponent from \"../component/UIAnimComponent\";\r\nimport { SceneType } from \"../scene/SceneManager\";\r\nimport BlackBgComp from \"../component/BlackBgComp\";\r\nimport YXButton from \"../component/YXButton\";\r\nimport AppHelper from \"../tool/AppHelper\";\r\n\r\nexport default class UIManager {\r\n    //防止子游戏import不了，使用变量的形式，如果有需要就改成enum\r\n    //用layer区分不同的弹窗效果\r\n    public MainLayer = \"MainLayer\";\r\n    public FullScreenLayer = \"FullScreenLayer\";\r\n    public PopLayer = \"PopLayer\";\r\n    public TipsLayer = \"TipsLayer\";\r\n\r\n\r\n\r\n    private uiRoot: cc.Node;\r\n    private canvasNode: cc.Node;\r\n    //layerName => layerNode\r\n    private layerMap = {};\r\n\r\n    //bg模板\r\n    private bgTemplate: cc.Node;\r\n\r\n    //string => wndbase\r\n    private windowMap: { [key: string]: WndBase } = {}\r\n    private showWindowList = [];\r\n\r\n    private resourceMgr: ResourceManager;\r\n\r\n\r\n    private fastTipMgr: FastTip;\r\n    /**\r\n     * 当前子游戏内是否有处理大厅messagebox\r\n     */\r\n    private bMessageBoxInGame: boolean = false;\r\n\r\n    constructor() {\r\n    }\r\n\r\n    public setup(resourceMgr: ResourceManager) {\r\n        this.resourceMgr = resourceMgr;\r\n        this.fastTipMgr = new FastTip();\r\n    }\r\n\r\n\r\n    //进场景公共操作  @todo  不要放到uiManager\r\n    public enterSceneInit() {\r\n        if (!CC_PREVIEW)\r\n            cc.debug.setDisplayStats(false);\r\n        cc.sys.garbageCollect();\r\n\r\n        if (cc.director.getScene().name == \"HallScene\")\r\n            cc.game.setFrameRate(Global.Setting.HallFPSConfig);\r\n        else\r\n            cc.game.setFrameRate(Global.Setting.FPSConfig);\r\n    }\r\n\r\n\r\n    //初始化界面\r\n    public initUIRoot(firstEnter = false) {\r\n        this.enterSceneInit();\r\n        //清理上一场景界面\r\n        this.clearAllUIPrefab();\r\n        Global.Persist.setState(false)\r\n        if (!firstEnter) {\r\n            Global.ResourceManager.releaseHelper.clearUnuseAssets()\r\n        }\r\n        else {\r\n            Global.ResourceManager.releaseHelper.adjustByIphone6();\r\n        }\r\n        let canvasNode = cc.find(\"Canvas\");\r\n\r\n        if (canvasNode == null) {\r\n            Logger.error(\"找不到Canvas\");\r\n            return;\r\n        }\r\n        this.canvasNode = canvasNode;\r\n        let canvas = canvasNode.getComponent(cc.Canvas);\r\n\r\n\r\n        // //@todo 根据分辨率判断\r\n        // canvas.fitHeight = true;\r\n        // // canvas.fitWidth = true;\r\n        this.adjuestCanvasScreenStretch(canvas);\r\n\r\n        let uiRoot = canvasNode.getChildByName(\"HUIRoot\");\r\n        if (uiRoot == null) {\r\n            uiRoot = new cc.Node(\"HUIRoot\");\r\n            uiRoot.zIndex = 10;\r\n            canvasNode.addChild(uiRoot);\r\n        }\r\n        this.uiRoot = uiRoot;\r\n        this.addUILayer(uiRoot, this.MainLayer);\r\n        this.addUILayer(uiRoot, this.FullScreenLayer);\r\n        this.addUILayer(uiRoot, this.PopLayer)\r\n        this.addUILayer(uiRoot, this.TipsLayer)\r\n        this.loadCommonBg();\r\n\r\n        this.fastTipMgr.initTip(this.layerMap[this.TipsLayer]);\r\n    }\r\n\r\n    RestorePersistNode() {\r\n        Global.Persist.setState(true);\t\t// debug 大厅选场切场景保留显示时先显示根, 再挂UI, 避免触发一次active\r\n        for (let key in this.windowMap) {\r\n            if (this.windowMap[key]) {\r\n                if (this.windowMap[key].destoryType == DestoryType.Persist) {\r\n                    if (this.windowMap[key].node && this.windowMap[key].node.isValid && this.windowMap[key].active) {\r\n                        Global.Persist.saveToPool(this.windowMap[key].name, this.windowMap[key].node, true);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        let RestoreNode = [\"WndGameLobbyShell\"]\r\n        for (let index = 0; index < RestoreNode.length; index++) {\r\n            let key = RestoreNode[index];\r\n            if (key) {\r\n                let restore = this.getWindow(key)\r\n                let flag = restore ? restore.active : false;\r\n                if(!flag) // 只有在有大厅选场的游戏 进入子游戏的情况下 才保留大厅选场显示 防止闪现大厅的问题\r\n                {\r\n                    let tmpNode :cc.Node = Global.Persist.getFromPool(key)\r\n                    if(cc.isValid(tmpNode))\r\n                    {\r\n                        tmpNode.removeFromParent(true)\r\n                        tmpNode.destroy()\r\n                        tmpNode = null\r\n                    }\r\n                    continue\r\n                }\r\n                // else\r\n                // {\r\n                //     Global.Persist.setState(flag)\r\n                // }\r\n            }\r\n        }\r\n    }\r\n\r\n    public adjuestCanvasScreenStretch(canvas: cc.Canvas) {\r\n        let size = cc.winSize;\r\n        if (Global.Setting.SystemInfo.orientationLandscape) {\r\n            canvas.designResolution = cc.size(1280, 720);\r\n            let designSize = canvas.designResolution;\r\n            if (size.width / size.height >= designSize.width / designSize.height) {\r\n                canvas.fitHeight = true;\r\n                canvas.fitWidth = false;\r\n            }\r\n            else {\r\n                canvas.fitHeight = true;\r\n                canvas.fitWidth = true;\r\n            }\r\n        } else {\r\n            canvas.designResolution = cc.size(720, 1280);\r\n            canvas.fitHeight = false;\r\n            canvas.fitWidth = true;\r\n        }\r\n\r\n\r\n    }\r\n\r\n\r\n    private addUILayer(root: cc.Node, layer: string) {\r\n        let node = root.getChildByName(layer);\r\n        if (node == null) {\r\n            node = new cc.Node(layer);\r\n            root.addChild(node);\r\n        }\r\n        this.layerMap[layer] = node;\r\n    }\r\n\r\n    public getLayer(key) {\r\n        return this.layerMap[key];\r\n    }\r\n\r\n    //注册UI\r\n    public registUI(wndbase: WndBase) {\r\n        if (this.windowMap[wndbase.name] != null) {\r\n            Logger.error(\"重复注册UI\", wndbase.name);\r\n            return;\r\n        }\r\n        this.windowMap[wndbase.name] = wndbase;\r\n    }\r\n\r\n\r\n\r\n    public getWindow<T extends WndBase>(wndName: string): T {\r\n        if (this.windowMap[wndName] == null) {\r\n            Logger.error(\"没有注册界面！！！需要先注册\", wndName);\r\n            return null;\r\n        }\r\n        let window = this.windowMap[wndName];\r\n        return window as T;\r\n    }\r\n\r\n\r\n    public show(wndName: string, ...args) {\r\n        if (this.windowMap[wndName] == null) {\r\n            Logger.error(\"没有注册界面！！！需要先注册\", wndName);\r\n            return;\r\n        }\r\n        let window = this.windowMap[wndName] as WndBase;\r\n        window.args = args\r\n        //界面正在加载  只设置active属性\r\n        if (window.isLoading) {\r\n            window.active = true;\r\n            return;\r\n        }\r\n        //已经加载过\r\n        if (window.isLoaded) {\r\n            //界面已经打开  触发onreshow\r\n            if (window.active == true) {\r\n                this.addToTop(window);\r\n                window.reshow();\r\n                return;\r\n            }\r\n            this.openWindowInternal(window);\r\n\r\n            return;\r\n        }\r\n        window.active = true;\r\n\r\n        window.loadingState = LoadingState.Loading;\r\n        if (window.resPath == null || window.resPath == \"\") {\r\n            Logger.error(\"未设置界面资源路径！！！\", window.name);\r\n            return;\r\n        }\r\n        if (window.destoryType == DestoryType.Persist) {\r\n            let tmpNode = Global.Persist.getFromPool(window.name)\r\n            if (tmpNode) {\r\n                this.onWindowLoaded(window, null, tmpNode, true);\r\n\r\n                return\r\n            }\r\n        }\r\n        this.resourceMgr.loadRes(window.resPath, (error, prefab) => {\r\n            Logger.log(\"show window\", wndName)\r\n            this.onWindowLoaded(window, error, prefab);\r\n        }, null, null, false, true);\r\n    }\r\n\r\n    public close(wndName: string) {\r\n        let window = this.getWindow<WndBase>(wndName);\r\n        Logger.log(\"close wnd\", wndName);\r\n        if (window == null || !window.isLoaded || !window.active) {\r\n            Logger.log(\"-----close \" + wndName)\r\n            return;\r\n        }\r\n        //@todo 根据动画类型关闭界面\r\n        this.realClose(window);\r\n    }\r\n\r\n    public closeHallLoading() {\r\n        // let loading = cc.Canvas.instance.node.getChildByName(\"loading\");\r\n        // if(loading)\r\n        //     loading.active = false;\r\n    }\r\n\r\n    public showHallLoading() {\r\n        // let loading = cc.Canvas.instance.node.getChildByName(\"loading\");\r\n        // if(loading)\r\n        //     loading.active = true;\r\n    }\r\n\r\n\r\n\r\n    public dispose(wndName: string) {\r\n        let window = this.getWindow<WndBase>(wndName);\r\n        if (window == null)\r\n            return;\r\n        if (window.loadingState == LoadingState.None)\r\n            return;\r\n        if (window.destoryType == DestoryType.Persist && window.active) {\r\n            return\r\n        }\r\n        window.loadingState = LoadingState.None;\r\n        window.dispose();\r\n\r\n        if (window.node != null && cc.isValid(window.node)) {\r\n            window.node.removeFromParent(true);\r\n            window.node.destroy();\r\n            window.node = null;\r\n        }\r\n        window.releaseRes();\r\n    }\r\n\r\n\r\n    private onWindowLoaded(window: WndBase, error, prefab, isNode = false) {\r\n        if (error != null) {\r\n            Logger.error(\"加载UI出错\", window.name, error.message);\r\n            Logger.error(\"msg\", JSON.stringify(error));\r\n            if (prefab == null) {\r\n                return;\r\n            }\r\n            // return;\r\n        }\r\n        if (!this.uiRoot.isValid)\r\n            return;\r\n        window.loadingState = LoadingState.Loaded;\r\n        if (window.destoryType == DestoryType.Persist) {\r\n            if (isNode) {\r\n                window.setNode(prefab);\r\n            }\r\n            else {\r\n                let tmpNode = cc.instantiate(prefab)\r\n                window.setNode(tmpNode);\r\n            }\r\n        }\r\n        else {\r\n            window.setNode(cc.instantiate(prefab));\r\n        }\r\n\r\n        if (window.isNeedDelay) {\r\n            window.active = false\r\n        }\r\n        AppHelper.afterWindowInit(window.name, window.node, window)\r\n        window.node.active = window.active;\r\n        if (window.commonBg != null && window.commonBg.isValid) {\r\n            window.commonBg.removeFromParent();\r\n            window.commonBg.destroy();\r\n            window.commonBg = null;\r\n        }\r\n        if (this.bgTemplate) {\r\n\r\n            window.commonBg = cc.instantiate(this.bgTemplate);\r\n\r\n            let comp = Global.UIHelper.safeGetComponent(window.commonBg, \"\", BlackBgComp);\r\n            comp.window = window;\r\n            if (window.commonBg) {\r\n                let btn = window.commonBg.getComponent(YXButton);\r\n                if (btn == null) {\r\n                    btn = window.commonBg.addComponent(YXButton);\r\n                    btn.transition = null\r\n                }\r\n\r\n                window.commonBg.on(\"click\", () => {\r\n                    if (!btn.isClickValid)\r\n                        return;\r\n                    btn.isClickValid = false;\r\n                    btn.scheduleOnce(() => {\r\n                        if (btn.isValid)\r\n                            btn.isClickValid = true;\r\n                    }, 1);\r\n                    this.realClose(window)\r\n                })\r\n\r\n            }\r\n        }\r\n        window.animComp = Global.UIHelper.safeGetComponent(window.node, \"\", UIAnimComponent);\r\n        //防止资源没加载完关闭\r\n        if (window.active || window.isNeedDelay) {\r\n            this.openWindowInternal(window);\r\n        }\r\n    }\r\n\r\n\r\n    private realClose(window) {\r\n        window.realClose();\r\n        this.removeWindowFromShowList(window);\r\n        this.doCloseAnim(window)\r\n        // this.adjustBg();\r\n    }\r\n\r\n    private doCloseAnim(window) {\r\n        if (window.animComp && window.layer == this.PopLayer) {\r\n            window.animComp.doPopupCloseAnim();\r\n        }\r\n        else {\r\n            if (window.commonBg) {\r\n                window.commonBg.active = false;\r\n                window.active = false;\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    //调整层级\r\n    private addToTop(window: WndBase) {\r\n        if (!window.isLoaded)\r\n            return;\r\n        let layerView = this.layerMap[window.layer]\r\n        if (layerView == null) {\r\n            layerView = this.layerMap[this.PopLayer];\r\n        }\r\n\r\n        if (!window.node.isValid) {\r\n            this.dispose(window.name);\r\n            return;\r\n        }\r\n\r\n        if (layerView == null || !layerView.isValid) {\r\n            return;\r\n        }\r\n        window.node.setParent(null);\r\n        if (window.layer == this.PopLayer && window.showBg && window.commonBg) {\r\n            // window.commonBg.active = true;\r\n            window.commonBg.removeFromParent(false);\r\n            layerView.addChild(window.commonBg);\r\n        }\r\n        layerView.addChild(window.node);\r\n    }\r\n\r\n\r\n\r\n    private openWindowInternal(window: WndBase) {\r\n        if (this.showWindowList.indexOf(window) > -1) {\r\n            Logger.error(\"!!!! 重复add window\", window)\r\n        }\r\n        this.showWindowList.push(window);\r\n        this.addToTop(window);\r\n\r\n        if (window.isNeedDelay) {\r\n            window.tryOpen(window.args);\r\n            window.animComp.bg = window.commonBg;\r\n            window.animComp.ui = window.node;\r\n            window.animComp.target = window;\r\n        }\r\n        else {\r\n            window.active = true;\r\n            window.open(window.args);\r\n            this.openWindowByLayer(window);\r\n        }\r\n\r\n\r\n    }\r\n\r\n\r\n\r\n\r\n    private openWindowByLayer(window: WndBase) {\r\n\r\n        if (window.layer == this.PopLayer) {\r\n            window.active = true;\r\n            window.animComp.bg = window.commonBg;\r\n            window.animComp.ui = window.node;\r\n            window.animComp.target = window;\r\n            window.animComp.doPopupOpenAnim();\r\n        }\r\n        else if (window.layer == this.FullScreenLayer) {\r\n            // window.active = true;\r\n            window.node.opacity = 1;\r\n            Global.Component.frameEnd(() => {\r\n                window.node.opacity = 255\r\n                window.afterOpen();\r\n            });\r\n        }\r\n        else {\r\n            window.active = true;\r\n        }\r\n    }\r\n\r\n\r\n    private removeWindowFromShowList(window: WndBase) {\r\n        for (let i = this.showWindowList.length - 1; i >= 0; i--) {\r\n            if (this.showWindowList[i] == window) {\r\n                this.showWindowList.splice(i, 1);\r\n            }\r\n        }\r\n    }\r\n\r\n    private loadCommonBg() {\r\n        this.resourceMgr.loadRes(\"hall/prefabs/ui/CommonBg\", (error, prefab) => {\r\n            if (error != null) {\r\n                Logger.error(\"hall/prefabs/ui/CommonBg  加载失败\");\r\n                return;\r\n            }\r\n            this.bgTemplate = cc.instantiate(prefab);\r\n            this.bgTemplate.active = false\r\n            let widget = this.bgTemplate.getComponent(cc.Widget);\r\n            if (widget) {\r\n                widget.target = this.canvasNode;\r\n            }\r\n            // this.bgTemplate.addChild(bg);\r\n        })\r\n    }\r\n\r\n\r\n    public clearAllUIPrefab() {\r\n        for (let key in this.windowMap) {\r\n            this.dispose(key);\r\n        }\r\n        if (this.bgTemplate && cc.isValid(this.bgTemplate)) {\r\n            this.bgTemplate.destroy();\r\n            this.bgTemplate = null;\r\n        }\r\n        this.showWindowList = []\r\n\r\n        this.fastTipMgr.clearAll();\r\n    }\r\n\r\n    public closeAllUIPrefab(ignoreMainLayer = false) {\r\n        this.showHallLoading();\r\n\r\n        for (let i = this.showWindowList.length - 1; i >= 0; i--) {\r\n\r\n            if (this.showWindowList[i] == null) {\r\n                Logger.error(\"showWindowList[i] == null ~!!!!!\", i);\r\n            }\r\n            else {\r\n                if (this.showWindowList[i].layer == this.MainLayer && ignoreMainLayer\r\n                    || (this.showWindowList[i].layer == this.FullScreenLayer && ignoreMainLayer))//grace 2020 3.19 大厅跟随选场 切场景不强制关闭选场界面 防止闪现大厅的问题\r\n                {\r\n                    continue;\r\n                }\r\n                if(this.showWindowList[i].name == \"WndNetWaiting\")\r\n                {\r\n                    continue\r\n                }\r\n                this.showWindowList[i].close();\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    private scaleAnim(window: WndBase) {\r\n        window.node.scale = 0.4;\r\n        window.node.runAction(cc.scaleTo(0.2, 1).easing(cc.easeBackOut()));\r\n    }\r\n\r\n\r\n    public onUpdate(dt) {\r\n        this.fastTipMgr.onUpdate(dt);\r\n    }\r\n\r\n\r\n    //-------------messagebox接口------------------------------------------------\r\n    /**\r\n     * 带警报Icon的提示弹窗\r\n     * @param content 显示文本\r\n     * @param callbackY 确定回调\r\n     * @param callbackN 取消或者关闭回调\r\n     */\r\n    public showAlertBox(content: string, callbackY?: Function, callbackN?: Function, autoClose = true, autoReleaseFunc = true) {\r\n        this.show(\"WndMessageBox\", content, 2, callbackY, callbackN, autoClose, autoReleaseFunc, true);\r\n    }\r\n    /**\r\n     * 只有确定按钮的提示弹窗\r\n     * @param content 显示文本\r\n     * @param callbackY 确定回调\r\n     * @param callbackN 取消或者关闭回调\r\n     */\r\n    public showSingleBox(content: string, callbackY?: Function, callbackN?: Function, autoClose = true, autoReleaseFunc = true) {\r\n        if (Global.SceneManager.sceneType == SceneType.Game) {\r\n            if (this.bMessageBoxInGame) {\r\n                var objArr = [content, 2, callbackY, callbackN, autoClose, autoReleaseFunc];\r\n                Game.Event.event(Game.EVENT_MESSAGE_BOX, objArr);\r\n                return;\r\n            }\r\n        }\r\n        this.show(\"WndMessageBox\", content, 2, callbackY, callbackN, autoClose, autoReleaseFunc);\r\n    }\r\n\r\n    public showYesNoBox(content: string, callbackY?: Function, callbackN?: Function, autoClose = true) {\r\n        if (Global.SceneManager.sceneType == SceneType.Game) {\r\n            if (this.bMessageBoxInGame) {\r\n                var objArr = [content, 1, callbackY, callbackN, autoClose];\r\n                Game.Event.event(Game.EVENT_MESSAGE_BOX, objArr);\r\n                return;\r\n            }\r\n        }\r\n        this.show(\"WndMessageBox\", content, 1, callbackY, callbackN, autoClose);\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * 设置是否在子游戏内处理大厅messagebox\r\n     * @param bMessageBox \r\n     */\r\n    public SetMessageBoxInGame(bMessageBox: boolean) {\r\n        this.bMessageBoxInGame = bMessageBox;\r\n    }\r\n\r\n\r\n    //---------------------------------------------------------------------------\r\n    /**\r\n     * 通用tips  支持富文本\r\n     * @param msg \r\n     */\r\n    public fastTip(msg) {\r\n        this.fastTipMgr.show(msg);\r\n    }\r\n\r\n    /**\r\n     * 显示横竖屏切换提示UI\r\n     * @param compeleteCallBack 提示播放完以后的回调\r\n     * @param showTime 提示显示时长(单位:秒)\r\n     */\r\n    public showPortraitScreenNotice(compeleteCallBack: Function, showTime?: number) {\r\n        // Logger.error(\"showPortraitScreenNotice() called!!!\");\r\n        this.show(\"WndScreenPortraitNotice\", compeleteCallBack, showTime);\r\n    }\r\n}"]}