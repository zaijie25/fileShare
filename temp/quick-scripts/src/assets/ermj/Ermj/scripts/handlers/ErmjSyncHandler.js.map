{"version":3,"sources":["assets\\ermj\\Ermj\\scripts\\handlers\\ErmjSyncHandler.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import ErmjBaseHandler from \"./ErmjBaseHandler\";\r\nimport ErmjDriver from \"../ErmjDriver\";\r\n\r\nexport class ErmjSyncBeginHandler extends ErmjBaseHandler{\r\n    protected refreshData(msg){\r\n        this.context.syncMode = true;\r\n    }\r\n\r\n    protected execute(msg){\r\n        ErmjDriver.instance.beginSync();\r\n    }\r\n}\r\n\r\nexport class ErmjSyncEndHandler extends ErmjBaseHandler{\r\n    protected refreshData(msg){\r\n        this.context.syncMode = false;\r\n    }\r\n}\r\n\r\nexport class ErmjSyncRefreshHandler extends ErmjBaseHandler{\r\n    protected execute(msg){\r\n        this.mainUI.leftTipsView.updateLeftLbl(msg._para.left_count);\r\n        // 复盘\r\n        this.mainUI.mjHillView.doDeal(msg._para.head_count || 0);\r\n        this.mainUI.mjHillView.doPatchwork(msg._para.tail_count || 0);\r\n        \r\n        let flowerCards = msg._para.flower_cards || {};\r\n        for(let chair in flowerCards){\r\n            let localSeat = this.SitHelper.serverSToLocalN(Number(chair));\r\n            this.mainUI.callMjPlayer(localSeat, \"flowerCardAdd\", flowerCards[chair]);\r\n        }\r\n\r\n        let lastOutLocalSeat = this.SitHelper.serverSToLocalN(msg._para.last_out_chair);\r\n        let outCards = msg._para.out_cards || {};\r\n        for(let chair in outCards){\r\n            let localSeat = this.SitHelper.serverSToLocalN(Number(chair));\r\n            if(localSeat != lastOutLocalSeat){          // debug 先还原其他人, 最后还原最近一次出牌者, 服务器牌数组按出牌顺序, 保证可以拿到最后一张出牌引用\r\n                this.mainUI.callMjPlayer(localSeat, \"showOutCardDirectly\", outCards[chair]);\r\n            }\r\n        }\r\n        if (outCards[msg._para.last_out_chair]){        // 出过牌才显示\r\n            this.mainUI.callMjPlayer(lastOutLocalSeat, \"showOutCardDirectly\", outCards[msg._para.last_out_chair]);\r\n            this.mainUI.showLastOutSign(true);\r\n        }\r\n\r\n        let setCards = msg._para.set_cards || {};\r\n        for(let chair in setCards){\r\n            let localSeat = this.SitHelper.serverSToLocalN(Number(chair));\r\n            this.mainUI.callMjPlayer(localSeat, \"syncAllOperView\", setCards[chair]);\r\n        }\r\n    }\r\n}"]}