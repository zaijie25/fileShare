{"version":3,"sources":["assets\\ermj\\Ermj\\scripts\\handlers\\ErmjLeaveHandler.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import ErmjBaseHandler from \"./ErmjBaseHandler\";\r\nimport ErmjDriver from \"../ErmjDriver\";\r\n\r\nexport default class ErmjLeaveHandler extends ErmjBaseHandler{\r\n    protected refreshData(msg){\r\n        let sit = this.SitHelper.serverSToLocalN(msg._src);\r\n        if(this.context.playerList[sit]){\r\n            Logger.error(\"leave\", sit, msg._src);\r\n            this.context.playerList[sit].clear();\r\n        }\r\n        else{\r\n            Logger.error(\"leave error\");\r\n        }\r\n    }\r\n\r\n    protected execute(msg){\r\n        let sit = this.SitHelper.serverSToLocalN(msg._src);\r\n        Game.Event.event(Game.EVENT_ADDTIMELOCK, \"ErmjLeaveHandler\", this.Define.HeadMoveTime + 0.1);\r\n\r\n        if(msg._src == this.context.selfSrc){\r\n            //重新匹配\r\n            if(msg._para && msg._para.Reason && msg._para.Reason._reason == 103){\r\n                Game.Server.clearData();\r\n                Game.Tween.clear();\r\n                Global.HallServer.setSession(null);\r\n                let gameTimes = msg._para && msg._para.GameTimes || 0;\r\n                if (gameTimes > 0){\r\n                    Game.Server.stopGame();\r\n                    this.mainUI.settleView.showActionBtn(true);\r\n                    this.mainUI.flowView.showActionBtn(true);\r\n                }\r\n                else{\r\n                    this.mainUI.flowView.showActionBtn(false);\r\n                    this.mainUI.settleView.showActionBtn(false);\r\n                    this.mainUI.matchPlayerView.active = false;\r\n                    Game.Server.clearDst();\r\n                    Game.Control.trySendEnter({\"_from\":\"jump\"});\r\n                }\r\n            }\r\n            else{\r\n                this.mainUI.callPlayer(sit, \"hide\");\r\n                if (msg._para && msg._para.Reason && msg._para.Reason._reason == 102) {\r\n                    Global.Toolkit.transmitHallMsg(\"金币不够啦，是否前往充值？\",()=>{\r\n                        Global.UI.show(\"WndRecharge\");\r\n                    });\r\n                }\r\n                else if( msg._para &&  msg._para.Reason && msg._para.Reason._explain){\r\n                    Global.Toolkit.transmitHallMsg(msg._para.Reason._explain,null,null,1)\r\n                }\r\n                ErmjDriver.instance.leaveGame(); \r\n            }\r\n        }\r\n        else{\r\n            if (this.context.get(this.Define.FieldInSettle))    // 结算中 不去处理其他玩家的leave\r\n                return;\r\n            if(msg._para && msg._para.Reason && (msg._para.Reason._reason == 103 || msg._para.Reason._reason == 105)){\r\n                // 103 105不处理\r\n            }\r\n            else{\r\n                this.mainUI.callPlayer(sit, \"hide\");\r\n            }\r\n        }\r\n    }\r\n\r\n    public checkInQueue(msg){\r\n        //不是自己 就放到对列中\r\n        if (msg._src != Game.Context.selfSrc) \r\n            return true;\r\n        if (msg._para && msg._para.Reason && (msg._para.Reason._reason == 102 || msg._para.Reason._reason == 103  || msg._para.Reason._reason == 20)){\r\n            //重新匹配中不发送心跳\r\n            if(msg._para.Reason._reason == 103){\r\n                if(Game.Server.stopHeartBeat)\r\n                    Game.Server.stopHeartBeat();\r\n            }\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n}"]}