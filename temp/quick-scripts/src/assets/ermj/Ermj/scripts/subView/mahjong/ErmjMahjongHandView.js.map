{"version":3,"sources":["assets\\ermj\\Ermj\\scripts\\subView\\mahjong\\ErmjMahjongHandView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import ErmjBaseView from \"../ErmjBaseView\";\r\nimport ErmjPathHelper, { ErmjAudioConst } from \"../../data/ErmjPathHelper\";\r\nimport ErmjMjStyleHelper from \"../../tool/ErmjMjStyleHelper\";\r\nimport ErmjGameConst from \"../../data/ErmjGameConst\";\r\n\r\nexport default class ErmjMahjongHandView extends ErmjBaseView{\r\n    private frontBg: cc.Node;\r\n    private frontSp: cc.Sprite;\r\n    private backBg: cc.Node;\r\n    private _isSelect = false;\r\n    private _value: number;\r\n    private rawPos: cc.Vec3 = cc.Vec3.ZERO;\r\n    private _isOut: boolean = false;\r\n    private _sortIndex: number = 0;\r\n    private selectSign: cc.Node;\r\n    private isTouchEnable: boolean = true;\r\n\r\n    constructor(node: cc.Node){\r\n        super();\r\n        this.setNode(node);\r\n    }\r\n\r\n    protected initView(){\r\n        this.frontBg = this.getChild(\"bg\");\r\n        this.frontSp = this.getComponent(\"front\", cc.Sprite);\r\n        this.backBg = this.getChild(\"back\");\r\n        this.selectSign = this.getChild(\"selectSign\");\r\n        this.selectSign.active = false;\r\n    }\r\n\r\n    public set isSelect(flag: boolean){\r\n        this._isSelect = flag;\r\n    }\r\n\r\n    public get isSelect(){\r\n        return this._isSelect;\r\n    }\r\n\r\n    public set isOut(flag: boolean){\r\n        this._isOut = flag;\r\n    }\r\n\r\n    public get isOut(){\r\n        return this._isOut;\r\n    }\r\n\r\n    /** 设置排序, 同时设置在父节点的渲染顺序 */\r\n    public set sortIndex(value: number){\r\n        this._sortIndex = value;\r\n        this.node.setSiblingIndex(value);\r\n    }\r\n\r\n    public get sortIndex(){\r\n        return this._sortIndex;\r\n    }\r\n\r\n    public set mahjongValue(value: number){\r\n        if (this._value == value)\r\n            return;\r\n        this._value = value;\r\n        Global.ResourceManager.loadBundleAutoAtlas(ErmjGameConst.Gid, this.frontSp, ErmjPathHelper.gameTexturePath + \"mahjong/atlas_mahjong\", ErmjMjStyleHelper.mjHandMap[value], null, true);\r\n        if (cc.sys.isBrowser)\r\n            this.node.name = String(value);\r\n    }\r\n\r\n    public get mahjongValue(){\r\n        return this._value;\r\n    }\r\n\r\n    /** 设置麻将正反面 */\r\n    public set isFront(flag: boolean){\r\n        this.frontBg.active = flag;\r\n        this.frontSp.node.active = flag;\r\n        this.backBg.active = !flag;\r\n    }\r\n\r\n    public setTouchEnable(flag: boolean){\r\n        Global.UIHelper.setNodeGray(this.node, !flag);\r\n        this.isTouchEnable = flag;\r\n    }\r\n\r\n    /** 设置正面背景特殊色提示 */\r\n    public setSpecialColor(flag: boolean){\r\n        this.frontBg.color = flag && ErmjMjStyleHelper.SpecialBgColor || ErmjMjStyleHelper.NormalBgColor;\r\n    }\r\n\r\n    private rememberRawPos(){\r\n        this.rawPos = this.node.position;\r\n    }\r\n\r\n    public onSelect(isSound = false){\r\n        this.isSelect = !this.isSelect;\r\n        if (this.isSelect){\r\n            // isSound && ErmjGameConst.playSound(ErmjAudioConst.commonAudio.SelectPoker, true);\r\n            this.rememberRawPos();\r\n            this.node.setPosition(cc.v2(this.rawPos.x, this.rawPos.y + this.Define.ChooseOffsetY));\r\n        }\r\n        else{\r\n            this.node.setPosition(this.rawPos);\r\n        }\r\n    }\r\n\r\n    public resetSelect(){\r\n        this.node.setPosition(this.rawPos);\r\n        this.isSelect = false;\r\n    }\r\n\r\n    /**\r\n     * 麻将移动(自身父坐标内)\r\n     * @param to 终点坐标\r\n     * @param timeScale 移动时长\r\n     * @param timeWait 移动前延时\r\n     * @param callback 完成回调\r\n     */\r\n    public doMove(to: cc.Vec3, timeScale = 1, timeWait = 0, callback?: Function, isSound = false, ease: any = cc.easeIn(1)){\r\n        let tween = Game.Tween.get(this.node);\r\n        tween.delay(timeWait)\r\n        .call(()=>{\r\n            // isSound && ErmjGameConst.playSound(ErmjAudioConst.commonAudio.DispatchPoker, true);\r\n        })\r\n        .to(timeScale, {position: to}, ease)\r\n        .call(callback)\r\n        .start();\r\n    }\r\n\r\n    /**\r\n     * 补花动画\r\n     * @param newValue 补花进来的牌 0代表未知牌 以牌背显示\r\n     * @param showTime 动画时长 消失出现动画时长\r\n     * @param hideWaitTime 消失后等待时间\r\n     */\r\n    public doChangeFlower(newValue: number, showTime: number, hideWaitTime = 0){\r\n        let [width, height] = this.getRealSize();\r\n        let tween = Game.Tween.get(this.node);\r\n        this.node.opacity = 255;\r\n        tween.by(showTime, {position: cc.v3(0, height), opacity: -254}, cc.easeIn(1))\r\n        .call(()=>{\r\n            if (newValue > 0)\r\n                this.mahjongValue = newValue;\r\n        })\r\n        .delay(hideWaitTime)\r\n        .by(showTime, {position: cc.v3(0, -height), opacity: 254}, cc.easeOut(1))\r\n        .start();\r\n    }\r\n\r\n    /**\r\n     * 摸牌动画\r\n     * @param endPos 终点\r\n     * @param showTime 出现时长\r\n     */\r\n    public doDraw(endPos: cc.Vec3, showTime: number){\r\n        let tween = Game.Tween.get(this.node);\r\n        this.node.setPosition(endPos.add(cc.v3(0, 60)));\r\n        this.node.opacity = 50;\r\n        this.node.angle = 30;\r\n        tween.to(showTime, {position: endPos, opacity: 255, angle: 0}, cc.easeIn(1))\r\n        .start();\r\n    }\r\n\r\n    /**\r\n     * 获取麻将的落地原始位置\r\n     */\r\n    private getRawPos(){\r\n        return this.rawPos;\r\n    }\r\n\r\n    public getWorldPos(){\r\n        return this.node.parent.convertToWorldSpaceAR(this.node.position);\r\n    }\r\n\r\n    /**\r\n     * 检测点击坐标在麻将内\r\n     * @param position 世界坐标点\r\n     */\r\n    public checkIsTouch(position: cc.Vec2){\r\n        let rec = this.node.getBoundingBoxToWorld();\r\n        return rec.contains(position);\r\n    }\r\n\r\n    public getRealSize(){\r\n        return [this.node.width * this.node.scaleX, this.node.height * this.node.scaleY];\r\n    }\r\n\r\n    /**\r\n     * 是否是显示可选择的麻将子\r\n     */\r\n    public checkMjValid(){\r\n        return this.isTouchEnable && this.node.activeInHierarchy && this.node.active;\r\n    }\r\n\r\n    /** 选中光标位置 */\r\n    public getSelectSignWorldPos(){\r\n        return this.selectSign.parent.convertToWorldSpaceAR(this.selectSign.position);\r\n    }\r\n\r\n    public reset(){\r\n        this.node.opacity = 255;\r\n        this.node.angle = 0;\r\n        this.isSelect = false;\r\n        this.isFront = false;\r\n        this.isOut = false;\r\n        this.setTouchEnable(true);\r\n    }\r\n}"]}