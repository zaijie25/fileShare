{"version":3,"sources":["assets\\ddz\\ddz\\scripts\\subView\\DdzMarkerView.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,6CAAwC;AACxC,qDAAgD;AAChD,yDAAoD;AACpD,qDAA+C;AAC/C,0CAAqC;AAErC;;GAEG;AACH;IAA2C,iCAAW;IA0BlD,uBAAY,IAAa;QAAzB,YACI,iBAAO,SAEV;QA5BO,wBAAkB,GAAiB,EAAE,CAAC;QAC9C,0BAA0B;QAClB,2BAAqB,GAAG;YAC5B,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;SAC9C,CAAC;QAEM,gCAA0B,GAAG;YACjC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;SAC9C,CAAC;QAEM,YAAM,GAAG;YACb,CAAC,EAAE,EAAE;YACL,CAAC,EAAE,EAAE;YACL,CAAC,EAAE,EAAE;YACL,CAAC,EAAE,EAAE;YACL,CAAC,EAAE,EAAE;YACL,CAAC,EAAE,CAAC;YACJ,CAAC,EAAE,CAAC;YACJ,EAAE,EAAE,CAAC;YACL,EAAE,EAAE,CAAC;YACL,EAAE,EAAE,CAAC;YACL,EAAE,EAAE,CAAC;YACL,EAAE,EAAE,CAAC;SACR,CAAA;QAIG,KAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;;IACvB,CAAC;IAES,gCAAQ,GAAlB;QACI,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,EAAE,EAAE;YACzB,IAAI,IAAI,GAAG,IAAI,CAAC,QAAQ,CAAC,cAAc,GAAG,CAAC,CAAC,CAAC;YAC7C,IAAI,IAAI,GAAG,IAAI,UAAU,CAAC,IAAI,CAAC,CAAC;YAChC,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;SACtC;IACL,CAAC;IAES,8BAAM,GAAhB;QACI,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,sBAAY,CAAC,YAAY,EAAE,IAAI,EAAE,IAAI,CAAC,cAAc,CAAC,CAAC;QACpE,IAAI,CAAC,cAAc,EAAE,CAAC;IAC1B,CAAC;IAES,+BAAO,GAAjB;QACI,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,sBAAY,CAAC,YAAY,EAAE,IAAI,EAAE,IAAI,CAAC,cAAc,CAAC,CAAC;IACzE,CAAC;IAEM,sCAAc,GAArB;QACI,IAAI,UAAU,GAAG,IAAI,CAAC,OAAO,CAAC,aAAa,EAAE,CAAC;QAC9C,IAAI,cAAc,GAAG,IAAI,CAAC,OAAO,CAAC,iBAAiB,EAAE,CAAC;QACtD,IAAI,QAAQ,GAAG,UAAU,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC;QACjD,IAAI,MAAM,GAAG,QAAQ,CAAC,MAAM,CAAC,UAAC,IAAI,EAAE,KAAK,EAAE,GAAG,IAAK,OAAA,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,KAAK,EAA3B,CAA2B,CAAC,CAAC,CAAC,IAAI;QACrF,IAAI,UAAU,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,IAAI,sBAAO,CAAC,KAAK,mBAAQ,IAAI,CAAC,0BAA0B,CAAC,mBAAO,IAAI,CAAC,qBAAqB,CAAC,CAAC;QAC9H,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,MAAM,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,EAAE,EAAE;YACzC,IAAI,KAAK,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;YACtB,IAAI,IAAI,CAAC,WAAW,CAAC,eAAe,CAAC,KAAK,CAAC,EAAE;gBACzC,IAAI,GAAG,GAAG,CAAC,CAAC,CAAC;gBACb,IAAI,KAAK,IAAI,wBAAc,CAAC,QAAQ;oBAChC,GAAG,GAAG,CAAC,CAAC;qBACP,IAAI,KAAK,IAAI,wBAAc,CAAC,UAAU;oBACvC,GAAG,GAAG,CAAC,CAAC;qBACP;oBACA,GAAG,GAAI,IAAI,CAAC,WAAW,CAAC,aAAa,CAAC,KAAK,CAAC,GAAzC,CAA0C;iBACjD;gBAED,IAAI,GAAG,IAAI,CAAC,IAAI,GAAG,IAAI,EAAE,EAAE;oBACvB,IAAI,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC;wBAChB,GAAG,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;oBAC3B,UAAU,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;iBACxB;aACJ;SACJ;QACD,IAAI,CAAC,WAAW,CAAC,UAAU,CAAC,CAAC;IACjC,CAAC;IAEO,mCAAW,GAAnB,UAAoB,GAAa;QAC7B,IAAI,CAAC,kBAAkB,CAAC,OAAO,CAAC,UAAC,IAAI,EAAE,GAAG;YACtC,IAAI,KAAK,GAAG,GAAG,CAAC,GAAG,CAAC,CAAC;YACrB,IAAI,KAAK,IAAI,CAAC,EAAE;gBACZ,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC;aAC5B;QACL,CAAC,CAAC,CAAC;IACP,CAAC;IACL,oBAAC;AAAD,CApFA,AAoFC,CApF0C,qBAAW,GAoFrD;;AAED;IAAyB,8BAAW;IAEhC,oBAAY,IAAI;QAAhB,YACI,iBAAO,SAEV;QADG,KAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;;IACvB,CAAC;IAES,6BAAQ,GAAlB;QACI,IAAI,CAAC,QAAQ,GAAa,IAAI,CAAC,YAAY,CAAC,UAAU,EAAE,EAAE,CAAC,KAAK,CAAC,CAAC;IACtE,CAAC;IAED,cAAc;IACP,iCAAY,GAAnB,UAAoB,GAAe;QAAf,oBAAA,EAAA,OAAe;QAC/B,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,MAAM,CAAC,GAAG,CAAC,CAAC;QACnC,IAAI,GAAG,IAAI,CAAC,EAAE;YACV,6DAA6D;YAC7D,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,GAAG,IAAI,EAAE,CAAC,KAAK,EAAE,CAAC,OAAO,CAAC,mBAAS,CAAC,QAAQ,CAAC,UAAU,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,CAAC;SACtG;aACI;YACD,8DAA8D;YAC9D,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,GAAG,IAAI,EAAE,CAAC,KAAK,EAAE,CAAC,OAAO,CAAC,mBAAS,CAAC,QAAQ,CAAC,UAAU,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,CAAC;SACtG;IACL,CAAC;IACL,iBAAC;AAAD,CAvBA,AAuBC,CAvBwB,qBAAW,GAuBnC","file":"","sourceRoot":"/","sourcesContent":["import DdzBaseView from \"./DdzBaseView\";\r\nimport DdzGameEvent from \"../data/DdzGameEvent\";\r\nimport DdzPokerHelper from \"../data/DdzPokerHelper\";\r\nimport { DdzMode } from \"../data/DdzRuleConst\";\r\nimport DdzDriver from \"../DdzDriver\";\r\n\r\n/**\r\n * 记牌器的view\r\n */\r\nexport default class DdzMarkerView extends DdzBaseView {\r\n    private pokerMarkerColList: MarkerItem[] = [];\r\n    // 记牌器数据, 0大王 1小王 2~14 2-A\r\n    private pokerMarkerDefaultArr = [\r\n        1, 1, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4\r\n    ];\r\n    \r\n    private quickPokerMarkerDefaultArr = [\r\n        1, 1, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 0, 0, 0\r\n    ];\r\n\r\n    private keyMap = {\r\n        3: 14,\r\n        4: 13,\r\n        5: 12,\r\n        6: 11,\r\n        7: 10,\r\n        8: 9,\r\n        9: 8,\r\n        10: 7,\r\n        11: 6,\r\n        12: 5,\r\n        13: 4,\r\n        14: 3,\r\n    }\r\n\r\n    constructor(node: cc.Node) {\r\n        super();\r\n        this.setNode(node);\r\n    }\r\n\r\n    protected initView() {\r\n        for (let i = 0; i < 15; i++) {\r\n            let node = this.getChild('content/item' + i);\r\n            let item = new MarkerItem(node);\r\n            this.pokerMarkerColList.push(item);\r\n        }\r\n    }\r\n\r\n    protected onOpen() {\r\n        Game.Event.on(DdzGameEvent.UpdateMarker, this, this.onUpdateMarker);\r\n        this.onUpdateMarker();\r\n    }\r\n\r\n    protected onClose() {\r\n        Game.Event.off(DdzGameEvent.UpdateMarker, this, this.onUpdateMarker);\r\n    }\r\n\r\n    public onUpdateMarker() {\r\n        let markerData = this.Context.getMarkerData();\r\n        let selfHandPokers = this.Context.getSelfHandPokers();\r\n        let knownArr = markerData.concat(selfHandPokers);\r\n        let result = knownArr.filter((item, index, arr) => arr.indexOf(item) === index); //去重\r\n        let defaultArr = this.Context.mode == DdzMode.Quick && [...this.quickPokerMarkerDefaultArr]|| [...this.pokerMarkerDefaultArr];\r\n        for (let i = 0; i <= result.length - 1; i++) {\r\n            let value = result[i];\r\n            if (this.PokerHelper.checkPokerValid(value)) {\r\n                let key = -1;\r\n                if (value == DdzPokerHelper.RedGhost)\r\n                    key = 0;\r\n                else if (value == DdzPokerHelper.BlackGhost)\r\n                    key = 1;\r\n                else {\r\n                    [key] = this.PokerHelper.getPokerValue(value);\r\n                }\r\n\r\n                if (key >= 0 && key <= 14) {\r\n                    if (this.keyMap[key])\r\n                        key = this.keyMap[key];\r\n                    defaultArr[key] -= 1;\r\n                }\r\n            }\r\n        }\r\n        this.setDataShow(defaultArr);\r\n    }\r\n\r\n    private setDataShow(arr: number[]) {\r\n        this.pokerMarkerColList.forEach((item, key) => {\r\n            let count = arr[key];\r\n            if (count >= 0) {\r\n                item.setLeftCount(count);\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\nclass MarkerItem extends DdzBaseView {\r\n    private countLbl: cc.Label;\r\n    constructor(node) {\r\n        super();\r\n        this.setNode(node);\r\n    }\r\n\r\n    protected initView() {\r\n        this.countLbl = <cc.Label>this.getComponent('countLbl', cc.Label);\r\n    }\r\n\r\n    //TODO 记牌器字体颜色\r\n    public setLeftCount(num: number = 4) {\r\n        this.countLbl.string = String(num);\r\n        if (num == 0) {\r\n            // this.countLbl.node.color = new cc.Color(194, 48, 17, 255);\r\n            this.countLbl.node.color = new cc.Color().fromHEX(DdzDriver.instance.skinDefine.markerColorArr[0]);\r\n        }\r\n        else {\r\n            // this.countLbl.node.color = new cc.Color(240, 155, 85, 255);\r\n            this.countLbl.node.color = new cc.Color().fromHEX(DdzDriver.instance.skinDefine.markerColorArr[1]);\r\n        }\r\n    }\r\n}"]}