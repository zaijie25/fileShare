{"version":3,"sources":["assets\\ddz\\ddz\\scripts\\subView\\DdzPokerGroup.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import DdzBaseView from \"./DdzBaseView\";\r\nimport DdzPokerView from \"../subView/DdzPokerView\";\r\nimport DdzPokerPool from \"../tool/DdzPokerPool\";\r\nimport DdzDriver from \"../DdzDriver\";\r\n\r\nexport default class DdzPokerGroup extends DdzBaseView{\r\n    private restNode: cc.Node;\r\n    private restCountLbl: cc.Label;\r\n    private pokerShowRoot: cc.Node;\r\n    private playStartRoot: cc.Node;\r\n\r\n    private onShowPokers: DdzPokerView[] = [];\r\n    private pokerPool: DdzPokerPool;\r\n    private showSpaceX = 23;\r\n    private showSpaceY = -60;\r\n    private desPos: cc.Vec3;\r\n    private showCenterPos: cc.Vec3;\r\n\r\n    constructor(node: cc.Node, protected nSeat: number){\r\n        super();\r\n        this.pokerPool = DdzDriver.instance.PokerPool;\r\n        this.setNode(node);\r\n    }\r\n\r\n    protected initView(){\r\n        this.restNode = this.getChild('rest');\r\n        this.restNode.active = false;\r\n        this.restCountLbl = <cc.Label>this.getComponent('rest/countLbl', cc.Label);\r\n\r\n        this.pokerShowRoot = this.getChild('pokerShow');\r\n        this.desPos = this.pokerShowRoot.position;\r\n        this.playStartRoot = this.getChild('playStartRoot');\r\n    }\r\n\r\n    public setRestCountShow(isShow: boolean, num: number){\r\n        this.restNode.active = isShow;\r\n        if (isShow)\r\n            this.restCountLbl.string = String(num);\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param isShow \r\n     * @param arr \r\n     */\r\n    public showPlayPokers(isShow: boolean, arr: number[] = []){\r\n        if(isShow){\r\n            this.showCenterPos = cc.Vec3.ZERO;\r\n            this.pokerPool.recycleAll(this.onShowPokers);\r\n            this.onShowPokers = [];\r\n            let sortArr = arr;\r\n            this.onShowPokers = this.pokerPool.getItemArr(sortArr.length);\r\n            this.onShowPokers.forEach((poker, index) => {\r\n                poker.active = true;\r\n                poker.isFront = true;\r\n                poker.pokerValue = sortArr[index];\r\n                poker.setPokerStyle(0);\r\n                poker.node.setParent(this.pokerShowRoot);\r\n            });\r\n            this.layoutShowPokers();\r\n            \r\n            let dzLocalSeat = this.Context.get(this.Define.FieldDzLocSeat);\r\n            if (this.nSeat == dzLocalSeat){\r\n                this.onShowPokers[sortArr.length -1].setDzOwner(true);\r\n            }\r\n            this.pokerShowRoot.active = false;\r\n        }\r\n        else{\r\n            this.showCenterPos = cc.Vec3.ZERO;\r\n            this.pokerPool.recycleAll(this.onShowPokers);\r\n            this.onShowPokers = [];\r\n        }\r\n    }\r\n\r\n    public playOutPokersAnim(isAnim: boolean, arr: number[]){\r\n        this.pokerShowRoot.active = true;\r\n        if (isAnim){\r\n            let count = arr.length;\r\n            if (count >= 5){\r\n                this.pokerShowRoot.setPosition(this.desPos);\r\n                this.onShowPokers.forEach((poker, index) =>{\r\n                    poker.active = false;\r\n                    Game.Component.scheduleOnce(()=>{\r\n                        poker.active = true;\r\n                    }, index * 0.03 + 0.01);\r\n                })\r\n                Game.Event.event(Game.EVENT_ADDTIMELOCK, 'playOutPokersAnim', count * 0.03 + 0.01);\r\n            }\r\n            else{\r\n                this.pokerShowRoot.setPosition(this.playStartRoot.position);\r\n                let tween = Game.Tween.get(this.pokerShowRoot);\r\n                tween.to(this.Define.PokerPlayMoveTime, {position: this.desPos}, cc.easeQuarticActionOut())\r\n                .start();\r\n            }\r\n        }\r\n        else{\r\n            this.pokerShowRoot.setPosition(this.desPos);\r\n        }\r\n    }\r\n\r\n    private layoutShowPokers(){\r\n        let count = this.onShowPokers.length;\r\n        if(count <= 0)\r\n            return;\r\n        let [width, height] = this.onShowPokers[0].getPokerSize();\r\n        let [startX, startY] = [width /2, -height /2];\r\n        let maxCol = 10;        // 一行展示太多 在春天时两个人剩余牌会重叠\r\n        if (this.nSeat == 0){\r\n            this.onShowPokers.forEach((poker, i) => {\r\n                let pos = cc.v3((i- Math.ceil(count/2 - 1)) * this.showSpaceX, 0);\r\n                poker.setPokerPosition(pos);\r\n            });\r\n            this.showCenterPos = this.desPos;\r\n        }\r\n        else if(this.nSeat == 1){\r\n            this.onShowPokers.forEach((poker, i) => {\r\n                if (i <= maxCol -1){\r\n                    let colCount = count > maxCol ? maxCol: count;\r\n                    let pos = cc.v3(-startX - (colCount - i - 1) * this.showSpaceX, startY);\r\n                    poker.setPokerPosition(pos);\r\n                }\r\n                else{\r\n                    let colCount = count - maxCol;\r\n                    let pos = cc.v3(-startX - (colCount - i % maxCol - 1) * this.showSpaceX, startY + this.showSpaceY);\r\n                    poker.setPokerPosition(pos);\r\n                }\r\n            });\r\n            if (count <= maxCol){  // n张牌等间距m叠放 width = 2 * (n-1) *m\r\n                this.showCenterPos = cc.v3((this.desPos.x - (width * count - 2*(count-1)* this.showSpaceX) /2), this.desPos.y - height /2);\r\n            }\r\n            else{       // 两张牌由于父节点锚点在上方，牌锚点在中心，因而需要先加h/2\r\n                this.showCenterPos = cc.v3((this.desPos.x - (width * count - 2*(count-1)* this.showSpaceX) /2), this.desPos.y + height /2 - (height * 2 - this.showSpaceY) /2);\r\n            }\r\n        }\r\n        else if(this.nSeat == 2){\r\n            this.onShowPokers.forEach((poker, i) => {\r\n                if (i <= maxCol -1){\r\n                    let pos = cc.v3(startX + i * this.showSpaceX, startY);\r\n                    poker.setPokerPosition(pos);\r\n                }\r\n                else{\r\n                    let pos = cc.v3(startX + i % maxCol * this.showSpaceX, startY + this.showSpaceY);\r\n                    poker.setPokerPosition(pos);\r\n                }\r\n            });\r\n            if (count <= maxCol){\r\n                this.showCenterPos = cc.v3((this.desPos.x + (width * count - 2*(count-1)* this.showSpaceX) /2), this.desPos.y - height /2);\r\n            }\r\n            else{\r\n                this.showCenterPos = cc.v3((this.desPos.x + (width * count - 2*(count-1)* this.showSpaceX) /2), this.desPos.y + height /2 - (height * 2 - this.showSpaceY) /2);\r\n            }\r\n        }\r\n    }\r\n\r\n    public getPokerDealAnimPos(){\r\n        return this.restNode.parent.convertToWorldSpaceAR(this.restNode.position);\r\n    }\r\n\r\n    public getPokerShowDesWorldPos(){\r\n        return this.pokerShowRoot.parent.convertToWorldSpaceAR(this.showCenterPos || this.desPos);\r\n    }\r\n\r\n    public resetGroupPoker(){\r\n        this.restNode.active = false;\r\n        this.showPlayPokers(false);\r\n    }\r\n}"]}