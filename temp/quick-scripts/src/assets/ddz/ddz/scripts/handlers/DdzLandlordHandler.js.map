{"version":3,"sources":["assets\\ddz\\ddz\\scripts\\handlers\\DdzLandlordHandler.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import DdzBaseHandler from \"./DdzBaseHandler\";\r\nimport { DdzGameActState } from \"../data/DdzGameConst\";\r\nimport { DdzAudioConst } from \"../data/DdzPathHelper\";\r\nimport DdzRuleConst, { DdzMode } from \"../data/DdzRuleConst\";\r\n\r\nexport class DdzCalLandlordHandler extends DdzBaseHandler{\r\n    protected execute(msg){\r\n        let localSeat = this.SitHelper.serverSToLocalN(msg._src);\r\n        let time = 0;\r\n        let serverTime = msg._times;\r\n        if (serverTime && Game.Component.correctTime){\r\n            let dev = Game.Component.correctTime(serverTime);\r\n            time = msg._timeo * 1000 - dev;\r\n        }\r\n        else{\r\n            time = msg._timeo * 1000 - (Date.now() - msg._receiveTime);\r\n        }\r\n        if (time <= 0)\r\n            time = 1000;\r\n        if (localSeat == 0){\r\n            this.mainUI.askActionView.setRobViewShow(true, msg._para.land_items, msg._para.miss_items);\r\n        }\r\n        this.mainUI.showActionTimer(true, localSeat, time, null);\r\n    }\r\n\r\n    protected executeSync(msg){\r\n        this.execute(msg);\r\n    }\r\n}\r\n\r\nexport class DdzOnLandlordHandler extends DdzBaseHandler{\r\n    protected execute(msg){\r\n        let localSeat = this.SitHelper.serverSToLocalN(msg._src);\r\n        let selected = msg._para.selected;\r\n        if (localSeat == 0){\r\n            this.mainUI.askActionView.setRobViewShow(false);\r\n        }\r\n        let res = '';\r\n        if (selected <= 0){\r\n            let soundArr = DdzAudioConst.NotCallLandordArr;\r\n            res = soundArr[0];\r\n        }\r\n        else{\r\n            let soundArr = DdzAudioConst.CallLandordArr;\r\n            res = soundArr[selected - 1];\r\n        }\r\n        Global.Audio.playGameBundleSound(DdzAudioConst.genderSoundPath(res, 0), true);\r\n        this.mainUI.showActionTimer(false);\r\n        this.mainUI.callPlayer(localSeat, 'setState', true, DdzGameActState.Rob, selected);\r\n    }\r\n\r\n    protected executeSync(msg){\r\n        let localSeat = this.SitHelper.serverSToLocalN(msg._src);\r\n        let selected = msg._para.selected;\r\n        if (localSeat == 0){\r\n            this.mainUI.askActionView.setRobViewShow(false);\r\n        }\r\n        this.mainUI.showActionTimer(false);\r\n        this.mainUI.callPlayer(localSeat, 'setState', true, DdzGameActState.Rob, selected);\r\n    }\r\n}\r\n\r\nexport class DdzLandlordResultHandler extends DdzBaseHandler{\r\n    protected execute(msg){\r\n        this.mainUI.askActionView.setRobViewShow(false);\r\n        let dzSeat = this.SitHelper.serverSToLocalN(msg._para.land_chair);\r\n        this.context.set(this.Define.FieldDzLocSeat, dzSeat);\r\n        this.mainUI.dzLeftPokersView.showScoreLbl(true, msg._para.selected);\r\n        this.mainUI.dzLeftPokersView.setThreePokerValue(msg._para.cards);\r\n        this.mainUI.dzLeftPokersView.showThreePoker(true);\r\n\r\n        if (dzSeat == 0){\r\n            this.context.addSelfHandPokers(msg._para.cards, false);\r\n            this.mainUI.selfPlayView.showLandlordPoker(msg._para.cards);\r\n            this.mainUI.updateRoundMult(msg._para.selected * 2);\r\n        }\r\n        else{\r\n            let cfg = DdzRuleConst.ModeConfig[this.context.mode];\r\n            this.mainUI.callPlayer(dzSeat, 'setPlayerLeftPokers', true, cfg.baseCount + cfg.leftCount);\r\n            this.mainUI.updateRoundMult(msg._para.selected);\r\n        }\r\n        this.mainUI.callPlayer(dzSeat, 'setDz', true, true);\r\n        Game.Event.event(Game.EVENT_ADDTIMELOCK, \"DdzLandlordResultHandler\", this.Define.FlyDzIcon + 0.1);\r\n    }\r\n\r\n    protected executeSync(msg){\r\n        this.mainUI.askActionView.setRobViewShow(false);\r\n        let dzSeat = this.SitHelper.serverSToLocalN(msg._para.land_chair);\r\n        this.context.set(this.Define.FieldDzLocSeat, dzSeat);\r\n        if (dzSeat == 0){\r\n            this.mainUI.updateRoundMult(msg._para.selected * 2);\r\n        }\r\n        else{\r\n            this.mainUI.updateRoundMult(msg._para.selected);\r\n        }\r\n        this.mainUI.dzLeftPokersView.showScoreLbl(true, msg._para.selected);\r\n        this.mainUI.dzLeftPokersView.setThreePokerValue(msg._para.cards);\r\n        this.mainUI.dzLeftPokersView.showThreePoker(true);\r\n\r\n        this.mainUI.selfPlayView.showDzOwnerSign();\r\n        this.mainUI.callPlayer(dzSeat, 'setDz', true, false);\r\n    }\r\n}\r\n\r\nexport class DdzReCalLandlordHandler extends DdzBaseHandler{\r\n    protected execute(msg){\r\n        let isMatch = msg._para && msg._para.clear == 1;\r\n        Game.Tween.clear();\r\n        Game.Component.unscheduleAllCallbacks(); \r\n        this.mainUI.clearByRound();\r\n        Game.Event.event(Game.EVENT_ADDTIMELOCK, \"DdzReCalLandlordHandler\", 0.2);\r\n        if (isMatch){\r\n            this.mainUI.clearOtherPlayers();\r\n            this.context.clearByRound();    // 多次都不叫地主到解散才清理数据 debug 放外面会导致游戏开始标志重置\r\n        }\r\n    }\r\n}"]}