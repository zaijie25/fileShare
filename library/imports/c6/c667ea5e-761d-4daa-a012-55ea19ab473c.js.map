{"version":3,"sources":["assets\\bbwz\\Bbwz\\scripts\\data\\BbwzHistoryData.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import BbwzConstDefine from \"./BbwzConstDefine\";\r\nimport BbwzGameEvent from \"./BbwzGameEvent\";\r\nimport BbwzDriver from \"../BbwzDriver\";\r\n\r\nconst updateInterval = 5;\r\nexport default class BbwzHistoryData{\r\n    public trendDataList: any[] = [];\r\n    public longCount = 0;\r\n    public huCount = 0;\r\n    public heCount = 0;\r\n    public rateTag: number;             // 场子标签 1-低倍场 2-中倍场 3-高倍场\r\n    public tableID: string = \"\";        // 牌桌唯一标识\r\n    public tableName = \"牌桌名字\";\r\n    public onlinePlayer = 0;            // 在线人数\r\n    public tableState = 0;              // 牌桌状态 0-等待开局 1-开始下注 2-下注结束 3-开奖\r\n    public betLeftTime = 13;               // 开始下注倒计时：秒，带小数点\r\n\r\n    private dtTotal = 0;\r\n    public reqEnable = false;\r\n\r\n    // 设置数据\r\n    private parseServerCfg(cfg: any) {\r\n        this.trendDataList = cfg.AwardList || [];\r\n\r\n        this.longCount = 0;\r\n        this.huCount = 0;\r\n        this.heCount = 0;\r\n        this.trendDataList.forEach(element => {\r\n            let hit = element.hit;\r\n            if (hit.mix > 0) {\r\n                this.heCount++;\r\n                element.result = 0;\r\n            }\r\n            if (hit.dragon > 0) {\r\n                this.longCount++;\r\n                element.result = 1;\r\n            }\r\n            if (hit.tiger > 0) {\r\n                this.huCount++;\r\n                element.result = 2;\r\n            }\r\n        });\r\n\r\n        // 以下暂时用不上\r\n        this.rateTag = cfg.rate_tag;\r\n        this.tableID = cfg.level;\r\n        this.onlinePlayer = cfg.player_count;\r\n        this.tableState = cfg.status;\r\n        this.betLeftTime = cfg.count_down;\r\n    }\r\n\r\n    public clear(){\r\n        this.trendDataList = [];\r\n        this.longCount = 0;\r\n        this.huCount = 0;\r\n        this.heCount = 0;\r\n    }\r\n\r\n    public onUpdate(dt: number){\r\n        if (!this.reqEnable)\r\n            return;\r\n        \r\n        this.dtTotal += dt;\r\n        if (this.dtTotal < updateInterval)\r\n            return;\r\n\r\n        this.reqGameHisData();\r\n    }\r\n\r\n    public reqGameHisData(){\r\n        this.dtTotal = 0;\r\n        Global.HallServer.send(NetAppface.mod, \"GetGameData\", {\"gid\": BbwzConstDefine.GAME_ID}, (_param: any)=>{\r\n            if (!BbwzDriver.instance || !BbwzDriver.instance.inGame)       // 容错 不依赖大厅的协议跨场景丢弃\r\n                return;\r\n            let dataArr: any[] = _param.Data;\r\n            if (dataArr && dataArr.length > 0) {\r\n                for (let i = 0; i < dataArr.length; i++) {\r\n                    let data = dataArr[i];\r\n                    if (data.gid == BbwzConstDefine.GAME_ID && data.level == Game.Control.curLv) {\r\n                        this.parseServerCfg(data);\r\n                        Game.Event.event(BbwzGameEvent.onHistoryDataRes, this.trendDataList);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }, null, false);\r\n    }\r\n}"]}