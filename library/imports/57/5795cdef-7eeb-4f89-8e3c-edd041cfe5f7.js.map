{"version":3,"sources":["assets\\hall\\scripts\\logic\\hall\\ui\\personalInfo\\WndBindPhone.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAAA,oDAA+C;AAC/C,2DAAsD;AACtD,+DAA0D;AAC1D,2DAAsD;AAEtD,gEAA4F;AAE5F;IAA0C,gCAAO;IAAjD;;IAqHA,CAAC;IA9Ga,6BAAM,GAAhB;QACI,IAAI,CAAC,IAAI,GAAG,cAAc,CAAC;QAC3B,IAAI,CAAC,KAAK,GAAG,MAAM,CAAC,EAAE,CAAC,QAAQ,CAAC;QAChC,IAAI,CAAC,OAAO,GAAG,0CAA0C,CAAC;QAC1D,IAAI,CAAC,KAAK,GAAsB,MAAM,CAAC,YAAY,CAAC,QAAQ,CAAC,mBAAmB,CAAC,CAAC;IACtF,CAAC;IAES,+BAAQ,GAAlB;QACI,IAAI,CAAC,cAAc,CAAC,UAAU,EAAE,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;QACrD,IAAI,CAAC,cAAc,CAAC,WAAW,EAAE,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;QACtD,IAAI,CAAC,cAAc,CAAC,SAAS,EAAE,IAAI,CAAC,cAAc,EAAE,IAAI,CAAC,CAAC;QAE1D,IAAI,CAAC,cAAc,GAAmB,IAAI,CAAC,OAAO,CAAC,gBAAgB,EAAE,IAAI,CAAC,QAAQ,CAAC,gBAAgB,CAAC,EAAE,wBAAc,CAAC,CAAC;QACtH,IAAI,CAAC,YAAY,GAAiB,IAAI,CAAC,OAAO,CAAC,cAAc,EAAE,IAAI,CAAC,QAAQ,CAAC,cAAc,CAAC,EAAE,sBAAY,CAAC,CAAC;QAC5G,IAAI,CAAC,YAAY,CAAC,oBAAoB,CAAC,IAAI,CAAC,cAAc,EAAE,CAAC,CAAC,CAAC;QAC/D,IAAI,CAAC,YAAY,GAAiB,IAAI,CAAC,OAAO,CAAC,eAAe,EAAE,IAAI,CAAC,QAAQ,CAAC,cAAc,CAAC,EAAE,sBAAY,CAAC,CAAC;IACjH,CAAC;IAEO,+BAAQ,GAAhB;QACI,IAAI,CAAC,KAAK,EAAE,CAAC;IACjB,CAAC;IAES,6BAAM,GAAhB,UAAiB,IAAI;QAEjB,IAAI,CAAC,cAAc,CAAC,YAAY,GAAG,IAAI,CAAA;QACvC,IAAI,CAAC,YAAY,CAAC,YAAY,GAAG,IAAI,CAAA;QACrC,IAAI,CAAC,YAAY,CAAC,YAAY,GAAG,IAAI,CAAA;QACrC,IAAI,CAAC,cAAc,CAAC,KAAK,GAAG,EAAE,CAAC;QAC/B,IAAI,CAAC,YAAY,CAAC,IAAI,GAAG,EAAE,CAAC;QAC5B,IAAI,CAAC,YAAY,CAAC,GAAG,GAAG,EAAE,CAAC;IAC/B,CAAC;IAEO,qCAAc,GAAtB;QAAA,iBAyEC;QAxEG,IAAG,IAAI,CAAC,cAAc,CAAC,KAAK,IAAI,EAAE,EAClC;YACI,OAAO,MAAM,CAAC,EAAE,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;SACvC;QACD,IAAG,IAAI,CAAC,YAAY,CAAC,IAAI,IAAI,EAAE,EAC/B;YACI,OAAO,MAAM,CAAC,EAAE,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;SACtC;QACD,IAAG,IAAI,CAAC,YAAY,CAAC,GAAG,IAAI,EAAE,EAC9B;YACI,OAAO,MAAM,CAAC,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;SACrC;QAED,IAAG,CAAC,IAAI,CAAC,cAAc,CAAC,WAAW,EAAE,EACrC;YACI,MAAM,CAAC,EAAE,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC;YAChC,OAAO;SACV;QAED,IAAI,KAAK,GAAG,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC;QACtC,IAAI,IAAI,GAAG,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;QAClC,IAAI,IAAI,GAAG,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC;QACpC,IAAI,GAAG,GAAG,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC;QAEhC,IAAG,CAAC,MAAM,CAAC,OAAO,CAAC,aAAa,CAAC,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,EACvD;YACI,OAAO,MAAM,CAAC,EAAE,CAAC,OAAO,CAAC,MAAM,CAAC,QAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC;SAC3D;QAED,GAAG,GAAG,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;QAC9B,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,KAAK,EAAE,IAAI,EAAE,IAAI,EAAE,GAAG,EAAE,UAAC,GAAO;YACpD,2FAA2F;YAC3F,8FAA8F;YAC9F,IAAI,UAAU,GAAG,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAA,CAAA,QAAQ;YAC5D,IAAI,WAAW,GAAG,GAAG,CAAC,WAAW,CAAC,CAAC,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,CAAA,CAAA,QAAQ;YAE/D,IAAI,KAAK,CAAA;YACT,IAAG,CAAC,GAAG,CAAC,KAAK,EACb;gBACI,KAAK,GAAG,EAAE,CAAA;aACb;YACD,IAAG,GAAG,CAAC,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,EAC/B;gBACI,KAAK,GAAG,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC,GAAG,CAAC,KAAK,CAAC,CAAA;aAC9C;iBAED;gBACI,KAAK,GAAG,GAAG,CAAC,KAAK,CAAC;aACrB;YACD,MAAM,CAAC,UAAU,CAAC,KAAK,GAAG,KAAK,CAAA,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC;YAC5C,IAAG,UAAU,GAAG,CAAC,IAAI,WAAW,GAAG,CAAC,EAAC,EAAG,aAAa;gBACjD,IAAG,UAAU,GAAG,CAAC,EAAC;oBACd,0BAAgB,CAAC,QAAQ,CAAC,UAAU,CAAC,6BAAU,CAAC,WAAW,EAAE;wBACzD,0BAAgB,CAAC,QAAQ,CAAC,OAAO,CAAC,6BAAU,CAAC,WAAW,CAAC,CAAC;wBAC1D,MAAM,CAAC,EAAE,CAAC,IAAI,CAAC,cAAc,EAAC,UAAU,EAAC,WAAW,GAAG,CAAC,CAAC,CAAC,CAAC,kCAAe,CAAC,SAAS,CAAC,CAAC,CAAC,kCAAe,CAAC,aAAa,CAAC,CAAC;oBAC1H,CAAC,CAAC,CAAA;iBACL;gBACD,IAAG,WAAW,GAAG,CAAC,EAAC;oBACf,0BAAgB,CAAC,QAAQ,CAAC,UAAU,CAAC,6BAAU,CAAC,YAAY,EAAE;wBAC1D,0BAAgB,CAAC,QAAQ,CAAC,OAAO,CAAC,6BAAU,CAAC,YAAY,CAAC,CAAC;wBAC3D,MAAM,CAAC,EAAE,CAAC,IAAI,CAAC,cAAc,EAAC,WAAW,EAAC,UAAU,GAAG,CAAC,CAAC,CAAC,CAAC,kCAAe,CAAC,UAAU,CAAC,CAAC,CAAC,kCAAe,CAAC,cAAc,CAAC,CAAC;oBAC5H,CAAC,CAAC,CAAA;iBACL;aACJ;YACD,IAAG,UAAU,IAAI,CAAC,IAAI,WAAW,IAAI,CAAC,EAAC,EAAG,kBAAkB;gBACxD,IAAG,KAAK,EAAC;oBACL,MAAM,CAAC,EAAE,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;iBAC/B;aACJ;YACD,KAAI,CAAC,QAAQ,EAAE,CAAC;QAEpB,CAAC,CAAC,CAAC;IACP,CAAC;IAES,8BAAO,GAAjB;QACI,0BAAgB,CAAC,QAAQ,CAAC,WAAW,CAAC,6BAAU,CAAC,SAAS,CAAC,CAAC;IAChE,CAAC;IACL,mBAAC;AAAD,CArHA,AAqHC,CArHyC,iBAAO,GAqHhD","file":"","sourceRoot":"/","sourcesContent":["import WndBase from \"../../../core/ui/WndBase\";\r\nimport AutoCodeView from \"../login/view/AutoCodeView\";\r\nimport PhoneInputView from \"../login/view/PhoneInputView\";\r\nimport PwdInputView from \"../login/view/PwdInputView\";\r\nimport PersonalInfoModel from \"../../../hallcommon/model/PersonalInfoModel\";\r\nimport HallPopMsgHelper, { PopWndName, BindAwardUIType } from \"../../tool/HallPopMsgHelper\";\r\n\r\nexport default class WndBindPhone extends WndBase{\r\n    private phoneInputView: PhoneInputView;\r\n    private authCodeView: AutoCodeView;\r\n    private pwdInputView: PwdInputView;\r\n    private model: PersonalInfoModel;\r\n\r\n\r\n    protected onInit() {\r\n        this.name = \"WndBindPhone\";\r\n        this.layer = Global.UI.PopLayer;\r\n        this.resPath = \"hall/prefabs/ui/PersonalInfo/BindPhoneUI\";\r\n        this.model = <PersonalInfoModel>Global.ModelManager.getModel(\"PersonalInfoModel\");\r\n    }\r\n\r\n    protected initView(){\r\n        this.addCommonClick(\"bg/close\", this.closeWnd, this);\r\n        this.addCommonClick(\"cancelBtn\", this.closeWnd, this);\r\n        this.addCommonClick(\"sureBtn\", this.onSureBtnClick, this);\r\n\r\n        this.phoneInputView = <PhoneInputView>this.addView(\"PhoneInputView\", this.getChild(\"phoneContainer\"), PhoneInputView);\r\n        this.authCodeView = <AutoCodeView>this.addView(\"AutoCodeView\", this.getChild(\"authCodeView\"), AutoCodeView);\r\n        this.authCodeView.setPhoneInputAndType(this.phoneInputView, 1);\r\n        this.pwdInputView = <PwdInputView>this.addView(\"PwdInputView1\", this.getChild(\"pwdContainer\"), PwdInputView);\r\n    }\r\n\r\n    private closeWnd(){\r\n        this.close();\r\n    }\r\n\r\n    protected onOpen(args){\r\n\r\n        this.phoneInputView.subViewState = true\r\n        this.authCodeView.subViewState = true\r\n        this.pwdInputView.subViewState = true\r\n        this.phoneInputView.phone = \"\";\r\n        this.authCodeView.code = \"\";\r\n        this.pwdInputView.pwd = \"\";\r\n    }\r\n\r\n    private onSureBtnClick(){\r\n        if(this.phoneInputView.phone == \"\")\r\n        {\r\n            return Global.UI.fastTip(\"请输入手机号码\");\r\n        }\r\n        if(this.authCodeView.code == \"\")\r\n        {\r\n            return Global.UI.fastTip(\"请输入验证码\");\r\n        }\r\n        if(this.pwdInputView.pwd == \"\")\r\n        {\r\n            return Global.UI.fastTip(\"请输入密码\");\r\n        }\r\n\r\n        if(!this.phoneInputView.isAreaVaild())\r\n        {\r\n            Global.UI.fastTip(\"请选择正确的地区信息\");\r\n            return;\r\n        }\r\n\r\n        let phone = this.phoneInputView.phone;\r\n        let code = this.authCodeView.code;\r\n        let area = this.phoneInputView.area;\r\n        let pwd = this.pwdInputView.pwd;\r\n\r\n        if(!Global.Toolkit.checkPWFormat(this.pwdInputView.pwd))\r\n        {\r\n            return Global.UI.fastTip(Global.Language.getWord(1303));\r\n        }\r\n\r\n        pwd = Global.Toolkit.md5(pwd);\r\n        this.model.reqBindPhone(phone, code, area, pwd, (msg:any)=>{\r\n            // let bind_point = msg.bind_point ? Global.Toolkit.formatPoint(msg.bind_point) : 0//绑定送礼金额\r\n            // let phone_point = msg.phone_point ? Global.Toolkit.formatPoint(msg.phone_point) : 0//绑定送礼金额\r\n            let bind_point = msg.bind_point ? msg.bind_point : 0//绑定送礼金额\r\n            let phone_point = msg.phone_point ? msg.phone_point : 0//绑定送礼金额\r\n\r\n            let phone \r\n            if(!msg.phone)\r\n            {\r\n                phone = \"\"\r\n            }\r\n            if(msg.phone.indexOf(\" \") == -1)\r\n            {\r\n                phone = Global.AESUtil.decodeMsg(msg.phone)  \r\n            }\r\n            else\r\n            {\r\n                phone = msg.phone;\r\n            }\r\n            Global.PlayerData.phone = phone? phone : \"\";\r\n            if(bind_point > 0 || phone_point > 0){  //有绑定送金或者自动送金\r\n                if(bind_point > 0){\r\n                    HallPopMsgHelper.Instance.addMsgList(PopWndName.BindGiftGet, ()=>{\r\n                        HallPopMsgHelper.Instance.addLock(PopWndName.BindGiftGet);\r\n                        Global.UI.show(\"WndRebateGet\",bind_point,phone_point > 0 ? BindAwardUIType.bindPoint : BindAwardUIType.onlyBindPoint);\r\n                    })\r\n                }\r\n                if(phone_point > 0){\r\n                    HallPopMsgHelper.Instance.addMsgList(PopWndName.PhoneGiftGet, ()=>{\r\n                        HallPopMsgHelper.Instance.addLock(PopWndName.PhoneGiftGet);\r\n                        Global.UI.show(\"WndRebateGet\",phone_point,bind_point > 0 ? BindAwardUIType.phonePoint : BindAwardUIType.onlyPhonePoint);\r\n                    })\r\n                }\r\n            }\r\n            if(bind_point == 0 && phone_point == 0){  //都没有送金的时候也要弹出绑定成功\r\n                if(phone){\r\n                    Global.UI.fastTip(\"绑定手机成功\");\r\n                }\r\n            }\r\n            this.closeWnd();\r\n            \r\n        });\r\n    }\r\n\r\n    protected onClose(){\r\n        HallPopMsgHelper.Instance.releaseLock(PopWndName.BindPhone);\r\n    }\r\n}"]}