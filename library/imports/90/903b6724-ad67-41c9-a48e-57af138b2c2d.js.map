{"version":3,"sources":["assets\\hall\\scripts\\logic\\core\\tool\\PersisitHelpper.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["//常驻节点工具类\r\nexport default class PersistHelper\r\n{\r\n    //持久化根节点\r\n    private persistNode:cc.Node;\r\n    //切场景不销毁的池节点\r\n    private poolNode:cc.Node;\r\n    private persistNodeMap = {}\r\n    private showNode: cc.Node;\r\n    public init()\r\n    {\r\n        if(this.persistNode != null)\r\n            return;\r\n        this.persistNode = new cc.Node(\"persistNode\");\r\n        let winSize= cc.winSize;\r\n        this.persistNode.position = cc.v3(winSize.width*this.persistNode.anchorX, winSize.height*this.persistNode.anchorY,)\r\n        //cc.director.getScene().addChild(this.persistNode);\r\n        //持久化节点必须在根节点  如果没有父节点会自动挂载到scene上\r\n        cc.game.addPersistRootNode(this.persistNode);\r\n        this.persistNode.active = false;\r\n        this.poolNode = new cc.Node(\"persistPoolNode\");\r\n        this.persistNode.addChild(this.poolNode);\r\n        this.poolNode.active = false;\r\n\r\n        this.showNode = new cc.Node(\"alwaysShowNode\");\r\n        this.persistNode.addChild(this.showNode);\r\n        this.showNode.active = true;        // 常驻显示 用于展示\r\n    }\r\n\r\n    //挂载到常驻节点下，用于跨场景使用\r\n    public saveToPool(key:string, node:cc.Node, alwaysShow: boolean = false)\r\n    {\r\n        if(this.persistNode == null || !this.persistNode.isValid)\r\n        {\r\n            Logger.error(\"invalid persitNode!!!\");\r\n            return;\r\n        }\r\n        if(this.persistNodeMap[key] == null)\r\n            this.persistNodeMap[key] = [];\r\n        let pool = this.persistNodeMap[key];\r\n        pool.push(node);\r\n        // node.removeFromParent(false);        // 会触发ondisable\r\n        if (!alwaysShow)\r\n            node.setParent(this.poolNode);\r\n        else\r\n            node.setParent(this.showNode);\r\n    }\r\n\r\n    public getFromPool(key:string)\r\n    {\r\n        if(this.persistNode == null || !this.persistNode.isValid)\r\n        {\r\n            Logger.error(\"invalid persitNode!!!\");\r\n            return;\r\n        }\r\n        let pool = this.persistNodeMap[key];\r\n        if(pool == null)\r\n            return null;\r\n        while(pool.length > 0)\r\n        {\r\n            let node = pool.pop();\r\n            if(node && node.isValid)\r\n            {\r\n                return node;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    public getPersistNode()\r\n    {\r\n        return this.persistNode;\r\n    }\r\n    \r\n    /** 控制根节点展示 */\r\n    public setState(tag)\r\n    {\r\n        if(this.persistNode)\r\n        {\r\n            this.persistNode.active = tag\r\n        }\r\n            \r\n        // if(this.poolNode)\r\n        // {\r\n        //     this.poolNode.active = tag\r\n        // }\r\n        \r\n    }\r\n}"]}