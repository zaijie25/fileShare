{"version":3,"sources":["assets\\hall\\scripts\\logic\\hall\\ui\\rebate\\WndRebateGet.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAAA,oDAAgE;AAChE,gEAA4F;AAG5F;IAA0C,gCAAO;IAAjD;QAAA,qEAqGC;QA7FW,mBAAa,GAAU,CAAC,CAAC,CAAC,CAAC,MAAM;;IA6F7C,CAAC;IA3Fa,6BAAM,GAAhB;QACI,IAAI,CAAC,IAAI,GAAG,cAAc,CAAC;QAC3B,IAAI,CAAC,KAAK,GAAG,MAAM,CAAC,EAAE,CAAC,QAAQ,CAAC;QAChC,IAAI,CAAC,OAAO,GAAG,oCAAoC,CAAC;QACpD,IAAI,CAAC,WAAW,GAAG,qBAAW,CAAC,IAAI,CAAA;IACvC,CAAC;IAES,+BAAQ,GAAlB;QAAA,iBAcC;QAbG,IAAI,CAAC,aAAa,GAAG,CAAC,CAAC,CAAC;QAExB,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC;QACxC,IAAI,CAAC,cAAc,CAAC,SAAS,EAAE,IAAI,CAAC,cAAc,EAAE,IAAI,CAAC,CAAC;QAC1D,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG,KAAK,CAAC;QAE5B,IAAI,CAAC,KAAK,GAAmB,IAAI,CAAC,YAAY,CAAC,OAAO,EAAC,EAAE,CAAC,WAAW,CAAC,CAAC;QAEvE,IAAI,CAAC,SAAS,GAAa,IAAI,CAAC,YAAY,CAAC,mBAAmB,EAAE,EAAE,CAAC,KAAK,CAAC,CAAC;QAC5E,IAAI,CAAC,QAAQ,GAAgB,IAAI,CAAC,YAAY,CAAC,QAAQ,EAAE,EAAE,CAAC,QAAQ,CAAC,CAAC;QACtE,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,QAAQ,CAAC,mBAAmB,CAAC;YAC/C,KAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC,EAAE,OAAO,EAAE,IAAI,CAAC,CAAC;QACjD,CAAC,CAAC,CAAA;IACN,CAAC;IAEO,qCAAc,GAAtB;QACI,gCAAgC;QAChC,IAAG,IAAI,CAAC,KAAK,IAAI,IAAI,CAAC,KAAK,CAAC,SAAS;YACjC,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC;QACtB,IAAI,CAAC,QAAQ,EAAE,CAAC;IACpB,CAAC;IAES,6BAAM,GAAhB,UAAiB,GAAG;QAApB,iBAwBC;QAvBG,IAAI,KAAK,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC;QACnB,IAAI,CAAC,aAAa,GAAG,CAAC,CAAC,CAAC;QACxB,IAAG,GAAG,CAAC,CAAC,CAAC,EACT;YACI,IAAI,CAAC,aAAa,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC;SAC/B;QACD,IAAI,KAAK,GAAqB,MAAM,CAAC,YAAY,CAAC,QAAQ,CAAC,kBAAkB,CAAC,CAAC;QAC/E,IAAI,CAAC,SAAS,CAAC,MAAM,GAAG,MAAM,CAAC,OAAO,CAAC,cAAc,CAAC,KAAK,EAAE,IAAI,CAAC,IAAI,KAAK,CAAC,YAAY,CAAC,QAAQ,EAAE,CAAC;QACpG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;QACnC,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC,EAAE,MAAM,EAAE,KAAK,CAAC,CAAC;QAC9D,IAAI,WAAW,GAAG,MAAM,CAAC,OAAO,CAAC,WAAW,CAAC,WAAW,CAAC;QACzD,IAAG,IAAI,CAAC,KAAK,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,SAAS,IAAI,WAAW;YACjD,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC;QACtB,IAAI,CAAC,OAAO,CAAC,KAAK,GAAG,CAAC,CAAC;QACvB,IAAI,CAAC,OAAO,GAAG,UAAU,CAAC;YACtB,KAAI,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;YAClC,KAAI,CAAC,OAAO,CAAC,MAAM,GAAG,IAAI,CAAC;YAC3B,KAAI,CAAC,OAAO,CAAC,SAAS,CAAC,EAAE,CAAC,QAAQ,CAAC,EAAE,CAAC,OAAO,CAAC,GAAG,EAAE,GAAG,CAAC,EAAE,EAAE,CAAC,OAAO,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;YAC9E,KAAI,CAAC,cAAc,CAAC,MAAM,EAAC,KAAI,CAAC,cAAc,EAAC,KAAI,CAAC,CAAA;QACxD,CAAC,EAAE,IAAI,CAAC,CAAC;QACT,IAAG,GAAG,CAAC,CAAC,CAAC,EAAC;YACN,IAAI,CAAC,aAAa,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC;SAC/B;IACL,CAAC;IAEO,+BAAQ,GAAhB;QACI,IAAG,IAAI,CAAC,aAAa,EAAC;YAClB,IAAI,CAAC,aAAa,EAAE,CAAC;SACxB;QACD,IAAI,CAAC,KAAK,EAAE,CAAC;IACjB,CAAC;IAES,8BAAO,GAAjB;QACI,IAAI,CAAC,aAAa,GAAG,IAAI,CAAA;QACzB,YAAY,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QAC3B,IAAG,IAAI,CAAC,aAAa,GAAG,CAAC,EAAC;YACtB,IAAG,IAAI,CAAC,aAAa,IAAI,kCAAe,CAAC,SAAS,EAClD;gBACI,0BAAgB,CAAC,QAAQ,CAAC,WAAW,CAAC,6BAAU,CAAC,SAAS,CAAC,CAAC;gBAC5D,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,EAAE,UAAU,CAAC,YAAY,EAAE,EAAE,CAAC,CAAC;gBACpE,OAAM;aACT;YACD,IAAG,IAAI,CAAC,aAAa,IAAI,kCAAe,CAAC,KAAK,IAAI,IAAI,CAAC,aAAa,IAAI,kCAAe,CAAC,SAAS,EAAC;gBAC9F,MAAM,CAAC,EAAE,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;aAC/B;YACD,IAAG,IAAI,CAAC,aAAa,IAAI,kCAAe,CAAC,SAAS,EAAC;gBAC/C,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,EAAE,UAAU,CAAC,YAAY,EAAE,EAAE,CAAC,CAAC;aACvE;YACD,IAAG,IAAI,CAAC,aAAa,IAAI,kCAAe,CAAC,cAAc,IAAI,IAAI,CAAC,aAAa,IAAI,kCAAe,CAAC,UAAU,EAAC;gBACxG,0BAAgB,CAAC,QAAQ,CAAC,WAAW,CAAC,6BAAU,CAAC,YAAY,CAAC,CAAC;aAClE;iBAAI;gBACD,0BAAgB,CAAC,QAAQ,CAAC,WAAW,CAAC,6BAAU,CAAC,WAAW,CAAC,CAAC;aACjE;SACJ;IACL,CAAC;IACD,gCAAS,GAAT;QAEI,IAAG,IAAI,CAAC,KAAK;YACT,IAAI,CAAC,KAAK,GAAG,IAAI,CAAA;IACzB,CAAC;IACL,mBAAC;AAAD,CArGA,AAqGC,CArGyC,iBAAO,GAqGhD","file":"","sourceRoot":"/","sourcesContent":["import WndBase, { DestoryType } from \"../../../core/ui/WndBase\";\r\nimport HallPopMsgHelper, { PopWndName, BindAwardUIType } from \"../../tool/HallPopMsgHelper\";\r\nimport BindingGiftModel from \"../../../hallcommon/model/BindingGiftModel\";\r\n\r\nexport default class WndRebateGet extends WndBase{\r\n    private rabateLbl: cc.Label;\r\n    private timeOut:  NodeJS.Timeout;\r\n    private effectSk: sp.Skeleton;\r\n    private sureBtn: cc.Node;\r\n\r\n    private sound:cc.AudioSource;\r\n\r\n    private bindAwardType:number = -1; //默认方式\r\n    private closeCallback: Function;\r\n    protected onInit() {\r\n        this.name = \"WndRebateGet\";\r\n        this.layer = Global.UI.PopLayer;\r\n        this.resPath = \"hall/prefabs/ui/Rebate/RebateGetUI\";\r\n        this.destoryType = DestoryType.None\r\n    }\r\n\r\n    protected initView(){\r\n        this.bindAwardType = -1;\r\n\r\n        this.sureBtn = this.getChild(\"sureBtn\");\r\n        this.addCommonClick(\"sureBtn\", this.onSureBtnClick, this);\r\n        this.sureBtn.active = false;\r\n\r\n        this.sound = <cc.AudioSource>this.getComponent(\"sound\",cc.AudioSource);\r\n\r\n        this.rabateLbl = <cc.Label>this.getComponent(\"labelBg/rebateLbl\", cc.Label);\r\n        this.effectSk = <sp.Skeleton>this.getComponent(\"effect\", sp.Skeleton);\r\n        this.effectSk && this.effectSk.setCompleteListener(()=>{\r\n            this.effectSk.setAnimation(0, \"idle2\", true);\r\n        })\r\n    }\r\n\r\n    private onSureBtnClick(){\r\n        // Global.Audio.stopAllEffect();\r\n        if(this.sound && this.sound.isPlaying)\r\n            this.sound.stop();\r\n        this.closeWnd();\r\n    }\r\n\r\n    protected onOpen(arr){\r\n        let point = arr[0];\r\n        this.bindAwardType = -1;\r\n        if(arr[1])\r\n        {\r\n            this.bindAwardType = arr[1];\r\n        }\r\n        var model = <BindingGiftModel>Global.ModelManager.getModel(\"BindingGiftModel\");\r\n        this.rabateLbl.string = Global.Toolkit.formatPointStr(point, true) || model.BindAwardNum.toString();\r\n        this.rabateLbl.node.active = false;\r\n        this.effectSk && this.effectSk.setAnimation(0, \"idle\", false);\r\n        let soundEnable = Global.Setting.settingData.soundEnable;\r\n        if(this.sound && !this.sound.isPlaying && soundEnable)\r\n            this.sound.play();\r\n        this.sureBtn.scale = 1;\r\n        this.timeOut = setTimeout(() => {\r\n            this.rabateLbl.node.active = true;\r\n            this.sureBtn.active = true;\r\n            this.sureBtn.runAction(cc.sequence(cc.scaleTo(0.1, 1.2), cc.scaleTo(0.1, 1)));\r\n            this.addCommonClick(\"Mask\",this.onSureBtnClick,this)\r\n        }, 1000);\r\n        if(arr[2]){\r\n            this.closeCallback = arr[2];\r\n        }\r\n    }\r\n\r\n    private closeWnd(){\r\n        if(this.closeCallback){\r\n            this.closeCallback();\r\n        }\r\n        this.close();\r\n    }\r\n\r\n    protected onClose(){\r\n        this.closeCallback = null\r\n        clearTimeout(this.timeOut);\r\n        if(this.bindAwardType > 0){\r\n            if(this.bindAwardType == BindAwardUIType.MegePoint )\r\n            {\r\n                HallPopMsgHelper.Instance.releaseLock(PopWndName.MegePoint);\r\n                Global.HallServer.send(NetAppface.mod, NetAppface.GetUserPoint, {});\r\n                return\r\n            }\r\n            if(this.bindAwardType != BindAwardUIType.share && this.bindAwardType != BindAwardUIType.bindPoint){\r\n                Global.UI.fastTip(\"绑定手机成功\");\r\n            }   \r\n            if(this.bindAwardType != BindAwardUIType.bindPoint){\r\n                Global.HallServer.send(NetAppface.mod, NetAppface.GetUserPoint, {});\r\n            }\r\n            if(this.bindAwardType == BindAwardUIType.onlyPhonePoint || this.bindAwardType == BindAwardUIType.phonePoint){\r\n                HallPopMsgHelper.Instance.releaseLock(PopWndName.PhoneGiftGet);\r\n            }else{\r\n                HallPopMsgHelper.Instance.releaseLock(PopWndName.BindGiftGet);\r\n            }\r\n        }\r\n    }\r\n    onDispose()\r\n    {\r\n        if(this.sound)\r\n            this.sound = null\r\n    }\r\n}"]}