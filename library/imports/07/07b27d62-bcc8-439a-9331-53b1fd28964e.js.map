{"version":3,"sources":["assets\\hall\\scripts\\logic\\core\\game\\serverHelper\\GameErrorHelper.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import BaseServerHelper from \"./BaseServerHelper\";\r\n\r\n//游戏逻辑通用错误处理\r\nexport default class GameErrorHelper extends BaseServerHelper\r\n{\r\n    public errorHandlerMap:{[key:number]:Function} = {}\r\n\r\n    //余额不足\r\n    private ERROR_NOT_ENOUGH = 301;\r\n\r\n    private ERROR_NO_SERVICE = 404;\r\n    //不在桌上\r\n    private ERROR_NOT_IN_TABLE = 1001;\r\n    //网络变化 需要回到大厅\r\n    private ERROR_NET_CHANGE = 902;\r\n\r\n    //不在桌子上\r\n    private ERROR_NOT_ONTABLE = 905;\r\n    //货币不足\r\n    private ERROR_LOW_LIMIT = 906;\r\n    //货币超出限制\r\n    private ERROR_UPPER_LIMIT = 907;\r\n\r\n    private ERROR_SYS_BUSY = 204;\r\n\r\n    protected onInit()\r\n    {\r\n    }\r\n\r\n    //注册子游戏定制错误处理  参数为errnoid, netData   返回true表示继续入队列 false丢弃协议\r\n    public registErrorHandler(key:number, callback:Function)\r\n    {\r\n        this.errorHandlerMap[key] = callback;\r\n    }\r\n\r\n    public clear()\r\n    {\r\n        this.errorHandlerMap = {}\r\n    }\r\n\r\n    public handleSysError(netData)\r\n    {\r\n        if(netData._errno == null)\r\n            return true;\r\n        //上报enter异常\r\n        if(netData._param && netData._param._cmd == Game.Command.Enter && Game.Control.enterData != null  && netData._errno == this.ERROR_SYS_BUSY)\r\n        {\r\n            let content:any = {}\r\n            content.enter = Game.Control.enterData;\r\n            content.error = netData;\r\n            Global.ReportTool.ReportClientError(\"EnterError\", content);\r\n        }\r\n\r\n        let handler = this.getErrorHandler(netData._errno);\r\n        if(handler)\r\n            return handler(netData._errno, netData);\r\n        \r\n        this.defultErrorHandler(netData._errno, netData._errstr);\r\n    }\r\n\r\n\r\n    public handleCmdError(netData)\r\n    {\r\n        if(netData._param._errno == null)\r\n            return true;\r\n\r\n        //上报enter异常\r\n        if(netData._param && netData._param._cmd == Game.Command.Enter && Game.Control.enterData != null && netData._param._errno == this.ERROR_SYS_BUSY)\r\n        {\r\n            let content:any = {}\r\n            content.enter = Game.Control.enterData;\r\n            content.error = netData;\r\n            Global.ReportTool.ReportClientError(\"EnterError\", content);\r\n        }\r\n        \r\n        let handler = this.getErrorHandler(netData._param._errno);\r\n        if(handler)\r\n            return handler(netData._param._errno, netData);\r\n        \r\n        this.defultErrorHandler(netData._param._errno, netData._param._errstr);\r\n    }\r\n\r\n\r\n    public handleLogicError(netData)\r\n    {\r\n        if(netData._param._para == null || netData._param._para._errno == null)\r\n            return true;\r\n        \r\n        //上报enter异常\r\n        if(netData._param&& netData._param._cmd == Game.Command.Enter && Game.Control.enterData != null && netData._param._para._errno == this.ERROR_SYS_BUSY)\r\n        {\r\n            let content:any = {}\r\n            content.enter = Game.Control.enterData;\r\n            content.error = netData;\r\n            Global.ReportTool.ReportClientError(\"EnterError\", content);\r\n        }\r\n\r\n        let handler = this.getErrorHandler(netData._param._para._errno);\r\n        if(handler)\r\n            return handler(netData._param._para._errno, netData);\r\n        \r\n        this.defultErrorHandler(netData._param._para._errno, netData._param._para._errstr);\r\n    }\r\n\r\n\r\n    private getErrorHandler(key)\r\n    {\r\n        return this.errorHandlerMap[key];\r\n    }\r\n\r\n    //服务器errno是唯一的\r\n    private defultErrorHandler(errno, errorStr)\r\n    {\r\n        Global.Event.event(GlobalEvent.FORCE_HIDE_WAITING);\r\n        Game.Control.stopCheckMsgTimer();\r\n        //pvp直接回选场  pve重新进游戏\r\n        if(errno == this.ERROR_NOT_IN_TABLE)\r\n        {\r\n            // this.server.stopGame();\r\n            this.server.clearData();\r\n            Game.Event.event(Game.EVENT_NOT_IN_TABLE);\r\n            return;\r\n        }\r\n        if(errno == this.ERROR_LOW_LIMIT)\r\n        {\r\n            this.server.stopGame();\r\n            Game.Event.event(Game.EVENT_FORCE_LEAVE_GAME);\r\n            \r\n            Global.Toolkit.showMoneyNotEnough();\r\n            return\r\n        }\r\n\r\n        //1000以下error默认退出\r\n        if(errno < 1000)\r\n        {\r\n            this.server.stopGame();\r\n            let errFunc = ()=>{Game.Event.event(Game.EVENT_FORCE_LEAVE_GAME);}\r\n            let err = cc.js.formatStr(\"%s[%s]\",errorStr,errno)\r\n            Global.UI.showSingleBox(err, errFunc, errFunc);\r\n            return;\r\n        }\r\n\r\n        if(errorStr && errorStr != \"\")\r\n        {\r\n            \r\n           // Global.UI.fastTip(errorStr+\"[\"+errno+\"]\");\r\n            Global.UI.fastTip(errorStr+\"\");\r\n            return;\r\n        }\r\n    }\r\n\r\n}"]}