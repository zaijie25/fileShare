{"version":3,"sources":["assets\\hall\\scripts\\logic\\hall\\ui\\playerInfo\\HeadLayerView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import ViewBase from \"../../../core/ui/ViewBase\";\r\nimport PlayerInfoModel from \"../../../hallcommon/model/PlayerInfoModel\";\r\n\r\n/**\r\n * 选择头像界面\r\n */\r\nexport default class HeadLayerView extends ViewBase {\r\n\r\n    model: PlayerInfoModel\r\n    /**\r\n     * 头像范围\r\n     */\r\n    private headCount: number = 81;\r\n    /**\r\n     * 当前选中的头像索引\r\n     */\r\n    private chooseHeadIndex: number = 0;\r\n    /**\r\n     * 滚动容器\r\n     */\r\n    scrollView: cc.ScrollView = null;\r\n    /**\r\n     * 预设节点\r\n     */\r\n    itemNode: cc.Node = null;\r\n    /**\r\n     * 选中节点\r\n     */\r\n    //chooseNode:cc.Node = null;\r\n    /**\r\n     * 当前生效的头像标识（勾）\r\n     */\r\n    chooseBg: cc.Node = null;\r\n    chooseGou: cc.Node = null;\r\n    chooseCheck: cc.Node = null;\r\n    /**\r\n     * 初始坐标和间隔\r\n     */\r\n    xyGapArr = [0, 0, 138, 141];\r\n\r\n    protected initView() {\r\n        this.model = Global.ModelManager.getModel(\"PlayerInfoModel\")\r\n        this.headCount = Global.Setting.headNameRange;\r\n\r\n        this.scrollView = this.getComponent(\"scrollview\", cc.ScrollView)\r\n        this.itemNode = this.getChild(\"scrollview/view/content/itemlayer/item\");\r\n        this.itemNode.active = false;\r\n        let startX = this.itemNode.x;\r\n        let startY = this.itemNode.y;\r\n        this.xyGapArr[0] = startX;\r\n        this.xyGapArr[1] = startY;\r\n\r\n        this.xyGapArr[2] = Global.Setting.SkinConfig.zhuangbanHeadWH[0]\r\n        this.xyGapArr[3] = Global.Setting.SkinConfig.zhuangbanHeadWH[1]\r\n\r\n        let h = 0;\r\n        let index = 0;\r\n\r\n        Global.Component.schedule(() => {\r\n            if (index >= this.headCount) {\r\n                h = -h + (this.itemNode.height / 2)\r\n                var size = this.scrollView.node.getContentSize();\r\n                if (h < size.height) {\r\n                    h = size.height;\r\n                }\r\n                this.scrollView.content.setContentSize(0, h);\r\n                return\r\n            }\r\n            let end = index + 2;\r\n            let begin = index;\r\n            for (let i = begin; i < end; i++) {\r\n                if (i >= this.headCount) {\r\n                    index++;\r\n                    return;\r\n                }\r\n                let item: cc.Node = cc.instantiate(this.itemNode);\r\n                item.active = true\r\n                item.setParent(this.itemNode.parent);\r\n\r\n                item.name = \"head_\" + i;\r\n                item.x = startX + this.xyGapArr[2] * (i % 5); \r\n\r\n                h = startY - this.xyGapArr[3] * Math.floor(i / 5);\r\n                item.y = h;\r\n                Global.UIHelper.addCommonClick(item, \"\", this.HeadBtnFunc, this, cc.Button.Transition.NONE);\r\n\r\n                this.UpdateHead(item, i);\r\n                index++;\r\n            }\r\n        }, 0, this.headCount / 2)\r\n\r\n\r\n        // this.chooseBg = cc.find(\"chooselayer/chooseBG\", this.scrollView.content);\r\n        this.chooseGou = cc.find(\"chooselayer/chooseGou\", this.scrollView.content);\r\n        // this.chooseCheck = cc.find(\"chooselayer/chooseCheck\", this.scrollView.content)\r\n    }\r\n\r\n\r\n    /**\r\n    * 更新界面\r\n    */\r\n    UpdateUI() {\r\n        var i = this.chooseHeadIndex;\r\n        var x = this.xyGapArr[0] + this.xyGapArr[2] * (i % 5);\r\n        var y = this.xyGapArr[1] - this.xyGapArr[3] * Math.floor(i / 5);\r\n\r\n        i = parseInt(Global.PlayerData.headimg) - 1;\r\n        var x = this.xyGapArr[0] + this.xyGapArr[2] * (i % 5);\r\n        var y = this.xyGapArr[1] - this.xyGapArr[3] * Math.floor(i / 5);\r\n        this.chooseGou.x = x + 48;\r\n        this.chooseGou.y = y - 48;\r\n        // this.chooseBg.x = x;\r\n        // this.chooseBg.y = y -30;\r\n        // this.chooseCheck.x = x + 4;\r\n        // this.chooseCheck.y = y - 5;\r\n    }\r\n\r\n    /**\r\n     * 更新头像\r\n     * @param itemNode 头像节点\r\n     * @param index 索引\r\n     */\r\n    UpdateHead(itemNode: cc.Node, index: number) {\r\n        var headImg = \"\" + (index + 1);\r\n        var sprite: cc.Sprite = cc.find(\"mask/headFrame\", itemNode).getComponent(cc.Sprite)\r\n        sprite.spriteFrame = Global.Toolkit.getLocalHeadSf(headImg);\r\n    }\r\n\r\n    /**\r\n     * 头像点击\r\n     * @param target \r\n     */\r\n    HeadBtnFunc(target){\r\n        var arr = target.name.split(\"_\");\r\n        var index = parseInt(arr[arr.length - 1]);\r\n        this.chooseHeadIndex = index;\r\n        this.UpdateUI();\r\n        \r\n        var chooseHead = \"\" + (this.chooseHeadIndex + 1);\r\n        if(chooseHead != Global.PlayerData.headimg){\r\n            //请求修改头像\r\n            let param:any = {}\r\n            param.headimg = chooseHead;\r\n            this.model.reqEditUserInfo(param, ()=>{\r\n                Global.PlayerData.headimg = chooseHead; //更新玩家数据！\r\n                this.UpdateUI();\r\n                \r\n            });\r\n        }\r\n    }\r\n\r\n    protected onSubViewShow() {\r\n        this.chooseHeadIndex = parseInt(Global.PlayerData.headimg) - 1;\r\n        this.UpdateUI();\r\n    }\r\n\r\n    protected onSubViewHide() {\r\n\r\n    }\r\n\r\n}"]}