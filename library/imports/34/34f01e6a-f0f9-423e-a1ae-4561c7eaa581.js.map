{"version":3,"sources":["assets\\hall\\scripts\\logic\\core\\component\\ScrollViewCarmack.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { any } from \"../../../framework/libs/underscore\";\r\n\r\n// Learn TypeScript:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/typescript.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n//此组件使用：Global.UIHelper.addScrollViewCarmackComp\r\n@ccclass\r\nexport default class ScrollViewCarmack extends cc.Component {\r\n\r\n    //子节点预设\r\n    @property(cc.Node)\r\n    itemPrefab : cc.Node = null;\r\n\r\n    //子节点父对象\r\n    @property(cc.Node)\r\n    content : cc.Node = null;\r\n\r\n    //子节点间隔\r\n    @property\r\n    itemNodePadding = 3;\r\n\r\n    //子节点偏移坐标：由于子节点的锚点导致的坐标计算偏移问题(子节点锚点在中心就偏移 1/2 子节点高)\r\n    @property\r\n    itemOffset = 64;\r\n\r\n    /**\r\n     * 显示容器额外尺寸\r\n     */\r\n    contentExtraSize = 0;\r\n\r\n    //滚动组件\r\n    scrollView : cc.ScrollView = null;\r\n    \r\n    //子节点的高\r\n    itemNodeSize:number = 127;\r\n    //子节点总数量\r\n    itemAllCount : number = 5;\r\n\r\n    //当前显示的第一个节点的索引\r\n    currStartIndex : number = -1;\r\n\r\n    //所有子节点集合\r\n    itemNodeArr : cc.Node[] = [];\r\n\r\n    //总数据集合\r\n    allDatas : any[] = [];\r\n\r\n    //子节点更新函数\r\n    item_setter:(itemNode:cc.Node, index:number, data: any)=>void;\r\n    //子节点更新函数的this对象\r\n    item_setter_caller:any = null;\r\n\r\n    /**\r\n     * 是否垂直滚动\r\n     */\r\n    bVertical = true;\r\n\r\n    init() {\r\n        this.scrollView = this.node.getComponent(cc.ScrollView);\r\n        if(this.scrollView.horizontal){\r\n            //水平滚动\r\n            this.bVertical = false;\r\n        }else if(this.scrollView.vertical){\r\n            //垂直滚动\r\n            this.bVertical = true;\r\n        }\r\n        this.content = this.scrollView.content;\r\n\r\n        this.itemNodeSize = this.bVertical ? this.itemPrefab.height : this.itemPrefab.width;\r\n        var showSize = this.bVertical ? this.node.height : this.node.width;\r\n        this.itemAllCount = Math.ceil(showSize / (this.itemNodeSize + this.itemNodePadding)) + 2;\r\n\r\n        this.itemNodeArr = [];\r\n        for(let index = 0; index < this.itemAllCount; index++){\r\n            let itemNode = cc.instantiate(this.itemPrefab);\r\n            itemNode.setParent(this.content);\r\n            this.itemNodeArr.push(itemNode);\r\n        }\r\n        this.node.on(\"scrolling\", this.on_scrolling, this);\r\n        this.node.on(cc.Node.EventType.SIZE_CHANGED, this.onSizeChange, this);\r\n    }\r\n\r\n    //更新显示\r\n    public updateView(bToBottom:boolean = false) {\r\n        let contentSize = this.allDatas.length * (this.itemNodeSize + this.itemNodePadding) + this.contentExtraSize;\r\n        let size = this.content.getContentSize();\r\n        \r\n        if(this.bVertical){\r\n            size.height = contentSize;\r\n            this.content.setContentSize(size);\r\n\r\n            if(bToBottom) {\r\n                this.scrollView.scrollToBottom();\r\n                this.currStartIndex = this.allDatas.length - this.itemAllCount;\r\n            }\r\n            else {\r\n                if(this.allDatas.length < (this.itemAllCount-2)) {\r\n                    this.scrollView.scrollToTop();\r\n                    this.currStartIndex = 0;\r\n                }\r\n                else {\r\n                    let maxOffsetY = this.content.height - this.node.height;\r\n                    let scrollOffset = this.scrollView.getScrollOffset();\r\n                    let offset = scrollOffset.y >= maxOffsetY ? cc.v2(scrollOffset.x, maxOffsetY) : scrollOffset;\r\n                    this.scrollView.scrollToOffset(offset);\r\n                    this.currStartIndex = this.offsetToIndex(offset);\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            size.width = contentSize;\r\n            this.content.setContentSize(size);\r\n            \r\n            if(bToBottom) {\r\n                this.scrollView.scrollToRight();\r\n                this.currStartIndex = this.allDatas.length - this.itemAllCount;\r\n            }\r\n            else {\r\n                if(this.allDatas.length < (this.itemAllCount-2)) {\r\n                    this.scrollView.scrollToLeft();\r\n                    this.currStartIndex = 0;\r\n                }\r\n                else {\r\n                    let scrollOffset = this.scrollView.getScrollOffset();\r\n                    let offset = scrollOffset.x <= this.scrollView.getMaxScrollOffset().x ? this.scrollView.getMaxScrollOffset() : scrollOffset;\r\n                    this.scrollView.scrollToOffset(offset);\r\n                    this.currStartIndex = this.offsetToIndex(offset);\r\n                }\r\n            }\r\n        }\r\n        this.render_items();\r\n    }\r\n\r\n    /** 根据偏移计算显示的Index */\r\n    protected offsetToIndex(offset:cc.Vec2):number {\r\n        let pos:number = 0;\r\n        var scrollSize = 0;\r\n        if(this.bVertical){\r\n            pos = offset.y;\r\n            scrollSize = this.content.height - this.node.height;\r\n        }\r\n        else{\r\n            pos = - offset.x;\r\n            scrollSize = this.content.width - this.node.width;\r\n        }\r\n        if(pos < 0)\r\n        {\r\n            pos = 0;\r\n        }\r\n        if(pos > scrollSize)\r\n        {\r\n            pos = scrollSize;\r\n        }\r\n\r\n        let index:number = Math.floor(pos / (this.itemNodeSize + this.itemNodePadding)) - 2;\r\n        if(index < 0){\r\n            index = 0;\r\n        }\r\n        return index;\r\n    }\r\n\r\n    //重置content大小\r\n    public UpDateScrollData() {\r\n        let contentSize = this.allDatas.length * (this.itemNodeSize + this.itemNodePadding) + this.contentExtraSize;\r\n        let size = this.content.getContentSize();\r\n        \r\n        if(this.bVertical){\r\n            size.height = contentSize;\r\n        }else{\r\n            size.width = contentSize;\r\n        }\r\n        this.content.setContentSize(size);\r\n    }\r\n\r\n    //隐藏所有子节点\r\n    public clearView(){\r\n        this.currStartIndex = 0;\r\n        this.scrollView.scrollToLeft();\r\n        this.scrollView.scrollToTop();\r\n        this.content.children.forEach(element=>{\r\n            element.active = false;\r\n        });\r\n    }\r\n\r\n    //滚动事件\r\n    private on_scrolling(){\r\n        let pos:number = 0;\r\n        var scrollSize = 0;\r\n        if(this.bVertical){\r\n            pos = this.content.y;\r\n            scrollSize = this.content.height - this.node.height;\r\n        }else{\r\n            pos = -this.content.x;\r\n            scrollSize = this.content.width - this.node.width;\r\n        }\r\n        if(pos < 0)\r\n        {\r\n            pos = 0;\r\n        }\r\n        if(pos > scrollSize)\r\n        {\r\n            pos = scrollSize;\r\n        }\r\n        let start:number = Math.ceil(pos / (this.itemNodeSize + this.itemNodePadding)) - 1;\r\n        if(start < 0){\r\n            start = 0;\r\n        }\r\n        if(start < this.currStartIndex)\r\n        {\r\n            //往上 往左\r\n            this.bottomNodeToUp();\r\n        }else if(start > this.currStartIndex){\r\n            //往下 往右\r\n            this.UpNodeToBottom();\r\n        }\r\n    }\r\n\r\n    /** 当scrollView尺寸改变时要修改item的数量,防止出现数据显示不完整等问题出现 */\r\n    private onSizeChange() {\r\n        this.itemNodeSize = this.bVertical ? this.itemPrefab.height : this.itemPrefab.width;\r\n        let showSize = this.bVertical ? this.node.height : this.node.width;\r\n        let itemAllCount = Math.ceil(showSize / (this.itemNodeSize + this.itemNodePadding)) + 2;\r\n\r\n        let addCount = itemAllCount - this.itemNodeArr.length;\r\n        for(let index = 0; index < addCount; index++) {\r\n            let itemNode = cc.instantiate(this.itemPrefab);\r\n            itemNode.setParent(this.content);\r\n            this.itemNodeArr.push(itemNode);\r\n        }\r\n        if(addCount > 0) {\r\n            this.itemAllCount = itemAllCount;\r\n            this.updateView();\r\n        }\r\n    }\r\n\r\n    //底部子节点放置到顶部\r\n    private bottomNodeToUp(){\r\n        let dataIndex = this.currStartIndex - 1;\r\n        if(dataIndex < 0){\r\n            return;\r\n        }\r\n        this.currStartIndex--;\r\n        let bottomNode = this.itemNodeArr.pop();\r\n        this.itemNodeArr.unshift(bottomNode);\r\n        \r\n        let pos = dataIndex * (this.itemNodeSize + this.itemNodePadding);\r\n        if(this.bVertical){\r\n            bottomNode.y = -(pos + this.itemOffset);\r\n        }else{\r\n            bottomNode.x = pos + this.itemOffset;\r\n        }\r\n\r\n        this.item_setter.call(this.item_setter_caller, bottomNode, dataIndex, this.allDatas[dataIndex]);\r\n    }\r\n\r\n    //顶部子节点放置到底部\r\n    private UpNodeToBottom(){\r\n        let dataIndex = this.currStartIndex + this.itemNodeArr.length;\r\n        if(dataIndex >= this.allDatas.length){\r\n            return;\r\n        }\r\n        this.currStartIndex++;\r\n        let upNode = this.itemNodeArr.shift();\r\n        this.itemNodeArr.push(upNode);\r\n\r\n        let pos = dataIndex * (this.itemNodeSize + this.itemNodePadding);\r\n        if(this.bVertical){\r\n            upNode.y = -(pos + this.itemOffset);\r\n        }else{\r\n            upNode.x = pos + this.itemOffset;\r\n        }\r\n\r\n        this.item_setter.call(this.item_setter_caller, upNode, dataIndex, this.allDatas[dataIndex]);\r\n    }\r\n    \r\n    //渲染子节点\r\n    private render_items(){\r\n        for(let index = 0; index < this.itemAllCount; index++){\r\n            let itemNode = this.itemNodeArr[index];\r\n            let dataIndex = this.currStartIndex + index;\r\n            if(dataIndex < 0){\r\n                itemNode.active = false;\r\n                itemNode.setParent(this.node);\r\n                continue;\r\n            }\r\n            let pos = dataIndex * (this.itemNodeSize + this.itemNodePadding);\r\n            if(this.bVertical){\r\n                itemNode.y = -(pos + this.itemOffset);\r\n            }\r\n            else{\r\n                itemNode.x = pos + this.itemOffset;\r\n            }\r\n\r\n            if(this.allDatas.length > dataIndex){\r\n                itemNode.active = true;\r\n                itemNode.setParent(this.content);\r\n                this.item_setter.call(this.item_setter_caller, itemNode, dataIndex, this.allDatas[dataIndex]);\r\n            }else{\r\n                itemNode.active = false;\r\n                itemNode.setParent(this.node);\r\n            }\r\n        }\r\n    }\r\n\r\n    \r\n}\r\n"]}