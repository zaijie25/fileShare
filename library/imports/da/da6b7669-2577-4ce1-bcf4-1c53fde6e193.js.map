{"version":3,"sources":["assets\\hall\\scripts\\logic\\hallcommon\\model\\BankModel.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import ModelBase from \"../../../framework/model/ModelBase\";\r\nimport { NetAppface } from \"../../core/net/hall/NetEvent\";\r\nimport GlobalEvent from \"../../core/GlobalEvent\";\r\n\r\nexport default class BankModel extends ModelBase\r\n{\r\n\r\n    private _defaultPassword : string = \"888888\";\r\n    private _bankPassword : string = null;\r\n\r\n    public get Name()\r\n    {\r\n        return \"BankModel\";\r\n    }\r\n\r\n    protected onInit()\r\n    {\r\n    }\r\n\r\n    /**\r\n     * 数据清理时的回调\r\n    */\r\n    protected onClear() {\r\n        this._bankPassword = null;\r\n    }\r\n\r\n    public getDefaultPassword(){\r\n        return this._defaultPassword;\r\n    }\r\n\r\n    public IntoWnd(){\r\n        if(this._bankPassword){\r\n            \r\n            this.reqLoginBank(this._bankPassword);\r\n        }else{\r\n            Global.UI.show(\"WndBankLogin\");\r\n        }\r\n    }\r\n\r\n    private bankErronFunc( data : any ){\r\n        if(data._errstr != null){\r\n            this.showBankTips(data._errstr);\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /** 显示银行Tip */\r\n    public showBankTips( msg : string){\r\n        Global.UI.fastTip(msg);\r\n    }\r\n\r\n    /**\r\n     * 登录银行\r\n     * @param pwd 银行密码\r\n     */\r\n    public reqLoginBank( pwd : string ){\r\n        var pwdMD5 = Global.Toolkit.md5(pwd);\r\n        let _param = {\r\n            \"pwd\": pwdMD5,\r\n        }\r\n        Global.HallServer.send(NetAppface.mod, NetAppface.LoginBank, _param,\r\n            function (data : any){\r\n                this._bankPassword = pwd;\r\n                this.onResLoginBank( data );\r\n            }.bind(this),\r\n\r\n            function (data : any) {\r\n                this._bankPassword = null;\r\n                return this.bankErronFunc(data);\r\n            }.bind(this)\r\n        );\r\n    }\r\n\r\n    /**\r\n     * \"_param\": {\r\n\t\t    \"bank_point\": 银行金额\r\n        }\r\n     */\r\n    private onResLoginBank( data : any ){\r\n        Global.Event.event(GlobalEvent.SHOW_NET_WAITING, \"WndBankUI\")\r\n        Global.PlayerData.bank_point = data.bank_point;\r\n        Global.UI.close(\"WndBankLogin\");\r\n        Global.UI.show(\"WndBankUI\");\r\n    }\r\n\r\n    /**\r\n     * 修改密码\r\n     * @param oldpwd 旧银行密码\r\n     * @param newpwd 新银行密码\r\n     */\r\n    public reqSetBankPwd( oldpwd : string , newpwd : string ){\r\n        var oldpwdMD5 = Global.Toolkit.md5(oldpwd);\r\n        var newpwdMD5 = Global.Toolkit.md5(newpwd);\r\n        let _param = {\r\n            \"old_pwd\":oldpwdMD5,//MD5\r\n            \"new_pwd\":newpwdMD5,//MD5\r\n        }\r\n        Global.HallServer.send(NetAppface.mod, NetAppface.SetBankPwd, _param,\r\n            function (data : any) {\r\n                this._bankPassword = newpwd;\r\n                this.onResSetBankPwd( data );\r\n            }.bind(this),\r\n\r\n            this.bankErronFunc.bind(this)\r\n        );\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    private onResSetBankPwd( data : any ){\r\n        this.showBankTips(\"修改密码成功\");\r\n        Global.UI.close(\"WndBankChangePW\");\r\n        this.IntoWnd();\r\n        // Global.Event.event(GlobalEvent.BANK_CHANGE_PWD_SUCCEED);\r\n    }\r\n\r\n     /**\r\n      * 忘记密码\r\n      * @param phone 手机号\r\n      * @param code 验证码\r\n      * @param pwd 新密码\r\n      * @param acode 区号\r\n      */\r\n    public reqForgetBankPwd( phone : string , code : string , pwd : string , acode : string ){\r\n        var pwdMD5 = Global.Toolkit.md5(pwd);\r\n        let _param = {\r\n            \"phone\":Global.AESUtil.aesEncrypt(Global.Toolkit.cryptoKey,Global.Toolkit.cryptoIv,phone),\r\n            \"code\":code,\r\n            \"pwd\":pwdMD5,\r\n            \"acode\":acode,\r\n        }\r\n        Global.HallServer.send(NetAppface.mod, NetAppface.ForgetBankPwd, _param,this.onResForgetBankPwd.bind(this),this.bankErronFunc.bind(this));\r\n    }\r\n\r\n    /**\r\n     * \r\n     */\r\n    private onResForgetBankPwd( data : any ){\r\n        this.showBankTips(\"修改密码成功\");\r\n        Global.UI.close(\"WndBankForgetPW\");\r\n    }\r\n\r\n    /**\r\n      * 存钱\r\n      * @param point 存钱金额\r\n      */\r\n    public reqSaveBankPoint( point : Number ){\r\n        let fixPoint = point.toFixed(0);//2019-5-25 xiaoC number类型可能出现.99999999\r\n        let intPoint = parseInt(fixPoint, 10);\r\n        let _param = {\r\n            \"type\" : 1, //1存 2取\r\n\t\t    \"point\" : intPoint,\r\n        }\r\n        Global.HallServer.send(NetAppface.mod, NetAppface.DealBankPoint, _param,this.onResSaveDealBankPoint.bind(this),this.bankErronFunc.bind(this));\r\n    }\r\n\r\n    /**\r\n      * 取钱\r\n      * @param point 取钱金额\r\n      */\r\n    public reqDrawBankPoint( point : Number ){\r\n        let fixPoint = point.toFixed(0);//2019-5-25 xiaoC number类型可能出现.99999999\r\n        let intPoint = parseInt(fixPoint, 10);\r\n        let _param = {\r\n            \"type\" : 2, //1存 2取\r\n\t\t    \"point\" : intPoint,\r\n        }\r\n        Global.HallServer.send(NetAppface.mod, NetAppface.DealBankPoint, _param,this.onResDarwDealBankPoint.bind(this),this.bankErronFunc.bind(this));\r\n    }\r\n\r\n    /**\r\n     \"_param\": {\r\n\t\t\"bank_point\":操作之后银行卡金额\r\n\t\t\"point\":自身金额\r\n    } \r\n     */\r\n    private onResSaveDealBankPoint( data : any ){\r\n        this.showBankTips(\"存款成功\")\r\n        Global.PlayerData.point = data.point;\r\n        Global.PlayerData.bank_point = data.bank_point;\r\n    }\r\n\r\n    /**\r\n     \"_param\": {\r\n\t\t\"bank_point\":操作之后银行卡金额\r\n\t\t\"point\":自身金额\r\n    } \r\n     */\r\n    private onResDarwDealBankPoint( data : any ){\r\n        this.showBankTips(\"取款成功\")\r\n        Global.PlayerData.point = data.point;\r\n        Global.PlayerData.bank_point = data.bank_point;\r\n    }\r\n\r\n\r\n   \r\n}\r\n"]}