{"version":3,"sources":["assets\\hall\\scripts\\logic\\core\\component\\PrivateMarqueeComp.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import HallModel from \"../../hallcommon/model/HallModel\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class PrivateMarqueeComp extends cc.Component {\r\n    private textNode: cc.RichText;\r\n    private gameid = 0;\r\n    gameData: any;\r\n    onLoad() {\r\n        this.textNode = cc.find(\"text\", this.node).getComponent(cc.RichText)\r\n        let addNode = cc.find(\"tuwan_03\", this.node);\r\n        addNode.on(cc.Node.EventType.TOUCH_END, this.onOpenGame, this);\r\n        this.updateUseInfo(null)\r\n    }\r\n\r\n    updateUseInfo(data) {\r\n        if(data && data.gid != 0){\r\n\r\n            let gameInfo = Global.GameData.getGameInfo(data.gid);\r\n            if (!gameInfo || gameInfo.name == null) {\r\n                Logger.error(\"找不到gameid\", data.gid);\r\n                return;\r\n            }\r\n            this.gameid = data.gid;\r\n            let text = \"<outline color=#791e02 width=1>哇！玩家<color=#70f0f6>%s</color>太棒了，在<color=#ed0353>%s</color>游戏中一把赢得了<color=#fbed7b>%s</color>元！</outline>\";\r\n            let point = Global.Toolkit.formatPoint(data.point);//佣金或者返利数\r\n            var msgStr = cc.js.formatStr(text,data.nickname,data.gname,point);\r\n            this.textNode.string = msgStr;\r\n        }\r\n    }\r\n\r\n    //界面销毁\r\n    protected onDestroy() {\r\n    }\r\n\r\n    onOpenGame() {\r\n        let gid = this.gameid;\r\n        this.gameData = Global.GameData.getGameInfo(gid);\r\n        Global.HotUpdateManager.CurrentGame = this.gameData.game_id;\r\n        if(Game.Control.GAME_DDZ_HJ_ARR.indexOf(gid) >= 0){\r\n            //斗地主合集\r\n            Global.HotUpdateManager.CurrentGame = \"\" + Game.Control.GAME_DDZ_HJ_ARR[0];\r\n            Game.Control.curGid = gid;\r\n        }\r\n        if (Global.SceneManager.inGame())\r\n            return;\r\n        //百盛游戏\r\n        if (this.gameData.gtype === 8){\r\n            if (this.checkVersion())\r\n            {\r\n                let hallModel:HallModel = Global.ModelManager.getModel(\"HallModel\")\r\n                hallModel.requestApplyEnterGame(this.gameData.game_id)\r\n            }\r\n            return;\r\n        }\r\n        //外接web游戏\r\n        if (this.gameData.gameType === 9){\r\n            let hallModel:HallModel = Global.ModelManager.getModel(\"HallModel\")\r\n            hallModel.requestApplyEnterGame(this.gameData.game_id)\r\n        }\r\n        if(!Global.HotUpdateManager.checkIsGameDownload(gid) && cc.sys.isNative){\r\n            Global.UI.fastTip(\"未下载游戏\");\r\n            return;\r\n        }\r\n        //没有更新游戏\r\n        if(!Global.HotUpdateManager.checkIsGameNewest(gid) && cc.sys.isNative){\r\n            return;\r\n        }\r\n        let self = this;\r\n        let enterFunc = async () => {\r\n            if (Global.Setting.needHallChooseRoom && self.gameData.levels.length == 1 && self.gameData.gameType != 1) //除了PVP只有一个选场直接进游戏\r\n            {\r\n                let level = self.gameData.levels[0].level || \"l0\"\r\n                if(!Global.Toolkit.checkMoney(level,self.gameData))\r\n                {\r\n                    return\r\n                }\r\n                Global.Event.event(GlobalEvent.RecordGameListOffsetX);\r\n                Game.Control.curLv = level\r\n                if (self.gameData.levelType == 1) {\r\n                    Game.Control.connnectAndEnterGame(self.gameData.game_id, \"l0\");\r\n                }\r\n                else {\r\n                    Global.SceneManager.loadGameScene();\r\n                }\r\n                return\r\n            }\r\n\r\n            Game.GamePreloadTool.setup(gid);\r\n            if (Game.GamePreloadTool.checkPreloadBundleExist(gid)){        // 配置了走游戏选场\r\n                await Game.GamePreloadTool.preloadBundle();\r\n                await Game.GamePreloadTool.preloadPrefab(Game.GamePreloadTool.lobbyUIPath);\r\n                Global.UI.show(\"WndGameLobbyShell\", gid);\r\n                return;\r\n            }\r\n            Global.Event.event(GlobalEvent.RecordGameListOffsetX);\r\n            if (self.gameData.levelType == 1) {\r\n                Game.Control.connnectAndEnterGame(self.gameData.game_id, \"l0\");\r\n            }\r\n            else {\r\n                Global.SceneManager.loadGameScene();\r\n            }\r\n        }\r\n        //进游戏前判断是否拉到游戏配置\r\n        if (!this.checkGameCfg()) {\r\n            //弹框提示游戏没有配置\r\n            Global.UI.showSingleBox(\"游戏配置没有拉到，请稍等~\");\r\n            return;\r\n        }\r\n\r\n        if (!this.checkMoney())\r\n            return;\r\n\r\n        if (!this.checkVersion())\r\n            return;\r\n        //检查是否需要显示横竖屏切换提示\r\n        if (self.gameData.portraitModel) {\r\n            Global.UI.showPortraitScreenNotice(enterFunc);\r\n        }\r\n        else {\r\n            enterFunc();\r\n        }\r\n    }\r\n\r\n    onDisable() {\r\n        \r\n    }\r\n    hideNode() {\r\n        let hide = () => {\r\n            this.node.active = false;\r\n        }\r\n        if (this.node.active) {\r\n            this.node.stopAllActions();\r\n            this.node.opacity = 255;\r\n            var ac = cc.fadeOut(0.5);\r\n            var af = cc.callFunc(() => {\r\n                hide();\r\n                this.node.opacity = 255;\r\n            });\r\n            var seq = cc.sequence(ac, af);\r\n            this.node.runAction(seq);\r\n            return;\r\n        }\r\n    }\r\n    \r\n    showNode(data) {\r\n        this.updateUseInfo(data)\r\n        let show = () => {\r\n            this.node.active = true;\r\n        }\r\n        this.node.y = -500;\r\n        if (this.node) {\r\n            this.node.stopAllActions();\r\n            this.node.opacity = 255;\r\n            var mv = cc.moveTo(0.2, 0, -200);\r\n            var af = cc.callFunc(() => {\r\n                show();\r\n                this.node.opacity = 255;\r\n            });\r\n            var seq = cc.sequence(mv, af);\r\n            this.node.runAction(seq);\r\n            Global.Component.scheduleOnce(() => {\r\n                this.hideNode()\r\n            }, 10);\r\n            return;\r\n        }\r\n    }\r\n\r\n    private checkMoney() {\r\n        if (this.gameData.checkMoney) {\r\n            if (this.gameData.levels && this.gameData.levels.length == 1) {\r\n                let pointLow = this.gameData.levels[0].PointLow;\r\n                if (Global.PlayerData.point < pointLow) {\r\n                    let limit = Global.Toolkit.formatPointStr(pointLow);\r\n                    let str = \"游戏准入\" + limit + \"金币，请您充值哦！\"\r\n                    //Global.UI.fastTip();\r\n                    Global.Toolkit.showMoneyNotEnough(str)\r\n                    return false;\r\n                }\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    private checkVersion() {\r\n        if (this.gameData.supportVersion && this.gameData.supportVersion > 0) {\r\n            if (!Global.Toolkit.checkVersionSupport(this.gameData.supportVersion, this.gameData.supportIosVersion)) {\r\n                Global.UI.showYesNoBox(\"版本过旧，请下载新包使用该功能\", () => {\r\n                    cc.sys.openURL(Global.Setting.Urls.downLoadUrl);\r\n                })\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    private checkGameCfg() {\r\n        //进游戏前判断是否拉到游戏配置\r\n        if (this.gameData && this.gameData.levels && this.gameData.levels.length > 0) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n}"]}