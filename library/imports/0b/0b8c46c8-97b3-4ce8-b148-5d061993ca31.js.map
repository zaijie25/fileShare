{"version":3,"sources":["assets\\hall\\scripts\\logic\\hall\\ui\\common\\FastTip.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\r\nexport default class FastTip \r\n{\r\n    private tipList = [];\r\n    private msgList = [];\r\n\r\n    private CHECK_INTERVAL = 0.3;\r\n    private TIP_DISTANCE_H = 50;\r\n    private MAX_TIP_COUNT = 5;\r\n    //透明时间\r\n    private FADE_OUT_TIME = 0.1;\r\n    //移动时间\r\n    private MOVE_UP_TIME = 0.2;\r\n    //tip起始位置\r\n    private START_POS_Y = 20\r\n    //tip显示时间\r\n    private TIP_LIVE_TIME = 2;\r\n\r\n    private timeInterval = 0;\r\n\r\n\r\n    private curTipIndex = 0;\r\n\r\n    private hasInit = false;\r\n\r\n    public initTip(root:cc.Node)\r\n    {\r\n        this.timeInterval = 0;\r\n        if(this.hasInit)\r\n        {\r\n            Logger.error(\"重复初始化\");\r\n        }\r\n        Global.ResourceManager.loadRes(\"hall/prefabs/ui/FastTipItem\", (error, prefab)=>\r\n        {\r\n            if(!cc.isValid(root))\r\n            {\r\n                Logger.log(\"root已经销毁\");\r\n                return;\r\n            }\r\n            if(error != null)\r\n            {\r\n                Logger.error(error.message);\r\n            }\r\n            if(prefab)\r\n            {\r\n                for(let i = 0; i < this.MAX_TIP_COUNT; i++)\r\n                {\r\n                    let tip = new FastTipItem();\r\n                    tip.setNode(cc.instantiate(prefab));\r\n                    root.addChild(tip.node);\r\n                    tip.node.name = \"tip\" + i;\r\n                    tip.active = false;\r\n                    this.tipList.push(tip);\r\n                }\r\n                this.hasInit = true;\r\n            }\r\n        })\r\n    }\r\n\r\n\r\n    public show(content:string)\r\n    {\r\n        if(content == null || content == \"\") {\r\n            return;\r\n        }\r\n        \r\n        if(this.isFisrt())\r\n        {\r\n            let tip = this.getTip();\r\n            if(tip == null)\r\n                return;\r\n            tip.reset();\r\n            tip.show(content, this.START_POS_Y,0, this.FADE_OUT_TIME, this.TIP_LIVE_TIME);\r\n        }\r\n        else\r\n        {\r\n            if(!this.filter(content))\r\n                return;\r\n            this.msgList.push(content);\r\n        }\r\n    }\r\n\r\n    //过滤掉重复提示\r\n    private filter(content)\r\n    {\r\n        if(this.msgList.indexOf(content) > -1)\r\n            return false;\r\n        for(let i = 0; i < this.tipList.length; i++)\r\n        {\r\n            if(this.tipList[i].getContent() == content)\r\n                return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n\r\n    public clearAll()\r\n    {\r\n        for(let i = 0; i < this.tipList.length; i++)\r\n        {\r\n            this.tipList[i].dispose();\r\n        }\r\n        this.tipList = [];\r\n        this.hasInit = false;\r\n    }\r\n\r\n\r\n    public onUpdate(dt)\r\n    {\r\n        if(!this.hasInit)\r\n            return;\r\n        this.timeInterval += dt;\r\n        if(this.timeInterval > this.CHECK_INTERVAL)\r\n        {\r\n            this.timeInterval = 0;\r\n            if(this.msgList.length == 0)\r\n                return;\r\n            //播放\r\n            let msg = this.msgList.shift();\r\n            let tip = this.getTip();\r\n            tip.reset();\r\n            tip.show(msg, this.START_POS_Y, this.MOVE_UP_TIME, this.FADE_OUT_TIME, this.TIP_LIVE_TIME);\r\n            for(let i = 0; i < this.tipList.length; i++)\r\n            {\r\n                if(this.tipList[i] != tip && this.tipList[i].isRunning)\r\n                    this.tipList[i].moveUp(this.MOVE_UP_TIME, this.TIP_DISTANCE_H);\r\n            }\r\n        }\r\n    }\r\n\r\n    \r\n\r\n    private getTip()\r\n    {\r\n        let tip = this.tipList[this.curTipIndex];\r\n        this.curTipIndex = (this.curTipIndex + 1) % this.MAX_TIP_COUNT;\r\n        return tip;\r\n    }\r\n\r\n    private isFisrt()\r\n    {\r\n        for(let i = 0; i < this.tipList.length; i++)\r\n        {\r\n            if(this.tipList[i].isRunning)\r\n                return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n}\r\n\r\n\r\nimport ViewBase from \"../../../core/ui/ViewBase\"\r\nclass FastTipItem extends ViewBase\r\n{\r\n    private content:cc.Label;\r\n    private bgNode:cc.Node;\r\n    public isRunning;\r\n    private targetPosY = 0;\r\n    protected initView()\r\n    {\r\n        this.content = this.getComponent(\"content\", cc.Label);\r\n        this.bgNode = this.getChild(\"black_bg\");\r\n    }\r\n\r\n    public setContent(txt)\r\n    {\r\n        this.content.string = txt;\r\n        let txtWidth = this.content.node.width;\r\n        setTimeout(() => {\r\n            if (cc.isValid(this.content.node)) {\r\n                txtWidth = this.content.node.width;\r\n                if (txtWidth < 40)\r\n                    txtWidth = 40;\r\n                let width = txtWidth + 150;\r\n                if (width < 602)\r\n                    width = 602;\r\n                this.bgNode.width = width;\r\n            }\r\n        }, 20);\r\n       \r\n    }\r\n\r\n    public getContent()\r\n    {\r\n        if(this.node && this.node.isValid)\r\n        {\r\n            return this.content.string;\r\n        }\r\n    }\r\n\r\n    public reset()\r\n    {\r\n        this.targetPosY = 0;\r\n        this.node.active = false;\r\n        this.content.string = \"\";\r\n        this.content.unscheduleAllCallbacks();\r\n        this.node.stopAllActions();\r\n    }\r\n\r\n    public show(content, posY, delayTime, time, hideTime)\r\n    {\r\n        this.setContent(content)\r\n        this.targetPosY = posY;\r\n        this.isRunning = true;\r\n        this.node.active = true;\r\n        this.node.y = posY;\r\n        this.node.opacity = 0;\r\n        let sequence = cc.sequence(cc.delayTime(delayTime), cc.fadeIn(time));\r\n        this.node.runAction(sequence);\r\n\r\n        // this.content.scheduleOnce(()=>{\r\n        //     this.node.runAction(cc.fadeIn(time));\r\n        //     // this.isRunning = false;\r\n        // }, hideTime)\r\n        this.content.scheduleOnce(()=>{\r\n            this.node.runAction(cc.fadeOut(time));\r\n            this.isRunning = false;\r\n        }, hideTime)\r\n    }\r\n\r\n    public moveUp(time, distance)\r\n    {\r\n        this.targetPosY += distance;\r\n        this.node.runAction(cc.moveTo(time, this.node.x, this.targetPosY)\r\n            .easing(cc.easeIn(1)));\r\n    }\r\n\r\n    public dispose()\r\n    {\r\n        if(this.node && this.node.isValid)\r\n        {\r\n            this.node.removeFromParent();\r\n            this.node.destroy();\r\n        }\r\n    }\r\n}"]}