{"version":3,"sources":["assets\\hall\\scripts\\logic\\hall\\ui\\playerInfo\\DiantaiItem.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import PlayerInfoModel from \"../../../hallcommon/model/PlayerInfoModel\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n/**\r\n * 电台单个Item\r\n */\r\n@ccclass\r\nexport default class DiantaiItem extends cc.Component {\r\n    /**\r\n     * 歌曲数据对象\r\n     */\r\n    dataObj = null;\r\n    /**\r\n     * 歌曲名称\r\n     */\r\n    labelName:cc.Label = null;\r\n    /**\r\n     * 歌手\r\n     */\r\n    labelSinger:cc.Label = null;\r\n    /**\r\n     * 下载进度条\r\n     */\r\n    processBar:cc.ProgressBar = null;\r\n    /**\r\n     * 各个状态节点集合\r\n     */\r\n    stateNodeArr:cc.Node[] = [];\r\n    /**\r\n     * 当前显示进度\r\n     */\r\n    progressPercent = 0;\r\n\r\n    onLoad(){\r\n        this.labelName = cc.find(\"label_name\", this.node).getComponent(cc.Label);\r\n        this.labelSinger = cc.find(\"label_singer\", this.node).getComponent(cc.Label);\r\n\r\n        this.processBar = cc.find(\"xiazaizhong/progressBar\", this.node).getComponent(cc.ProgressBar);\r\n\r\n        this.stateNodeArr[0] = Global.UIHelper.addCommonClick(this.node, \"xiazaiBtn\", this.xiazaiBtnFunc, this);\r\n        this.stateNodeArr[1] = cc.find(\"xiazaizhong\", this.node);\r\n        this.stateNodeArr[2] = Global.UIHelper.addCommonClick(this.node, \"bofangBtn\", this.bofangBtnFunc, this);\r\n        this.stateNodeArr[3] = cc.find(\"bofangzhong\", this.node);\r\n        // this.stateNodeArr[4] = cc.find(\"btnLayout/img_play_icon\", this.node);\r\n        // this.stateNodeArr[5] = cc.find(\"img_bg_now\", this.node);\r\n       \r\n    }\r\n\r\n   \r\n\r\n    update(dt){\r\n        if(!this.dataObj || !this.dataObj.downloadpercent)\r\n        {\r\n            return\r\n        }\r\n        if(this.progressPercent < this.dataObj.downloadpercent){\r\n            this.progressPercent += dt * 0.1;\r\n        }\r\n        if(this.progressPercent > this.dataObj.downloadpercent){\r\n            this.progressPercent = this.dataObj.downloadpercent;\r\n            if(this.progressPercent >= 1){\r\n                this.dataObj.download = true;\r\n                this.UpdateUI();\r\n            }\r\n        }\r\n        this.processBar.progress = this.progressPercent;\r\n    }\r\n    /**\r\n     * 初始化\r\n     */\r\n    init(data) {\r\n        this.dataObj = data\r\n        if (CC_JSB) {\r\n            if (this.dataObj && !this.dataObj.download) {\r\n                let name = this.dataObj.file;\r\n                // let filePath = jsb.fileUtils.getWritablePath() + Global.Toolkit.md5(name)+\".mp3\";\r\n                const filePath = this.getLocalFileName(name);\r\n                if (jsb.fileUtils.isFileExist(filePath)) {\r\n                    this.dataObj.download = true;\r\n                    this.loadSoundRes();\r\n                }\r\n            }\r\n        }\r\n        this.UpdateUI();\r\n    }\r\n\r\n    /**\r\n     * 更新界面\r\n     */\r\n    UpdateUI() {\r\n        if (!this.labelName || !this.dataObj) {\r\n            return;\r\n        }\r\n        this.labelName.string = \"\" + this.dataObj.name;\r\n        this.labelSinger.string = \"\" + this.dataObj.singer;\r\n\r\n        for (var i = 0; i < this.stateNodeArr.length; i++) {\r\n            var node = this.stateNodeArr[i];\r\n            node.active = false;\r\n        }\r\n        let playingUrl = Global.Setting.storage.get(\"bgm\")\r\n        var bPlaying: boolean = (this.dataObj.surl == playingUrl);\r\n        let defautColor = Global.Setting.SkinConfig.infoSinerColors[0];\r\n        let selectColor = Global.Setting.SkinConfig.infoSinerColors[1];\r\n        if (bPlaying) {\r\n            this.stateNodeArr[3].active = true;\r\n            this.labelName.node.color = new cc.Color().fromHEX(selectColor);\r\n            this.labelSinger.node.color = new cc.Color().fromHEX(selectColor);\r\n            // this.stateNodeArr[4].active = true;\r\n            // this.stateNodeArr[5].active = true;\r\n        } else {\r\n            this.labelName.node.color = new cc.Color().fromHEX(defautColor);\r\n            this.labelSinger.node.color = new cc.Color().fromHEX(defautColor);\r\n            // this.stateNodeArr[4].active = false;\r\n            // this.stateNodeArr[5].active = false;\r\n            if(this.dataObj.download){\r\n                this.stateNodeArr[2].active = true;\r\n            }else if(this.dataObj.downloadpercent > 0){\r\n                this.stateNodeArr[1].active = true;\r\n            }else{\r\n                this.stateNodeArr[0].active = true;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 下载按钮点击\r\n     */\r\n    xiazaiBtnFunc(){\r\n        var self = this;\r\n        let name: string = this.dataObj.file;\r\n        let url = this.dataObj.url;\r\n        var bTest = false;\r\n        // var bTest = true;\r\n        if (bTest || CC_JSB) {\r\n            if(CC_JSB){\r\n                // var filePath = jsb.fileUtils.getWritablePath() + Global.Toolkit.md5(name)+\".mp3\";\r\n                var filePath = this.getLocalFileName(name);\r\n            }\r\n            if (bTest || !jsb.fileUtils.isFileExist(filePath)) {\r\n                let xhr = cc.loader.getXMLHttpRequest();\r\n                xhr.onreadystatechange = function () {\r\n                    if (xhr.readyState === 4) {\r\n                        if (xhr.status === 200) {\r\n                            if(filePath){\r\n                                self.saveFileToNative(filePath, xhr.response, ()=>{self.downloadSuccess()});\r\n                            }\r\n                            return;\r\n                        }else{\r\n                            self.downloadFaild();\r\n                        }\r\n                    }\r\n                }.bind(this);\r\n                //进度回调在C++层没有实现，所以原生环境下无效\r\n                xhr.onprogress = function(event:ProgressEvent){\r\n                    if(event.lengthComputable){\r\n                        var percent = event.loaded / event.total;\r\n                        // Global.UI.fastTip(\"下载进度：\" + percent);\r\n                        if(percent > 0.99){\r\n                            percent = 0.99;\r\n                        }\r\n                        self.dataObj.downloadpercent = percent;\r\n                    }else{\r\n                        self.dataObj.downloadpercent = 0.99;\r\n                    }\r\n                }.bind(this);\r\n                xhr.responseType = 'arraybuffer';\r\n                xhr.open(\"GET\", url, true);\r\n                xhr.send();\r\n            }else{\r\n                self.downloadSuccess();\r\n                return;\r\n            }\r\n        }else{\r\n            Global.UI.fastTip(\"web版不支持下载\");\r\n            return;\r\n        }\r\n\r\n        this.dataObj.downloadpercent = 0.99;\r\n        this.UpdateUI();\r\n    }\r\n\r\n    /**\r\n     * url转MD5，并拼接后缀\r\n     * @param url \r\n     */\r\n    getLocalFileName(url:string):string{\r\n        let name = url;\r\n        let end = name.lastIndexOf('.');\r\n        let namePre = name.slice(0,end);\r\n        let fileSuffix = name.substring(end);\r\n        return jsb.fileUtils.getWritablePath() + Global.Toolkit.md5(namePre)+fileSuffix;\r\n    }\r\n    \r\n    /**\r\n     * 保存文件到本地\r\n     * @param filepath \r\n     * @param data \r\n     * @param callback \r\n     */\r\n    saveFileToNative(filepath, data, callback?) {\r\n        if (typeof data !== 'undefined') {\r\n            if (jsb.fileUtils.writeDataToFile(new Uint8Array(data), filepath)) {\r\n                cc.log('DiantaiItem Remote write file succeed.');\r\n                if (callback) {\r\n                    callback();\r\n                }\r\n                return;\r\n            }\r\n        }\r\n        this.downloadFaild();\r\n    }\r\n\r\n    /**\r\n     * 下载完成\r\n     */\r\n    downloadSuccess(){\r\n        this.dataObj.downloadpercent = 1;\r\n        this.UpdateUI();\r\n        this.loadSoundRes();\r\n    }\r\n\r\n    /**\r\n     * 下载失败\r\n     */\r\n    downloadFaild(){\r\n        this.dataObj.downloadpercent = 0;\r\n        this.UpdateUI();\r\n        Global.UI.fastTip(\"下载失败，请重试\");\r\n    }\r\n\r\n    /**\r\n     * 加载本地音乐资源\r\n     */\r\n    loadSoundRes(){\r\n        Global.ResourceManager.load(this.dataObj.surl, \r\n            function( error : Error , res : any){\r\n                if (error) {\r\n                    Logger.error(error.message || error);\r\n                    return;\r\n                }\r\n                // Global.ResourceManager.setAutoReleaseRecursively(res, false);\r\n            });\r\n    }\r\n\r\n    /**\r\n     * 播放按钮点击\r\n     */\r\n    bofangBtnFunc(){\r\n        \r\n\r\n        if(this.dataObj.file == Global.Setting.hallBGM){\r\n            Global.Audio.playHallBGM();\r\n        }else{\r\n            Global.Audio.playMusic(this.dataObj.surl);\r\n        }\r\n\r\n        //PlayerInfoModel.playingObj = this.dataObj;\r\n        Global.Setting.storage.set(\"bgm\", this.dataObj.surl);\r\n        this.UpdateUI();\r\n        var model:PlayerInfoModel = Global.ModelManager.getModel(\"PlayerInfoModel\")\r\n        if(model)\r\n        {\r\n            model.event(PlayerInfoModel.UpdateScrollView)\r\n        }\r\n    }\r\n}\r\n"]}