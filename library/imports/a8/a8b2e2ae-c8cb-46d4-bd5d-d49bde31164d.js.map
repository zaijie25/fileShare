{"version":3,"sources":["assets\\hall_editor_cmp\\LoopPageView.js"],"names":["cc","Class","PageView","editor","CC_EDITOR","menu","help","inspector","executeInEditMode","ctor","_firstTempPage","_firstPage","_lastTempPage","_lastPage","_realPages","isTouched","isAutoScroll","autoScrollDelayTime","autoScrollTime","_curAutoScrollCountDown","onLoad","node","on","_checkLoop","_super","pageCount","_pages","length","_curPageIdx","_scrollToPage","idx","timeInSecond","onScrollViewScroll","undefined","scrollToOffset","_moveOffsetValue","indicator","_changedState","_delFirstTempPage","shift","active","setParent","destroy","_delLastTempPage","pop","_addFirstTempPage","instantiate","content","addChild","splice","_addLastTempPage","push","_updateFirstLastPage","_initPages","children","i","page","indexOf","_syncScrollDirection","_syncSizeMode","_updatePageView","getCurrentPageIndex","setCurrentPageIndex","index","Math","max","min","getPages","addPage","updatePage","insertPage","getPageIndex","preCurIndex","curIndex","nextCurIndex","removePage","warnID","name","removePageAtIndex","removeChild","removeAllPages","locPages","len","scrollToPage","_autoScrollToPage","bounceBackStarted","_startBounceBackIfNeeded","moveOffset","_touchBeganPosition","sub","_touchEndPosition","dragDirection","_getDragDirection","nextIndex","pageTurningSpeed","abs","_isScrollable","touchMoveVelocity","_calculateTouchMoveVelocity","_isQuicklyScrollable","_onTouchBegan","event","captureListeners","_onTouchMoved","_onTouchEnded","_onTouchCancelled","update","dt","_autoScrolling"],"mappings":"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","sourceRoot":"/","sourcesContent":["\r\n\r\ncc.Class({\r\n    extends: cc.PageView,\r\n\r\n    editor: CC_EDITOR && {\r\n        menu: 'i18n:MAIN_MENU.component.ui/LoopPageView',\r\n        help: 'i18n:COMPONENT.help_url.pageview',\r\n        inspector: 'packages://inspector/inspectors/comps/ccpageview.js',\r\n        executeInEditMode: false\r\n    },\r\n\r\n    ctor: function () {\r\n        //首页临时\r\n        this._firstTempPage = null;\r\n        //真实的第一页\r\n        this._firstPage = null;\r\n        //末页临时\r\n        this._lastTempPage = null;\r\n        //真实的末页\r\n        this._lastPage = null;\r\n        //真实页面列表\r\n        this._realPages = [];\r\n\r\n        //玩家是否操作中\r\n        this.isTouched = false;\r\n\r\n        //自动播放开关\r\n        this.isAutoScroll = false;\r\n        //自动切页滚动间隔\r\n        this.autoScrollDelayTime = 3;\r\n        //切页用时\r\n        this.autoScrollTime = 1;\r\n        this._curAutoScrollCountDown = this.autoScrollDelayTime;\r\n    },\r\n\r\n\r\n    onLoad () {\r\n        this.node.on('scroll-ended',this._checkLoop,this);\r\n        //this.node.on(\"scrolling\",this.onScrollViewScroll,this)\r\n        this._super();\r\n    },\r\n\r\n    _checkLoop(){\r\n        var pageCount = this._pages.length;\r\n        if(this._curPageIdx == (pageCount - 1)){\r\n            this._scrollToPage(1, false);\r\n        }else if(this._curPageIdx == 0){\r\n            this._scrollToPage(pageCount - 2,false);\r\n        }\r\n        //this._updateFirstTempPage()\r\n       // this._updateLastTempPage()\r\n    },\r\n\r\n    /**\r\n     * !#en Scroll PageView to index.\r\n     * !#zh 滚动到指定页面\r\n     * @method scrollToPage\r\n     * @param {Number} idx index of page.\r\n     * @param {Number} timeInSecond scrolling time\r\n     */\r\n    _scrollToPage: function (idx, timeInSecond) {\r\n        if (idx < 0 || idx >= this._pages.length)\r\n            return;\r\n        this.onScrollViewScroll()\r\n        \r\n        timeInSecond = timeInSecond !== undefined ? timeInSecond : 0.3;\r\n        this._curPageIdx = idx;\r\n        this.scrollToOffset(this._moveOffsetValue(idx), timeInSecond, true);\r\n        if (this.indicator) {\r\n            this.indicator._changedState();\r\n        }\r\n    },\r\n\r\n\r\n    _delFirstTempPage(){\r\n        if(this._pages.length == 0) return;\r\n        if(this._firstTempPage){\r\n            if(this._firstTempPage == this._pages[0]){\r\n                this._pages.shift();\r\n            }\r\n            this._firstTempPage.active = false;\r\n            this._firstTempPage.setParent(null);\r\n            this._firstTempPage.destroy();\r\n            this._firstTempPage = null;\r\n        }\r\n    },\r\n\r\n    _delLastTempPage(){\r\n        if(this._pages.length == 0) return;\r\n        if(this._lastTempPage){\r\n            if(this._lastTempPage == this._pages[this._pages.length - 1]){\r\n                this._pages.pop();\r\n            }\r\n            this._lastTempPage.active = false;\r\n            this._lastTempPage.setParent(null);\r\n            this._lastTempPage.destroy();\r\n            this._lastTempPage = null;\r\n        }\r\n    },\r\n\r\n    _addFirstTempPage(){\r\n        if(!this._lastPage) return;\r\n        this._firstTempPage = cc.instantiate(this._lastPage);\r\n        this.content.addChild(this._firstTempPage);\r\n        this._pages.splice(0, 0, this._firstTempPage);\r\n    },\r\n\r\n    _addLastTempPage(){\r\n        if(!this._firstPage) return;\r\n        this._lastTempPage = cc.instantiate(this._firstPage);\r\n        this.content.addChild(this._lastTempPage);\r\n        this._pages.push(this._lastTempPage);\r\n    },\r\n\r\n    _updateFirstLastPage(){\r\n        if(this._pages.length > 0){\r\n            this._firstPage = this._pages[0];\r\n            this._lastPage = this._pages[this._pages.length - 1];\r\n        }\r\n    },\r\n\r\n    // 初始化页面\r\n    _initPages: function () {\r\n        if (!this.content) { return; }\r\n\r\n        this._delFirstTempPage();\r\n        this._delLastTempPage();\r\n\r\n        var children = this.content.children;\r\n        for (var i = 0; i < children.length; ++i) {\r\n            var page = children[i];\r\n            if (this._pages.indexOf(page) >= 0) { continue; }\r\n            this._pages.push(page);\r\n            this._realPages.push(page);\r\n        }\r\n        \r\n        this._updateFirstLastPage();\r\n        \r\n        this._addFirstTempPage();\r\n        this._addLastTempPage();\r\n\r\n        this._syncScrollDirection();\r\n        this._syncSizeMode();\r\n        this._updatePageView();\r\n    },\r\n\r\n    /**\r\n     * !#en Returns current page index\r\n     * !#zh 返回当前页面索引\r\n     * @method getCurrentPageIndex\r\n     * @returns {Number}\r\n     */\r\n    getCurrentPageIndex: function () {\r\n        if(this._curPageIdx == 0){\r\n            return this._realPages.length - 1;\r\n        }else if(this._curPageIdx == (this._pages.length - 1)){\r\n            return 0;\r\n        }\r\n        return this._curPageIdx - 1;\r\n    },\r\n\r\n    /**\r\n     * !#en Set current page index\r\n     * !#zh 设置当前页面索引\r\n     * @method setCurrentPageIndex\r\n     * @param {Number} index\r\n     */\r\n    setCurrentPageIndex: function (index) {\r\n        index = Math.max(0,index);\r\n        index = Math.min(this._realPages.length - 1,index); \r\n        this._scrollToPage(index + 1, true); \r\n    },\r\n\r\n    /**\r\n     * !#en Returns all pages of pageview\r\n     * !#zh 返回视图中的所有页面\r\n     * @method getPages\r\n     * @returns {Node[]}\r\n     */\r\n    getPages: function () {\r\n        return this._realPages;\r\n    },\r\n\r\n    /**\r\n     * !#en At the end of the current page view to insert a new view\r\n     * !#zh 在当前页面视图的尾部插入一个新视图\r\n     * @method addPage\r\n     * @param {Node} page\r\n     */\r\n    addPage: function (page) {\r\n        if (!page || this._realPages.indexOf(page) !== -1 || !this.content)\r\n            return;\r\n\r\n        this._delFirstTempPage();\r\n        this._delLastTempPage();\r\n\r\n        this.content.addChild(page);\r\n        this._pages.push(page);\r\n        this._realPages.push(page);\r\n\r\n        this._updateFirstLastPage();\r\n\r\n        this._addFirstTempPage();\r\n        this._addLastTempPage();\r\n\r\n        this._updatePageView();\r\n    },\r\n\r\n    updatePage:function(page) \r\n    {\r\n        if(!page || !this._pages)       \r\n        {\r\n            return\r\n        }\r\n        // for (let index = 0; index < this._pages.length; index++) {  // debug 偶现进子游戏时this._pages报null 作容错过滤\r\n        //     let tmppage = this._pages[index];\r\n        //     if(tmppage)\r\n        //     {\r\n        //         if(tmppage.uuid === page.uuid)\r\n        //         {\r\n        //             this._pages[index] = page\r\n        //             break\r\n        //         }\r\n\r\n        //     }\r\n            \r\n        // }\r\n        // for (let index = 0; index < this._realPages.length; index++) {\r\n        //     let tmppage = this._realPages[index];\r\n        //     if(tmppage)\r\n        //     {\r\n        //         if(tmppage.uuid === page.uuid)\r\n        //         {\r\n        //             this._realPages[index] = page\r\n        //             break\r\n        //         }\r\n\r\n        //     }\r\n            \r\n        // }\r\n\r\n        // if (this._lastTempPage) {\r\n        //     if (this._lastTempPage.uuid === page.uuid) {\r\n        //         this._lastTempPage = page\r\n        //     }\r\n        // }\r\n        // if (this._firstTempPage) {\r\n        //     if (this._firstTempPage.uuid === page.uuid) {\r\n        //         this._firstTempPage = page\r\n        //     }\r\n        // }\r\n\r\n        // if (this._firstPage) {\r\n        //     if (this._firstPage.uuid === page.uuid) {\r\n        //         this._firstPage = page\r\n        //     }\r\n        // }\r\n\r\n        // if (this._lastPage) {\r\n        //     if (this._lastPage.uuid === page.uuid) {\r\n        //         this._lastPage = page\r\n        //     }\r\n        // }\r\n    },\r\n\r\n    /**\r\n     * !#en Inserts a page in the specified location\r\n     * !#zh 将页面插入指定位置中\r\n     * @method insertPage\r\n     * @param {Node} page\r\n     * @param {Number} index\r\n     */\r\n    insertPage: function (page, index) {\r\n        if (index < 0 || !page || this._realPages.indexOf(page) !== -1 || !this.content)\r\n            return;\r\n\r\n        var pageCount = this._realPages.length;\r\n        if (index >= pageCount)\r\n            this.addPage(page);\r\n        else {\r\n            this._delFirstTempPage();\r\n            this._delLastTempPage();\r\n\r\n            this._pages.splice(index, 0, page);\r\n            this._realPages.splice(index, 0, page);\r\n            this.content.addChild(page);\r\n\r\n            this._updateFirstLastPage();\r\n\r\n            this._addFirstTempPage();\r\n            this._addLastTempPage();\r\n\r\n            this._updatePageView();\r\n        }\r\n    },\r\n\r\n    onScrollViewScroll: function(){\r\n        let [preCurIndex, curIndex, nextCurIndex] = [this.getPageIndex(this._curPageIdx - 1), this.getPageIndex(this._curPageIdx), this.getPageIndex(this._curPageIdx + 1)];\r\n        \r\n        for(let i = 0; i< this._pages.length; i++){\r\n            if (i == preCurIndex || i == curIndex || i==nextCurIndex){\r\n                this._pages[i].children[0].active = true;\r\n            }\r\n            else{\r\n                this._pages[i].children[0].active = false;\r\n            }\r\n        }\r\n    },\r\n\r\n    getPageIndex: function (index) {\r\n        if (index > this._pages.length -1){\r\n            return 1;\r\n        }\r\n        if (index < 0){\r\n            return this._realPages.length;\r\n        }\r\n        return index;\r\n    },\r\n\r\n    /**\r\n     * !#en Removes a page from PageView.\r\n     * !#zh 移除指定页面\r\n     * @method removePage\r\n     * @param {Node} page\r\n     */\r\n    removePage: function (page) {\r\n        if (!page || !this.content) return;\r\n        var index = this._realPages.indexOf(page);\r\n        if (index === -1) {\r\n            cc.warnID(4300, page.name);\r\n            return;\r\n        }\r\n        this.removePageAtIndex(index);\r\n    },\r\n\r\n    /**\r\n     * !#en Removes a page at index of PageView.\r\n     * !#zh 移除指定下标的页面\r\n     * @method removePageAtIndex\r\n     * @param {Number} index\r\n     */\r\n    removePageAtIndex: function (index) {\r\n        if (index < 0 || index >= this._realPages.length) return;\r\n\r\n        this._delFirstTempPage();\r\n        this._delLastTempPage();\r\n\r\n        var page = this._realPages[index];\r\n        if (page) {\r\n            this.content.removeChild(page);\r\n            this._pages.splice(index, 1);\r\n            this._realPages.splice(index, 1);\r\n        }\r\n\r\n        this._updateFirstLastPage();\r\n        \r\n        this._addFirstTempPage();\r\n        this._addLastTempPage();\r\n\r\n        this._updatePageView();\r\n    },\r\n\r\n    /**\r\n     * !#en Removes all pages from PageView\r\n     * !#zh 移除所有页面\r\n     * @method removeAllPages\r\n     */\r\n    removeAllPages: function () {\r\n        if (!this.content) { return; }\r\n        this.isAutoScroll = false;\r\n\r\n        var locPages = this._pages;\r\n        for (var i = 0, len = locPages.length; i < len; i++)\r\n            this.content.removeChild(locPages[i]);\r\n        this._pages.length = 0;\r\n        this._realPages.length = 0;\r\n\r\n        this._delFirstTempPage();\r\n        this._delLastTempPage();\r\n        this._updatePageView();\r\n    },\r\n\r\n    /**\r\n     * !#en Scroll PageView to index.\r\n     * !#zh 滚动到指定页面\r\n     * @method scrollToPage\r\n     * @param {Number} idx index of page.\r\n     * @param {Number} timeInSecond scrolling time\r\n     */\r\n    scrollToPage: function (idx, timeInSecond) {\r\n        idx = Math.max(0,idx);\r\n        idx = Math.min(this._realPages.length - 1,idx); \r\n        idx = idx + 1;\r\n        timeInSecond = timeInSecond !== undefined ? timeInSecond : 0.3;\r\n        this._curPageIdx = idx;\r\n        this.scrollToOffset(this._moveOffsetValue(idx), timeInSecond, true);\r\n        if (this.indicator) {\r\n            this.indicator._changedState();\r\n        }\r\n    },\r\n\r\n    _updatePageView: function () {\r\n        this._super();\r\n        this._scrollToPage(1,false);\r\n    },\r\n\r\n    _autoScrollToPage: function () {\r\n        var bounceBackStarted = this._startBounceBackIfNeeded();\r\n        var moveOffset = this._touchBeganPosition.sub(this._touchEndPosition);\r\n        if (bounceBackStarted) {\r\n            var dragDirection = this._getDragDirection(moveOffset);\r\n            if (dragDirection === 0) {\r\n                return;\r\n            }\r\n            if (dragDirection > 0) {\r\n                this._curPageIdx = this._pages.length - 1;\r\n            }\r\n            else {\r\n                this._curPageIdx = 0;\r\n            }\r\n            if (this.indicator) {\r\n                this.indicator._changedState();\r\n            }\r\n        }\r\n        else {\r\n            var index = this._curPageIdx, nextIndex = index + this._getDragDirection(moveOffset);\r\n            var timeInSecond = this.pageTurningSpeed * Math.abs(index - nextIndex);\r\n            if (nextIndex < this._pages.length) {\r\n                if (this._isScrollable(moveOffset, index, nextIndex)) {\r\n                    this._scrollToPage(nextIndex, timeInSecond);\r\n                    return;\r\n                }\r\n                else {\r\n                    var touchMoveVelocity = this._calculateTouchMoveVelocity();\r\n                    if (this._isQuicklyScrollable(touchMoveVelocity)) {\r\n                        this._scrollToPage(nextIndex, timeInSecond);\r\n                        return;\r\n                    }\r\n                }\r\n            }\r\n            this._scrollToPage(index, timeInSecond);\r\n        }\r\n    },\r\n\r\n    _onTouchBegan: function (event, captureListeners) {\r\n        this._super(event, captureListeners);\r\n        this.isTouched = true;\r\n        this._curAutoScrollCountDown = this.autoScrollDelayTime;\r\n    },\r\n\r\n    _onTouchMoved: function (event, captureListeners) {\r\n        this._super(event, captureListeners);\r\n        this.isTouched = true;\r\n        this._curAutoScrollCountDown = this.autoScrollDelayTime;\r\n        this.onScrollViewScroll()\r\n    },\r\n\r\n    _onTouchEnded: function (event, captureListeners) {\r\n        this._super(event, captureListeners);\r\n        this.isTouched = false;\r\n        this._curAutoScrollCountDown = this.autoScrollDelayTime;\r\n        this.onScrollViewScroll()\r\n    },\r\n\r\n    _onTouchCancelled: function (event, captureListeners) {\r\n        this._super(event, captureListeners);\r\n        this.isTouched = false;\r\n        this._curAutoScrollCountDown = this.autoScrollDelayTime;\r\n        this.onScrollViewScroll()\r\n    },\r\n\r\n    update(dt){\r\n        this._super(dt);\r\n        if(this._pages.length < 3) return;\r\n\r\n        //循环逻辑\r\n        if(!this.isTouched && !this._autoScrolling){\r\n            this._checkLoop();\r\n        }\r\n    \r\n        //自动滚动\r\n        if(!this.isAutoScroll || this.isTouched) return;\r\n        this._curAutoScrollCountDown -= dt;\r\n        if(this._curAutoScrollCountDown <= 0){\r\n            this._curAutoScrollCountDown += this.autoScrollDelayTime;\r\n            var nextIndex = this._curPageIdx + 1;\r\n            this._scrollToPage(nextIndex,this.autoScrollTime);\r\n        }\r\n    }\r\n\r\n});\r\n"]}