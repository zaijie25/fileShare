{"version":3,"sources":["assets\\hall\\scripts\\logic\\hall\\ui\\hall\\views\\PlayerHeadView.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAAA,4DAAuD;AACvD,yDAAoD;AACpD,gFAA2E;AAG3E;IAA4C,kCAAQ;IAApD;QAAA,qEAgMC;QAvLG;;WAEG;QACH,eAAS,GAAc,IAAI,CAAC;QAC5B;;WAEG;QACH,eAAS,GAAc,IAAI,CAAC;;IAgLhC,CAAC;IA1Ka,iCAAQ,GAAlB;QACI,IAAI,CAAC,WAAW,GAAG,MAAM,CAAC,YAAY,CAAC,QAAQ,CAAC,iBAAiB,CAAC,CAAA;QAClE,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,YAAY,CAAC,WAAW,EAAE,EAAE,CAAC,KAAK,CAAC,CAAC;QAC1D,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,YAAY,CAAC,UAAU,EAAE,EAAE,CAAC,KAAK,CAAC,CAAC;QACvD,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,YAAY,CAAC,SAAS,EAAE,EAAE,CAAC,MAAM,CAAC,CAAC;QAC1D,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,YAAY,CAAC,WAAW,EAAE,EAAE,CAAC,MAAM,CAAC,CAAC;QAC3D,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,YAAY,CAAC,UAAU,EAAE,EAAE,CAAC,MAAM,CAAC,CAAC;QAC1D,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,UAAU,CAAC,CAAA;QACpD,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC,QAAQ,CAAC,mBAAmB,CAAC,CAAA;QAC3D,IAAI,CAAC,SAAS,GAAI,IAAI,CAAC,QAAQ,CAAC,oBAAoB,CAAC,CAAA;QACrD,IAAI,IAAI,CAAC,SAAS,EAClB;YACI,IAAI,CAAC,SAAS,CAAC,MAAM,GAAG,KAAK,CAAA;SAChC;QACD,IAAI,CAAC,cAAc,CAAC,UAAU,EAAE,IAAI,CAAC,YAAY,EAAE,IAAI,CAAC,CAAC;QACzD,IAAI,IAAI,CAAC,SAAS,EAAE;YAChB,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC;SAC3D;QAED,IAAI,CAAC,cAAc,CAAC,MAAM,EAAE,IAAI,CAAC,WAAW,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;IAG9D,CAAC;IAEO,oCAAW,GAAnB;QAEI,MAAM,CAAC,EAAE,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;IACpC,CAAC;IAGD,sCAAa,GAAb;QACI,IAAI,CAAC,cAAc,EAAE,CAAC;QACtB,IAAI,CAAC,eAAe,EAAE,CAAC;QACvB,MAAM,CAAC,KAAK,CAAC,EAAE,CAAC,qBAAW,CAAC,kBAAkB,EAAE,IAAI,EAAE,IAAI,CAAC,cAAc,CAAC,CAAC;QAC3E,MAAM,CAAC,KAAK,CAAC,EAAE,CAAC,qBAAW,CAAC,SAAS,EAAE,IAAI,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;IAEvE,CAAC;IACD,sCAAa,GAAb;QAEI,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,qBAAW,CAAC,kBAAkB,EAAE,IAAI,EAAE,IAAI,CAAC,cAAc,CAAC,CAAC;QAC5E,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,qBAAW,CAAC,SAAS,EAAE,IAAI,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;IACxE,CAAC;IAED,kCAAS,GAAT;QACI,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,qBAAW,CAAC,kBAAkB,EAAE,IAAI,EAAE,IAAI,CAAC,cAAc,CAAC,CAAC;QAC5E,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,qBAAW,CAAC,SAAS,EAAE,IAAI,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;IACxE,CAAC;IAEO,uCAAc,GAAtB;QACI,IAAI,UAAU,GAAG,MAAM,CAAC,UAAU,CAAC;QACnC,IAAI,OAAO,GAAG,IAAI,CAAC,UAAU,CAAC;QAC9B,IAAI,OAAO,CAAC,IAAI,EAAE;YACd,IAAI,CAAC,GAAG,OAAO,CAAC,IAAI,CAAC,KAAK,EACtB,CAAC,GAAG,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC;YAC5B,OAAO,CAAC,WAAW,GAAG,MAAM,CAAC,OAAO,CAAC,cAAc,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;YACxE,OAAO,CAAC,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;YACvB,OAAO,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC;SAC3B;QACD,IAAI,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,SAAS,CAAC,IAAI,IAAI,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,OAAO,EAAE;YACtE,MAAM,CAAC,OAAO,CAAC,uBAAuB,CAAC,IAAI,CAAC,SAAS,EAAE,UAAU,CAAC,SAAS,EAAC,KAAK,EAAC,IAAI,CAAC,CAAC;SAC3F;QAED,IAAI,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,SAAS,CAAC,IAAI,IAAI,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,OAAO,EAAE;YACvE,2DAA2D;YAC1D,MAAM,CAAC,OAAO,CAAC,WAAW,CAAC,IAAI,CAAC,SAAS,EAAE,UAAU,CAAC,GAAG,CAAC,CAAC;SAC9D;QACD,IAAI,IAAI,CAAC,QAAQ,EAAE;YACf,IAAI,UAAU,CAAC,KAAK,IAAI,EAAE,EAAE;gBACxB,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,KAAK,CAAC;aAChC;iBACI;gBACD,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,IAAI,CAAC;aAC/B;SACJ;IACL,CAAC;IAEO,uCAAc,GAAtB;QACI,IAAI,UAAU,GAAG,MAAM,CAAC,UAAU,CAAC;QACnC,IAAI,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE;YACrB,IAAI,CAAC,SAAS,CAAC,MAAM,GAAG,MAAM,CAAC,OAAO,CAAC,WAAW,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;SAC3E;IACL,CAAC;IAEM,uCAAc,GAArB;QACI,IAAI,UAAU,GAAG,MAAM,CAAC,UAAU,CAAC;QACnC,IAAI,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE;YACnB,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG,EAAE,GAAG,UAAU,CAAC,GAAG,CAAC,QAAQ,EAAE,CAAC;SACxD;QACD,IAAI,CAAC,cAAc,EAAE,CAAC;QACtB,IAAI,CAAC,cAAc,EAAE,CAAC;IAC1B,CAAC;IAED;;OAEG;IACH,qCAAY,GAAZ;QACI,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,qBAAW,CAAC,gBAAgB,EAAE,SAAS,CAAC,CAAA;QAC3D,MAAM,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;IAC9B,CAAC;IAED,qCAAY,GAAZ;QAEI,IAAG,IAAI,CAAC,KAAK,EACb;YACI,aAAa,CAAC,IAAI,CAAC,KAAK,CAAC,CAAA;SAC5B;QACD,IAAG,IAAI,CAAC,SAAS,IAAI,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,EAC/C;YACI,IAAI,CAAC,SAAS,CAAC,MAAM,GAAG,KAAK,CAAA;SAChC;QACD,IAAI,CAAC,KAAK,GAAG,IAAI,CAAA;IACrB,CAAC;IAGM,wCAAe,GAAtB;QACI,IAAG,CAAC,yBAAe,CAAC,QAAQ,CAAC,UAAU,EACvC;YACI,IAAG,IAAI,CAAC,iBAAiB,EACzB;gBACI,IAAI,CAAC,iBAAiB,CAAC,MAAM,GAAG,KAAK,CAAA;aACxC;YACD,IAAG,IAAI,CAAC,SAAS,EACjB;gBACI,IAAI,CAAC,SAAS,CAAC,MAAM,GAAG,KAAK,CAAA;aAChC;YACD,OAAM;SACT;QACD,IAAI,IAAI,CAAC,iBAAiB,EAAE;YACxB,IAAI,UAAU,GAAG,yBAAe,CAAC,QAAQ,CAAC,aAAa,GAAG,CAAC,CAAA;YAC3D,IAAI,QAAQ,GAAG,yBAAe,CAAC,QAAQ,CAAC,cAAc,GAAE,CAAC,CAAA;YACzD,IAAI,SAAS,GAAG,yBAAe,CAAC,QAAQ,CAAC,eAAe,GAAC,CAAC,CAAA;YAC1D,IAAG,IAAI,CAAC,SAAS,EACjB;gBACI,IAAI,CAAC,QAAQ,EAAE,CAAA;aAClB;YACD,IAAK,UAAU,IAAI,QAAQ,IAAI,SAAS,EAAE;gBACtC,IAAI,CAAC,iBAAiB,CAAC,MAAM,GAAG,IAAI,CAAC;aACxC;iBACI;gBACD,IAAI,CAAC,iBAAiB,CAAC,MAAM,GAAG,KAAK,CAAC;aACzC;SACJ;IAGL,CAAC;IAED,iCAAQ,GAAR;QAAA,iBAuBC;QAtBG,IAAI,CAAC,YAAY,EAAE,CAAA;QACnB,IAAI,CAAC,KAAK,GAAG,WAAW,CAAC;YACrB,IAAI,UAAU,GAAG,yBAAe,CAAC,QAAQ,CAAC,aAAa,GAAG,CAAC,CAAA;YAC3D,IAAI,QAAQ,GAAG,yBAAe,CAAC,QAAQ,CAAC,cAAc,GAAG,CAAC,CAAA;YAC1D,IAAI,SAAS,GAAG,yBAAe,CAAC,QAAQ,CAAC,eAAe,GAAG,CAAC,CAAA;YAC9D,uEAAuE;YACrE,IAAI,UAAU,IAAI,SAAS,IAAI,QAAQ,EAAC;gBACpC,IAAI,KAAI,CAAC,SAAS,IAAI,EAAE,CAAC,OAAO,CAAC,KAAI,CAAC,SAAS,CAAC,EAAE;oBAC9C,KAAI,CAAC,SAAS,CAAC,MAAM,GAAG,IAAI,CAAA;oBAC5B,UAAU,CAAC;wBACP,IAAI,KAAI,CAAC,SAAS,IAAI,EAAE,CAAC,OAAO,CAAC,KAAI,CAAC,SAAS,CAAC,EAAE;4BAAE,KAAI,CAAC,SAAS,CAAC,MAAM,GAAG,KAAK,CAAA;yBAAE;oBACvF,CAAC,EAAE,IAAI,CAAC,CAAC;iBACZ;aACJ;iBACI;gBACD,IAAI,KAAI,CAAC,SAAS,IAAI,EAAE,CAAC,OAAO,CAAC,KAAI,CAAC,SAAS,CAAC,EAAE;oBAC9C,KAAI,CAAC,SAAS,CAAC,MAAM,GAAG,KAAK,CAAA;oBAC7B,KAAI,CAAC,YAAY,EAAE,CAAA;iBACtB;aACJ;QAEL,CAAC,EAAE,KAAK,CAAC,CAAC;IACd,CAAC;IACL,qBAAC;AAAD,CAhMA,AAgMC,CAhM2C,kBAAQ,GAgMnD","file":"","sourceRoot":"/","sourcesContent":["import GlobalEvent from \"../../../../core/GlobalEvent\";\r\nimport ViewBase from \"../../../../core/ui/ViewBase\";\r\nimport PlayerInfoModel from \"../../../../hallcommon/model/PlayerInfoModel\";\r\nimport HallBtnHelper from \"./HallBtnHelper\";\r\n\r\nexport default class PlayerHeadView extends ViewBase {\r\n\r\n    private nameLabel: cc.Label;\r\n    private idLabel: cc.Label;\r\n    private headSprite: cc.Sprite;\r\n    private vipEffect:cc.Node\r\n    private playerModel\r\n\r\n    private timer:any\r\n    /**\r\n     * 头像框\r\n     */\r\n    headKuang: cc.Sprite = null;\r\n    /**\r\n     * vip标识\r\n     */\r\n    spriteVip: cc.Sprite = null;\r\n    /**\r\n     * vip红点\r\n     */\r\n    public spriteVipHongdian: cc.Node;\r\n    private hongdian: cc.Node;\r\n    protected initView() {\r\n        this.playerModel = Global.ModelManager.getModel(\"PlayerInfoModel\")\r\n        this.nameLabel = this.getComponent(\"nameLabel\", cc.Label);\r\n        this.idLabel = this.getComponent(\"playerID\", cc.Label);\r\n        this.headSprite = this.getComponent(\"headImg\", cc.Sprite);\r\n        this.headKuang = this.getComponent(\"headFrame\", cc.Sprite);\r\n        this.spriteVip = this.getComponent(\"vip_icon\", cc.Sprite);\r\n        this.hongdian = this.node.getChildByName(\"hongdian\")\r\n        this.spriteVipHongdian = this.getChild(\"vip_icon/hongdian\")\r\n        this.vipEffect =  this.getChild(\"vip_icon/vipEffect\")\r\n        if( this.vipEffect)\r\n        {\r\n            this.vipEffect.active = false\r\n        }\r\n        this.addCommonClick(\"vip_icon\", this.onVipBtnFunc, this);\r\n        if (this.spriteVip) {\r\n            this.spriteVip.node.active = !Global.Setting.vipDisable;\r\n        }\r\n        \r\n        this.addCommonClick(\"head\", this.onHeadClick, this, null);\r\n       \r\n\r\n    }\r\n    \r\n    private onHeadClick()\r\n    {\r\n        Global.UI.show(\"WndPlayerInfo\");\r\n    }\r\n\r\n\r\n    onSubViewShow() {\r\n        this.updateUserInfo();\r\n        this.onShowVipReward();\r\n        Global.Event.on(GlobalEvent.PERSONALINFOUPDATE, this, this.updateUserInfo);\r\n        Global.Event.on(GlobalEvent.VIPREWARD, this, this.onShowVipReward);\r\n       \r\n    }\r\n    onSubViewHide()\r\n    {\r\n        Global.Event.off(GlobalEvent.PERSONALINFOUPDATE, this, this.updateUserInfo);\r\n        Global.Event.off(GlobalEvent.VIPREWARD, this, this.onShowVipReward);\r\n    }\r\n\r\n    onDispose() {\r\n        Global.Event.off(GlobalEvent.PERSONALINFOUPDATE, this, this.updateUserInfo);\r\n        Global.Event.off(GlobalEvent.VIPREWARD, this, this.onShowVipReward);\r\n    }\r\n\r\n    private updateUserHead() {\r\n        let playerData = Global.PlayerData;\r\n        let headImg = this.headSprite;\r\n        if (headImg.node) {\r\n            let w = headImg.node.width,\r\n                h = headImg.node.height;\r\n            headImg.spriteFrame = Global.Toolkit.getLocalHeadSf(playerData.headimg);\r\n            headImg.node.width = w;\r\n            headImg.node.height = h;\r\n        }\r\n        if (this.headKuang && this.headKuang.node && this.headKuang.node.isValid) {\r\n            Global.Toolkit.loadLocalHeadFrameByVip(this.headKuang, playerData.headkuang,false,true);\r\n        }\r\n\r\n        if (this.spriteVip && this.spriteVip.node && this.spriteVip.node.isValid) {\r\n           // this.spriteVip.string = Global.PlayerData.vip.toString()\r\n            Global.Toolkit.loadVipIcon(this.spriteVip, playerData.vip);\r\n        }\r\n        if (this.hongdian) {\r\n            if (playerData.phone != \"\") {\r\n                this.hongdian.active = false;\r\n            }\r\n            else {\r\n                this.hongdian.active = true;\r\n            }\r\n        }\r\n    }\r\n\r\n    private updateUserName() {\r\n        let playerData = Global.PlayerData;\r\n        if (this.nameLabel.node) {\r\n            this.nameLabel.string = Global.Toolkit.removeEmoji(playerData.nickname);\r\n        }\r\n    }\r\n\r\n    public updateUserInfo() {\r\n        let playerData = Global.PlayerData;\r\n        if (this.idLabel.node) {\r\n            this.idLabel.string = \"\" + playerData.uid.toString();\r\n        }\r\n        this.updateUserHead();\r\n        this.updateUserName();\r\n    }\r\n\r\n    /**\r\n     * VIP图标点击\r\n     */\r\n    onVipBtnFunc() {\r\n        Global.Event.event(GlobalEvent.SHOW_NET_WAITING, \"WndVip3\")\r\n        Global.UI.show(\"WndVip3\");\r\n    }\r\n\r\n    clearTimeOut()\r\n    {\r\n        if(this.timer)\r\n        {\r\n            clearInterval(this.timer)\r\n        }\r\n        if(this.vipEffect && cc.isValid(this.vipEffect))\r\n        {\r\n            this.vipEffect.active = false\r\n        }\r\n        this.timer = null\r\n    }\r\n\r\n\r\n    public onShowVipReward() {\r\n        if(!PlayerInfoModel.instance.vip_reward)\r\n        {\r\n            if(this.spriteVipHongdian)\r\n            {\r\n                this.spriteVipHongdian.active = false\r\n            }\r\n            if(this.vipEffect)\r\n            {\r\n                this.vipEffect.active = false\r\n            }\r\n            return\r\n        }\r\n        if (this.spriteVipHongdian) {\r\n            let rewardFlag = PlayerInfoModel.instance.is_vip_reward > 0\r\n            let weekFlag = PlayerInfoModel.instance.is_week_reward >0\r\n            let monthFlag = PlayerInfoModel.instance.is_month_reward>0\r\n            if(this.vipEffect)\r\n            {\r\n                this.setTimer()\r\n            }\r\n            if ( rewardFlag || weekFlag || monthFlag) {\r\n                this.spriteVipHongdian.active = true;\r\n            }\r\n            else {\r\n                this.spriteVipHongdian.active = false;\r\n            }\r\n        }\r\n\r\n\r\n    }\r\n\r\n    setTimer() {\r\n        this.clearTimeOut()\r\n        this.timer = setInterval(() => {\r\n            let rewardFlag = PlayerInfoModel.instance.is_vip_reward > 0\r\n            let weekFlag = PlayerInfoModel.instance.is_week_reward > 0\r\n            let monthFlag = PlayerInfoModel.instance.is_month_reward > 0\r\n          //  if (rewardFlag || monthFlag || weekFlag || !Global.PlayerData.vip){\r\n            if (rewardFlag || monthFlag || weekFlag){\r\n                if (this.vipEffect && cc.isValid(this.vipEffect)) {\r\n                    this.vipEffect.active = true\r\n                    setTimeout(() => {\r\n                        if (this.vipEffect && cc.isValid(this.vipEffect)) { this.vipEffect.active = false }\r\n                    }, 5000);\r\n                }\r\n            }\r\n            else {\r\n                if (this.vipEffect && cc.isValid(this.vipEffect)) {\r\n                    this.vipEffect.active = false\r\n                    this.clearTimeOut()\r\n                }\r\n            }\r\n\r\n        }, 10000);\r\n    }\r\n}\r\n"]}