{"version":3,"sources":["assets\\hall\\scripts\\logic\\hall\\ui\\login\\view\\PhoneInputView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import ViewBase from \"../../../../core/ui/ViewBase\";\r\nimport { ListView } from \"../../../../../listview\";\r\nexport default class PhoneInputView extends ViewBase\r\n{\r\n\r\n    private areaInput:cc.EditBox;\r\n    private codeIcon:cc.Sprite;\r\n    private phoneInput:cc.EditBox;\r\n\r\n    private countryLabel:cc.Label;\r\n\r\n    private showAreaView = false;\r\n\r\n    private chooseCountryView:ChooseCountryView;\r\n\r\n\r\n    protected initView()\r\n    {\r\n        this.codeIcon = this.getComponent(\"codeIcon\", cc.Sprite);\r\n        this.phoneInput = this.getComponent(\"phone\", cc.EditBox);\r\n        this.areaInput = this.getComponent(\"area\", cc.EditBox);\r\n        this.countryLabel = this.getComponent(\"countryName\", cc.Label);\r\n        // this.addCommonClick(\"bg4\", this.onCodeIconClick, this, null);\r\n        // this.addCommonClick(\"codeIcon\", this.onCodeIconClick, this, null);\r\n        // this.addCommonClick(\"chooseAreaView/mask\", this.onCodeIconClick, this, null);\r\n        this.chooseCountryView = new ChooseCountryView();\r\n        this.chooseCountryView.onSelect = this.selectCountry.bind(this);\r\n        this.chooseCountryView.setNode(this.getChild(\"chooseAreaView\"));\r\n        this.chooseCountryView.subViewState = false;\r\n\r\n        this.areaInput.node.on(\"editing-did-ended\", this.onAreaEditEnd, this);\r\n\r\n\r\n    }\r\n\r\n\r\n    private onAreaEditEnd()\r\n    {\r\n        this.countryLabel.string = this.chooseCountryView.searchArea(this.areaInput.string);\r\n    }\r\n\r\n    private onCodeIconClick()\r\n    {\r\n        this.showAreaView = !this.showAreaView;\r\n        this.updateCodeState();\r\n    }\r\n\r\n    private updateCodeState()\r\n    {\r\n        this.chooseCountryView.active = this.showAreaView;\r\n        this.codeIcon.node.angle = this.showAreaView ? -180 : 0\r\n    }\r\n\r\n    private selectCountry(code, name)\r\n    {\r\n        this.areaInput.string = code;\r\n        this.countryLabel.string = name;\r\n        this.onCodeIconClick();\r\n    }\r\n\r\n    public set phone(value)\r\n    {\r\n        this.phoneInput.string = value;\r\n    }\r\n\r\n    public get phone()\r\n    {\r\n        return this.phoneInput.string;\r\n    }\r\n    \r\n    public set area(value)\r\n    {\r\n        this.areaInput.string = value;\r\n        this.countryLabel.string = this.chooseCountryView.searchArea(value);\r\n    }\r\n    public get area()\r\n    {\r\n        return this.areaInput.string;\r\n    }\r\n\r\n    protected onSubViewShow()\r\n    {\r\n        this.chooseCountryView.onSubViewShow();\r\n        this.showAreaView = false;\r\n        this.updateCodeState();\r\n    }\r\n\r\n    public isAreaVaild()\r\n    {\r\n        return this.chooseCountryView.isAreaVaild(this.area);\r\n    }\r\n}\r\n\r\n\r\nclass ChooseCountryView extends ViewBase\r\n{\r\n    private item:cc.Node;\r\n    private contentRoot:cc.Node;\r\n    private scroll:cc.ScrollView;\r\n    private itemList = [];\r\n    private countryCfg:any\r\n    private listView:ListView;\r\n\r\n    public onSelect:Function\r\n\r\n    protected initView()\r\n    {\r\n        this.item = this.getChild(\"scroll/view/content/item\");\r\n        this.contentRoot = this.getChild(\"scroll/view/content\");\r\n        this.item.active = false;\r\n\r\n        this.scroll = this.getComponent(\"scroll\", cc.ScrollView);\r\n\r\n        this.countryCfg = Global.ResourceManager.getRes(\"hall/config/countrycode\", cc.JsonAsset).json;\r\n\r\n        let listParam:any = {}\r\n        listParam.scrollview = this.scroll;\r\n        listParam.mask  = this.getChild(\"scroll/view\");\r\n        listParam.content = this.getChild(\"scroll/view/content\");\r\n        listParam.item_tpl = this.getChild(\"scroll/view/content/item\");\r\n        listParam.direction = 1;\r\n        listParam.item_setter = (item, data, index) =>\r\n        {\r\n            let info = this.countryCfg[index];\r\n            let numLabel = item.getChildByName(\"code\").getComponent(cc.Label);\r\n            let countryLabel = item.getChildByName(\"country\").getComponent(cc.Label);\r\n            numLabel.string = info.phone_code; \r\n            countryLabel.string = info.cn;\r\n        };\r\n\r\n        listParam.select_cb = (data, index)=>\r\n        {\r\n            let info = this.countryCfg[index];\r\n            if(this.onSelect)\r\n                this.onSelect(info.phone_code.replace(\"+\", \"\"), info.cn);\r\n        }\r\n        this.listView = new ListView(listParam);\r\n        this.listView.set_data(this.countryCfg);\r\n\r\n\r\n        // this.contentRoot.height = this.item.height * this.countryCfg.length;\r\n        // this.initItems()\r\n\r\n    }\r\n\r\n    public onSubViewShow()\r\n    {\r\n        this.scroll.scrollToTop(0);\r\n        this.listView.set_data(this.countryCfg);\r\n    }\r\n\r\n    private initItems()\r\n    {\r\n        for(let i = 0; i < this.countryCfg.length; i++)\r\n        {\r\n            let info = this.countryCfg[i];\r\n            let item = cc.instantiate(this.item);\r\n            item.active = true;\r\n            let numLabel = item.getChildByName(\"code\").getComponent(cc.Label);\r\n            let countryLabel = item.getChildByName(\"country\").getComponent(cc.Label);\r\n            numLabel.string = info.phone_code; \r\n            countryLabel.string = info.cn;\r\n            this.contentRoot.addChild(item);\r\n            let tmpIndex = i\r\n            item.on(cc.Node.EventType.TOUCH_END,()=>\r\n            {\r\n                this.onItemClick(tmpIndex);\r\n            }, this)\r\n            this.itemList.push(item);\r\n        }\r\n    }\r\n\r\n    private onItemClick(index)\r\n    {\r\n        if(this.countryCfg[index])\r\n        {\r\n            let info = this.countryCfg[index];\r\n            if(this.onSelect)\r\n                this.onSelect(info.phone_code.replace(\"+\", \"\"), info.cn);\r\n        }\r\n    }\r\n\r\n    public searchArea(areacode)\r\n    {\r\n        if(areacode == \"\")\r\n            return \"请从列表中选择\";\r\n        let code = \"+\" + areacode;\r\n        for(let i = 0; i < this.countryCfg.length; i++)\r\n        {\r\n            if(this.countryCfg[i].phone_code == code)\r\n            {\r\n                return this.countryCfg[i].cn;\r\n            }\r\n        }\r\n        return \"国家/地区代码无效\"\r\n    }\r\n\r\n    public isAreaVaild(areacode)\r\n    {\r\n        if(areacode == \"\")\r\n            return false;\r\n        let code = \"+\" + areacode;\r\n        for(let i = 0; i < this.countryCfg.length; i++)\r\n        {\r\n            if(this.countryCfg[i].phone_code == code)\r\n            {\r\n                return true;\r\n            }\r\n        }\r\n        return false\r\n    }\r\n\r\n\r\n\r\n}"]}