{"version":3,"sources":["assets\\hall\\scripts\\logic\\core\\loadingMVC\\LoadingFacade.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA,+CAAkC;AAElC,oCAA+B;AAC/B,gCAA2B;AAC3B,2CAAsC;AACtC,0DAAyD;AACzD,qDAA6C;AAE7C,+CAA0C;AAC1C,yDAAoD;AACpD,2DAAsD;AACtD,4EAAuE;AACvE,iDAAkD;AAClD,8CAAyC;AACzC,+CAA0C;AAC1C,2DAAsD;AACtD,mDAA8C;AAC9C,yDAAoD;AAE9C,IAAA,KAAwB,EAAE,CAAC,UAAU,EAAnC,OAAO,aAAA,EAAE,QAAQ,cAAkB,CAAC;AAG5C;IAA2C,iCAAc;IAAzD;QAAA,qEAkGC;QAxFG,cAAQ,GAAG;YACP,eAAM,CAAC,GAAG,CAAC,mDAAmD,CAAC,CAAA;YAC/D,IAAI,CAAC,gBAAgB,CAAC,sBAAK,CAAC,wBAAwB,CAAC,CAAA;QACzD,CAAC,CAAA;;IAqFL,CAAC;sBAlGoB,aAAa;IAG9B,4CAAoB,GAApB;QACI,iBAAM,oBAAoB,WAAE,CAAC;QAC7B,IAAI,CAAC,WAAW,EAAE,CAAC;QACnB,gBAAM,CAAC,KAAK,CAAC,EAAE,CAAC,qBAAW,CAAC,aAAa,EAAE,IAAI,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;QACvE,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;IACxD,CAAC;IAOa,wBAAU,GAAxB;QAEU,MAAO,CAAC,MAAM,GAAG,gBAAM,CAAC;QACxB,MAAO,CAAC,IAAI,GAAG,cAAI,CAAC;QACpB,MAAO,CAAC,MAAM,GAAG,eAAM,CAAC;QACxB,MAAO,CAAC,OAAO,GAAG,iBAAO,CAAC;QAC1B,MAAO,CAAC,YAAY,GAAG,sBAAY,CAAC;QACpC,MAAO,CAAC,aAAa,GAAG,uBAAa,CAAC;QACtC,MAAO,CAAC,UAAU,GAAG,qBAAU,CAAC;QAChC,MAAO,CAAC,eAAe,GAAG,yBAAe,CAAC;QAC1C,MAAO,CAAC,WAAW,GAAG,qBAAW,CAAC;QAClC,MAAO,CAAC,eAAe,GAAG,yBAAe,CAAC;QAC1C,MAAO,CAAC,WAAW,GAAG,qBAAW,CAAC;QAExC,gBAAM,CAAC,KAAK,EAAE,CAAC;QACf,cAAI,CAAC,KAAK,EAAE,CAAC;QACb,mBAAS,CAAC,IAAI,EAAE,CAAC;IACrB,CAAC;IAED,YAAY;IACL,mCAAW,GAAlB;QACI,eAAM,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC;QAC5B,eAAa,CAAC,UAAU,EAAE,CAAA;QAC1B,yBAAyB;QACzB,gBAAM,CAAC,EAAE,CAAC,UAAU,EAAE,CAAC;QACvB,SAAS;QACT,gBAAM,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC;QACtB,uDAAuD;QACvD,IAAI;QACJ,2EAA2E;QAC3E,IAAI;QACJ,wDAAwD;QACxD,0BAA0B;QAC1B,gBAAM,CAAC,aAAa,CAAC,iBAAiB,CAAC,gBAAM,CAAC,OAAO,CAAC,UAAU,CAAC,SAAS,CAAC,CAAA;QAC3E,gBAAM,CAAC,QAAQ,CAAC,cAAc,CAAC,sBAAsB,CAAC,CAAC;QACvD,EAAE,CAAC,IAAI,CAAC,YAAY,CAAC,gBAAM,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;IACnD,CAAC;IAED,+BAAO,GAAP,UAAQ,QAAQ,EAAE,IAAI,EAAE,aAAa,EAAE,UAAU;QAC7C,gBAAM,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;QAC1B,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;QACzB,qEAAqE;QACrE,yBAAyB;QACzB,IAAG,CAAC,UAAU;YACV,aAAa,GAAG,IAAI,CAAC;QACzB,gBAAM,CAAC,OAAO,CAAC,gBAAgB,GAAG,aAAa,CAAC;QAChD,gBAAM,CAAC,OAAO,CAAC,UAAU,GAAG,UAAU,CAAC;QACvC,IAAI,CAAC,aAAa,CAAC,IAAI,sBAAY,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,CAAA;QAC7E,IAAI,CAAC,aAAa,CAAC,IAAI,2BAAiB,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAA;QACxD,uDAAuD;QACvD,IAAI,CAAC,gBAAgB,CAAC,IAAI,yBAAY,CAAC,IAAI,CAAC,CAAC,CAAA;QAC7C,IAAI,CAAC,gBAAgB,CAAC,sBAAK,CAAC,QAAQ,CAAC,CAAA;IAEzC,CAAC;IAED,uCAAe,GAAf;QACI,IAAI,CAAC,gBAAgB,CAAC,sBAAK,CAAC,eAAe,CAAC,CAAA;IAChD,CAAC;IAED,wCAAgB,GAAhB;QACI,IAAI,CAAC,aAAa,CAAC,sBAAK,CAAC,QAAQ,CAAC,CAAA;QAClC,IAAI,CAAC,cAAc,CAAC,yBAAY,CAAC,IAAI,CAAC,CAAA;QACtC,uCAAuC;QACvC,IAAI,CAAC,WAAW,CAAC,2BAAiB,CAAC,IAAI,CAAC,CAAA;QACxC,gBAAM,CAAC,KAAK,CAAC,GAAG,CAAC,qBAAW,CAAC,aAAa,EAAE,IAAI,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;QACxE,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;IACzD,CAAC;IACa,6BAAe,GAA7B;QACI,IAAI,QAAQ,GAAG,eAAa,CAAC,WAAW,CAAC,eAAa,CAAC,IAAI,CAAC,CAAA;QAC5D,IAAI,QAAQ,EAAE;YACV,QAAQ,CAAC,gBAAgB,EAAE,CAAC;YAC5B,eAAa,CAAC,UAAU,CAAC,eAAa,CAAC,IAAI,CAAC,CAAA;SAC/C;QACD,OAAO;IACX,CAAC;IAGD,sBAAkB,yBAAQ;aAA1B;YACI,IAAI,CAAC,eAAa,CAAC,WAAW,CAAC,eAAa,CAAC,IAAI,CAAC;gBAC9C,eAAa,CAAC,WAAW,CAAC,eAAa,CAAC,IAAI,CAAC,GAAG,IAAI,eAAa,CAAC,eAAa,CAAC,IAAI,CAAC,CAAC;YAE1F,OAA2B,CAAC,eAAa,CAAC,WAAW,CAAC,eAAa,CAAC,IAAI,CAAC,CAAC,CAAC;QAC/E,CAAC;;;OAAA;;IA/Fa,kBAAI,GAAG,eAAe,CAAC;IAFpB,aAAa;QADjC,OAAO;OACa,aAAa,CAkGjC;IAAD,oBAAC;CAlGD,AAkGC,CAlG0C,OAAO,CAAC,MAAM,GAkGxD;kBAlGoB,aAAa","file":"","sourceRoot":"/","sourcesContent":["import Const from './LoadingConst'\r\nimport StartUpCommand from './LoadingStartUpCmd'\r\nimport Global from \"../Global\";\r\nimport Game from \"../Game\";\r\nimport ViewSet from \"../game/ViewSet\";\r\nimport { Logger } from \"../../../framework/debug/Logger\";\r\nimport ViewMediator from './LoadingMediator';\r\nimport HotUpdateProxy from './HotUpdateProxy';\r\nimport PreLoadProxy from './PreLoadProxy';\r\nimport PVPSitHelper from \"../game/pvp/PvpSitHelper\";\r\nimport PVPPlayerData from \"../game/pvp/PVPPlayerData\";\r\nimport EventDispatcher from \"../../../framework/event/EventDispatcher\";\r\nimport { NetAppface } from '../net/hall/NetEvent';\r\nimport GlobalEvent from '../GlobalEvent';\r\nimport AppHelper from '../tool/AppHelper';\r\nimport HeadTipsManager from '../tool/HeadTipsManager';\r\nimport TaskManager from '../tool/TaskManager';\r\nimport AppHotUpdateProxy from './AppHotUpdateProxy';\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class LoadingFacade extends puremvc.Facade {\r\n    public manifest: cc.Asset[];\r\n    public static NAME = \"LoadingFacade\";\r\n    initializeController() {\r\n        super.initializeController();\r\n        this.gameStartUp();\r\n        Global.Event.on(GlobalEvent.DunInitFinish, this, this.onDunInitFinish);\r\n        cc.game.on(cc.game.EVENT_SHOW, this.onResume, this);\r\n    }\r\n\r\n    onResume = function () {\r\n        Logger.log(\"---------LoadingFacade----------onResume---------\")\r\n        this.sendNotification(Const.CHCEK_HOTUPDATE_PROGRESS)\r\n    }\r\n\r\n    public static initGlobal()\r\n    {\r\n        (<any>window).Global = Global;\r\n        (<any>window).Game = Game;\r\n        (<any>window).Logger = Logger;\r\n        (<any>window).ViewSet = ViewSet;\r\n        (<any>window).PVPSitHelper = PVPSitHelper;\r\n        (<any>window).PVPPlayerData = PVPPlayerData;\r\n        (<any>window).NetAppface = NetAppface;\r\n        (<any>window).EventDispatcher = EventDispatcher;\r\n        (<any>window).GlobalEvent = GlobalEvent;\r\n        (<any>window).HeadTipsManager = HeadTipsManager;\r\n        (<any>window).TaskManager = TaskManager;\r\n\r\n        Global.setup();\r\n        Game.setup();\r\n        AppHelper.init();\r\n    }\r\n\r\n    //初始化游戏内相关配置\r\n    public gameStartUp() {\r\n        Logger.error(\"gameStartUp\");\r\n        LoadingFacade.initGlobal()\r\n        //初始化section  注册ui  model\r\n        Global.UI.initUIRoot();\r\n        //初始化常驻节点\r\n        Global.Persist.init();\r\n        // if(!Global.SectionManager.hasSection(\"hallSection\"))\r\n        // {\r\n        //     Global.SectionManager.register(\"hallSection\", new HallSection());   \r\n        // }\r\n        // Global.SectionManager.callSectionInit(\"hallSection\");\r\n        // Global.UI.initUIRoot();\r\n        Global.ModuleManager.loadSkinModuleCfg(Global.Setting.SkinConfig.moduleCfg)\r\n        Global.Language.registLanguage(\"hall/config/language\");\r\n        cc.game.setFrameRate(Global.Setting.FPSConfig);\r\n    }\r\n    \r\n    startUp(manifest, node, isStartUpdate, serverType) {\r\n        Global.NativeEvent.Init();\r\n        this.manifest = manifest;\r\n        // Logger.log(\"--------manifest url -----\" + this.manifest.nativeUrl)\r\n        //正式环境下强制热更，后续有不热更需求再更新逻辑\r\n        if(!CC_PREVIEW)\r\n            isStartUpdate = true;\r\n        Global.Setting.isStartHotUpdate = isStartUpdate;\r\n        Global.Setting.serverType = serverType;\r\n        this.registerProxy(new PreLoadProxy(this.manifest[this.manifest.length - 1]))\r\n        this.registerProxy(new AppHotUpdateProxy(this.manifest))\r\n        //this.registerProxy(new HotUpdateProxy(this.manifest))\r\n        this.registerMediator(new ViewMediator(node))\r\n        this.sendNotification(Const.START_UP)\r\n\r\n    }\r\n\r\n    onDunInitFinish(){\r\n        this.sendNotification(Const.DUN_INIT_FINISH)\r\n    }\r\n\r\n    unregisterFacade() {\r\n        this.removeCommand(Const.START_UP)\r\n        this.removeMediator(ViewMediator.NAME)\r\n        //this.removeProxy(HotUpdateProxy.NAME)\r\n        this.removeProxy(AppHotUpdateProxy.NAME)\r\n        Global.Event.off(GlobalEvent.DunInitFinish, this, this.onDunInitFinish);\r\n        cc.game.off(cc.game.EVENT_SHOW, this.onResume, this);\r\n    }\r\n    public static releaseInstance() {\r\n        let instance = LoadingFacade.instanceMap[LoadingFacade.NAME]\r\n        if (instance) {\r\n            instance.unregisterFacade();\r\n            LoadingFacade.removeCore(LoadingFacade.NAME)\r\n        }\r\n        return;\r\n    }\r\n\r\n\r\n    public static get Instance(): LoadingFacade {\r\n        if (!LoadingFacade.instanceMap[LoadingFacade.NAME])\r\n            LoadingFacade.instanceMap[LoadingFacade.NAME] = new LoadingFacade(LoadingFacade.NAME);\r\n\r\n        return <LoadingFacade><any>(LoadingFacade.instanceMap[LoadingFacade.NAME]);\r\n    }\r\n}\r\n"]}