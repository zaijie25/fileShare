{"version":3,"sources":["assets\\ermj\\Ermj\\scripts\\handlers\\ErmjTingHandler.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import ErmjBaseHandler from \"./ErmjBaseHandler\";\r\nimport ErmjGameConst from \"../data/ErmjGameConst\";\r\nimport { ErmjAudioConst } from \"../data/ErmjPathHelper\";\r\n\r\nexport class ErmjTingHandler extends ErmjBaseHandler{\r\n    protected execute(msg){\r\n        this.mainUI.askActionView.active = false;\r\n\r\n        let localSeat = this.SitHelper.serverSToLocalN(msg._src);\r\n        if (localSeat == 0){\r\n            this.context.set(this.Define.FieldInTing, true);\r\n            this.mainUI.selfPlayView.onTing();\r\n        }\r\n        this.mainUI.callPlayer(localSeat, \"showStateSp\", true, ErmjGameConst.StateSpStrCfg.Ting);\r\n        this.mainUI.callPlayer(localSeat, \"showTingSign\", true);\r\n        // 亮出被听牌\r\n        let looksArr: any[] = msg._para.ting_looks || [];\r\n        for(let i = 0; i < looksArr.length; i++){\r\n            let localSeat = this.SitHelper.serverSToLocalN(looksArr[i].chair);\r\n            this.mainUI.callMjPlayer(localSeat, \"setBeInTing\");\r\n            this.mainUI.callMjPlayer(localSeat, \"showDownHand\", localSeat != this.context.selfLocalSeat, looksArr[i].cards || [], false, true);\r\n            this.mainUI.callMjPlayer(localSeat, \"showDarkKongSeen\", looksArr[i].kongs || []);\r\n        }\r\n\r\n        if (msg._para.ting_type == 1){\r\n            this.mainUI.onPlay(localSeat, msg._para.card);      // 普通听才出牌\r\n            Game.Component.scheduleOnce(()=>{\r\n                ErmjGameConst.playSound(ErmjAudioConst.genderSoundPath(\"ting\", localSeat == 0 ? 0 : 1), true);\r\n            }, 0.5);\r\n            Game.Event.event(Game.EVENT_ADDTIMELOCK, \"ErmjTingHandler\", 1.5);\r\n        }\r\n        else{\r\n            ErmjGameConst.playSound(ErmjAudioConst.genderSoundPath(\"ting\", localSeat == 0 ? 0 : 1), true);\r\n            Game.Event.event(Game.EVENT_ADDTIMELOCK, \"ErmjTingHandler\", 1);\r\n        }\r\n    }\r\n\r\n    protected executeSync(msg){\r\n        this.mainUI.askActionView.active = false;\r\n        \r\n        let localSeat = this.SitHelper.serverSToLocalN(msg._src);\r\n        if (localSeat == 0){\r\n            this.context.set(this.Define.FieldInTing, true);\r\n            this.mainUI.selfPlayView.onTing();\r\n        }\r\n        this.mainUI.callPlayer(localSeat, \"showTingSign\", true);\r\n        // 亮出被听牌\r\n        let looksArr: any[] = msg._para.ting_looks || [];\r\n        for(let i = 0; i < looksArr.length; i++){\r\n            let localSeat = this.SitHelper.serverSToLocalN(looksArr[i].chair);\r\n            this.mainUI.callMjPlayer(localSeat, \"setBeInTing\");\r\n            this.mainUI.callMjPlayer(localSeat, \"showDownHand\", localSeat != this.context.selfLocalSeat, looksArr[i].cards || [], false, true);\r\n            this.mainUI.callMjPlayer(localSeat, \"showDarkKongSeen\", looksArr[i].kongs || []);\r\n        }\r\n    }\r\n}\r\n\r\nexport class ErmjCallTingHandler extends ErmjBaseHandler{\r\n    protected execute(msg){\r\n        let localSeat = this.SitHelper.serverSToLocalN(msg._src);\r\n        if (localSeat == 0){\r\n            this.mainUI.askActionView.active = true;\r\n            this.mainUI.askActionView.showTingBtn(true, msg._para);\r\n        }\r\n        let time = 0;\r\n        let serverTime = msg._times;\r\n        if (serverTime && Game.Component.correctTime){\r\n            let dev = Game.Component.correctTime(serverTime);\r\n            time = msg._timeo * 1000 - dev;\r\n        }\r\n        else{\r\n            time = msg._timeo * 1000 - (Date.now() - msg._receiveTime);\r\n        }\r\n        if (!time || time <= 0)\r\n            time = 1000;\r\n        this.mainUI.askNoticeView.setTimeRunConfig(Math.round(time / 1000), null, null);\r\n    }\r\n}\r\n\r\nexport class ErmjTingResultHandler extends ErmjBaseHandler{\r\n    protected execute(msg){\r\n        let localSeat = this.SitHelper.serverSToLocalN(msg._src);\r\n        if (localSeat == 0){\r\n            this.mainUI.selfPlayView.winTipsView.active = true;\r\n            this.mainUI.selfPlayView.winTipsView.updateWinList(msg._para.ting_items);\r\n            this.context.set(this.Define.FieldTingData, msg._para.ting_items);          // [{\"card\":3, \"fan\":10, \"num\":2}, ...]\r\n        }\r\n    }\r\n}"]}