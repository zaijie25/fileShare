{"version":3,"sources":["assets\\ermj\\Ermj\\scripts\\handlers\\ErmjRewardHandler.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import ErmjDriver from \"../ErmjDriver\";\r\nimport ErmjBaseHandler from \"./ErmjBaseHandler\";\r\n\r\nexport default class ErmjRewardHandler extends ErmjBaseHandler{\r\n    protected execute(msg){\r\n        this.mainUI.askBtnView.setAutoPlayBtnShow(true);\r\n        this.context.set(this.Define.FieldInSettle, true);\r\n        this.mainUI.callAllPlayers(\"showStateSp\", false);\r\n        this.mainUI.askNoticeView.setTimerShow(false);\r\n        this.mainUI.selfPlayView.resetSelectMj();\r\n        this.mainUI.selfPlayView.active = false;\r\n        this.mainUI.askActionView.active = false;\r\n        \r\n        let winFlag = msg._para.win_flag;\r\n        let detailMap = msg._para.details || {};        // 赢家番map\r\n        let handCardMap = msg._para.all_hand_cards || {};    // 所有人现存手牌\r\n        let darkCardMap = msg._para.all_an_kongs || {};     // 暗杠牌\r\n\r\n        let delay = 0;\r\n        for(let chair in handCardMap){\r\n            let localSeat = this.SitHelper.serverSToLocalN(Number(chair));\r\n            this.mainUI.callMjPlayer(localSeat, \"showDownHand\", true, handCardMap[chair], !!detailMap[chair]);\r\n            if (localSeat != this.context.selfLocalSeat)\r\n                this.mainUI.callMjPlayer(localSeat, \"showDarkKongSeen\", darkCardMap[chair] || []);\r\n        }\r\n        delay += 0.5;\r\n        if (winFlag != 0){\r\n            Game.Component.scheduleOnce(()=>{\r\n                for(let chair in detailMap){\r\n                    let info = detailMap[chair];\r\n                    let localSeat = this.SitHelper.serverSToLocalN(Number(chair));\r\n                    let fanIndex = 10000;\r\n                    for(let key in info.fan_detail){       // 找到最小的index 即最大番型展示\r\n                        if (fanIndex > Number(key)){\r\n                            fanIndex = Number(key);\r\n                        }\r\n                    }\r\n                    if (fanIndex != 10000)\r\n                        this.mainUI.callPlayer(localSeat, \"showFanType\", true, fanIndex);\r\n                }\r\n            }, delay);\r\n            delay += 1.5;\r\n        }\r\n\r\n        Game.Component.scheduleOnce(()=>{\r\n            if (winFlag == 0){\r\n                this.mainUI.flowView.active = true;\r\n            }\r\n            else{\r\n                this.mainUI.settleView.active = true;\r\n                this.mainUI.settleView.showSettleInfo(winFlag == 1, msg._para.award, msg._para.fan, detailMap, handCardMap);\r\n                // this.mainUI.settleView.delayShowActionBtn(time);     // 由leave-103控制显示\r\n            }\r\n        }, delay);\r\n        \r\n        ErmjDriver.instance.mainUI.taskManager.reqGetCommisionInfo();\r\n        Game.Event.event(Game.EVENT_ADDTIMELOCK, \"ErmjLeaveHandler\", delay + 0.1);\r\n    }\r\n\r\n    protected executeSync(msg){\r\n        this.mainUI.diceAnimComp.node.active = false;\r\n        this.context.set(this.Define.FieldInSettle, true);\r\n        this.mainUI.callAllPlayers(\"showStateSp\", false);\r\n        this.mainUI.askNoticeView.setTimerShow(false);\r\n        this.mainUI.selfPlayView.resetSelectMj();\r\n        this.mainUI.selfPlayView.active = false;\r\n\r\n        let winFlag = msg._para.win_flag;\r\n        let detailMap = msg._para.details || {};        // 赢家番map\r\n        let handCardMap = msg._para.all_hand_cards || {};    // 所有人现存手牌\r\n        let darkCardMap = msg._para.all_an_kongs || {};     // 暗杠牌\r\n\r\n        for(let chair in handCardMap){\r\n            let localSeat = this.SitHelper.serverSToLocalN(Number(chair));\r\n            this.mainUI.callMjPlayer(localSeat, \"showDownHand\", true, handCardMap[chair], !!detailMap[chair]);\r\n            if (localSeat != this.context.selfLocalSeat)\r\n                this.mainUI.callMjPlayer(localSeat, \"showDarkKongSeen\", darkCardMap[chair] || []);\r\n        }\r\n\r\n        if (winFlag == 0){\r\n            this.mainUI.flowView.active = true;\r\n        }\r\n        else{\r\n            this.mainUI.settleView.active = true;\r\n            this.mainUI.settleView.showSettleInfo(winFlag == 1, msg._para.award, msg._para.fan, detailMap, handCardMap);\r\n            // this.mainUI.settleView.delayShowActionBtn(time);\r\n        }\r\n    }\r\n}"]}