{"version":3,"sources":["assets\\hall\\scripts\\logic\\core\\component\\TaskComp.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\r\n\r\nenum Directiton{\r\n    Left = -1,\r\n    Right = 1\r\n}\r\n\r\n@ccclass\r\nexport default class TaskComp extends cc.Component {\r\n    private taskLbl: cc.Label;\r\n    private taskTips: cc.Node;\r\n    private taskTipLbl: cc.Label;\r\n    private showNode: cc.Node;\r\n    private readonly tipsOffsetWidth: number = 40;      // tips的宽偏移量\r\n    private rawTopsPos: cc.Vec3;\r\n    private touchBgNode: cc.Node;\r\n    private isTargetFinish: boolean;\r\n\r\n    protected onLoad() {\r\n        this.touchBgNode = cc.find(\"touchBg\", this.node);\r\n        this.touchBgNode.active = false;\r\n        this.touchBgNode.on(cc.Node.EventType.TOUCH_END, this.onTouchBgCLick, this);\r\n        this.touchBgNode._touchListener.setSwallowTouches(false);        // 允许点击穿透\r\n\r\n        this.taskTips = cc.find(\"taskTips\", this.node);\r\n        this.taskTipLbl = cc.find(\"taskTips/taskTipLbl\", this.node).getComponent(cc.Label);\r\n        this.taskTips.active = false;\r\n        this.showNode = cc.find(\"content\", this.node)\r\n        this.showNode.active = false;\r\n        this.taskLbl = cc.find(\"content/taskLbl\", this.node).getComponent(cc.Label);\r\n        Global.UIHelper.addCommonClick(this.node, \"content/taskBtn\", this.showTipLbl, this);\r\n        this.rawTopsPos = this.taskTips.position;\r\n    }\r\n\r\n    private onTouchBgCLick(){\r\n        this.closeTips();\r\n    }\r\n\r\n    private closeTips() {\r\n        this.taskTips.active = false;\r\n        this.touchBgNode.active = false;\r\n        this.unscheduleAllCallbacks();\r\n    }\r\n\r\n    /**\r\n     * 初始化\r\n     * @param dir 1向右 -1向左\r\n     */\r\n    public initTask(dir: number) {\r\n        if (dir == Directiton.Left) {\r\n            this.taskTips.setPosition(cc.v3(-this.rawTopsPos.x, this.rawTopsPos.y));\r\n            this.taskTips.scaleX = 1;\r\n            this.taskTipLbl.node.scaleX = 1;\r\n            this.taskTipLbl.node.anchorX = 1;\r\n        }\r\n        else if (dir == Directiton.Right) {\r\n            this.taskTips.setPosition(cc.v3(this.rawTopsPos.x, this.rawTopsPos.y));\r\n            this.taskTips.scaleX = -1;\r\n            this.taskTipLbl.node.scaleX = -1;\r\n            this.taskTipLbl.node.anchorX = 0;\r\n        }\r\n    }\r\n\r\n    // 显示任务的信息\r\n    private showTipLbl() {\r\n        this.taskTips.active = true;\r\n        this.touchBgNode.active = true;\r\n        this.setTipsWidth();\r\n\r\n        this.unscheduleAllCallbacks();\r\n        this.scheduleOnce(() => {\r\n            this.closeTips();\r\n        }, 5);\r\n        \r\n        if (this.isTargetFinish){\r\n            let str = \"请前往财神到页面领取奖励！\";\r\n            Global.UI.fastTip(str);\r\n        }\r\n    }\r\n\r\n    protected onDisable(){\r\n        this.unscheduleAllCallbacks();\r\n    }\r\n\r\n    public updateTask(data: any){\r\n        this.taskTipLbl.string = \"任务说明:\" + data.task_desc;\r\n        this.taskLbl.string = `${data.task_self_num}/${data.task_num}`;\r\n        if (data.task_status != 2) {        // 2已领取\r\n            this.showContent(true);\r\n        }\r\n        else{\r\n            this.showContent(false);\r\n        }\r\n        if (data.task_self_num == data.task_num && data.task_num > 0 || data.task_status == 1){     // 1已完成未领取\r\n            this.isTargetFinish = true;\r\n        }\r\n        else\r\n            this.isTargetFinish = false;\r\n    }\r\n\r\n    public showContent(flag: boolean){\r\n        this.showNode.active = flag;\r\n    }\r\n\r\n    private setTipsWidth() {\r\n        let lblWidth = this.taskTipLbl.node.width;\r\n        this.taskTips.width = lblWidth + this.tipsOffsetWidth;\r\n    }\r\n}"]}