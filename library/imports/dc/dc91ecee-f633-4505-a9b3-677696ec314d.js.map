{"version":3,"sources":["assets\\bbwz\\Bbwz\\scripts\\manager\\BbwzBetManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { BbwzRole } from \"../data/BbwzConstDefine\";\r\nimport BbwzCircularQueue from \"../tool/BbwzCircularQueue\";\r\n\r\nexport default class BbwzBetManager{\r\n    // 采用循环队列, 单局每个座位下注不会超过100次, size取100完全足够了 况且不会只进列不出列的\r\n    private static playerQueue: {[key: number]: BbwzCircularQueue<QueueItem>}  = {     \r\n        [BbwzRole.Self]: new BbwzCircularQueue<QueueItem>(100),\r\n        [BbwzRole.Online]: new BbwzCircularQueue<QueueItem>(100),\r\n        [BbwzRole.Wiser]: new BbwzCircularQueue<QueueItem>(100),\r\n        [BbwzRole.Richer1]: new BbwzCircularQueue<QueueItem>(100),\r\n        [BbwzRole.Richer2]: new BbwzCircularQueue<QueueItem>(100),\r\n        [BbwzRole.Richer3]: new BbwzCircularQueue<QueueItem>(100),\r\n        [BbwzRole.Richer4]: new BbwzCircularQueue<QueueItem>(100),\r\n        [BbwzRole.Richer5]: new BbwzCircularQueue<QueueItem>(100),\r\n    };\r\n\r\n    /**\r\n     * 其他玩家下注时的飞筹码计算\r\n     */\r\n    public static getSendCount(queueLength: number) {\r\n        let len = Global.Toolkit.getRoundInteger(4, 1);\r\n        if (queueLength <= len) \r\n            return queueLength;\r\n        let count = Global.Toolkit.getRoundInteger(queueLength / 2 + 1);\r\n        return count;\r\n    }\r\n\r\n    /**\r\n     * 清理下注队列\r\n     * @param seat 指定座位, 传空全部清理\r\n     */\r\n    public static clearBetQueue(seat?: number){\r\n        if (seat && this.playerQueue[seat]){\r\n            let queue = this.playerQueue[seat];\r\n            queue.clear();\r\n        }\r\n        else{\r\n            for (let key in this.playerQueue){\r\n                let queue = this.playerQueue[key];\r\n                queue.clear();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 添加一条下注行为到队列\r\n     * @param seat 座位\r\n     * @param areaName 下注区域名\r\n     * @param betNum 下注金额\r\n     */\r\n    public static addBetQueue(seat: BbwzRole, areaName: string, betNum: number){\r\n        let circleQueue = this.playerQueue[seat];\r\n        if (circleQueue){\r\n            let queuItem = new QueueItem(areaName, betNum);\r\n            circleQueue.enQueue(queuItem);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 获取一个座位下注队列\r\n     * @param seat 座位\r\n     */\r\n    public static getOneRoleBetQueue(seat: BbwzRole){\r\n        let circleQueue = this.playerQueue[seat];\r\n        if (circleQueue)\r\n            return circleQueue;\r\n    }\r\n\r\n    /**\r\n     * 某个座位下注行为队列出列一条\r\n     * 下注数据shift更新频繁, 采用循环队列 减少开销\r\n     * @param seat 座位\r\n     */\r\n    public static shiftOneRoleBetQueue(seat: BbwzRole){\r\n        let circleQueue = this.playerQueue[seat];\r\n        if (circleQueue){\r\n            let queueItem = circleQueue.front();\r\n            circleQueue.deQueue();\r\n            return queueItem;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 获取某个座位下注队列长度\r\n     * @param seat 座位\r\n     */\r\n    public static getOneRoleBetQueueLength(seat: BbwzRole){\r\n        let circleQueue = this.playerQueue[seat];\r\n        if (circleQueue)\r\n            return circleQueue.length;\r\n        return 0;\r\n    }\r\n\r\n    public static getAllPlayerQueue(){\r\n        return this.playerQueue;\r\n    }\r\n}\r\n\r\nexport class QueueItem{\r\n    constructor(public tableType: string, public betNum: number){\r\n        // Logger.error(tableType, betNum);\r\n    }\r\n}"]}