{"version":3,"sources":["assets\\ermj\\Ermj\\scripts\\component\\ErmjLoadingUI.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import ErmjMainUI from \"../panel/ErmjMainUI\";\r\nimport ErmjPathHelper from \"../data/ErmjPathHelper\";\r\nimport ErmjGameConst from \"../data/ErmjGameConst\";\r\nimport ErmjDriver from \"../ErmjDriver\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class ErmjLoadingUI extends cc.Component{\r\n    private dependAtlas = [\r\n        // atlas\r\n        ErmjPathHelper.gameTexturePath + \"dynamic/atlas_dynamic\",\r\n        ErmjPathHelper.gameTexturePath + \"mahjong/atlas_mahjong\",\r\n        ErmjPathHelper.gameTexturePath + \"type/atlas_type\",\r\n    ];\r\n    private dependceArr = [\r\n        // ui\r\n        ErmjPathHelper.gamePrefabsPath + \"panel/ErmjMainUI\",\r\n\r\n        ErmjPathHelper.gamePrefabsPath + \"panel/mahjong/mahjongHillView\",\r\n        ErmjPathHelper.gamePrefabsPath + \"panel/mahjong/mahjongOutView\",\r\n        ErmjPathHelper.gamePrefabsPath + \"panel/mahjong/mahjongOperView\",\r\n\r\n        ErmjPathHelper.gamePrefabsPath + \"panel/subView/matchPlayerView\",\r\n        ErmjPathHelper.gamePrefabsPath + \"panel/subView/gameStartView\",\r\n    ];\r\n    // 同时加载太多有明显卡顿感, 分批加载\r\n    private dependceArr2 = [\r\n        ErmjPathHelper.gamePrefabsPath + \"panel/subView/diceAnim\",\r\n        ErmjPathHelper.gamePrefabsPath + \"panel/subView/rubMjAnim\",\r\n        ErmjPathHelper.gamePrefabsPath + \"panel/subView/askActionView\",\r\n        ErmjPathHelper.gamePrefabsPath + \"panel/subView/askNoticeView\",\r\n        ErmjPathHelper.gamePrefabsPath + \"panel/subView/selfPlayView\",\r\n        ErmjPathHelper.gamePrefabsPath + \"panel/subView/flowView\",\r\n        ErmjPathHelper.gamePrefabsPath + \"panel/subView/settleView\",\r\n        ErmjPathHelper.gamePrefabsPath + \"panel/subView/winLightningView\",\r\n        ErmjPathHelper.gamePrefabsPath + \"panel/subView/autoBtnVIew\",\r\n    ];\r\n    private loadingContent: cc.Node;\r\n\r\n    onLoad(){\r\n        this.loadingContent = cc.find(\"content\", this.node);\r\n        this.loadingContent.active = false;\r\n    }\r\n\r\n    protected start(){\r\n        this.initLoading();\r\n        this.preloadRes();\r\n    }\r\n\r\n    private async initLoading(){\r\n        if (Global.GameData.checkHasCustomLoading && !Global.GameData.checkHasCustomLoading(ErmjGameConst.Gid)){\r\n            let comp = await Global.UIHelper.getGameLoadingComp();\r\n            this.loadingContent.active = false;\r\n            comp.node.setParent(this.node);\r\n            comp.node.active = true;\r\n        }\r\n        else{\r\n            this.loadingContent.active = true;\r\n        }\r\n    }\r\n\r\n    private async preloadRes(){\r\n        let loadAtlas = ()=>{\r\n            return new Promise((resolve, reject)=>{\r\n                Global.ResourceManager.loadBundleRes(ErmjGameConst.Gid, this.dependAtlas, (err, res)=>{\r\n                    if (err){\r\n                        reject(err);\r\n                    }\r\n                    else{\r\n                        resolve(res);\r\n                    }\r\n                }, cc.SpriteAtlas);\r\n            })\r\n        }\r\n        let loadPrefab1 = ()=>{\r\n            return new Promise((resolve, reject)=>{\r\n                Global.ResourceManager.loadBundleRes(ErmjGameConst.Gid, this.dependceArr, (err, res)=>{\r\n                    if (err){\r\n                        reject(err);\r\n                    }\r\n                    else{\r\n                        resolve(res);\r\n                    }\r\n                }, null);\r\n            });\r\n        }\r\n        let loadPrefab2 = ()=>{\r\n            return new Promise((resolve, reject)=>{\r\n                Global.ResourceManager.loadBundleRes(ErmjGameConst.Gid, this.dependceArr2, (err, res)=>{\r\n                    if (err){\r\n                        reject(err);\r\n                    }\r\n                    else{\r\n                        resolve(res);\r\n                    }\r\n                }, null);\r\n            });\r\n        }\r\n\r\n        await HeadTipsManager.preloadRes();\r\n        await TaskManager.preloadRes();\r\n        await loadAtlas();\r\n        await loadPrefab1();\r\n        await loadPrefab2();\r\n        // 防止load过程中强踢到大厅后调用报错\r\n        if (!this.node || !cc.isValid(this.node) || !ErmjDriver.instance.inGame) {\r\n            return;\r\n        }\r\n\r\n        this.initUI();\r\n        Game.Component.scheduleOnce(()=>{\r\n            ErmjDriver.instance.startScene();\r\n        }, 0.5);\r\n    }\r\n\r\n    private initUI(){\r\n        let CanvasNode = cc.Canvas.instance.node;\r\n\r\n        let fullScreenLayer:cc.Node = Global.UI.getLayer(\"FullScreenLayer\") || CanvasNode;\r\n        let popLayer:cc.Node = Global.UI.getLayer(\"PopLayer\") || CanvasNode;\r\n        let mainUI = this.getUINode(ErmjPathHelper.gamePrefabsPath + \"panel/ErmjMainUI\");\r\n        ErmjDriver.instance.mainUI = mainUI.getComponent(ErmjMainUI);\r\n        fullScreenLayer.addChild(mainUI);   // 放到同一层次，方便进入场动画\r\n        mainUI.active = false;\r\n    }\r\n\r\n    private getUINode(path){\r\n        let prefab = Global.ResourceManager.getBundleRes(ErmjGameConst.Gid, path, cc.Prefab);\r\n        if(prefab == null)\r\n        {\r\n            Logger.error(\"获取预设失败\", path);\r\n            return null;\r\n        }\r\n        return cc.instantiate(prefab);\r\n    }\r\n}"]}