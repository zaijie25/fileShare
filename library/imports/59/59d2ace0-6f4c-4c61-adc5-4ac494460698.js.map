{"version":3,"sources":["assets\\ermj\\Ermj\\scripts\\subView\\mahjong\\ErmjMahjongOutView.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAAA,gDAA2C;AAC3C,4DAA2E;AAC3E,kEAAqF;AACrF,0DAAqD;AAGrD;IAAgD,sCAAY;IAOxD,4BAAY,IAAa;QAAzB,YACI,iBAAO,SAEV;QADG,KAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;;IACvB,CAAC;IAES,qCAAQ,GAAlB;QACI,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,YAAY,CAAC,IAAI,EAAE,EAAE,CAAC,MAAM,CAAC,CAAC;QAClD,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,YAAY,CAAC,OAAO,EAAE,EAAE,CAAC,MAAM,CAAC,CAAC;QACrD,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM,EAAE,EAAE,CAAC,MAAM,CAAC,CAAC;QACnD,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC;IACrD,CAAC;IAGD,sBAAW,4CAAY;aASvB;YACI,OAAO,IAAI,CAAC,MAAM,CAAC;QACvB,CAAC;QAZD,gBAAgB;aAChB,UAAwB,KAAa;YACjC,IAAI,IAAI,CAAC,MAAM,IAAI,KAAK;gBACpB,OAAO;YACX,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;YACpB,MAAM,CAAC,eAAe,CAAC,mBAAmB,CAAC,uBAAa,CAAC,GAAG,EAAE,IAAI,CAAC,OAAO,EAAE,wBAAc,CAAC,eAAe,GAAG,uBAAuB,EAAE,2BAAiB,CAAC,QAAQ,CAAC,KAAK,CAAC,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;YACrL,IAAI,EAAE,CAAC,GAAG,CAAC,SAAS;gBAChB,IAAI,CAAC,IAAI,CAAC,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,CAAC;QACvC,CAAC;;;OAAA;IAMD;;;;OAIG;IACI,0CAAa,GAApB,UAAqB,UAAkB,EAAE,SAA6B;QAClE,IAAI,CAAC,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;QACpB,IAAI,CAAC,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;QAChB,IAAA,KAAa,2BAAiB,CAAC,iBAAiB,CAAC,UAAU,CAAC,EAA3D,GAAG,SAAA,EAAE,GAAG,SAAmD,CAAC;QACjE,IAAI,WAAW,GAAG,2BAAiB,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC;QAC1D,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,GAAG,CAAC,WAAW,CAAC,UAAU,CAAC;QAClD,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,GAAG,GAAG,CAAC,UAAU,GAAG,GAAG,GAAG,WAAW,CAAC,UAAU,CAAC;QACxE,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,GAAG,GAAG,GAAG,WAAW,CAAC,UAAU,CAAC;QACxD,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,GAAG,GAAG,GAAG,WAAW,CAAC,UAAU,CAAC;QACvD,MAAM,CAAC,eAAe,CAAC,mBAAmB,CAAC,uBAAa,CAAC,GAAG,EAAE,IAAI,CAAC,OAAO,EAAE,wBAAc,CAAC,eAAe,GAAG,uBAAuB,EAAE,GAAG,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;QAC5J,MAAM,CAAC,eAAe,CAAC,mBAAmB,CAAC,uBAAa,CAAC,GAAG,EAAE,IAAI,CAAC,MAAM,EAAE,wBAAc,CAAC,eAAe,GAAG,uBAAuB,EAAE,GAAG,CAAC,MAAM,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;IACjK,CAAC;IAGD,sBAAW,uCAAO;QADlB,cAAc;aACd,UAAmB,IAAa;YAC5B,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;YAChC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;YAChC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,IAAI,CAAC;QACpC,CAAC;;;OAAA;IAED,kBAAkB;IACX,4CAAe,GAAtB,UAAuB,IAAa;QAChC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,GAAG,IAAI,IAAI,2BAAiB,CAAC,cAAc,IAAI,2BAAiB,CAAC,aAAa,CAAC;IAC1G,CAAC;IAED;;;;;;OAMG;IACI,sCAAS,GAAhB,UAAiB,IAAa,EAAE,EAAW,EAAE,UAAkB,EAAE,SAAiB;QAAlF,iBAgBC;QAfG,IAAI,CAAC,aAAa,CAAC,CAAC,EAAE,sCAAkB,CAAC,IAAI,CAAC,CAAC;QAC3C,IAAA,KAAa,2BAAiB,CAAC,iBAAiB,CAAC,UAAU,CAAC,EAA3D,GAAG,SAAA,EAAE,GAAG,SAAmD,CAAC;QACjE,IAAI,WAAW,GAAG,2BAAiB,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC;QAC1D,IAAI,CAAC,IAAI,CAAC,KAAK,GAAG,GAAG,CAAC;QACtB,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;QAC5B,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,GAAG,GAAG,GAAG,WAAW,CAAC,UAAU,CAAC;QACxD,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,GAAG,GAAG,GAAG,WAAW,CAAC,UAAU,CAAC;QAEvD,IAAI,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACtC,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC;aACrC,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC,YAAY,EAAE,EAAC,QAAQ,EAAE,EAAE,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,WAAW,CAAC,UAAU,EAAE,KAAK,EAAE,GAAG,GAAG,GAAG,CAAC,UAAU,GAAG,WAAW,CAAC,UAAU,EAAC,EAAE,EAAE,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;aAC1J,IAAI,CAAC;YACF,KAAI,CAAC,aAAa,CAAC,UAAU,EAAE,SAAS,CAAC,CAAC;QAC9C,CAAC,CAAC;aACD,KAAK,EAAE,CAAC;IACb,CAAC;IAED;;;;;;OAMG;IACI,mCAAM,GAAb,UAAc,EAAW,EAAE,SAAa,EAAE,QAAY,EAAE,QAAmB,EAAE,OAAe,EAAE,IAAwB;QAA3F,0BAAA,EAAA,aAAa;QAAE,yBAAA,EAAA,YAAY;QAAuB,wBAAA,EAAA,eAAe;QAAE,qBAAA,EAAA,OAAY,EAAE,CAAC,MAAM,CAAC,CAAC,CAAC;QAClH,IAAI,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACtC,KAAK,CAAC,KAAK,CAAC,QAAQ,CAAC;aACpB,IAAI,CAAC;YACF,sFAAsF;QAC1F,CAAC,CAAC;aACD,EAAE,CAAC,SAAS,EAAE,EAAC,QAAQ,EAAE,EAAE,EAAC,EAAE,IAAI,CAAC;aACnC,IAAI,CAAC,QAAQ,CAAC;aACd,KAAK,EAAE,CAAC;IACb,CAAC;IAEM,wCAAW,GAAlB;QACI,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;IACrF,CAAC;IAEM,iDAAoB,GAA3B;QACI,OAAO,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,qBAAqB,CAAC,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;IAC1F,CAAC;IAEM,kCAAK,GAAZ;QACI,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;QACrB,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,GAAG,2BAAiB,CAAC,aAAa,CAAC;QAC1D,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;QAC5B,IAAI,CAAC,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;QACpB,IAAI,CAAC,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;QACpB,IAAI,CAAC,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;IACxB,CAAC;IACL,yBAAC;AAAD,CA1HA,AA0HC,CA1H+C,sBAAY,GA0H3D","file":"","sourceRoot":"/","sourcesContent":["import ErmjBaseView from \"../ErmjBaseView\";\r\nimport ErmjPathHelper, { ErmjAudioConst } from \"../../data/ErmjPathHelper\";\r\nimport ErmjMjStyleHelper, { ErmjRelativeDefine } from \"../../tool/ErmjMjStyleHelper\";\r\nimport ErmjGameConst from \"../../data/ErmjGameConst\";\r\n\r\n\r\nexport default class ErmjMahjongOutView extends ErmjBaseView{\r\n    private frontBg: cc.Sprite;\r\n    private frontSp: cc.Sprite;\r\n    private backBg: cc.Sprite;\r\n    private _value: number;\r\n    private attentionPoint: cc.Node;\r\n\r\n    constructor(node: cc.Node){\r\n        super();\r\n        this.setNode(node);\r\n    }\r\n\r\n    protected initView(){\r\n        this.frontBg = this.getComponent(\"bg\", cc.Sprite);\r\n        this.frontSp = this.getComponent(\"front\", cc.Sprite);\r\n        this.backBg = this.getComponent(\"back\", cc.Sprite);\r\n        this.attentionPoint = this.getChild(\"attention\");\r\n    }\r\n\r\n    /** 设置牌值和图案样式 */\r\n    public set mahjongValue(value: number){\r\n        if (this._value == value)\r\n            return;\r\n        this._value = value;\r\n        Global.ResourceManager.loadBundleAutoAtlas(ErmjGameConst.Gid, this.frontSp, ErmjPathHelper.gameTexturePath + \"mahjong/atlas_mahjong\", ErmjMjStyleHelper.mjOutMap[value], null, true);\r\n        if (cc.sys.isBrowser)\r\n            this.node.name = String(value);\r\n    }\r\n\r\n    public get mahjongValue(){\r\n        return this._value;\r\n    }\r\n\r\n    /**\r\n     * 设置麻将子显示样式\r\n     * @param perspLevel 透视等级\r\n     * @param nRelative 相对主机方位\r\n     */\r\n    public setPerspStyle(perspLevel: number, nRelative: ErmjRelativeDefine){\r\n        this.node.angle = 0;\r\n        this.node.skewX = 0;\r\n        let {cfg, dir} = ErmjMjStyleHelper.getPerspectiveCfg(perspLevel);\r\n        let relativeCfg = ErmjMjStyleHelper.mjOutStyle[nRelative];\r\n        this.frontSp.node.angle = -relativeCfg.frontAngle;\r\n        this.frontSp.node.skewX = cfg.frontSkewX * dir * relativeCfg.perspScale;\r\n        this.frontBg.node.scaleX = dir * relativeCfg.perspScale;\r\n        this.backBg.node.scaleX = dir * relativeCfg.perspScale;\r\n        Global.ResourceManager.loadBundleAutoAtlas(ErmjGameConst.Gid, this.frontBg, ErmjPathHelper.gameTexturePath + \"mahjong/atlas_mahjong\", cfg.bgSp, null, true);\r\n        Global.ResourceManager.loadBundleAutoAtlas(ErmjGameConst.Gid, this.backBg, ErmjPathHelper.gameTexturePath + \"mahjong/atlas_mahjong\", cfg.backSp, null, true);\r\n    }\r\n\r\n    /** 设置麻将正反面 */\r\n    public set isFront(flag: boolean){\r\n        this.frontBg.node.active = flag;\r\n        this.frontSp.node.active = flag;\r\n        this.backBg.node.active = !flag;\r\n    }\r\n\r\n    /** 设置正面背景特殊色提示 */\r\n    public setSpecialColor(flag: boolean){\r\n        this.frontBg.node.color = flag && ErmjMjStyleHelper.SpecialBgColor || ErmjMjStyleHelper.NormalBgColor;\r\n    }\r\n\r\n    /**\r\n     * 出牌动画\r\n     * @param from 本地起点坐标 \r\n     * @param to 本地终点坐标\r\n     * @param perspLevel 目的位置透视\r\n     * @param nRelative 相对主机朝向\r\n     */\r\n    public doOutAnim(from: cc.Vec3, to: cc.Vec3, perspLevel: number, nRelative: number){\r\n        this.setPerspStyle(0, ErmjRelativeDefine.Self);\r\n        let {cfg, dir} = ErmjMjStyleHelper.getPerspectiveCfg(perspLevel);\r\n        let relativeCfg = ErmjMjStyleHelper.mjOutStyle[nRelative];\r\n        this.node.scale = 1.5;\r\n        this.node.setPosition(from);\r\n        this.frontBg.node.scaleX = dir * relativeCfg.perspScale;\r\n        this.backBg.node.scaleX = dir * relativeCfg.perspScale;\r\n\r\n        let tween = Game.Tween.get(this.node);\r\n        tween.delay(this.Define.outMjShowTime)\r\n        .to(this.Define.outMjFlyTime, {position: to, scale: 1, angle: -relativeCfg.frontAngle, skewX: dir * cfg.frontSkewX * relativeCfg.perspScale}, cc.easeIn(1))\r\n        .call(()=>{\r\n            this.setPerspStyle(perspLevel, nRelative);\r\n        })\r\n        .start();\r\n    }\r\n\r\n    /**\r\n     * 麻将移动(自身父坐标内)\r\n     * @param to 终点坐标\r\n     * @param timeScale 移动时长\r\n     * @param timeWait 移动前延时\r\n     * @param callback 完成回调\r\n     */\r\n    public doMove(to: cc.Vec3, timeScale = 1, timeWait = 0, callback?: Function, isSound = false, ease: any = cc.easeIn(1)){\r\n        let tween = Game.Tween.get(this.node);\r\n        tween.delay(timeWait)\r\n        .call(()=>{\r\n            // isSound && ErmjGameConst.playSound(ErmjAudioConst.commonAudio.DispatchPoker, true);\r\n        })\r\n        .to(timeScale, {position: to}, ease)\r\n        .call(callback)\r\n        .start();\r\n    }\r\n\r\n    public getRealSize(){\r\n        return [this.node.width * this.node.scaleX, this.node.height * this.node.scaleY];\r\n    }\r\n\r\n    public getAttentionWorldPos(){\r\n        return this.attentionPoint.parent.convertToWorldSpaceAR(this.attentionPoint.position);\r\n    }\r\n\r\n    public reset(){\r\n        this.isFront = false;\r\n        this.frontBg.node.color = ErmjMjStyleHelper.NormalBgColor;\r\n        this.frontSp.node.angle = 0;\r\n        this.node.angle = 0;\r\n        this.node.scale = 1;\r\n        this.node.skewX = 0;\r\n    }\r\n}"]}