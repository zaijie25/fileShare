{"version":3,"sources":["assets\\hall_editor_cmp\\CountDownBtn.js"],"names":["cc","Class","Component","editor","CC_EDITOR","menu","properties","btnLabel","Label","btnRichLabel","RichText","richInfo","countDownTime","onLoad","btnCom","getComponent","Button","oldString","string","_oldHitTest","node","_hitTest","enableAutoGrayEffect","on","onClickFunc","startCountDown","emptyFunc","interactable","startTime","Date","now","TimerID","setInterval","updateTimeLabel","bind","leftTime","curTime","Math","ceil","js","formatStr","overCountDown","clearInterval"],"mappings":"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","sourceRoot":"/","sourcesContent":["\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    editor: CC_EDITOR && {\r\n        menu: 'i18n:MAIN_MENU.component.ui/CountDownBtn',\r\n    },\r\n\r\n    properties: {\r\n        btnLabel : cc.Label,\r\n        btnRichLabel : cc.RichText,\r\n        richInfo : \"\",\r\n        countDownTime : 60,\r\n    },\r\n\r\n    onLoad(){\r\n        this.btnCom = this.getComponent(cc.Button);\r\n        if(this.btnLabel != null){\r\n            this.oldString = this.btnLabel.string;\r\n        }else if(this.btnRichLabel  != null){\r\n            this.oldString = this.btnRichLabel.string;\r\n        }\r\n        if(!this.btnCom){\r\n            this._oldHitTest = this.node._hitTest;\r\n        }else{\r\n            this.btnCom.enableAutoGrayEffect = true;\r\n        }\r\n        this.node.on(\"click\",this.onClickFunc,this);\r\n    },\r\n\r\n    startCountDown(){\r\n        if(!this.btnCom){\r\n            this.node._hitTest = this.emptyFunc;\r\n        }else{\r\n            this.btnCom.interactable = false;\r\n        }\r\n        this.startTime = Date.now();\r\n        this.TimerID = setInterval(this.updateTimeLabel.bind(this),100);\r\n    },\r\n\r\n    updateTimeLabel(){\r\n        var leftTime = (Date.now() - this.startTime) / 1000;\r\n        var curTime = Math.ceil(this.countDownTime - leftTime);\r\n        if(this.btnLabel != null){\r\n            this.btnLabel.string = curTime + \"s\";\r\n        }else if(this.btnRichLabel  != null){\r\n            this.btnRichLabel.string = cc.js.formatStr(this.richInfo,curTime + \"s\");\r\n        }\r\n        if(curTime <= 0){\r\n            this.overCountDown();\r\n        }\r\n    },\r\n\r\n    overCountDown(){\r\n        clearInterval(this.TimerID);\r\n        this.TimerID = null;\r\n        if(!this.btnCom){\r\n            this.node._hitTest = this._oldHitTest.bind(this.node);\r\n        }else{\r\n            this.btnCom.interactable = true;\r\n        }\r\n        if(this.btnLabel != null){\r\n            this.btnLabel.string = this.oldString;\r\n        }else if(this.btnRichLabel  != null){\r\n            this.btnRichLabel.string = this.oldString;\r\n        }\r\n    },\r\n\r\n    emptyFunc(){\r\n        return false;\r\n    },\r\n\r\n    onClickFunc(){\r\n        this.startCountDown();\r\n    }\r\n});\r\n"]}