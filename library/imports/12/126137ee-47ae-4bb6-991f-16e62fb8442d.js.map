{"version":3,"sources":["assets\\hall\\scripts\\logic\\core\\hotUpdate\\HotUpdateManager.ts"],"names":[],"mappings":";;;;;;AAAA,+CAA0C;AAG1C,6EAAwE;AAExE;IAwBI;QAvBQ,kBAAa,GAAG,gDAAgD,CAAC,CAAA,OAAO;QACxE,sBAAiB,GAAG,YAAY,CAAC,CAAA,cAAc;QAC/C,0BAAqB,GAAG,MAAM,CAAA,CAAA,QAAQ;QACtC,wBAAmB,GAAG,kBAAkB,CAAC;QACzC,wBAAmB,GAAG,kBAAkB,CAAC;QACzC,yBAAoB,GAAG,WAAW,CAAC;QAEpC,mBAAc,GAAG,EAAE,CAAC;QACpB,uBAAkB,GAAG,EAAE,CAAC;QACxB,gBAAW,GAAG,EAAE,CAAC;QAChB,gBAAW,GAAG,EAAE,CAAC;QAMlB,mBAAc,GAAG,OAAO,CAAC;QACzB,mBAAc,GAAG,EAAE,CAAC;QACnB,sBAAiB,GAAG,EAAE,CAAC,CAAC,MAAM;QAE/B,eAAU,GAAQ,IAAI,CAAC;QACvB,gBAAW,GAAG,CAAC,CAAC;QA4MtB,WAAW;QACX,mBAAc,GAAG,UAAU,QAAQ;YACjC,iCAAiC;YAChC,OAAO,IAAI,OAAO,CAAC,UAAU,OAAO,EAAE,MAAM;gBACxC,IAAI,GAAG,GAAG,EAAE,CAAC,MAAM,CAAC,iBAAiB,EAAE,CAAC;gBACxC,GAAG,CAAC,kBAAkB,GAAG;oBACrB,IAAG,GAAG,CAAC,UAAU,KAAK,CAAC,EAAC;wBACpB,IAAI,GAAG,CAAC,MAAM,IAAI,GAAG,IAAI,GAAG,CAAC,MAAM,GAAG,GAAG,EAAE;4BACvC,IAAI,OAAO,GAAG,GAAG,CAAC,YAAY,CAAC;4BAC/B,IAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;4BAClC,iDAAiD;4BAC9C,OAAO,CAAC,IAAI,CAAC,CAAC;yBACjB;6BAAI;4BACD,MAAM,EAAE,CAAA;yBACX;qBACJ;gBACL,CAAC,CAAC;gBACF,GAAG,CAAC,OAAO,GAAG,KAAK,CAAC;gBACrB,qDAAqD;gBACpD,GAAG,CAAC,IAAI,CAAC,KAAK,EAAE,QAAQ,EAAE,IAAI,CAAC,CAAC;gBAChC,GAAG,CAAC,SAAS,GAAG,cAAK,MAAM,EAAE,CAAA,CAAA,CAAC,CAAA;gBAC9B,GAAG,CAAC,IAAI,EAAE,CAAC;YACf,CAAC,CAAC,CAAA;QACN,CAAC,CAAC;QAhOE,IAAI,CAAC,YAAY,GAAG,IAAI,sBAAY,CAAC,IAAI,CAAC,iBAAiB,EAAE,IAAI,CAAC,mBAAmB,EAAE,IAAI,CAAC,mBAAmB,EAAE,IAAI,CAAC,oBAAoB,CAAC,CAAC;QAC5I,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC,yBAAyB,CAAC,MAAM,CAAC,CAAA;IACxE,CAAC;IAED,sBAAI,yCAAW;aAAf;YACI,OAAO,IAAI,CAAC,WAAW,CAAC;QAC5B,CAAC;aAED,UAAgB,GAAW;YACvB,IAAI,CAAC,WAAW,GAAG,GAAG,CAAC;QAC3B,CAAC;;;OAJA;IAMD,sBAAI,0CAAY;aAAhB;YACI,OAAO,IAAI,CAAC,aAAa,CAAC;QAC9B,CAAC;aAED,UAAiB,GAAW;YACxB,IAAI,CAAC,aAAa,GAAG,GAAG,CAAC;QAC7B,CAAC;;;OAJA;IAMD,sBAAI,8CAAgB;aAApB;YACI,OAAO,IAAI,CAAC,iBAAiB,CAAA;QACjC,CAAC;;;OAAA;IAED,sBAAI,kDAAoB;aAAxB;YACI,OAAO,IAAI,CAAC,qBAAqB,CAAC;QACtC,CAAC;;;OAAA;IAED,sBAAI,gDAAkB;aAAtB;YACI,OAAO,IAAI,CAAC,mBAAmB,CAAC;QACpC,CAAC;;;OAAA;IAED,sBAAI,gDAAkB;aAAtB;YACI,OAAO,IAAI,CAAC,mBAAmB,CAAC;QACpC,CAAC;;;OAAA;IAED,sBAAI,iDAAmB;aAAvB;YACI,OAAO,IAAI,CAAC,oBAAoB,CAAC;QACrC,CAAC;;;OAAA;IAED,8CAAmB,GAAnB,UAAoB,GAAG;QACnB,IAAI,YAAY,GAAG,IAAI,CAAC,YAAY,CAAC,YAAY,CAAC,GAAG,CAAC,CAAA;QACtD,OAAO,YAAY,CAAA;IACvB,CAAC;IAED,sBAAsB;IACtB,4CAAiB,GAAjB,UAAkB,GAAG;QACjB,IAAI,CAAC,IAAI,CAAC,mBAAmB,CAAC,GAAG,CAAC;YAC9B,OAAO,KAAK,CAAC;QACjB,IAAI,aAAa,GAAG,MAAM,CAAC,gBAAgB,CAAC,cAAc,CAAC,GAAG,CAAC,QAAQ,EAAE,CAAC,IAAI,OAAO,CAAA;QACrF,IAAI,QAAQ,GAAG,MAAM,CAAC,QAAQ,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;QAChD,IAAI,QAAQ,IAAI,IAAI;YAChB,OAAO,KAAK,CAAC;QACjB,IAAI,UAAU,GAAG,QAAQ,CAAC,OAAO,CAAC;QAClC,IAAI,UAAU,IAAI,EAAE;YAChB,OAAO,KAAK,CAAC;QACjB,OAAO,MAAM,CAAC,OAAO,CAAC,cAAc,CAAC,UAAU,EAAE,aAAa,CAAC,IAAI,CAAC,CAAA;IACxE,CAAC;IAGD;;;;;OAKG;IACH,oDAAyB,GAAzB,UAA0B,MAAM,EAAE,UAAW,EAAE,UAAe;QAAf,2BAAA,EAAA,eAAe;QAC1D,IAAI,SAAS,GAAG,IAAI,CAAC,sBAAsB,CAAC,MAAM,CAAC,GAAG,GAAG,GAAG,IAAI,CAAC,kBAAkB,CAAA;QACnF,IAAI,OAAO,GAAG,OAAO,CAAA;QACrB,IAAI,CAAC,EAAE,CAAC,GAAG,CAAC,QAAQ,EAAE;YAClB,OAAO,OAAO,CAAC;SAClB;QACD,IAAI,OAAO,GAAG,GAAG,CAAC,SAAS,CAAC,WAAW,CAAC,SAAS,CAAC,CAAA;QAClD,IAAI,OAAO,EAAE;YACT,IAAI,OAAO,GAAG,GAAG,CAAC,SAAS,CAAC,iBAAiB,CAAC,SAAS,CAAC,CAAA;YACxD,IAAI,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAA;YAClC,IAAI,QAAQ,EAAE;gBACV,IAAI,UAAU,EAAE;oBACZ,IAAI,QAAQ,CAAC,UAAU,IAAI,IAAI,IAAI,QAAQ,CAAC,UAAU,IAAI,SAAS,EAAE;wBACjE,gEAAgE;wBAChE,OAAO,QAAQ,CAAC,UAAU,CAAA;qBAC7B;iBACJ;gBACD,IAAI,QAAQ,CAAC,OAAO,IAAI,IAAI,IAAI,QAAQ,CAAC,OAAO,IAAI,SAAS,EAAE;oBAC3D,MAAM,CAAC,GAAG,CAAC,yCAAyC,GAAG,MAAM,GAAG,sBAAsB,GAAG,QAAQ,CAAC,OAAO,CAAC,CAAA;oBAC1G,OAAO,GAAG,QAAQ,CAAC,OAAO,CAAA;oBAC1B,IAAI,CAAC,4BAA4B,CAAC,MAAM,EAAE,OAAO,CAAC,CAAA;iBACrD;qBAAM;oBACH,MAAM,CAAC,GAAG,CAAC,0DAA0D,CAAC,CAAA;iBACzE;aACJ;iBAAM;gBACH,MAAM,CAAC,GAAG,CAAC,0DAA0D,CAAC,CAAA;aACzE;YACD,OAAO,OAAO,CAAA;SACjB;QACD,IAAI,YAAY,GAAG,GAAG,CAAC,SAAS,CAAC,WAAW,CAAC,UAAU,CAAC,CAAA;QACxD,IAAI,YAAY,EAAE;YACd,IAAI,OAAO,GAAG,GAAG,CAAC,SAAS,CAAC,iBAAiB,CAAC,UAAU,CAAC,CAAA;YACzD,IAAI,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAA;YAClC,IAAI,QAAQ,EAAE;gBACV,IAAI,UAAU,EAAE;oBACZ,IAAI,QAAQ,CAAC,UAAU,IAAI,IAAI,IAAI,QAAQ,CAAC,UAAU,IAAI,SAAS,EAAE;wBACjE,gEAAgE;wBAChE,OAAO,QAAQ,CAAC,UAAU,CAAA;qBAC7B;yBAAM;wBACH,OAAO,OAAO,CAAA;qBACjB;iBACJ;aACJ;SACJ;QACD,OAAO,OAAO,CAAC;IACnB,CAAC;IAED,iDAAsB,GAAtB,UAAuB,MAAM;QACzB,IAAI,QAAQ,GAAG,IAAI,CAAC,YAAY,CAAC,cAAc,CAAC,MAAM,CAAC,CAAA;QACvD,OAAO,QAAQ,CAAC;IACpB,CAAC;IAED,8CAAmB,GAAnB,UAAoB,MAAM,EAAC,IAAI,EAAC,QAAQ;QACpC,IAAI,SAAS,GAAG,IAAI,GAAG,GAAG,GAAC,QAAQ,CAAA;QACnC,IAAI,OAAO,GAAG,OAAO,CAAA;QACrB,IAAI,CAAC,EAAE,CAAC,GAAG,CAAC,QAAQ,EAAE;YAClB,OAAO,OAAO,CAAC;SAClB;QACD,MAAM,CAAC,KAAK,CAAC,2CAA2C,EAAC,IAAI,CAAC,CAAA;QAC9D,IAAI,OAAO,GAAG,GAAG,CAAC,SAAS,CAAC,WAAW,CAAC,SAAS,CAAC,CAAA;QAClD,IAAI,OAAO,EAAE;YACT,IAAI,OAAO,GAAG,GAAG,CAAC,SAAS,CAAC,iBAAiB,CAAC,SAAS,CAAC,CAAA;YACxD,IAAI,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAA;YAClC,IAAI,QAAQ,EAAE;gBACV,IAAI,QAAQ,CAAC,OAAO,IAAI,IAAI,IAAI,QAAQ,CAAC,OAAO,IAAI,SAAS,EAAE;oBAC3D,MAAM,CAAC,GAAG,CAAC,mCAAmC,GAAG,MAAM,GAAG,sBAAsB,GAAG,QAAQ,CAAC,OAAO,CAAC,CAAA;oBACpG,OAAO,GAAG,QAAQ,CAAC,OAAO,CAAA;oBAC1B,oDAAoD;iBACvD;qBAAM;oBACH,MAAM,CAAC,GAAG,CAAC,oDAAoD,CAAC,CAAA;iBACnE;aACJ;iBAAM;gBACH,MAAM,CAAC,GAAG,CAAC,oDAAoD,CAAC,CAAA;aACnE;SACJ;QACD,OAAO,OAAO,CAAC;IACnB,CAAC;IAED,0CAAe,GAAf,UAAgB,MAAM,EAAC,UAAU,EAAC,UAAU;QAGxC,IAAI,SAAS,GAAG,IAAI,CAAC,sBAAsB,CAAC,MAAM,CAAC,GAAI,GAAG,GAAE,UAAU,GAAG,WAAW,CAAA;QACpF,IAAI,OAAO,GAAG,OAAO,CAAA;QACrB,IAAI,CAAC,EAAE,CAAC,GAAG,CAAC,QAAQ,EAAE;YAClB,OAAO,OAAO,CAAC;SAClB;QACD,IAAI,OAAO,GAAG,GAAG,CAAC,SAAS,CAAC,WAAW,CAAC,SAAS,CAAC,CAAA;QAClD,IAAI,OAAO,EAAE;YACT,IAAI,OAAO,GAAG,GAAG,CAAC,SAAS,CAAC,iBAAiB,CAAC,SAAS,CAAC,CAAA;YACxD,IAAI,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAA;YAClC,IAAI,QAAQ,EAAE;gBACV,IAAI,QAAQ,CAAC,UAAU,CAAC,IAAI,IAAI,IAAI,QAAQ,CAAC,UAAU,CAAC,IAAI,SAAS,IAAI,QAAQ,CAAC,UAAU,CAAC,CAAC,SAAS,CAAC,IAAI,IAAI,IAAI,QAAQ,CAAC,UAAU,CAAC,CAAC,SAAS,CAAC,IAAI,SAAS,EAAE;oBAC9J,MAAM,CAAC,GAAG,CAAC,yCAAyC,GAAG,MAAM,GAAG,sBAAsB,GAAG,QAAQ,CAAC,UAAU,CAAC,CAAC,SAAS,CAAC,CAAC,CAAA;oBACzH,OAAO,GAAG,QAAQ,CAAC,UAAU,CAAC,CAAC,SAAS,CAAC,CAAA;oBACzC,uDAAuD;iBAC1D;qBAAM;oBACH,MAAM,CAAC,GAAG,CAAC,0DAA0D,CAAC,CAAA;iBACzE;aACJ;iBAAM;gBACH,MAAM,CAAC,GAAG,CAAC,0DAA0D,CAAC,CAAA;aACzE;SACJ;QACD,OAAO,OAAO,CAAC;IACnB,CAAC;IAGD,gDAAqB,GAArB,UAAsB,MAAM,EAAC,UAAU,EAAC,UAAU,EAAC,YAAY;QAE3D,IAAI,GAAG,GAAG,EAAE,CAAA;QACZ,IAAI,SAAS,GAAG,IAAI,CAAC,sBAAsB,CAAC,MAAM,CAAC,GAAI,GAAG,GAAE,UAAU,GAAG,WAAW,CAAA;QACpF,YAAY,GAAG,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC,YAAY,CAAC,CAAA;QACrD,iDAAiD;QACjD,IAAI,CAAC,EAAE,CAAC,GAAG,CAAC,QAAQ,EAAE;YAClB,OAAO,GAAG,CAAC;SACd;QACD,IAAI,OAAO,GAAG,GAAG,CAAC,SAAS,CAAC,WAAW,CAAC,SAAS,CAAC,CAAA;QAClD,IAAI,OAAO,EAAE;YACT,IAAI,OAAO,GAAG,GAAG,CAAC,SAAS,CAAC,iBAAiB,CAAC,SAAS,CAAC,CAAA;YACxD,IAAI,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAA;YAClC,IAAI,QAAQ,EAAE;gBACV,MAAM,CAAC,KAAK,CAAC,sBAAsB,EAAC,UAAU,CAAC,CAAA;gBAC/C,IAAI,QAAQ,CAAC,UAAU,CAAC,IAAI,IAAI,IAAI,QAAQ,CAAC,UAAU,CAAC,IAAI,SAAS,IAAI,QAAQ,CAAC,UAAU,CAAC,CAAC,MAAM,CAAC,IAAI,IAAI,IAAI,QAAQ,CAAC,UAAU,CAAC,CAAC,MAAM,CAAC,IAAI,SAAS,EAAE;oBACxJ,MAAM,CAAC,GAAG,CAAC,4BAA4B,GAAG,MAAM,GAAG,mBAAmB,GAAG,QAAQ,CAAC,UAAU,CAAC,CAAC,MAAM,CAAC,CAAC,CAAA;oBACtG,GAAG,GAAG,YAAY,GAAC,QAAQ,CAAC,UAAU,CAAC,CAAC,MAAM,CAAC,GAAE,GAAG,GAAE,QAAQ,CAAC,UAAU,CAAC,CAAC,SAAS,CAAC,CAAA;oBACrF,IAAI,CAAC,4BAA4B,CAAC,MAAM,EAAE,UAAU,CAAC,CAAA;iBACxD;qBAAM;oBACH,MAAM,CAAC,GAAG,CAAC,+DAA+D,CAAC,CAAA;iBAC9E;aACJ;iBAAM;gBACH,MAAM,CAAC,GAAG,CAAC,+DAA+D,CAAC,CAAA;aAC9E;SACJ;QACD,6DAA6D;QAC7D,OAAO,GAAG,CAAC;IACf,CAAC;IAyBD;;;;;;;;OAQG;IACH,yCAAc,GAAd,UAAe,YAAoB,EAAE,OAAc;QAC/C,IAAI,gBAAgB,GAAG,MAAM,CAAC,gBAAgB,CAAC;QAC/C,IAAI,YAAY,IAAI,IAAI,IAAI,YAAY,IAAI,SAAS,IAAI,YAAY,IAAI,EAAE,EAAE;YACzE,YAAY,GAAG,gBAAgB,CAAC,YAAY,CAAA;SAC/C;QACD,YAAY,GAAG,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC,YAAY,CAAC,CAAA;QACrD,IAAI,UAAU,GAAG,EAAE,CAAA;QACnB,IAAI,YAAY,GAAG,OAAO,CAAC;QAE3B,IAAI,aAAa,GAAG,OAAO,GAAE,GAAG,GAAE,IAAI,CAAC,kBAAkB,CAAA;QACzD,IAAI,qBAAqB,GAAG,GAAG,CAAC,SAAS,CAAC,WAAW,CAAC,aAAa,CAAC,CAAA;QAEpE,4DAA4D;QAC5D,IAAI,qBAAqB,EAAE;YACvB,IAAI,OAAO,GAAG,GAAG,CAAC,SAAS,CAAC,iBAAiB,CAAC,aAAa,CAAC,CAAA,CAAC,WAAW;YACxE,IAAI,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAA;YAClC,IAAI,QAAQ,CAAC,MAAM,IAAI,QAAQ,CAAC,GAAG,EAAE;gBACjC,UAAU,GAAG,QAAQ,CAAC,MAAM,CAAA;aAC/B;YACD,IAAG,QAAQ,CAAC,MAAM,EAAC;gBACf,YAAY,GAAG,QAAQ,CAAC,OAAO,CAAA;aAClC;SACJ;QACF,uDAAuD;QACtD,gEAAgE;QAChE,IAAI,oBAAoB,GAAG;YACvB,YAAY,EAAE,YAAY;YAC1B,mBAAmB,EAAE,YAAY,GAAG,IAAI,CAAC,kBAAkB;YAC3D,kBAAkB,EAAE,YAAY,GAAI,IAAI,CAAC,kBAAkB;YAC3D,SAAS,EAAE,YAAY;YACvB,QAAQ,EAAE,UAAU;YACpB,aAAa,EAAE,EAAE;SACpB,CAAA;QACH,qEAAqE;QAEnE,OAAO,oBAAoB,CAAA;IAE/B,CAAC;IAED,yCAAc,GAAd,UAAe,GAAG,EAAC,KAAK,EAAC,OAAO,EAAC,QAAQ;QAErC,IAAI,YAAY,GAAG,IAAI,CAAC,YAAY,CAAC,cAAc,CAAC,OAAO,CAAC,GAAG,GAAG,GAAE,QAAQ,CAAA;QAC5E,IAAG,CAAC,GAAG,CAAC,SAAS,CAAC,WAAW,CAAC,YAAY,CAAC,EAC3C;YACI,MAAM,CAAC,KAAK,CAAC,OAAO,EAAE,YAAY,CAAC,CAAC;YACpC,OAAO;SACV;QACD,IAAI,OAAO,GAAG,GAAG,CAAC,SAAS,CAAC,iBAAiB,CAAC,YAAY,CAAC,CAAC;QAC5D,IAAI,WAAW,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;QACtC,IAAI,KAAK,GAAG,WAAW,CAAC,iBAAiB,CAAC,OAAO,CAAC,KAAK,CAAC,CAAA;QACxD,IAAG,KAAK,IAAI,CAAC,CAAC,EACd;YACI,WAAW,CAAC,iBAAiB,GAAG,GAAG,GAAG,WAAW,CAAC,iBAAiB,CAAC,SAAS,CAAC,KAAK,GAAE,CAAC,EAAC,WAAW,CAAC,iBAAiB,CAAC,MAAM,CAAC,CAAA;YAC5H,WAAW,CAAC,UAAU,GAAG,GAAG,GAAG,WAAW,CAAC,UAAU,CAAC,SAAS,CAAC,KAAK,GAAE,CAAC,EAAC,WAAW,CAAC,iBAAiB,CAAC,MAAM,CAAC,CAAC;YAC/G,WAAW,CAAC,gBAAgB,GAAG,GAAG,GAAG,WAAW,CAAC,gBAAgB,CAAC,SAAS,CAAC,KAAK,GAAE,CAAC,EAAC,WAAW,CAAC,iBAAiB,CAAC,MAAM,CAAC,CAAA;SAC7H;QACD,IAAI,aAAa,GAAG,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC;QAChD,GAAG,CAAC,SAAS,CAAC,iBAAiB,CAAC,aAAa,EAAE,YAAY,CAAC,CAAC;IAEjE,CAAC;IAED,uDAA4B,GAA5B,UAA6B,MAAM,EAAE,OAAO;QACxC,IAAI,IAAI,CAAC,cAAc,EAAE;YACrB,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,GAAG,OAAO,CAAC;SACzC;QACD,IAAI,QAAQ,GAAG,MAAM,CAAC,QAAQ,CAAC,WAAW,CAAC,MAAM,CAAC,CAAA;QAClD,IAAI,QAAQ,EAAE;YACV,QAAQ,CAAC,cAAc,GAAG,OAAO,CAAC;SACrC;IAEL,CAAC;IAGD,kDAAuB,GAAvB,UAAwB,MAAM,EAAC,UAAU;QAErC,IAAG,CAAC,UAAU;YAAE,OAAM;QACvB,OAAO,MAAM,CAAC,gBAAgB,CAAC,sBAAsB,CAAC,MAAM,CAAC,GAAI,GAAG,GAAE,UAAU,GAAG,WAAW,CAAA;IACjG,CAAC;IAED,QAAQ;IACR,mDAAwB,GAAxB,UAAyB,MAAM;QAC3B,IAAI,QAAQ,GAAG,IAAI,CAAC,sBAAsB,CAAC,MAAM,CAAC,CAAA;QAClD,GAAG,CAAC,SAAS,CAAC,eAAe,CAAC,QAAQ,CAAC,CAAA;QACvC,IAAI,MAAM,IAAI,MAAM,EAAC;YACjB,MAAM,CAAC,WAAW,CAAC,gBAAgB,EAAE,CAAC;SACzC;IACL,CAAC;IAED;;;;;;;;;OASG;IACH,+CAAoB,GAApB,UAAqB,MAAM,EAAE,WAAW,EAAE,aAAa,EAAC,SAAS,EAAC,QAAgB;QAAhB,yBAAA,EAAA,gBAAgB;QAC9E,IAAI,kBAAkB,GAAG,IAAI,gCAAsB,EAAE,CAAC;QACtD,kBAAkB,CAAC,eAAe,CAAC,MAAM,EAAE,WAAW,EAAE,aAAa,EAAC,SAAS,CAAC,CAAA;QAChF,IAAI,QAAQ,GAAG,IAAI,CAAC,aAAa,EAAE,CAAA;QACnC,IAAI,WAAW,GAAG,IAAI,CAAC,QAAQ,EAAE,CAAA;QACjC,IAAG,QAAQ,IAAI,CAAC,QAAQ,EAAE,gBAAgB;SAC1C;YACI,IAAG,WAAW,IAAI,CAAC,CAAC,EACpB;gBACI,IAAG,IAAI,CAAC,kBAAkB,EAAE,EAC5B;oBACI,IAAI,CAAC,iBAAiB,CAAC,MAAM,CAAC,CAAC,EAAC,CAAC,EAAC,kBAAkB,CAAC,CAAA;iBACxD;qBAED;oBACI,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,kBAAkB,CAAC,CAAA;iBACrD;aACJ;iBAED;gBACI,IAAI,CAAC,iBAAiB,CAAC,MAAM,CAAC,WAAW,GAAC,CAAC,EAAC,CAAC,EAAC,kBAAkB,CAAC,CAAA;aAEpE;SACJ;aAED;YACI,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAA;SAClD;QACD,IAAI,CAAC,IAAI,CAAC,kBAAkB,EAAE,EAAE;YAC5B,IAAI,CAAC,kBAAkB,EAAE,CAAA;SAC5B;IACL,CAAC;IACD,QAAQ;IACR,yCAAc,GAAd,UAAe,MAAM;QACjB,IAAI,iBAAiB,GAAG,IAAI,CAAC,oBAAoB,CAAC,MAAM,CAAC,CAAC;QAC1D,IAAI,CAAC,iBAAiB,CAAC,MAAM,CAAC,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,iBAAiB,CAAC,EAAC,CAAC,CAAC,CAAC;IACvF,CAAC;IAED;;OAEG;IACH,mCAAQ,GAAR;QAEI,IAAI,KAAK,GAAG,CAAC,CAAC,CAAC;QACf,IAAI,OAAO,GAAG,MAAM,CAAC,QAAQ,CAAC,YAAY,CAAA;QAC1C,KAAK,IAAI,CAAC,GAAG,IAAI,CAAC,iBAAiB,CAAC,MAAM,GAAC,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE;YACvD,IAAI,kBAAkB,GAAG,IAAI,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAA;YAClD,IAAI,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,kBAAkB,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,CAAC,EAAE;gBAC7D,OAAO,CAAC,CAAC;aACZ;SACJ;QACD,OAAO,KAAK,CAAA;IAChB,CAAC;IAED;;OAEG;IACH,wCAAa,GAAb;QAEI,IAAI,OAAO,GAAG,MAAM,CAAC,QAAQ,CAAC,YAAY,CAAA;QAC1C,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,iBAAiB,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YACpD,IAAI,kBAAkB,GAAG,IAAI,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAA;YAElD,IAAI,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,kBAAkB,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,CAAC,EAAE;gBAC7D,OAAO,IAAI,CAAC;aACf;SACJ;QACD,OAAO,KAAK,CAAA;IAChB,CAAC;IAGD,QAAQ;IACR,6CAAkB,GAAlB;QACI,IAAI,IAAI,CAAC,iBAAiB,EAAE;YACxB,IAAI,kBAAkB,GAAG,IAAI,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAA;YAClD,IAAI,kBAAkB,EAAE;gBACpB,kBAAkB,CAAC,kBAAkB,EAAE,CAAC;aAC3C;SACJ;IACL,CAAC;IAED,QAAQ;IACR,+CAAoB,GAApB,UAAqB,MAAM;QACvB,IAAI,QAAQ,GAAG,IAAI,CAAC;QACpB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,iBAAiB,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YACpD,IAAI,kBAAkB,GAAG,IAAI,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAA;YAClD,IAAI,kBAAkB,CAAC,SAAS,KAAK,MAAM,EAAE;gBACzC,QAAQ,GAAG,kBAAkB,CAAC;gBAC9B,MAAM;aACT;SACJ;QACD,OAAO,QAAQ,CAAC;IACpB,CAAC;IAED,YAAY;IACZ,6CAAkB,GAAlB;QACI,IAAI,SAAS,GAAG,KAAK,CAAA;QACrB,IAAI,IAAI,CAAC,iBAAiB,EAAE;YACxB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,iBAAiB,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;gBACpD,IAAI,kBAAkB,GAAG,IAAI,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAA;gBAClD,IAAI,kBAAkB,CAAC,SAAS,EAAE;oBAC9B,SAAS,GAAG,IAAI,CAAC;oBACjB,MAAM;iBACT;aACJ;SACJ;QACD,OAAO,SAAS,CAAC;IACrB,CAAC;IAED,cAAc;IACd,gDAAqB,GAArB;QACI,IAAI,GAAG,GAAG,IAAI,CAAC;QACf,IAAI,IAAI,CAAC,iBAAiB,EAAE;YACxB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,iBAAiB,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;gBACpD,IAAI,kBAAkB,GAAG,IAAI,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAA;gBAClD,IAAI,kBAAkB,CAAC,SAAS,EAAE;oBAC9B,GAAG,GAAG,kBAAkB,CAAC,SAAS,CAAC;oBACnC,MAAM;iBACT;aACJ;SACJ;QACD,OAAO,GAAG,CAAC;IACf,CAAC;IAED,QAAQ;IACR,kDAAuB,GAAvB,UAAwB,MAAM,EAAE,UAA2B;QAA3B,2BAAA,EAAA,kBAA2B;QACvD,IAAI,IAAI,CAAC,iBAAiB,EAAE;YACxB,IAAI,KAAK,GAAG,CAAC,CAAC,CAAC;YACf,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,iBAAiB,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;gBACpD,IAAI,kBAAkB,GAAG,IAAI,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAA;gBAClD,IAAI,kBAAkB,CAAC,SAAS,KAAK,MAAM,EAAE;oBACzC,KAAK,GAAG,CAAC,CAAC;oBACV,MAAM;iBACT;aACJ;YACD,IAAI,KAAK,IAAI,CAAC,CAAC,EAAE;gBACb,IAAI,IAAI,GAAG,IAAI,CAAC,iBAAiB,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAA;gBAClD,IAAI,GAAG,IAAI,CAAC;aACf;YACD,IAAI,UAAU,EAAE;gBACZ,IAAI,CAAC,kBAAkB,EAAE,CAAC;aAC7B;SACJ;IACL,CAAC;IAGD,4CAAiB,GAAjB,UAAkB,MAAc,EAAE,OAAe,EAAE,YAAoB,EAAE,sBAA+B,EAAE,MAAU;QAAV,uBAAA,EAAA,UAAU;QAChH,IAAI,gBAAgB,GAAG,MAAM,CAAC,gBAAgB,CAAC;QAC/C,IAAI,YAAY,IAAI,IAAI,IAAI,YAAY,IAAI,SAAS,IAAI,YAAY,IAAI,EAAE,EAAE;YACzE,YAAY,GAAG,gBAAgB,CAAC,YAAY,CAAA;SAC/C;QACD,IAAI,cAAc,GAAG,sBAAsB,CAAA;QAC3C,IAAI,CAAC,cAAc,EAAE;YACjB,cAAc,GAAG,IAAI,CAAC,sBAAsB,CAAC,MAAM,CAAC,GAAG,GAAG,GAAG,IAAI,CAAC,kBAAkB,CAAA;SACvF;aAAM;YACH,IAAI,aAAa,GAAG,IAAI,CAAC,sBAAsB,CAAC,MAAM,CAAC,GAAG,GAAG,GAAG,IAAI,CAAC,kBAAkB,CAAA;YACvF,IAAI,qBAAqB,GAAG,GAAG,CAAC,SAAS,CAAC,WAAW,CAAC,aAAa,CAAC,CAAA;YACpE,IAAI,gBAAgB,GAAG,GAAG,CAAC,SAAS,CAAC,WAAW,CAAC,cAAc,CAAC,CAAA;YAChE,IAAI,iBAAiB,GAAG,OAAO,CAAA;YAC/B,IAAI,oBAAoB,GAAG,OAAO,CAAA;YAElC,IAAI,qBAAqB,EAAE;gBACvB,IAAI,OAAO,GAAG,GAAG,CAAC,SAAS,CAAC,iBAAiB,CAAC,aAAa,CAAC,CAAA;gBAC5D,IAAI,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAA;gBAClC,IAAI,QAAQ,CAAC,OAAO,EAAE;oBAClB,oBAAoB,GAAG,QAAQ,CAAC,OAAO,CAAA;iBAC1C;aACJ;YACD,IAAI,gBAAgB,EAAE;gBAClB,IAAI,OAAO,GAAG,GAAG,CAAC,SAAS,CAAC,iBAAiB,CAAC,cAAc,CAAC,CAAA;gBAC7D,IAAI,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAA;gBAClC,IAAI,QAAQ,CAAC,OAAO,EAAE;oBAClB,iBAAiB,GAAG,QAAQ,CAAC,OAAO,CAAA;iBACvC;aACJ;YACD,IAAI,MAAM,CAAC,OAAO,CAAC,cAAc,CAAC,oBAAoB,EAAE,iBAAiB,CAAC,GAAG,CAAC,EAAE;gBAC5E,cAAc,GAAG,aAAa,CAAA;aACjC;SACJ;QACD,YAAY,GAAG,YAAY,GAAG,GAAG,GAAG,MAAM,GAAG,GAAG,GAAG,OAAO,CAAA;QAC1D,iEAAiE;QACjE,IAAI,oBAAoB,GAAG;YACvB,YAAY,EAAE,YAAY;YAC1B,mBAAmB,EAAE,YAAY,GAAG,GAAG,GAAG,gBAAgB,CAAC,kBAAkB;YAC7E,kBAAkB,EAAE,YAAY,GAAG,GAAG,GAAG,gBAAgB,CAAC,kBAAkB;YAC5E,SAAS,EAAE,OAAO;YAClB,QAAQ,EAAE,EAAE;YACZ,aAAa,EAAE,EAAE;SACpB,CAAA;QAED,IAAI,OAAO,GAAG,GAAG,CAAC,SAAS,CAAC,WAAW,CAAC,cAAc,CAAC,CAAA;QACvD,IAAI,OAAO,EAAE;YACT,IAAI,OAAO,GAAG,GAAG,CAAC,SAAS,CAAC,iBAAiB,CAAC,cAAc,CAAC,CAAA;YAC7D,IAAI,OAAO,EAAE;gBACT,0CAA0C;gBAC1C,IAAI,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAA;gBAClC,IAAI,WAAW,GAAG,IAAI,CAAC;gBACvB,MAAM;gBACN,IAAI,MAAM,KAAK,CAAC,EAAE;oBACd,IAAI,MAAM,CAAC,OAAO,CAAC,cAAc,CAAC,QAAQ,CAAC,OAAO,EAAE,OAAO,CAAC,GAAG,CAAC,EAAE;wBAC9D,MAAM,CAAC,GAAG,CAAC,iBAAiB,GAAE,MAAM,CAAC,CAAA;wBACrC,QAAQ;wBACR,IAAI,OAAO,GAAG,IAAI,CAAC,sBAAsB,CAAC,MAAM,CAAC,CAAA;wBACjD,IAAI,GAAG,CAAC,SAAS,CAAC,WAAW,CAAC,OAAO,CAAC,EAAE;4BACpC,GAAG,CAAC,SAAS,CAAC,eAAe,CAAC,OAAO,CAAC,CAAA;4BACtC,IAAI,MAAM,IAAI,MAAM,EAAC;gCACjB,MAAM,CAAC,WAAW,CAAC,gBAAgB,EAAE,CAAC;6BACzC;yBACJ;wBACD,WAAW,GAAG,KAAK,CAAC;qBACvB;iBACJ;gBAED,IAAI,WAAW,IAAI,QAAQ,CAAC,UAAU,EAAE;oBACpC,2DAA2D;oBAC3D,IAAI,QAAQ,CAAC,UAAU,IAAI,YAAY,EAAE;wBACrC,MAAM;wBACN,oBAAoB,CAAC,UAAU,GAAG,YAAY,CAAA;wBAC9C,oBAAoB,CAAC,iBAAiB,GAAG,YAAY,GAAG,GAAG,GAAG,gBAAgB,CAAC,kBAAkB,CAAA;wBACjG,oBAAoB,CAAC,gBAAgB,GAAG,YAAY,GAAG,GAAG,GAAG,gBAAgB,CAAC,kBAAkB,CAAA;wBAChG,oBAAoB,CAAC,OAAO,GAAG,QAAQ,CAAC,OAAO,CAAC;wBAChD,oBAAoB,CAAC,MAAM,GAAG,QAAQ,CAAC,MAAM,CAAC;wBAC9C,oBAAoB,CAAC,WAAW,GAAG,QAAQ,CAAC,WAAW,CAAC;qBAC3D;yBAAM;wBACH,oBAAoB,GAAG,QAAQ,CAAA;qBAClC;iBACJ;aACJ;SACJ;aAAM;YACH,MAAM,CAAC,GAAG,CAAC,gBAAgB,CAAC,CAAA;YAC5B,oBAAoB,CAAC,UAAU,GAAG,YAAY,CAAA;YAC9C,oBAAoB,CAAC,iBAAiB,GAAG,YAAY,GAAG,GAAG,GAAG,gBAAgB,CAAC,kBAAkB,CAAA;YACjG,oBAAoB,CAAC,gBAAgB,GAAG,YAAY,GAAG,GAAG,GAAG,gBAAgB,CAAC,kBAAkB,CAAA;SACnG;QACD,OAAO,oBAAoB,CAAA;IAE/B,CAAC;IAED,kCAAO,GAAP;IAEA,CAAC;IACD,oCAAS,GAAT;IAEA,CAAC;IAGL,uBAAC;AAAD,CA3lBA,AA2lBC,IAAA","file":"","sourceRoot":"/","sourcesContent":["import UpdateHelper from \"./UpdateHelper\";\r\nimport CCLoaderHelper from \"./CCLoaderHelper\";\r\nimport PBHelper from \"./PBHelper\";\r\nimport GameHotUpdateComponent from \"./component/GameHotUpdateComponent\";\r\n\r\nexport default class HotUpdateManager {\r\n    private _hotUpdateUrl = \"https://intest.03866.com/client/cocosHotUpdate\";//热更新地址\r\n    private _hotUpdateDirName = \"gameUpdate\";//native 热更新目录\r\n    private _hallHotUpdateDirName = \"hall\"//大厅热更目录\r\n    private _projectCfgFileName = \"project.manifest\";\r\n    private _versionCfgFileName = \"version.manifest\";\r\n    private _hotUpdateStorageKey = \"download_\";\r\n\r\n    public nativeVersions = {};\r\n    public gIsGameDownloading = {};\r\n    public gameChecked = {};\r\n    private currentGame = \"\";\r\n\r\n    public updateHelper: UpdateHelper;\r\n    public ccLoaderHelper: CCLoaderHelper;\r\n    public pbHelper: PBHelper;\r\n\r\n    public hallNewVersion = \"0.0.0\";\r\n    public hallUpdatePath = \"\";\r\n    private gameHotUpdateList = []; //下载队列\r\n\r\n    public hotFailRes: any = null;\r\n    public hotFaildNum = 0;\r\n\r\n    constructor() {\r\n        this.updateHelper = new UpdateHelper(this._hotUpdateDirName, this._projectCfgFileName, this._versionCfgFileName, this._hotUpdateStorageKey);\r\n        this.nativeVersions[\"hall\"] = this.getNativeHotUpdateVersion(\"hall\")\r\n    }\r\n\r\n    get CurrentGame() {\r\n        return this.currentGame;\r\n    }\r\n\r\n    set CurrentGame(gid: string) {\r\n        this.currentGame = gid;\r\n    }\r\n\r\n    get hotUpdateUrl() {\r\n        return this._hotUpdateUrl;\r\n    }\r\n\r\n    set hotUpdateUrl(url: string) {\r\n        this._hotUpdateUrl = url;\r\n    }\r\n\r\n    get hotUpdateDirName() {\r\n        return this._hotUpdateDirName\r\n    }\r\n\r\n    get hallHotUpdateDirName() {\r\n        return this._hallHotUpdateDirName;\r\n    }\r\n\r\n    get projectCfgFileName() {\r\n        return this._projectCfgFileName;\r\n    }\r\n\r\n    get versionCfgFileName() {\r\n        return this._versionCfgFileName;\r\n    }\r\n\r\n    get hotUpdateStorageKey() {\r\n        return this._hotUpdateStorageKey;\r\n    }\r\n\r\n    checkIsGameDownload(gid) {\r\n        let isDownloaded = this.updateHelper.isDownloaded(gid)\r\n        return isDownloaded\r\n    }\r\n\r\n    //检查游戏是否是最新   是否可以直接进入\r\n    checkIsGameNewest(gid) {\r\n        if (!this.checkIsGameDownload(gid))\r\n            return false;\r\n        let nativeVersion = Global.HotUpdateManager.nativeVersions[gid.toString()] || \"0.0.0\"\r\n        let gameData = Global.GameData.getGameInfo(gid);\r\n        if (gameData == null)\r\n            return false;\r\n        let newVersion = gameData.version;\r\n        if (newVersion == \"\")\r\n            return false;\r\n        return Global.Toolkit.versionCompare(newVersion, nativeVersion) <= 0\r\n    }\r\n\r\n\r\n    /**\r\n     * \r\n     * @param gameid \r\n     * @param cfgVersion 是否获取cfgVersion cfgversion为后台配置的总版本号，该版本号不是实际的版本号任一子版本修改都将导致该版本号修改，\r\n     * 此版本号checkversion将传给服务器，用于依赖版本判断\r\n     */\r\n    getNativeHotUpdateVersion(gameid, cfgVersion?, projectUrl = \"\") {\r\n        let nativeUrl = this.getNativeHotUpdatePath(gameid) + \"/\" + this.projectCfgFileName\r\n        let version = \"0.0.0\"\r\n        if (!cc.sys.isNative) {\r\n            return version;\r\n        }\r\n        let isExist = jsb.fileUtils.isFileExist(nativeUrl)\r\n        if (isExist) {\r\n            let jsonStr = jsb.fileUtils.getStringFromFile(nativeUrl)\r\n            let jsonData = JSON.parse(jsonStr)\r\n            if (jsonData) {\r\n                if (cfgVersion) {\r\n                    if (jsonData.cfgVersion != null && jsonData.cfgVersion != undefined) {\r\n                        //this.updateNativeHotUpdateVersion(gameid, jsonData.cfgVersion)\r\n                        return jsonData.cfgVersion\r\n                    }\r\n                }\r\n                if (jsonData.version != null && jsonData.version != undefined) {\r\n                    Logger.log(\"getNativeHotUpdateVersion ---- gameid  \" + gameid + \" jsonData.version = \" + jsonData.version)\r\n                    version = jsonData.version\r\n                    this.updateNativeHotUpdateVersion(gameid, version)\r\n                } else {\r\n                    Logger.log(\"getNativeHotUpdateVersion ----jsonData.version = null 2 \")\r\n                }\r\n            } else {\r\n                Logger.log(\"getNativeHotUpdateVersion ----jsonData.version = null 1 \")\r\n            }\r\n            return version\r\n        }\r\n        let projectExist = jsb.fileUtils.isFileExist(projectUrl)\r\n        if (projectExist) {\r\n            let jsonStr = jsb.fileUtils.getStringFromFile(projectUrl)\r\n            let jsonData = JSON.parse(jsonStr)\r\n            if (jsonData) {\r\n                if (cfgVersion) {\r\n                    if (jsonData.cfgVersion != null && jsonData.cfgVersion != undefined) {\r\n                        //this.updateNativeHotUpdateVersion(gameid, jsonData.cfgVersion)\r\n                        return jsonData.cfgVersion\r\n                    } else {\r\n                        return \"0.0.0\"\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return version;\r\n    }\r\n    \r\n    getNativeHotUpdatePath(gameid) {\r\n        let gamePath = this.updateHelper.genStoragePath(gameid)\r\n        return gamePath;\r\n    }\r\n\r\n    getHotUpdateVersion(gameid,path,fileName) {\r\n        let nativeUrl = path + \"/\"+fileName\r\n        let version = \"0.0.0\"\r\n        if (!cc.sys.isNative) {\r\n            return version;\r\n        }\r\n        Logger.error(\"getHotUpdateVersion--path================\",path)\r\n        let isExist = jsb.fileUtils.isFileExist(nativeUrl)\r\n        if (isExist) {\r\n            let jsonStr = jsb.fileUtils.getStringFromFile(nativeUrl)\r\n            let jsonData = JSON.parse(jsonStr)\r\n            if (jsonData) {\r\n                if (jsonData.version != null && jsonData.version != undefined) {\r\n                    Logger.log(\"getHotUpdateVersion ---- gameid  \" + gameid + \" jsonData.version = \" + jsonData.version)\r\n                    version = jsonData.version\r\n                    //this.updateNativeHotUpdateVersion(gameid, version)\r\n                } else {\r\n                    Logger.log(\"getHotUpdateVersion ----jsonData.version = null 2 \")\r\n                }\r\n            } else {\r\n                Logger.log(\"getHotUpdateVersion ----jsonData.version = null 1 \")\r\n            }\r\n        }\r\n        return version;\r\n    }\r\n\r\n    getRemoteVesion(gameid,bundleName,newVersion)\r\n    {\r\n        \r\n        let nativeUrl = this.getNativeHotUpdatePath(gameid)  + \"/\"+ newVersion + \".manifest\"\r\n        let version = \"0.0.0\"\r\n        if (!cc.sys.isNative) {\r\n            return version;\r\n        }\r\n        let isExist = jsb.fileUtils.isFileExist(nativeUrl)\r\n        if (isExist) {\r\n            let jsonStr = jsb.fileUtils.getStringFromFile(nativeUrl)\r\n            let jsonData = JSON.parse(jsonStr)\r\n            if (jsonData) {\r\n                if (jsonData[bundleName] != null && jsonData[bundleName] != undefined && jsonData[bundleName][\"version\"] != null && jsonData[bundleName][\"version\"] != undefined) {\r\n                    Logger.log(\"getRemoteHotUpdateVersion ---- gameid  \" + gameid + \" jsonData.version = \" + jsonData[bundleName][\"version\"])\r\n                    version = jsonData[bundleName][\"version\"]\r\n                    //this.updateNativeHotUpdateVersion(gameid, newVersion)\r\n                } else {\r\n                    Logger.log(\"getRemoteHotUpdateVersion ----jsonData.version = null 2 \")\r\n                }\r\n            } else {\r\n                Logger.log(\"getRemoteHotUpdateVersion ----jsonData.version = null 1 \")\r\n            }\r\n        }\r\n        return version;\r\n    }\r\n\r\n\r\n    getRemoteHotUpdateUrl(gameid,bundleName,newVersion,hotUpdateUrl)\r\n    {\r\n        let url = \"\"\r\n        let nativeUrl = this.getNativeHotUpdatePath(gameid)  + \"/\"+ newVersion + \".manifest\"\r\n        hotUpdateUrl = Global.Toolkit.adjustUrl(hotUpdateUrl)\r\n        //Logger.error(\"nativeUrl============\",nativeUrl)\r\n        if (!cc.sys.isNative) {\r\n            return url;\r\n        }\r\n        let isExist = jsb.fileUtils.isFileExist(nativeUrl)\r\n        if (isExist) {\r\n            let jsonStr = jsb.fileUtils.getStringFromFile(nativeUrl)\r\n            let jsonData = JSON.parse(jsonStr)\r\n            if (jsonData) {\r\n                Logger.error(\"bundleName----------\",bundleName)\r\n                if (jsonData[bundleName] != null && jsonData[bundleName] != undefined && jsonData[bundleName][\"path\"] != null && jsonData[bundleName][\"path\"] != undefined) {\r\n                    Logger.log(\"getRemoteUrl ---- gameid  \" + gameid + \" jsonData.path = \" + jsonData[bundleName][\"path\"])\r\n                    url = hotUpdateUrl+jsonData[bundleName][\"path\"] +\"/\"+ jsonData[bundleName][\"version\"]\r\n                    this.updateNativeHotUpdateVersion(gameid, newVersion)\r\n                } else {\r\n                    Logger.log(\"getRemoteHotUpdateUrl ----jsonData[bundleName][path = null 2 \")\r\n                }\r\n            } else {\r\n                Logger.log(\"getRemoteHotUpdateUrl ----jsonData[bundleName][path = null 1 \")\r\n            }\r\n        }\r\n        //Logger.error(\"getRemoteHotUpdateUrl==================\",url)\r\n        return url;\r\n    }\r\n     //获取远程当前版本号\r\n     getGameVersion = function (wholeurl) {\r\n       // console.log(\"getGameVersion\");\r\n        return new Promise(function (resolve, reject) {\r\n            let xhr = cc.loader.getXMLHttpRequest();\r\n            xhr.onreadystatechange = () => {\r\n                if(xhr.readyState === 4){\r\n                    if (xhr.status >= 200 && xhr.status < 300) {\r\n                        let respone = xhr.responseText;\r\n                        let data = JSON.parse(respone);\r\n                     //   console.log(\"version=\", data, data.version);\r\n                        resolve(data);\r\n                    }else{\r\n                        reject()\r\n                    }\r\n                }\r\n            };\r\n            xhr.timeout = 30000;\r\n           // console.log(\"getGameVersion wholeurl=\", wholeurl);\r\n            xhr.open(\"GET\", wholeurl, true);\r\n            xhr.ontimeout = ()=>{reject()}\r\n            xhr.send();\r\n        })\r\n    };\r\n    /**\r\n     * \r\n     * @param gameid ID\r\n     * @param version 版本\r\n     * @param hotUpdateUrl 热更url\r\n     * @param context 本地url\r\n     * @param nativeManifestFilePath 随包资源url\r\n     * @param isHall 是否大厅\r\n     */\r\n    getManifestObj(hotUpdateUrl: string, context:string,) {\r\n        let HotUpdateManager = Global.HotUpdateManager;\r\n        if (hotUpdateUrl == null || hotUpdateUrl == undefined || hotUpdateUrl == \"\") {\r\n            hotUpdateUrl = HotUpdateManager.hotUpdateUrl\r\n        }\r\n        hotUpdateUrl = Global.Toolkit.adjustUrl(hotUpdateUrl)\r\n        let jsonAssets = {}\r\n        let jasonVersion = \"0.0.0\";\r\n\r\n        let nativeMaifest = context +\"/\"+ this.projectCfgFileName\r\n        let isNativeManifestExist = jsb.fileUtils.isFileExist(nativeMaifest)\r\n\r\n        // Logger.error(\"nativeMaifest--------------\",nativeMaifest)\r\n        if (isNativeManifestExist) {\r\n            let jsonStr = jsb.fileUtils.getStringFromFile(nativeMaifest) //new 标志新热更\r\n            let jsonData = JSON.parse(jsonStr)\r\n            if (jsonData.assets && jsonData.new) {\r\n                jsonAssets = jsonData.assets\r\n            }\r\n            if(jsonData.assets){\r\n                jasonVersion = jsonData.version\r\n            }\r\n        }\r\n       // Logger.error(\"projectpath=========\",ProjectFilePath)\r\n        //Logger.log(\"changeManifestUrl hotUpdateUrl = \" + hotUpdateUrl)\r\n        let localManifestJsonObj = {\r\n            \"packageUrl\": hotUpdateUrl,\r\n            \"remoteManifestUrl\": hotUpdateUrl + this.projectCfgFileName,\r\n            \"remoteVersionUrl\": hotUpdateUrl  + this.versionCfgFileName,\r\n            \"version\": jasonVersion,\r\n            \"assets\": jsonAssets,\r\n            \"searchPaths\": []\r\n        }\r\n      //  console.log(\"这是当前加载的本地配置文件\",JSON.stringify(localManifestJsonObj))\r\n       \r\n        return localManifestJsonObj\r\n\r\n    }\r\n\r\n    changeLocalUrl(url,param,context,fileName)\r\n    {\r\n        let fullLocalUrl = this.updateHelper.genStoragePath(context) + \"/\" +fileName\r\n        if(!jsb.fileUtils.isFileExist(fullLocalUrl))\r\n        {\r\n            Logger.error(\"找不到文件\", fullLocalUrl);\r\n            return;\r\n        }\r\n        let content = jsb.fileUtils.getStringFromFile(fullLocalUrl);\r\n        let tmpManifest = JSON.parse(content);\r\n        let index = tmpManifest.remoteManifestUrl.indexOf(param)\r\n        if(index != -1)\r\n        {\r\n            tmpManifest.remoteManifestUrl = url + tmpManifest.remoteManifestUrl.substring(index -1,tmpManifest.remoteManifestUrl.length)\r\n            tmpManifest.packageUrl = url + tmpManifest.packageUrl.substring(index -1,tmpManifest.remoteManifestUrl.length);\r\n            tmpManifest.remoteVersionUrl = url + tmpManifest.remoteVersionUrl.substring(index -1,tmpManifest.remoteManifestUrl.length)\r\n        }\r\n        let newTmpContent = JSON.stringify(tmpManifest);\r\n        jsb.fileUtils.writeStringToFile(newTmpContent, fullLocalUrl);\r\n\r\n    }\r\n\r\n    updateNativeHotUpdateVersion(gameid, version) {\r\n        if (this.nativeVersions) {\r\n            this.nativeVersions[gameid] = version;\r\n        }\r\n        let gameInfo = Global.GameData.getGameInfo(gameid)\r\n        if (gameInfo) {\r\n            gameInfo.native_version = version;\r\n        }\r\n\r\n    }\r\n\r\n\r\n    getNativeVersionFileUrl(gameid,newVersion)\r\n    {\r\n        if(!newVersion) return\r\n       return Global.HotUpdateManager.getNativeHotUpdatePath(gameid)  + \"/\"+ newVersion + \".manifest\"\r\n    }\r\n\r\n    //删除热更目录\r\n    removeNativeHotUpdateDir(gameid) {\r\n        let gamePath = this.getNativeHotUpdatePath(gameid)\r\n        jsb.fileUtils.removeDirectory(gamePath)\r\n        if (gameid == \"hall\"){\r\n            Global.NativeEvent.unzipHallPackage(); \r\n        }\r\n    }\r\n\r\n    /**\r\n     * 添加热更组件\r\n     * @param gameid 游戏id\r\n     * @param gameVersion 目标版本\r\n     * @param gameUpdateUrl 热更url\r\n     * @param isBack 是否回退\r\n     * @param state 热更状态 初始 -1000 -1 没下载过 0 下载成功并且版本是最新  1下载成功，版本不是最新 2下载中 3等待下载   4下载失败\r\n     * @param startVer 初始版本\r\n     * @param priority \r\n     */\r\n    addHotUpdateGameComp(gameid, gameVersion, gameUpdateUrl,remoteVer,priority = false) {\r\n        let hotUpdateComponent = new GameHotUpdateComponent();\r\n        hotUpdateComponent.initCheckUpDate(gameid, gameVersion, gameUpdateUrl,remoteVer)\r\n        let autoFlag = this.getAutoInlist()\r\n        let insertIndex = this.getIndex()\r\n        if(autoFlag && !priority) // 非自动下载的游戏优先级更高\r\n        {\r\n            if(insertIndex == -1)\r\n            {\r\n                if(this.checkIsGameDowning())\r\n                {\r\n                    this.gameHotUpdateList.splice(1,0,hotUpdateComponent)\r\n                }\r\n                else\r\n                {\r\n                    this.gameHotUpdateList.unshift(hotUpdateComponent)\r\n                }\r\n            }\r\n            else\r\n            {\r\n                this.gameHotUpdateList.splice(insertIndex+1,0,hotUpdateComponent)\r\n\r\n            }\r\n        }\r\n        else\r\n        {\r\n            this.gameHotUpdateList.push(hotUpdateComponent)\r\n        }\r\n        if (!this.checkIsGameDowning()) {\r\n            this.startHotUpdateGame()\r\n        }\r\n    }\r\n    //移除热更组件\r\n    removeGameComp(gameid) {\r\n        let gameHotUpdateComp = this.getHotUpdateGameComp(gameid);\r\n        this.gameHotUpdateList.splice(this.gameHotUpdateList.indexOf(gameHotUpdateComp),1);\r\n    }\r\n\r\n    /**\r\n     * 获取自动下载的索引\r\n     */\r\n    getIndex()\r\n    {\r\n        let index = -1;\r\n        let gidList = Global.GameData.autoDownList\r\n        for (let i = this.gameHotUpdateList.length-1; i >= 0; i--) {\r\n            let hotUpdateComponent = this.gameHotUpdateList[i]\r\n            if (gidList.indexOf(Number(hotUpdateComponent._gameType)) == -1) {\r\n                return i;\r\n            }\r\n        }\r\n        return index\r\n    }\r\n\r\n    /**\r\n     * 是否有自动下载\r\n     */\r\n    getAutoInlist()\r\n    {\r\n        let gidList = Global.GameData.autoDownList\r\n        for (let i = 0; i < this.gameHotUpdateList.length; i++) {\r\n            let hotUpdateComponent = this.gameHotUpdateList[i]\r\n            \r\n            if (gidList.indexOf(Number(hotUpdateComponent._gameType)) != -1) {\r\n                return true;\r\n            }\r\n        }\r\n        return false\r\n    }\r\n\r\n\r\n    //开始游戏下载\r\n    startHotUpdateGame() {\r\n        if (this.gameHotUpdateList) {\r\n            let hotUpdateComponent = this.gameHotUpdateList[0]\r\n            if (hotUpdateComponent) {\r\n                hotUpdateComponent.checkVersionUpdate();\r\n            }\r\n        }\r\n    }\r\n\r\n    //获取下载组件\r\n    getHotUpdateGameComp(gameid) {\r\n        let gameComp = null;\r\n        for (let i = 0; i < this.gameHotUpdateList.length; i++) {\r\n            let hotUpdateComponent = this.gameHotUpdateList[i]\r\n            if (hotUpdateComponent._gameType === gameid) {\r\n                gameComp = hotUpdateComponent;\r\n                break;\r\n            }\r\n        }\r\n        return gameComp;\r\n    }\r\n\r\n    //检查是否有游戏在下载\r\n    checkIsGameDowning() {\r\n        let isDowning = false\r\n        if (this.gameHotUpdateList) {\r\n            for (let i = 0; i < this.gameHotUpdateList.length; i++) {\r\n                let hotUpdateComponent = this.gameHotUpdateList[i]\r\n                if (hotUpdateComponent._updating) {\r\n                    isDowning = true;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        return isDowning;\r\n    }\r\n\r\n    //获取当前是哪个游戏在下载\r\n    getWhichGameIsDowning() {\r\n        let gid = null;\r\n        if (this.gameHotUpdateList) {\r\n            for (let i = 0; i < this.gameHotUpdateList.length; i++) {\r\n                let hotUpdateComponent = this.gameHotUpdateList[i]\r\n                if (hotUpdateComponent._updating) {\r\n                    gid = hotUpdateComponent._gameType;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        return gid;\r\n    }\r\n\r\n    //删除热更组件\r\n    removeHotUpdateGameComp(gameid, isStartNew: boolean = false) {\r\n        if (this.gameHotUpdateList) {\r\n            let index = -1;\r\n            for (let i = 0; i < this.gameHotUpdateList.length; i++) {\r\n                let hotUpdateComponent = this.gameHotUpdateList[i]\r\n                if (hotUpdateComponent._gameType === gameid) {\r\n                    index = i;\r\n                    break;\r\n                }\r\n            }\r\n            if (index != -1) {\r\n                let comp = this.gameHotUpdateList.splice(index, 1)\r\n                comp = null;\r\n            }\r\n            if (isStartNew) {\r\n                this.startHotUpdateGame();\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    changeManifestUrl(gameid: string, version: string, hotUpdateUrl: string, nativeManifestFilePath?: string, isBack = 0) {\r\n        let HotUpdateManager = Global.HotUpdateManager;\r\n        if (hotUpdateUrl == null || hotUpdateUrl == undefined || hotUpdateUrl == \"\") {\r\n            hotUpdateUrl = HotUpdateManager.hotUpdateUrl\r\n        }\r\n        let nativeFilePath = nativeManifestFilePath\r\n        if (!nativeFilePath) {\r\n            nativeFilePath = this.getNativeHotUpdatePath(gameid) + \"/\" + this.projectCfgFileName\r\n        } else {\r\n            let nativeMaifest = this.getNativeHotUpdatePath(gameid) + \"/\" + this.projectCfgFileName\r\n            let isNativeManifestExist = jsb.fileUtils.isFileExist(nativeMaifest)\r\n            let isNativeFileExit = jsb.fileUtils.isFileExist(nativeFilePath)\r\n            let nativeFileVersion = \"0.0.0\"\r\n            let nativeMaifestVersion = \"0.0.0\"\r\n\r\n            if (isNativeManifestExist) {\r\n                let jsonStr = jsb.fileUtils.getStringFromFile(nativeMaifest)\r\n                let jsonData = JSON.parse(jsonStr)\r\n                if (jsonData.version) {\r\n                    nativeMaifestVersion = jsonData.version\r\n                }\r\n            }\r\n            if (isNativeFileExit) {\r\n                let jsonStr = jsb.fileUtils.getStringFromFile(nativeFilePath)\r\n                let jsonData = JSON.parse(jsonStr)\r\n                if (jsonData.version) {\r\n                    nativeFileVersion = jsonData.version\r\n                }\r\n            }\r\n            if (Global.Toolkit.versionCompare(nativeMaifestVersion, nativeFileVersion) > 0) {\r\n                nativeFilePath = nativeMaifest\r\n            }\r\n        }\r\n        hotUpdateUrl = hotUpdateUrl + \"/\" + gameid + \"/\" + version\r\n        // Logger.log(\"changeManifestUrl hotUpdateUrl = \" + hotUpdateUrl)\r\n        let localManifestJsonObj = {\r\n            \"packageUrl\": hotUpdateUrl,\r\n            \"remoteManifestUrl\": hotUpdateUrl + \"/\" + HotUpdateManager.projectCfgFileName,\r\n            \"remoteVersionUrl\": hotUpdateUrl + \"/\" + HotUpdateManager.versionCfgFileName,\r\n            \"version\": \"0.0.1\",\r\n            \"assets\": {},\r\n            \"searchPaths\": []\r\n        }\r\n\r\n        let isExist = jsb.fileUtils.isFileExist(nativeFilePath)\r\n        if (isExist) {\r\n            let jsonStr = jsb.fileUtils.getStringFromFile(nativeFilePath)\r\n            if (jsonStr) {\r\n                // Logger.log(\"jsonStr =======\" + jsonStr)\r\n                let jsonData = JSON.parse(jsonStr)\r\n                let isMergeFile = true;\r\n                //回滚版本\r\n                if (isBack === 1) {\r\n                    if (Global.Toolkit.versionCompare(jsonData.version, version) > 0) {\r\n                        Logger.log(\"回滚游戏--- gameid \"+ gameid) \r\n                        //删除本地目录\r\n                        let dirPath = this.getNativeHotUpdatePath(gameid)\r\n                        if (jsb.fileUtils.isFileExist(dirPath)) {\r\n                            jsb.fileUtils.removeDirectory(dirPath)\r\n                            if (gameid == \"hall\"){\r\n                                Global.NativeEvent.unzipHallPackage();\r\n                            }\r\n                        }\r\n                        isMergeFile = false;\r\n                    }\r\n                }\r\n\r\n                if (isMergeFile && jsonData.packageUrl) {\r\n                    // Logger.log(\"native packageUrl = \" + jsonData.packageUrl)\r\n                    if (jsonData.packageUrl != hotUpdateUrl) {\r\n                        //修改地址\r\n                        localManifestJsonObj.packageUrl = hotUpdateUrl\r\n                        localManifestJsonObj.remoteManifestUrl = hotUpdateUrl + \"/\" + HotUpdateManager.projectCfgFileName\r\n                        localManifestJsonObj.remoteVersionUrl = hotUpdateUrl + \"/\" + HotUpdateManager.versionCfgFileName\r\n                        localManifestJsonObj.version = jsonData.version;\r\n                        localManifestJsonObj.assets = jsonData.assets;\r\n                        localManifestJsonObj.searchPaths = jsonData.searchPaths;\r\n                    } else {\r\n                        localManifestJsonObj = jsonData\r\n                    }\r\n                }\r\n            }\r\n        } else {\r\n            Logger.log(\"file not exist\")\r\n            localManifestJsonObj.packageUrl = hotUpdateUrl\r\n            localManifestJsonObj.remoteManifestUrl = hotUpdateUrl + \"/\" + HotUpdateManager.projectCfgFileName\r\n            localManifestJsonObj.remoteVersionUrl = hotUpdateUrl + \"/\" + HotUpdateManager.versionCfgFileName\r\n        }\r\n        return localManifestJsonObj\r\n\r\n    }\r\n\r\n    onClear() {\r\n\r\n    }\r\n    onDestroy() {\r\n\r\n    }\r\n\r\n\r\n}"]}