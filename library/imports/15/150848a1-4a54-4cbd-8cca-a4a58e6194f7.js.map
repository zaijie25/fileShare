{"version":3,"sources":["assets\\hall\\scripts\\logic\\hall\\ui\\recharge\\ScanCodeView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import ViewBase from \"../../../core/ui/ViewBase\";\r\nimport AppHelper from \"../../../core/tool/AppHelper\";\r\nimport CaptureTool from \"../Spread/CaptureTool\";\r\nimport { CustomerEntranceType } from \"../../../hallcommon/model/ServicerModel\";\r\n\r\nexport default class ScanCodeView extends ViewBase{\r\n    private qrNode:cc.Sprite\r\n    private timerLabel:cc.RichText\r\n    private moneyLabel:cc.Label\r\n    private CaptureTool:CaptureTool\r\n    private timeID = null;\r\n    private intervalTime = 180\r\n    private checkInerval = 1000\r\n\r\n    public amount = \"\"\r\n\r\n    public data = null\r\n\r\n    private formastr = \"<color=#CCE198>付款倒计时</c><color=#FFF100>%s</color><color=#CCE198>秒</c>\"\r\n\r\n    protected initView()\r\n    {\r\n        this.qrNode = this.getComponent(\"sewm_t/qrnode\",cc.Sprite)\r\n        this.timerLabel = this.getComponent(\"sewm_t/countDown\",cc.RichText)\r\n        this.timerLabel.string = \"\"\r\n        this.moneyLabel = this.getComponent(\"sewm_t/money\",cc.Label)\r\n        this.moneyLabel.string = \"\"\r\n        this.CaptureTool = this.getComponent(\"sewm_t\",CaptureTool)\r\n        this.addCommonClick(\"buttonGroup/saveToAlbum\",this.onSavePicBtnClicked,this)\r\n        this.addCommonClick(\"buttonGroup/openAli\",this.onOpenAliBtnClicked,this)\r\n        this.addCommonClick(\"buttonGroup/uploadBtn\",this.onUploadBtnClicked,this)\r\n\r\n\r\n    }\r\n\r\n    initQrcode(url:string)\r\n    {\r\n        let self = this\r\n        Global.Event.event(GlobalEvent.SHOW_NET_WAITING,\"initQrcode\")\r\n        cc.loader.load(url, function (err, texture:cc.Texture2D) {\r\n            Global.Event.event(GlobalEvent.HIDE_NET_WAITING,\"initQrcode\")\r\n            if(err)\r\n            {\r\n                Global.UI.fastTip(\"拉取付款码失败\")\r\n                return\r\n            }\r\n            if(cc.isValid(self.qrNode.node))\r\n            {\r\n                var frame = new cc.SpriteFrame(texture);\r\n                self.qrNode.spriteFrame = frame\r\n                self.startTimer()\r\n            }\r\n        })\r\n    }\r\n    onSavePicBtnClicked() {\r\n            let orderId = this.data.order_no\r\n            let filePath = jsb.fileUtils.getWritablePath() + Global.Toolkit.md5(orderId) + '_capImage.png';\r\n            let callback = () => {\r\n                Global.NativeEvent.saveToAlbum(filePath, () => {\r\n                    //Global.UI.fastTip(\"保存相册成功\")\r\n                    Logger.log(\"保存相册成功\")\r\n                })\r\n            }\r\n            if(this.CaptureTool)\r\n            {\r\n                this.CaptureTool.BeginCapture(orderId, callback,false)\r\n            }\r\n    }\r\n\r\n    onOpenAliBtnClicked() {\r\n         if (AppHelper.enableAliPaySDK) {\r\n            // 类型为支付宝支付时调用原生支付包支付\r\n            Global.NativeEvent.checkAliPayInstalled((retObj) => {\r\n                if (retObj.result == 0) {\r\n                    Logger.error(\"AliPayInstalled true\")\r\n                   Global.NativeEvent.awakeALiPayApp();\r\n                } \r\n                else if(retObj.result == -1){\r\n                    Global.UI.showSingleBox(\"请先安装支付宝\", null);\r\n                }\r\n            })\r\n        }\r\n        \r\n    }\r\n    onUploadBtnClicked() {\r\n        let model =  Global.ModelManager.getModel(\"ServicerModel\")\r\n        if(model)\r\n        {\r\n            model.enterCustomerService(CustomerEntranceType.HallService);\r\n        }\r\n    }\r\n\r\n    protected onSubViewShow()\r\n    {\r\n        this.reset()\r\n        if(!this.data)\r\n        {\r\n            return\r\n        }\r\n        try {\r\n            let content = JSON.parse(this.data.url)\r\n            this.initQrcode(content.url)\r\n            let money = content.amount / 100\r\n            this.moneyLabel.string = money.toString()\r\n\r\n        } catch (error) {\r\n            Global.UI.fastTip(\"解析订单失败，请重试！\")\r\n        }\r\n       \r\n    }\r\n    reset()\r\n    {\r\n        this.moneyLabel.string = \"\"\r\n        this.intervalTime = 180\r\n        this.qrNode.spriteFrame = null\r\n        if(this.timeID)\r\n        {\r\n            clearInterval(this.timeID)\r\n        }\r\n    }\r\n\r\n    startTimer()\r\n    {\r\n        if(this.timeID)\r\n        {\r\n            clearInterval(this.timeID)\r\n        }\r\n        this.timerLabel.string = cc.js.formatStr(this.formastr,this.intervalTime)\r\n        this.timeID = setInterval(()=>{\r\n            this.intervalTime -= 1\r\n            this.timerLabel.string = cc.js.formatStr(this.formastr,this.intervalTime)\r\n            if(this.intervalTime == 0)\r\n            {\r\n                this.node.active = false\r\n            }\r\n        },this.checkInerval)\r\n    }\r\n    protected onSubViewHide()\r\n    {\r\n        this.data = null\r\n        this.amount = \"\"\r\n        this.node.active = false\r\n        if(this.timeID)\r\n        {\r\n            clearInterval(this.timeID)\r\n        }\r\n    }\r\n    protected onDispose()\r\n    {\r\n        this.amount = \"\"\r\n        this.data = null\r\n        if(this.timeID)\r\n        {\r\n            clearInterval(this.timeID)\r\n        }\r\n    }\r\n}\r\n"]}