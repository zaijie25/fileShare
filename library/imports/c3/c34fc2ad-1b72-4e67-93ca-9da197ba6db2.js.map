{"version":3,"sources":["assets\\ermj\\Ermj\\scripts\\subView\\mahjong\\ErmjMahjongOperView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import ErmjBaseView from \"../ErmjBaseView\";\r\nimport ErmjMahjongOutView from \"./ErmjMahjongOutView\";\r\nimport ErmjMjStyleHelper from \"../../tool/ErmjMjStyleHelper\";\r\n\r\nexport enum OperState{\r\n    Chow = 1,\r\n    Pong,\r\n    Kong,\r\n    DarkKong,\r\n}\r\n\r\nexport default class ErmjMahjongOperView extends ErmjBaseView{\r\n    /** 四个麻将子, 第4个是上方那个用于杠 */\r\n    private mjOutItemList: ErmjMahjongOutView[] = [];\r\n    public state: OperState;\r\n    public value: number;       // 吃取最小的值\r\n\r\n    constructor(node: cc.Node, private nRelative: number){\r\n        super();\r\n        this.setNode(node);\r\n    }\r\n\r\n    protected initView(){\r\n        for(let i=0; i< 4; i++){\r\n            let node = this.getChild(\"mahjongOutView\" + i.toString());          // 直接摆在预设上, 后续无须设置setSiblingIndex\r\n            let view = new ErmjMahjongOutView(node);\r\n            view.active = false;\r\n            this.mjOutItemList.push(view);\r\n        }\r\n    }\r\n\r\n    /** 吃  presArr透视配置 */\r\n    public setChowStyle(valueArr: number[], chowCard: number, perspArr: number[]){\r\n        this.state = OperState.Chow;\r\n        let [temp] = valueArr;\r\n        let startPos = cc.Vec3.ZERO;\r\n        let total = perspArr.length;\r\n        for(let i = 0; i < this.mjOutItemList.length; i++){\r\n            let value = valueArr[i];\r\n            let mjItem = this.mjOutItemList[i];\r\n            if (value){\r\n                mjItem.active = true;\r\n                mjItem.mahjongValue = value;\r\n                mjItem.isFront = true;\r\n                mjItem.setSpecialColor(chowCard == value);\r\n\r\n                let nPersp = perspArr[total - i - 1] || 0;\r\n                let {cfg, dir} = ErmjMjStyleHelper.getPerspectiveCfg(nPersp);\r\n                mjItem.setPerspStyle(nPersp, this.nRelative);\r\n                mjItem.node.setPosition(startPos);\r\n                \r\n                let offsetX = dir > 0 ? cfg.devSpaceX : cfg.negDevSpaceX;\r\n                let spaceX = this.nRelative == 0 ? offsetX : -offsetX;\r\n                startPos = startPos.add(cc.v3(spaceX, 0));\r\n            }\r\n            else{\r\n                mjItem.active = false;\r\n            }\r\n            if (value < temp)\r\n                temp = value;\r\n        }\r\n        this.value = temp;      // 找最小的\r\n    }\r\n\r\n    /** 碰 */\r\n    public setPongStyle(valueArr: number[], perspArr: number[]){\r\n        this.state = OperState.Pong;\r\n        let startPos = cc.Vec3.ZERO;\r\n        let centerIndex = 1;\r\n        let total = perspArr.length;\r\n        for(let i = 0; i < this.mjOutItemList.length; i++){\r\n            let value = valueArr[i];\r\n            let mjItem = this.mjOutItemList[i];\r\n            if (value){\r\n                mjItem.active = true;\r\n                mjItem.mahjongValue = value;\r\n                mjItem.isFront = true;\r\n                mjItem.setSpecialColor(i == centerIndex);     // 中间那张\r\n\r\n                let nPersp = perspArr[total - i - 1] || 0;      // 顺序和perspArr倒序\r\n                let {cfg, dir} = ErmjMjStyleHelper.getPerspectiveCfg(nPersp);\r\n                mjItem.setPerspStyle(nPersp, this.nRelative);\r\n                mjItem.node.setPosition(startPos);\r\n                \r\n                let offsetX = dir > 0 ? cfg.devSpaceX : cfg.negDevSpaceX;\r\n                let spaceX = this.nRelative == 0 ? offsetX : -offsetX;\r\n                startPos = startPos.add(cc.v3(spaceX, 0));\r\n            }\r\n            else{\r\n                mjItem.active = false;\r\n            }\r\n        }\r\n        [this.value] = valueArr;\r\n    }\r\n    \r\n    /**\r\n     * 杠\r\n     * @param valueArr 牌值数组 别人暗杠[]\r\n     * @param isVisible true明杠 false暗杠\r\n     * @param isOneSeen 是否3暗+1明\r\n     * @param perspArr 透视配置列表 只有三个 杠牌取中间向上偏移\r\n     */\r\n    public setKongStyle(valueArr: number[], isVisible: boolean, isOneSeen: boolean, perspArr: number[]){\r\n        if (isVisible){\r\n            this.state = OperState.Kong;\r\n            [this.value] = valueArr;\r\n        }\r\n        else\r\n            this.state = OperState.DarkKong;\r\n        let startPos = cc.Vec3.ZERO;\r\n        let fourthPos = cc.Vec3.ZERO;\r\n        let centerIndex = 1;\r\n        let total = perspArr.length;\r\n        for(let i = 0; i < this.mjOutItemList.length; i++){\r\n            let value = valueArr[i];\r\n            let mjItem = this.mjOutItemList[i];\r\n            if (isVisible && value){\r\n                mjItem.active = true;\r\n                mjItem.mahjongValue = value;\r\n                mjItem.isFront = true;\r\n                mjItem.setSpecialColor(i == this.mjOutItemList.length -1);     // 上面那张 暗杠不显示\r\n            }\r\n            else{\r\n                mjItem.active = true;\r\n                if (isOneSeen && i == this.mjOutItemList.length -1){       // 看自己暗杠 下三张暗 上面明的\r\n                    mjItem.isFront = true;\r\n                    mjItem.mahjongValue = value;\r\n                    mjItem.setSpecialColor(false);\r\n                }\r\n                else{\r\n                    mjItem.isFront = false;\r\n                }\r\n            }\r\n            \r\n            if(i == this.mjOutItemList.length - 1){\r\n                let nPersp = perspArr[centerIndex] || 0;\r\n                mjItem.setPerspStyle(nPersp, this.nRelative);\r\n                mjItem.node.setPosition(fourthPos);\r\n            }\r\n            else{\r\n                let nPersp = perspArr[total - i - 1] || 0;\r\n                let {cfg, dir} = ErmjMjStyleHelper.getPerspectiveCfg(nPersp);\r\n                mjItem.setPerspStyle(nPersp, this.nRelative);\r\n                mjItem.node.setPosition(startPos);\r\n                if(i == centerIndex){\r\n                    fourthPos = cc.v3(startPos.x, startPos.y + this.Define.operMjKongOffsetY)\r\n                }\r\n                let offsetX = dir > 0 ? cfg.devSpaceX : cfg.negDevSpaceX;\r\n                let spaceX = this.nRelative == 0 ? offsetX : -offsetX;\r\n                startPos = startPos.add(cc.v3(spaceX, 0));\r\n            }\r\n        }\r\n    }\r\n\r\n    /** 被抢杠胡了 降级为碰 */\r\n    public beKongRobbed(){\r\n        this.mjOutItemList[this.mjOutItemList.length - 1].active = false;\r\n        this.mjOutItemList[this.mjOutItemList.length - 3].setSpecialColor(true);\r\n        this.state = OperState.Pong;\r\n    }\r\n\r\n    public checkPongValid(){\r\n        return this.state == OperState.Pong && this.value > 0;\r\n    }\r\n\r\n    public checkKongValid(){\r\n        return this.state == OperState.Kong && this.value > 0;\r\n    }\r\n\r\n    public checkDarkKongValid(){\r\n        return this.state == OperState.DarkKong;\r\n    }\r\n\r\n    protected onClose(){\r\n        this.state = -1;\r\n        this.value = 0;\r\n        this.mjOutItemList.forEach(item=>{\r\n            item.active = false;\r\n        })\r\n    }\r\n}"]}