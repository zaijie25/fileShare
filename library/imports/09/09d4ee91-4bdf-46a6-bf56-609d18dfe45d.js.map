{"version":3,"sources":["assets\\ddz\\ddz\\scripts\\component\\DdzLoadingUI.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import DdzMainUI from \"../panel/DdzMainUI\";\r\nimport DdzPathHelper from \"../data/DdzPathHelper\";\r\nimport DdzGameConst from \"../data/DdzGameConst\";\r\nimport DdzDriver from \"../DdzDriver\";\r\nimport DdzSkinDefine from \"../data/DdzSkinDefine\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class DdzLoadingUI extends cc.Component{\r\n    private dependAtlas = [\r\n        // atlas\r\n        DdzPathHelper.gameTexturePath + \"atlas/pokers/pokers\",\r\n        DdzPathHelper.gameTexturePath + \"atlas/frame/atlas_frame\",\r\n    ];\r\n    private dependceArr = [\r\n        DdzPathHelper.gameTexturePath + \"atlas/frame/font/num_jia\",\r\n        DdzPathHelper.gameTexturePath + \"atlas/frame/font/num_fu\",\r\n        // ui\r\n        DdzPathHelper.gamePrefabsPath + \"panel/ddzGameUI\",\r\n    ];\r\n    private dependceArr2 = [\r\n        DdzPathHelper.gamePrefabsPath + \"panel/subView/actRootView\",\r\n        DdzPathHelper.gamePrefabsPath + \"panel/subView/pokerPreNode\",\r\n        DdzPathHelper.gamePrefabsPath + \"panel/subView/pokerView\",\r\n        DdzPathHelper.gamePrefabsPath + \"panel/subView/matchPlayerView\",\r\n        DdzPathHelper.gamePrefabsPath + \"panel/subView/playerView\",\r\n        DdzPathHelper.gamePrefabsPath + \"panel/subView/settleView\",\r\n    ]\r\n    private dependAudio = [\r\n        DdzPathHelper.gameAudioPath + \"common/chuntian\",\r\n        DdzPathHelper.gameAudioPath + \"common/losegame\",\r\n        DdzPathHelper.gameAudioPath + \"common/wingame\",\r\n        DdzPathHelper.gameAudioPath + \"common/play_farmer_win\",\r\n        DdzPathHelper.gameAudioPath + \"common/play_lord_win\",\r\n        DdzPathHelper.gameAudioPath + \"common/dispatch\",\r\n        DdzPathHelper.gameAudioPath + \"common/sendcard\",\r\n        DdzPathHelper.gameAudioPath + \"common/common_alert\",\r\n        DdzPathHelper.gameAudioPath + \"cardType/huojian\",\r\n        DdzPathHelper.gameAudioPath + \"cardType/common_bomb\",\r\n        DdzPathHelper.gameAudioPath + \"cardType/common_plane\",\r\n        DdzPathHelper.gameAudioPath + \"cardType/liandui\",\r\n        DdzPathHelper.gameAudioPath + \"cardType/shunzi\",\r\n        DdzPathHelper.gameAudioPath + \"background\",\r\n        DdzPathHelper.gameAudioPath + \"afterboom\",\r\n    ];\r\n\r\n    private loadingContent: cc.Node;\r\n\r\n    onLoad(){\r\n        this.loadingContent = cc.find(\"content\", this.node);\r\n        this.loadingContent.active = false;\r\n    }\r\n\r\n    protected start(){\r\n        this.initLoading();\r\n        this.preloadRes();\r\n    }\r\n\r\n    private async initLoading(){\r\n        if (!Global.GameData.checkHasCustomLoading(DdzGameConst.Gid)){\r\n            let comp = await Global.UIHelper.getGameLoadingComp();\r\n            this.loadingContent.active = false;\r\n            comp.node.setParent(this.node);\r\n            comp.node.active = true;\r\n        }\r\n        else{\r\n            this.loadingContent.active = true;\r\n        }\r\n    }\r\n\r\n    private async preloadRes(){\r\n        let loadSkinJson = ()=>{\r\n            return new Promise((resolve, reject)=>{\r\n                Global.ResourceManager.loadGameBundleRes(DdzSkinDefine.jsonPath, (err, res)=>{\r\n                    if (err)\r\n                        reject(err);\r\n                    else{\r\n                        DdzDriver.instance.skinDefine = new DdzSkinDefine(res.json);\r\n                        resolve(res);\r\n                    }\r\n                }, cc.JsonAsset);\r\n            })\r\n        }\r\n        let loadAtlas = ()=>{\r\n            return new Promise((resolve, reject)=>{\r\n                Global.ResourceManager.loadGameBundleRes(this.dependAtlas, (err, res)=>{\r\n                    if (err){\r\n                        reject(err);\r\n                    }\r\n                    else{\r\n                        resolve(res);\r\n                    }\r\n                }, cc.SpriteAtlas);\r\n            })\r\n        }\r\n        let loadPrefab = ()=>{\r\n            return new Promise((resolve, reject)=>{\r\n                Global.ResourceManager.loadGameBundleRes(this.dependceArr, (err, res)=>{\r\n                    if (err){\r\n                        reject(err);\r\n                    }\r\n                    else{\r\n                        resolve(res);\r\n                    }\r\n                });\r\n            });\r\n        }\r\n        let loadPrefab2 = ()=>{\r\n            return new Promise((resolve, reject)=>{\r\n                Global.ResourceManager.loadGameBundleRes(this.dependceArr2, (err, res)=>{\r\n                    if (err){\r\n                        reject(err);\r\n                    }\r\n                    else{\r\n                        resolve(res);\r\n                    }\r\n                });\r\n            });\r\n        }\r\n        let loadAudio = ()=>{\r\n            return new Promise((resolve, reject)=>{\r\n                Global.ResourceManager.loadGameBundleRes(this.dependAudio, (err, res)=>{\r\n                    if (err){\r\n                        reject(err);\r\n                    }\r\n                    else{\r\n                        // 多个音效同时加载播放或者音效加载时间过长 会导致动画卡顿 预加载解决\r\n                        res.forEach(r=>{\r\n                            cc.loader.loadRes(r.nativeUrl, cc.AudioClip);\r\n                        });\r\n                        resolve(res);\r\n                    }\r\n                }, cc.AudioClip);\r\n            });\r\n        }\r\n        \r\n        await HeadTipsManager.preloadRes();\r\n        await TaskManager.preloadRes();\r\n        await loadSkinJson();\r\n        await loadAtlas();\r\n        await loadPrefab();\r\n        await loadPrefab2();\r\n        await loadAudio();\r\n\r\n        if (!cc.isValid(this.node)){\r\n            return;\r\n        }\r\n        this.initUI();\r\n        Game.Component.scheduleOnce(()=>{\r\n            DdzDriver.instance.startScene();\r\n        }, 0.5);\r\n    }\r\n\r\n    private initUI(){\r\n        let CanvasNode = cc.Canvas.instance.node;\r\n        let mainLayer:cc.Node = Global.UI.getLayer(\"MainLayer\") || CanvasNode;\r\n\r\n        let fullScreenLayer:cc.Node = Global.UI.getLayer(\"FullScreenLayer\") || CanvasNode;\r\n        let popLayer:cc.Node = Global.UI.getLayer(\"PopLayer\") || CanvasNode;\r\n        let mainUI = this.getUINode(DdzPathHelper.gamePrefabsPath + \"panel/ddzGameUI\");\r\n        DdzDriver.instance.mainUI = mainUI.getComponent(DdzMainUI);\r\n        fullScreenLayer.addChild(mainUI);   // 放到同一层次，方便进入场动画\r\n        mainUI.active = false;\r\n    }\r\n\r\n    private getUINode(path){\r\n        let prefab = Global.ResourceManager.getGameBundleRes(path, cc.Prefab);\r\n        if(prefab == null)\r\n        {\r\n            Logger.error(\"获取预设失败\", path);\r\n            return null;\r\n        }\r\n        return cc.instantiate(prefab);\r\n    }\r\n}"]}