{"version":3,"sources":["assets\\hall\\scripts\\logic\\hall\\ui\\hall\\PaoMaDengBaseView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import GlobalEvent from \"../../../core/GlobalEvent\";\r\nimport ViewBase from \"../../../core/ui/ViewBase\";\r\n\r\nexport default class PaoMaDengBaseView extends ViewBase {\r\n\r\n    private listNode : cc.Node;\r\n    private itemPrefab: cc.Node = null;\r\n    private itemList : Array<cc.RichText> = new Array();\r\n    private itemPool : Array<cc.RichText> = new Array();\r\n    private showCountLimit = 4;\r\n    private curShowCount = 0;\r\n\r\n    private getItem(){\r\n        var item = null;\r\n        if(this.itemPool.length > 0){\r\n            item = this.itemPool.pop();\r\n            item.node.setSiblingIndex(-1);\r\n\r\n        }else{\r\n            var itemObj = cc.instantiate(this.itemPrefab);\r\n            item = itemObj.getComponent(cc.RichText);\r\n            item.node.setParent(this.listNode);\r\n        }\r\n        item.node.active = true;\r\n        item.node.x = 0;\r\n        this.itemList.push(item);\r\n        return item;\r\n    }\r\n\r\n    private recoveryItem( reitem : cc.RichText ){\r\n        for (let index = 0; index < this.itemList.length; index++) {\r\n            const item = this.itemList[index];\r\n            if(item == reitem){\r\n                item.string = \"\";\r\n                item.node.active = false;\r\n                item.node.stopAllActions();\r\n                this.itemPool.push(item);\r\n                this.itemList.splice(index,1);\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    private clearRecord(){\r\n        for (let index = 0; index < this.itemList.length; index++) {\r\n            const item = this.itemList[index];\r\n            item.string = \"\";\r\n            item.node.active = false;\r\n            item.node.stopAllActions();\r\n            this.itemPool.push(item);\r\n        }\r\n        this.itemList = [];\r\n    }\r\n\r\n    //轮询Timer\r\n    private checkTimer = null;\r\n\r\n    //最后显示的消息Item\r\n    private lastMsgItem : cc.RichText = null;\r\n\r\n    //消息缓存队列\r\n    private msgDataCacheList = [];\r\n    //消息队列缓存长度限制\r\n    private listLengthLimit = 8;\r\n\r\n    //跑马灯基础路程长度\r\n    private boxLength = 590;\r\n    //跑马灯默认路程花费时间\r\n    private baseTime = 3;\r\n    //跑马灯速度\r\n    private baseSpeed = 1;\r\n\r\n    protected initView()\r\n    {\r\n        this.listNode = this.getChild(\"MsgBox\");\r\n        this.itemPrefab = this.getChild(\"MsgBox/PMDMsgItem\");\r\n        this.boxLength = this.listNode.width;\r\n        this.baseSpeed = this.boxLength / this.baseTime;\r\n    }\r\n\r\n    protected onSubViewShow(){\r\n        this.startTimer();\r\n    }\r\n\r\n    protected onSubViewHide(){\r\n        this.stopTimer();\r\n        this.clearRecord();\r\n    }\r\n\r\n    //界面销毁\r\n    protected onDispose()\r\n    {\r\n        this.stopTimer();\r\n    }\r\n\r\n    protected startTimer(){\r\n        if(this.checkTimer == null){\r\n            this.checkTimer = setInterval(this.checkMsgList.bind(this),100);\r\n        }\r\n    }\r\n\r\n    protected stopTimer(){\r\n        if(this.checkTimer){\r\n            clearInterval(this.checkTimer);\r\n            this.checkTimer = null;\r\n        }\r\n    }\r\n\r\n    private playAnim(item : cc.RichText ){\r\n        var moveds = item.node.x + item.node.width + this.boxLength;\r\n        var moveTime = moveds / this.baseSpeed;\r\n        var mv = cc.moveTo(moveTime , -(item.node.width + this.boxLength) , 0);\r\n        var mvover = cc.callFunc(function(){\r\n            this.recoveryItem(item);\r\n            this.curShowCount--;\r\n        },this);\r\n        item.node.runAction(cc.sequence(mv,mvover));\r\n        this.curShowCount++;\r\n    }\r\n\r\n    /**\r\n     * data ={  game_id: 1007\r\n                game_level: \"l0\"\r\n                game_rule: \"default\"\r\n                headimg: \"7\"\r\n                hitPoint: 5434000\r\n                nickname: \"鱼一直下\"\r\n        }\r\n     */\r\n    private checkMsgList(){\r\n        try {\r\n            if(this.node == null || !this.node.isValid)\r\n                return;\r\n            if(this.msgDataCacheList.length == 0 || this.curShowCount >= this.showCountLimit) return;\r\n            var data = this.msgDataCacheList.shift();\r\n    \r\n            var startX = 0;\r\n            if(this.lastMsgItem != null ){ //\r\n                startX = this.lastMsgItem.node.x + this.lastMsgItem.node.width + 100;\r\n                startX = Math.max(0,startX);\r\n            }\r\n\r\n            //拼接跑马灯文字\r\n            var formatStr = \"<color=#ffffff>鸿运当头，恭喜玩家</color>\"+\r\n            \"<color=#00ff00>%s,</color>\" +\r\n            \"<color=#ffffff>在</color><color=#00d2ff>%s</color>\" +\r\n            \"<color=#ffffff>中赢得</color>\" +\r\n            \"<color=#fff100>%s</color><color=#ffffff>元</color>\";\r\n            var msgStr = \"\";\r\n            if(data.nickname != null){\r\n                msgStr = cc.js.formatStr(formatStr,data.nickname,data.game_id,Global.Toolkit.GetMoneyFormat(data.hitPoint));\r\n            }else{\r\n                msgStr = data.msg;\r\n            }\r\n            //\r\n            this.lastMsgItem = this.getItem();\r\n            this.lastMsgItem.string = msgStr;\r\n            this.lastMsgItem.node.x = startX;\r\n            this.playAnim(this.lastMsgItem);\r\n        } catch (error) {\r\n            this.stopTimer();\r\n            Logger.error(error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 排序方法,子类可重写\r\n     * @param dataA \r\n     * @param dataB \r\n     */\r\n    protected dataSortFunc( dataA : any , dataB : any ){\r\n        return dataA.type - dataB.type;\r\n    }\r\n\r\n    /**\r\n     * 添加跑马灯数据\r\n     * @param data {\r\n            msg,\r\n            type,\r\n     * }\r\n     */\r\n    protected addMsgItem( data : any ){\r\n        this.msgDataCacheList.push(data);\r\n        while (this.msgDataCacheList.length > this.listLengthLimit) {\r\n            this.msgDataCacheList.shift()\r\n        }\r\n        this.msgDataCacheList.sort(this.dataSortFunc);\r\n        this.startTimer();\r\n    }\r\n    \r\n}\r\n"]}