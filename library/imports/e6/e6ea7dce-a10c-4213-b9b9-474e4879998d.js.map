{"version":3,"sources":["assets\\ddz\\ddz\\scripts\\component\\DdzAskClockView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import DdzBaseComponent from \"./DdzBaseComponent\";\r\n\r\n/**\r\n * 出牌倒计时view\r\n */\r\nexport default class DdzAskClockView extends DdzBaseComponent{\r\n    private clockPro: cc.ProgressBar;\r\n    private clockLbl: cc.Label;\r\n\r\n    private timeEnd: number;\r\n    private secondCall: Function;\r\n    private target: any;\r\n    private timeLeft: number;\r\n    private timeTotal: number;\r\n    private running: boolean = false;\r\n    private isClockAudio = false;\r\n    \r\n    private checkIntervalFrame = 0;\r\n    private FrameInterval = 2;\r\n    \r\n    protected initView(){\r\n        this.clockPro = <cc.ProgressBar>this.getNodeComponent('clock', cc.ProgressBar);\r\n        this.clockLbl = <cc.Label>this.getNodeComponent('timeLbl', cc.Label);\r\n    }\r\n\r\n    public init(){\r\n        this.initView();\r\n    }\r\n\r\n    public set active(flag: boolean){\r\n        this.node.active = flag;\r\n    }\r\n\r\n    public setSecondCall(callback: Function, target: any){\r\n        this.secondCall = callback;\r\n        this.target = target;\r\n    }\r\n\r\n    /**\r\n     * 开始倒计时\r\n     * @param time 剩余时间 ms\r\n     * @param nTotal 总时间 ms\r\n     */\r\n    public startTimer(time: number, nTotal: number = 0){\r\n        this.stopTimer();\r\n        this.timeTotal = nTotal || time;\r\n        this.updateTimeLbl(Math.round(time / 1000));\r\n        this.timeEnd = time + Date.now();\r\n        this.checkIntervalFrame = 0;\r\n        this.running = true;\r\n    }\r\n\r\n    public stopTimer(){\r\n        this.timeEnd = 0;\r\n        this.timeLeft = -1;\r\n        this.timeTotal = 0;\r\n        this.running = false;\r\n        this.checkIntervalFrame = 0;\r\n    }\r\n\r\n    private updateTimeLbl(time: number){\r\n        this.clockLbl.string = String(time);\r\n    }\r\n\r\n    private onUpdateTimer(){\r\n        let timeLeft = Math.round((this.timeEnd - Date.now()) / 1000);\r\n        this.clockPro.progress = (this.timeEnd - Date.now()) / this.timeTotal;\r\n        if (timeLeft == this.timeLeft)\r\n            return;\r\n        this.timeLeft = timeLeft;\r\n\r\n        if (this.secondCall && this.target && this.isClockAudio){\r\n            this.secondCall.call(this.target, this.timeLeft);\r\n        }\r\n        \r\n        if (timeLeft >= 0){\r\n            this.updateTimeLbl(timeLeft);\r\n        }\r\n        else{\r\n            this.stopTimer();\r\n            this.node.active = false;\r\n        }\r\n    }\r\n\r\n    public setViewActive(isActive){\r\n        this.node.active = isActive;\r\n    }\r\n\r\n    public setClockAudioEnable(flag: boolean){\r\n        this.isClockAudio = flag;\r\n    }\r\n\r\n    public setClockPosition(worldPos){\r\n        let localPos = this.node.parent.convertToNodeSpaceAR(worldPos);\r\n        this.node.setPosition(localPos);\r\n    }\r\n\r\n    protected onDisable(){\r\n        this.clockPro.progress = 1;\r\n        this.stopTimer();\r\n        this.setClockAudioEnable(false);\r\n    }\r\n\r\n    protected onDestroy(){\r\n        this.stopTimer();\r\n    }\r\n\r\n    protected update(dt){\r\n        if(!this.running)\r\n            return;\r\n        this.checkIntervalFrame ++;\r\n        if(this.checkIntervalFrame >= this.FrameInterval){\r\n            this.checkIntervalFrame = 0;\r\n            this.onUpdateTimer();\r\n        }\r\n    }\r\n}"]}