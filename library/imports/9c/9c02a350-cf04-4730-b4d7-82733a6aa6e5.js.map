{"version":3,"sources":["assets\\ddz\\ddz\\scripts\\handlers\\DdzEasyHandlers.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import DdzBaseHandler from \"./DdzBaseHandler\";\r\nimport DdzDriver from \"../DdzDriver\";\r\n\r\n//游戏开始协议\r\nexport class DdzStartHandler extends DdzBaseHandler {\r\n    protected refreshData(msg) {\r\n        this.context.set(this.Define.FieldGameStart, true);\r\n    }\r\n\r\n    protected execute(msg) {\r\n        this.mainUI.showActionTimer(false);\r\n    }\r\n\r\n    protected executeSync(msg) {\r\n        this.mainUI.showActionTimer(false);\r\n    }\r\n}\r\n\r\n//游戏结束\r\nexport class DdzEndHandler extends DdzBaseHandler {\r\n    protected refreshData() {\r\n        //清理单局数据\r\n        this.context.clearByRound();\r\n    }\r\n\r\n    protected execute() {\r\n        this.mainUI.callAllPlayers('showPlayerNormalEffect');\r\n        Game.Tween.clear();\r\n        Game.Component.unscheduleAllCallbacks();\r\n        // this.mainUI.clearByRound();      // 放到手动操作那边清理\r\n    }\r\n}\r\n\r\n//等待下一局\r\nexport class DdzWaitHandler extends DdzBaseHandler {\r\n    protected execute(msg) {\r\n        if (msg._para.status == 1) {\r\n            Logger.log(\"结算中\");\r\n        }\r\n        else {\r\n            this.mainUI.showActionTimer(false);\r\n            this.mainUI.matchPlayerView.active = true;\r\n        }\r\n    }\r\n}\r\n\r\n//刷新玩家信息\r\nexport class DdzRefreshHandler extends DdzBaseHandler {\r\n    // \"_param\":{\r\n    //     \"_cmd\":\"refresh\",\r\n    //     \"_src\":\"p5\",\r\n    //     \"_para\":{\r\n    //         \"app_id\":12,\r\n    //         \"user_id\":680272,\r\n    //         \"nick_name\":\"贵宾680272\",\r\n    //         \"headimg\":\"5\",\r\n    //         \"point\":475,\r\n    //         \"user_type\":1,\r\n    //         \"register_ip\":\"192.168.1.224\",\r\n    //         \"os_type\":1,\r\n    //         \"itime\":1556027819,\r\n    //         \"last_login_time\":\"2019-04-30 23:55:55\"\r\n    //     }\r\n    // }\r\n    protected refreshData(msg) {\r\n        let src = msg._src\r\n        let localSeat = this.SitHelper.serverSToLocalN(src);\r\n        if (this.context.playerList[localSeat] == null)\r\n            return;\r\n        this.context.playerList[localSeat].refresh(msg._para);\r\n    }\r\n\r\n    protected execute(msg) {\r\n        let src = msg._src\r\n        let localSeat = this.SitHelper.serverSToLocalN(src);\r\n        if (this.context.playerList[localSeat] == null)\r\n            return;\r\n        this.mainUI.callPlayer(localSeat, \"setPlayerPoint\", this.context.playerList[localSeat].point);\r\n        if (localSeat == 0)\r\n            this.mainUI.selfInfoView.updateSelfPoint(this.context.playerList[localSeat].point);\r\n    }\r\n}\r\n\r\nexport class DdzOfflineHandler extends DdzBaseHandler {\r\n    protected execute(msg) {\r\n        let src = msg._src\r\n        let localSeat = this.SitHelper.serverSToLocalN(src);\r\n        Logger.log(localSeat, '------->offline');\r\n        // 重连需要补发状态，暂不处理离线\r\n    }\r\n}\r\n\r\nexport class DdzLeaveMatchHandler extends DdzBaseHandler {\r\n    protected execute(msg) {\r\n        this.mainUI.matchPlayerView.active = false;\r\n        if (this.context.isWaitMatch) {\r\n            this.context.isWaitMatch = false;\r\n            Global.UI.showYesNoBox('匹配超时，是否重新匹配？', () => {\r\n                Game.Control.trySendEnter({ \"_from\": \"jump\" });    // 断socket则不能用这个\r\n            }, () => {\r\n                Game.Server.send(this.Define.CmdLeave, { \"IsClose\": 1 });\r\n                DdzDriver.instance.leaveGame();\r\n            });\r\n        }\r\n    }\r\n}"]}