{"version":3,"sources":["assets\\hall\\scripts\\logic\\core\\ui\\PersistUIControl.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import WndBase from \"./WndBase\";\r\nimport { SceneType } from \"../scene/SceneManager\";\r\n\r\nexport class PersistUIControl\r\n{\r\n    //缓存到持久化节点的ui  每次只保留一个，选场或者大厅\r\n    public curPersistUI : WndBase\r\n\r\n    //选择需要放到持久化节点的UI\r\n    //优先筛选非MainUI界面    找不到就把大厅放到持久化节点\r\n    public selectPersistUI(windowMap :  { [key: string]: WndBase } )\r\n    {   \r\n        for(let key in windowMap){\r\n            let window = windowMap[key];\r\n            if(window.active == true  && window.layer != Global.UI.MainLayer)\r\n            {\r\n                if(this.curPersistUI == null)\r\n                    this.curPersistUI = window;\r\n                else\r\n                {\r\n                    Logger.error(\"同时显示多个持久化界面！！！！\", window.name)\r\n                }\r\n            }\r\n        }\r\n\r\n        if(this.curPersistUI == null)\r\n        {\r\n            let hall = Global.UI.getWindow(\"WndHall\")\r\n            if(hall && hall.putToPersistWhenVisible)\r\n                this.curPersistUI = Global.UI.getWindow(\"WndHall\");\r\n        }\r\n    }\r\n\r\n    public savePersistUI(windowMap :  { [key: string]: WndBase } )\r\n    {\r\n        this.selectPersistUI(windowMap)\r\n        if(this.curPersistUI != null)\r\n        {\r\n            Global.Persist.addUIToPersisitNode(this.curPersistUI.name, this.curPersistUI.node, true)\r\n        }\r\n    }\r\n\r\n\r\n    public removePersisUI(key)\r\n    {\r\n        if(this.curPersistUI == null)\r\n            return null;\r\n        if(this.curPersistUI.name == key && this.curPersistUI.node.isValid)\r\n        {\r\n            let node = this.curPersistUI.node\r\n            //父节点切换时，替换cleanup方法，防止动画被停止\r\n            let tmpCleanupFunc = node.cleanup;\r\n            node.cleanup = ()=>{}\r\n            Global.Persist.removeUIFromPersisitNode(this.curPersistUI.name);\r\n            node.cleanup = tmpCleanupFunc\r\n            this.curPersistUI.node.active = this.curPersistUI.active\r\n            this.curPersistUI = null\r\n            return node;\r\n        }\r\n        return null;\r\n    }\r\n\r\n\r\n    //是否是持久化UI\r\n    public isPersistUI(wndName:string){\r\n        if(this.curPersistUI == null)\r\n            return false;\r\n        return this.curPersistUI.name == wndName\r\n    }\r\n\r\n    public showPersistUI(){\r\n        if(this.curPersistUI == null)\r\n            return;\r\n        //这个时候实际还在游戏场景里，SceneType先切到hall  需要重构\r\n        if(Global.SceneManager.sceneType == SceneType.Hall)\r\n        {\r\n            this.curPersistUI.activeInPersistNode = true;\r\n        }\r\n    }\r\n\r\n\r\n    public closePersistUI()\r\n    {\r\n        if(this.curPersistUI == null)\r\n            return;\r\n        if(!Global.SceneManager.inGame())\r\n            return;\r\n        this.curPersistUI.activeInPersistNode = false;\r\n    }\r\n\r\n}"]}